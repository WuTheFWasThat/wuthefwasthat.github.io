{"version":3,"sources":["assets/ts/utils/browser.ts","shared/utils/errors.ts","shared/utils/logger.ts","assets/ts/modes.ts","assets/ts/register.ts","assets/ts/keyEmitter.ts","assets/ts/utils/eventEmitter.ts","assets/ts/keyDefinitions.ts","assets/ts/utils/queue.ts","assets/ts/keyBindings.ts","assets/ts/keyHandler.ts","assets/ts/keyMappings.ts","assets/ts/utils/functional.ts","assets/ts/themes.ts","assets/ts/datastore.ts","shared/data_backend.ts","assets/ts/data_backend/index.ts","assets/ts/utils/text.ts","assets/ts/plugins.ts","assets/ts/path.ts","assets/ts/document.ts","assets/ts/mutations.ts","assets/ts/cursor.ts","assets/ts/session.ts","assets/ts/definitions/motions.ts","assets/ts/configurations/vim.ts","assets/ts/constants.ts","assets/ts/definitions/basics.ts","assets/ts/definitions/history.ts","assets/ts/definitions/indent.ts","assets/ts/menu.ts","assets/ts/definitions/menu.tsx","plugins/easy_motion/index.tsx","assets/ts/utils/token_unfolder.ts","assets/ts/definitions/meta.ts","assets/ts/definitions/zoom.ts","plugins/html/index.tsx","plugins/latex/index.tsx","assets/ts/components/line.tsx","plugins/marks/index.tsx","plugins/time_tracking/index.tsx","plugins/text_formatting/index.tsx","plugins/todo/index.tsx","plugins/recursive_expand/index.tsx","plugins/daily_notes/index.tsx","assets/ts/components/settings.tsx","assets/ts/components/breadcrumbs.tsx","assets/ts/components/spinner.tsx","assets/ts/components/block.tsx","assets/ts/components/session.tsx","assets/ts/components/menu.tsx","assets/ts/components/hotkeysTable.tsx","assets/ts/components/pluginTable.tsx","assets/ts/components/settings/backendSettings.tsx","assets/ts/components/fileInput.tsx","assets/ts/components/settings/behaviorSettings.tsx","assets/ts/components/app.tsx","assets/ts/app.tsx"],"names":["scrollDiv","$elem","amount","scrollTop","scrollIntoView","el","$within","margin","elemTop","getBoundingClientRect","top","elemBottom","bottom","top_margin","bottom_margin","$","height","window","innerHeight","isScrolledIntoView","$container","docViewTop","offset","docViewBottom","outerHeight","getParameterByName","name","replace","results","RegExp","exec","location","href","decodeURIComponent","downloadFile","filename","content","mimetype","blob","Blob","type","saveAs","mimetypeLookup","parts","split","length","toLowerCase","ExtendableError","message","constructor","stack","Error","NotImplemented","m","UnexpectedValue","value","GenericError","ExpectedError","AssertionError","assert","a","assert_equals","b","assert_deep_equals","_","JSON","stringify","LEVEL","STREAM","LEVELS","logger","level","INFO","stream","STDOUT","queue","info","debug","warn","error","fatal","this","setLevel","setStream","register_loglevel","log","apply","arguments","forEach","console","STDERR","QUEUE","push","Infinity","args","empty","Mode","metadata","id","session","oldMode","enter","actionName","context","every","beforeEvery","newMode","exit","transform_context","key","key_transforms","i","key_transform","MODES","registerMode","mode","deregisterMode","transform_insert_key","cursorBetween","cursor","backIfNeeded","_actionName","keyStream","save","keyHandler","getRepeat","newrepeat","repeat","nonSavingInsertActions","addCharsAtCursor","left","startAnchor","stopAnchor","getVisualLineSelections","parent","index1","index2","document","getChildren","children","visual_line","start_i","end_i","start","end","selected","slice","num_rows","within_row","menu","update","drop","RegisterTypes","getMode","Register","NONE","saved","saveNone","CHARS","emit","SERIALIZED_ROWS","CLONED_ROWS","serialized","options","pasteChars","pasteSerializedRows","pasteClonedRows","chars","before","addCharsAfterCursor","setCol","col","path","indexInParent","index","serialized_rows","addBlocks","setCursor","is","viewRoot","collapsed","row","hasChildren","cloned_rows","attachBlocks","EventEmitter","listeners","hooks","event","map","listener","Promise","all","addListener","on","fn","removeListener","filter","l","transform","t","obj","shiftMap","'","ignoreMap","16","17","18","91","93","keyCodeMap","8","9","13","27","32","33","34","35","36","37","38","39","40","46","48","49","50","51","52","53","54","55","56","57","186","187","188","189","190","191","192","219","220","221","222","j","keyCode","letter","String","fromCharCode","lower","InstallTrigger","SequenceAction","KeyEmitter","e","originalEvent","data","keydown","shiftKey","altKey","ctrlKey","metaKey","stopPropagation","preventDefault","Queue","vals","resolveNext","nextProm","val","enqueue","shift","undefined","resolve","motionKey","Motion","description","definition","Action","registry","motion","motionName","part_names","registerAction","part","acceptsMotion","call","composeActions","part_name","getRegistration","action","KeyBindingsTree","definitions","hasMotion","hasAction","lastAdded","tabs","prefix","Object","keys","child","getKey","print","mapped","errors","childBindings","concat","addMappingHelper","KeyBindings","mappings","bindings","allBindings","mapping","keySequences","command","sequence","addMapping","makeBindings","setMappings","off","KeyStream","lastSequence","curSequence","saveIndex","dequeue","KeyHandler","keyBindings","processQueue","recording","oldSave","recordKeyStream","_processKeys","processKeys","record","old_mode","mode_obj","Modes","DROP_ALL","dropAll","DROP","keep","new_mode_obj","getCommand","handleRecord","next","then","catch","err","setTimeout","transform_key","getAction","moveInfo","motion_repeat","getMotion","begins","x","toString","continues","indexOf","numStr","parseInt","KeyMappings","first","second","getMerged","assign","merged","keySequence","mappings_for_mode","sequences_for_name","_registerMapping","_deregisterMapping","getSlice","array","min","max","asyncFilter","arr","result","getStyles","clientStore","style_props","style","style_prop","backgroundColor","getClientSetting","color","fontWeight","textDecoration","border","colors","base03","base02","base01","base00","base0","base1","base2","base3","yellow","orange","red","magenta","violet","blue","cyan","green","themes","defaultTheme","Default","default_client_settings","showKeyBindings","hotkeys","copyToClipboard","formattedCopy","default_local_doc_settings","dataSource","firebaseId","firebaseApiKey","firebaseUserEmail","firebaseUserPassword","socketServerHost","socketServerPassword","socketServerDocument","ClientStore","backend","docname","cache","use_cache","default_value","get","parse","set","setting","_get","_macrosKey_","macros","_set","_settingKey_","_docSettingKey_","ancestry","_lastViewrootKey_","default_doc_settings","enabledPlugins","decodeLine","line","char","encodeLine","join","decodeParents","parents","DocumentStore","lastId","events","decode","fn_utils","decodedValue","encode","encodedValue","plugin","_lineKey_","char_info","properties","strikethrough","_parentsKey_","_childrenKey_","_detachedParentKey_","_collapsedKey_","_pluginDataKey_","_lastIDKey_","getId","setLine","setChildren","setCollapsed","DataBackend","_key","_value","SynchronousDataBackend","SynchronousInMemory","InMemory","sync_backend","MultipleUsersError","internalPrefix","SynchronousLocalStorageBackend","localStorage","getItem","setItem","LocalStorageBackend","lastSave","Date","now","getLastSave","_lastSaveKey_","FirebaseBackend","dbName","apiKey","fbase","numPendingSaves","firebase","initializeApp","databaseURL","database","email","password","auth","clientId","Math","random","lastClientRef","ref","snap","signInWithEmailAndPassword","credential","code","reject","once","exists","ClientSocketBackend","callback_table","ws","host","WebSocket","onerror","onclose","connect","onopen","onmessage","callback","sendMessage","send","isWhitespace","chr","urlRegex","isLink","text","test","matchWordRegex","regex_str","silentWordStartRegex","PluginStatus","Path","rootRow","root","pop","loadFromAncestry","ancestors","getAncestry","stop","reverse","other_path","walkFrom","ancestor","my_ancestry","their_ancestry","walk","descendent","other","CachedRowInfo","setInfo","childRows","parentRows","pluginData","DocumentCache","cached","childRow","cachedRow","parentRow","parentCachedRow","updateChildren","bubbleUpdate","updateFn","force","setChildRows","setParentRows","setPluginData","Document","store","getNew","emitAsync","loadRow","_attach","setDetachedParent","updateCachedPluginData","getLine","getCollapsed","getParents","applyHookAsync","ignoreCollapsed","getInfo","forceLoadTree","isCached","word","splice","num","deleted","parent_rows","setParents","parent_path","_getChildren","parent_row","_getParents","new_parent","canonicalPath","new_parent_path","getSiblings","sib","pathsofar","walkToLastVisible","isAttached","attachedParents","canonicalParent","inclusive","visited","visit","n","ci","_setChildren","pi","par","_setParents","parent_index","child_index","isClone","wasLast","last","_removeChild","child_row","isFirst","_addChild","getDetachedParent","old_detached_parent","old_parent_row","new_parent_row","old_parent","remove_info","add_info","old","new","attachChildren","new_children","_attachChildren","path1","path2","ancestors1","getAncestryPaths","ancestors2","commonAncestry","pair","lastCommon","firstDifference","allAncestors","hasChild","getSiblingOffset","getSiblingRange","min_offset","max_offset","siblings","_newChild","helper","visited_rows","that","query","nresults","case_sensitive","canonicalize","query_words","paths","traverseSubtree","getText","matches","struct","plugins","clone","serializeRow","serialize","pretty","id_mapping","replace_empty","clone_path","attachChild","newChild","serialized_child","loadTo","serialized_row","load","InMemoryDocument","PLUGINS","PluginApi","config","pluginManager","registrations","getPluginData","defaultMappings","registerModeMappings","deregisterDefaultMappings","deregisterModeMappings","desc","def","registerMotion","deregisterMotion","deregisterAction","who","_getEmitter","deregisterListener","addHook","deregisterHook","clear","removeHook","deregisterFn","disable","PluginsManager","plugin_infos","status","DISABLED","UNREGISTERED","plugin_info","enabled","getStatus","ENABLED","ENABLING","DISABLING","setStatus","api","enable","updateEnabledPlugins","registerPlugin","plugin_metadata","version","author","deregisterAll","validateRowInsertion","parent_id","noSiblingCheck","_hasChild","showMessage","text_class","includes","Mutation","_session","mutate","_cursor","AddChars","writeChars","DelChars","nchars","deletedChars","deleteChars","ChangeChars","newChars","ncharsDeleted","MoveBlock","old_index","isRoot","sameParent","_move","extend","_setPath","AttachBlocks","nrows","DetachBlocks","created_info","_detach","addNew","noNew","mutations","shedUntil","setPosition","AddBlocks","added_rows","ToggleBlock","toggleCollapsed","wordRegex","Cursor","moveCol","_setCol","cursorOptions","_fromMoveCol","pastEnd","getLength","len","maxcol","_left","_right","nextVisible","nextpath","prevVisible","prevpath","firstChild","lastVisible","getChar","matchChar","whitespaceWord","isInWhitespace","isInWord","atVisibleStart","_prevChar","wordcheck","_getWordCheck","atVisibleEnd","_nextChar","pastEndWord","found_next_word","found_whitespace","beforeFound","found","setPath","newpath","changeViewRoot","getSiblingBefore","prevsib","getSiblingAfter","nextsib","CursorsInfoTree","visual","hasSelection","getChild","markSelected","cols","markVisual","Session","doc","register","_anchor","history","historyIndex","jumpHistory","jumpIndex","getLinesPerPage","toggleBindingsDiv","cursorPath","reset_history","reset_jump_history","initialMode","toUpperCase","newmode","oldmode","verify","node","lines","whitespace","match","indent","annotation","forest","parseAllChildren","parentIndentation","lineNumber","parseJson","parsePlaintext","parseContent","jsonContent","exportLines","time","browser_utils","exportContent","after","state","from","fixCursorForMode","changeView","oldState","newState","mutation","str","rewind","undo_mutations","k","undo_mutation","moveCursor","_restoreViewState","validate","remutate","isDescendant","youngestVisibleAncestor","visibleAncestor","viewable","cur","answer","cursor_before","jump_fn","cursor_after","jump","cursor_path","oldjump","tryJump","newjump","_addToJumpHistory","newroot","zoomInto","oldestVisibleAncestor","do","addChars","yank","saveChars","delChars","change_fn","changeChars","swapCase","right","cursor1","cursor2","rows","_chr","ndeleted","yankRowAtCursor","curLineLength","includeEnd","yankChars","saveSerializedRows","toggleBlockCollapsed","newLineBelow","newLineAbove","addDelimiter","firstLine","secondLine","delimiter","delBlock","noSave","_joinRows","delCharsBeforeCursor","delBlocks","saveClonedRows","isVisible","zoomOut","yankBlocks","sibling","yankBlocksClone","ids","will_work","numblocks","newparent","moveBlock","pp_i","indentBlocks","unindentBlocks","p_i","later_siblings","prev","setBlockCollapsed","paste","anchor","getCommonAncestor","common","npages","numlines","round","down","up","childrenPath","getTextRecusive","resultChildren","childErr","childResult","InMemorySession","loadEmpty","keyDefinitions","_options","home","beginningWord","endWord","nextWord","findNextChar","findPrevChar","visibleHome","visibleEnd","nextSibling","prevSibling","SINGLE_LINE_MOTIONS","NORMAL_MOTION_MAPPINGS","INSERT_MOTION_MAPPINGS","NORMAL_MODE_MAPPINGS","VISUAL_MODE_MAPPINGS","VISUAL_LINE_MODE_MAPPINGS","INSERT_MODE_MAPPINGS","SEARCH_MODE_MAPPINGS","defaultMode","getDefaultData","mark","origin","SERVER_CONFIG","process","REACT_APP_SERVER_CONFIG","tmp","setMode","getWord","open","toggleCurBlockCollapsed","setCurBlockCollapsed","replaceCharsAfterCursor","deleteBetween","delBlocksAtCursor","resultArr","result_str","clearRowAtCursor","registerComposedAction","yankBetween","yankBlocksAtCursor","yankBlocksCloneAtCursor","delCharsAfterCursor","deleteAtCursor","pasteAfter","pasteBefore","joinAtCursor","newLineAtCursor","scroll","swapCaseAtCursor","swapCaseInVisual","getChildRange","swapCaseInVisualLine","nextClone","newPath","undo","redo","playRecording","RECORDING","RECORDING_LISTENER","macro","getMacros","setMacros","unindent","swapDown","swapUp","Menu","searchFn","selection","lastQuery","curText","start_search","searchRoot","search","accents","lineDiv","hooksInfo","applyHook","contents","renderHook","renderOptions","getVisiblePaths","makeArray","bullet","hasClass","attr","SliceToken","token","SplitToken","split_index","select","exportFile","zoomUp","zoomDown","zoomIn","jumpPrevious","jumpNext","EASY_MOTION_MAPPINGS","key_to_path","path_to_key","jump_key","updatedDataForRender","registerDefaultMappings","registerHook","ancestry_str","className","Unfolder","input","unfold","PartialUnfolder","partial_fn","wrapped","input2","emit2","RegexTokenizerSplitter","regex","match_tokenizer","filler_token","matched_token","RegexTokenizerModifier","change_info","hideBorderAndModify","left_border_to_hide_size","right_border_to_hide_size","changeCharInfo","classes","htmlTypes","htmlRegexParts","htmltype","htmlRegex","tokenizer","has_cursor","has_highlight","dangerouslySetInnerHTML","__html","html","katex","displayMode","LineComponent","props","lineData","cursors","highlights","lineHook","cursorBetweenDiv","display","width","marginLeft","marginRight","cursorStyle","DefaultTokenizer","highlight","highlightStyle","accent","accentStyle","column","target","onClick","onCharClick","bind","divType","React","trivial","wordHook","LineTokenizer","text_utils","linksStyle","WordTokenizer","finish","markStyle","padding","borderRadius","MarksPlugin","markstate","SetMark","UnsetMark","marks_to_paths","_setMark","_getMark","_unsetMark","registerListener","updateMark","markedRow","listMarks","allMarks","marks","findMarks","_document","marking","markText","markCol","lineContents","unshift","computeMarksToPaths","getData","rows_to_marks","setData","mark_to_rows","_getMarksToRows","_getRowsToMarks","marks_to_rows","marks_to_rows2","_sanityCheckMarks","hasOwnProperty","_setMarksToRows","_setRowsToMarks","all_marks","oldmark","other_row","marksPlugin","pad","padChar","numPads","Array","TimeTrackingPlugin","currentPath","isLogging","_oldPath","onRowChange","_setRowData","rowTime","timeTracked","elements","renderData","isCurRow","timeStr","printTime","curTime","_rebuildTreeTime","getRowData","treeTime","transformRowData","current","toggleLogging","resetCurrentPath","changeTimeCurrentPath","setInterval","delta_minutes","modifyTimeForRow","keytype","setRowData","forceValue","to","delta","times","totalTime","reduce","ancestor_row","_rebuildTotalTime","ms","sign","seconds","floor","minutes","hours","timeTracking","isStruckThrough","_isStruckThroughOldFormat","addStrikeThrough","removeStrikeThrough","is_struckthrough","toggleRecursiveCollapse","collapse","child_path","is_collapsed","dailyNotes","DailyNotesPlugin","init","TABS","dailyMarks","childAddedArr","dailyNotesRoot","lastRowText","detachTimer","setLogging","checkNewDay","checkRowTextChanged","ce","addCreatedToday","clearTimeout","checkDeleted","initDailyMarks","checkDailyMarks","item","date","createDailyNode","dt","dt_tomorrow","setDate","getDate","dt_yesterday","linkedNode","isNewDay","te","find","dt2","setHours","oldPath","rowTextOld","checkForDates","year","month","day","d","getFullYear","getMonth","dateStr","isValidDate","Number","newDay","getLinkedNode","addLinked","needReInit","getDailyNotesRoot","searchRows","isFound","element","isHasRows","createInDailyNode","foundInDailyNode","can","rootNode","foundLinked","linkedNodeChildren","linkedNodeChildrenArr","rowsToClone","setMark","isValidPath","getNodeWithText","createDailyNotesRoot","isCollapsed","serialzed_row","createBlock","yearNode","getNodeText","monthNode","dayNode","yearPath","monthPath","dayPath","setNode","linkedPath","setLinkedNode","CrumbComponent","BreadcrumbsComponent","loaded","crumbNodes","onCrumbClick","crumbContents","fontSize","marginBottom","Spinner","loadingText","RowComponent","cursorsTree","lineoptions","infoChildren","BlockComponent","nextProps","topLevel","onLineClick","onBulletClick","pathElements","fetchData","elLine","opacity","childrenLoaded","childrenDivs","cachedChild","cloneIcon","title","icon","onBulletClickProp","data-ancestry","SessionComponent","profileRender","getProfiler","fetchAndRerender","profilerMessage","t0","running","pending","run","promiseDebounce","finishProfiling","cursorNode","getPath","markCursor","markCols","setState","MenuComponent","curLine","searchResults","searchBox","HotkeysTableComponent","keyMap","ignoreEmpty","actionRows","motionRows","registration","mappings_for_name","cellStyle","float","label","PluginsTableComponent","borderCollapse","maxWidth","sort","btnClick","btnText","actions","statusText","getPlugin","tdStyle","boxShadow","BackendSettingsComponent","backendType","initialBackendType","getDocSetting","setDocSetting","reload","firebaseBaseUrl","backendTypes","placeholder","onChange","ev","setFirebaseId","setFirebaseApiKey","setFirebaseUserEmail","setFirebaseUserPassword","setSocketServerHost","setSocketServerPassword","setSocketServerDocument","backendTypeInfo","checked","readOnly","setBackendType","colSpan","saveDataSettings","FileInput","file","files","onSelect","reader","FileReader","readAsText","onload","evt","load_file","onLoad","onError","position","zIndex","handleChange","BehaviorSettingsComponent","setCopyToClipboard","setFormattedCopy","setClientSetting","SettingsCheckbox","htmlFor","getCurrentTheme","theme","theme_property","SettingsComponent","keyBindingsUpdate","preview_session","preview_menu","initial_theme","currentTab","DATA","themeProperty","presetTheme","forceUpdate","makeAccents","preview_document","_query","updateAll","rerenderAll","applyTheme","theme_prop","colorPickerRow","hex_color","rgb","substring","luma","paddingLeft","tabs_info","tab","heading","div","socketserver","importContent","THEME","flexBasis","flexGrow","paddingTop","theme_name","marginTop","_filename","onChangeComplete","hexColor","hex","pointerEvents","BEHAVIOR","HOTKEYS","onExport","hotkey_settings","PLUGIN","ABOUT","isActive","AppComponent","settingsMode","userMessage","saveMessage","contentEditable","flex","overflowY","showingKeyBindings","overflowX","appEl","richText","clipboardData","queryCommandSupported","textarea","createElement","textContent","body","appendChild","addEventListener","execCommand","ex","removeChild","removeEventListener","ReactDOM","flexDirection","alignItems","justifyContent","textAlign","alignSelf","ready","getLocalStore","getFirebaseStore","getSocketServerStore","getLineHeight","renderMain","caughtErr","backend_type","cursorDiv","line_height","socket_backend","dStore","prompt","fb_backend","msg","url","_col","alert","vimConfig","docStore","to_load","saved_mappings","merge","hash","getLastViewRoot","messageDivTimeout","getSetting","plugin_name","keyEmitter","richContent","formatted","richContents","recurse","p","depth","setLastViewRoot","listen","queueKey","setSetting","$pasteHack","focus","getSelection"],"mappings":"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","file":"static/js/main.fc9480ed.chunk.js","sourcesContent":["/* Utilities for stuff related to being in the browser */\nimport $ from 'jquery';\nimport { saveAs } from 'file-saver';\n\n// needed for the browser checks\ndeclare var window: any;\n\n// TODO: get jquery typing to work?\nexport function scrollDiv($elem: any, amount: number) {\n  // # animate.  seems to not actually be great though\n  // $elem.stop().animate({\n  //     scrollTop: $elem[0].scrollTop + amount\n  // }, 50)\n  return $elem.scrollTop($elem.scrollTop() + amount);\n}\n\n// TODO: get jquery typing to work?\nexport function scrollIntoView(el: Element, $within: any, margin: number = 0) {\n  const elemTop = el.getBoundingClientRect().top;\n  const elemBottom = el.getBoundingClientRect().bottom;\n\n  const top_margin = margin;\n  const bottom_margin = margin + ($('#bottom-bar').height() as number);\n\n  if (elemTop < top_margin) {\n    // scroll up\n    return scrollDiv($within, elemTop - top_margin);\n  } else if (elemBottom > window.innerHeight - bottom_margin) {\n    // scroll down\n    return scrollDiv($within, elemBottom - window.innerHeight + bottom_margin);\n  }\n}\n\nexport function isScrolledIntoView($elem: any, $container: any) {\n  const docViewTop = $container.offset().top;\n  const docViewBottom = docViewTop + $container.outerHeight();\n\n  const elemTop = $elem.offset().top;\n  const elemBottom = elemTop + $elem.height();\n\n  return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));\n}\n\nexport function getParameterByName(name: string) {\n  name = name.replace(/[\\[\\]]/g, '\\\\$&');\n  const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');\n  const results = regex.exec(window.location.href);\n  if (!results) { return null; }\n  if (!results[2]) { return ''; }\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n}\n\nexport function downloadFile(filename: string, content: string, mimetype: string) {\n  const blob = new Blob([content], {type: `${mimetype};charset=utf-8`});\n  saveAs(blob, filename);\n}\n\n// SEE: http://stackoverflow.com/questions/9847580/how-to-detect-safari-chrome-ie-firefox-and-opera-browser\nexport function isOpera(): boolean {\n  return !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0; // Opera 8.0+\n}\nexport function isSafari(): boolean {\n  return Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0; // Safari 3+\n}\nexport function isChrome(): boolean {\n  return !!window.chrome && !isOpera; // Chrome 1+\n}\ndeclare var InstallTrigger: any;\nexport function isFirefox(): boolean {\n  return typeof InstallTrigger !== 'undefined'; // Firefox 1.0+\n}\n\nexport function cancel(ev: Event) {\n  ev.stopPropagation();\n  ev.preventDefault();\n  return false;\n}\n\nexport function mimetypeLookup(filename: string): string | undefined {\n  const parts = filename.split('.');\n  const extension = parts.length > 1 ? parts[parts.length - 1] : '';\n  const extensionLookup: {[key: string]: string} = {\n    'json': 'application/json',\n    'txt': 'text/plain',\n    '': 'text/plain',\n  };\n  return extensionLookup[extension.toLowerCase()];\n}\n\n","import * as _ from 'lodash';\n\nexport class ExtendableError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = this.constructor.name;\n    this.stack = (new Error(message)).stack;\n  }\n}\n\nexport class NotImplemented extends ExtendableError {\n  constructor(m = '') {\n    super(m ? `Not implemented: ${m}!` : 'Not implemented!');\n  }\n}\n\nexport class UnexpectedValue extends ExtendableError {\n  constructor(name: string, value: any) {\n    super(`Unexpected value for \\`${name}\\`: ${value}`);\n  }\n}\n\nexport class GenericError extends ExtendableError {\n  constructor(m: string) { super(m); }\n}\n\n// error class for errors that we can reasonably expect to happen\n// e.g. bad user input, multiple users\n// is special because ignored by error handling in app.tsx\nexport class ExpectedError extends ExtendableError {\n  constructor(m: string) { super(m); }\n}\n\n///////////\n// asserts\n///////////\n\nexport class AssertionError extends ExtendableError {\n  constructor(m: string) {\n    super(`Assertion error: ${m}`);\n  }\n}\n\nexport function assert(a: boolean, message = 'assert error') {\n  if (!a) {\n    throw new AssertionError(`${message}\\nExpected ${a} to be true`);\n  }\n}\n\nexport function assert_equals(a: any, b: any, message = 'assert_equals error') {\n  if (a !== b) { throw new AssertionError(`${message}\\nExpected ${a} == ${b}`); }\n}\n\nexport function assert_not_equals(a: any, b: any, message = 'assert_not_equals error') {\n  if (a === b) { throw new AssertionError(`${message}\\nExpected ${a} != ${b}`); }\n}\n\n// for asserting object equality\nexport function assert_deep_equals(a: any, b: any, message = 'assert_deep_equals error') {\n  if (!_.isEqual(a, b)) {\n    throw new AssertionError(`${message}\n      \\nExpected:\n      \\n${JSON.stringify(a, null, 2)}\n      \\nBut got:\n      \\n${JSON.stringify(b, null, 2)}\n    `);\n  }\n}\n\nexport function assert_arrays_equal(arr_a: Array<any>, arr_b: Array<any>) {\n  const a_minus_b = _.difference(arr_a, arr_b);\n  if (a_minus_b.length) { throw new AssertionError(`Arrays not same, first contains: ${a_minus_b}`); }\n  const b_minus_a = _.difference(arr_b, arr_a);\n  if (b_minus_a.length) { throw new AssertionError(`Arrays not same, second contains: ${b_minus_a}`); }\n}\n","/*\nA straightforward class for configurable logging\nLog-levels and streams (currently only one stream at a time)\n*/\n\nexport enum LEVEL {\n  DEBUG = 0,\n  INFO = 1,\n  WARN = 2,\n  ERROR = 3,\n  FATAL = 4,\n}\n\nconst LEVELS = [\n  'DEBUG', 'INFO', 'WARN', 'ERROR', 'FATAL',\n];\n\nexport enum STREAM {\n  STDOUT,\n  STDERR,\n  QUEUE,\n}\n\nexport class Logger {\n  private stream!: STREAM;\n  private level!: LEVEL;\n  private queue: Array<any> = [];\n\n  // hack since we add the methods dynamically\n  public info: any;\n  public debug: any;\n  public warn: any;\n  public error: any;\n  public fatal: any;\n\n  constructor(level = LEVEL.INFO, stream = STREAM.STDOUT) {\n    this.setLevel(level);\n    this.setStream(stream);\n\n    const register_loglevel = (name: string, value: number) => {\n      return (this as any)[name.toLowerCase()] = function(this: Logger) {\n        if (this.level <= value) {\n          return this.log.apply(this, arguments as any);\n        }\n      };\n    };\n\n    LEVELS.forEach((name) => {\n      const value: LEVEL = (LEVEL as any)[name];\n      register_loglevel(name, value);\n    });\n  }\n\n  // tslint:disable-next-line no-unused-variable\n  public log() {\n    if (this.stream === STREAM.STDOUT) {\n      return console.log.apply(console, arguments as any);\n    } else if (this.stream === STREAM.STDERR) {\n      return console.error.apply(console, arguments as any);\n    } else if (this.stream === STREAM.QUEUE) {\n      return this.queue.push(arguments);\n    }\n  }\n\n  public setLevel(level: LEVEL) {\n    this.level = level;\n  }\n\n  public off() {\n    this.level = Infinity;\n  }\n\n  public setStream(stream: STREAM) {\n    this.stream = stream;\n    if (this.stream === STREAM.QUEUE) {\n      this.queue = [];\n    }\n  }\n\n  // for queue\n\n  public flush() {\n    if (this.stream === STREAM.QUEUE) {\n      this.queue.forEach((args) => {\n        console.log.apply(console, args);\n      });\n      return this.empty();\n    }\n  }\n\n  public empty() {\n    this.queue = [];\n  }\n}\n\nconst logger = new Logger(LEVEL.INFO);\nexport default logger;\n","// import { Document } from './document';\n// import * as DataStore from './datastore';\nimport Session from './session';\nimport { ActionName, ActionContext } from './keyDefinitions';\n\nimport { ModeId, Key } from './types';\n\nexport type ModeMetadata = {\n  name: string;\n  description?: string;\n  cursorBetween: boolean;\n  // whether only within-row motions are supported\n  within_row?: boolean;\n\n  // a list of functions taking a key and context\n  //   (key, context) -> [key, context]\n  // if the key should be ignored, return it as null (in which case\n  // other functions won't receive the key)\n  //\n  // the functions are called in the order they're registered\n  key_transforms?: Array<(key: Key, context: ActionContext) => Promise<[Key | null, ActionContext]>>;\n\n  // function taking session, upon entering mode\n  enter?: (session: Session, newMode?: ModeId) => Promise<void>;\n  // function executed on every action, while in the mode.\n  // takes session and keystream\n  beforeEvery?: (actionName: ActionName, context: ActionContext) => Promise<void>;\n  // function executed on every action, while in the mode.\n  // takes session and keystream\n  every?: (actionName: ActionName, context: ActionContext, oldMode: ModeId) => Promise<void>;\n  // function taking session, upon exiting mode\n  exit?: (session: Session, oldMode?: ModeId) => Promise<void>;\n\n  // a function taking a context and returning a new context\n  // in which definition functions will be executed\n  // (this is called right before execution)\n  transform_context?: (context: ActionContext) => Promise<any>;\n};\n\nexport default class Mode {\n  public metadata: ModeMetadata;\n  public name: string;\n  public id: ModeId;\n\n  constructor(metadata: ModeMetadata) {\n    this.metadata = metadata;\n    this.name = metadata.name;\n    this.id = metadata.name;\n  }\n\n  // function taking session, upon entering mode\n  public async enter(session: Session, oldMode?: ModeId): Promise<void> {\n    if (this.metadata.enter) {\n      return await this.metadata.enter(session, oldMode);\n    }\n  }\n\n  // function executed on every action, while in the mode.\n  // takes session and keystream\n  public async every(actionName: ActionName, context: ActionContext, oldMode: ModeId): Promise<void> {\n    if (this.metadata.every) {\n      return await this.metadata.every(actionName, context, oldMode);\n    }\n  }\n\n  // function executed on every action, while in the mode.\n  // takes session and keystream\n  public async beforeEvery(actionName: ActionName, context: ActionContext): Promise<void> {\n    if (this.metadata.beforeEvery) {\n      return await this.metadata.beforeEvery(actionName, context);\n    }\n  }\n\n  // function taking session, upon exiting mode\n  public async exit(session: Session, newMode?: ModeId): Promise<void> {\n    if (this.metadata.exit) {\n      return await this.metadata.exit(session, newMode);\n    }\n  }\n  // a function taking a context and returning a new context\n  // in which definition functions will be executed\n  // (this is called right before execution)\n  public async transform_context(context: ActionContext): Promise<any> {\n    if (this.metadata.transform_context) {\n      return await this.metadata.transform_context(context);\n    }\n    return context;\n  }\n\n  public async transform_key(key: Key | null, context: ActionContext): Promise<[Key | null, ActionContext]> {\n    if (this.metadata.key_transforms) {\n      for (let i = 0; i < this.metadata.key_transforms.length; i++) {\n        if (key == null) {\n          break;\n        }\n        const key_transform = this.metadata.key_transforms[i];\n        [key, context] = await key_transform(key, context);\n      }\n    }\n    return [key, context];\n  }\n\n};\n\n// mapping from mode name to the actual mode object\nexport const MODES: {[key: string]: Mode} = {};\n\nconst registerMode = function(metadata: ModeMetadata) {\n  if (MODES[metadata.name]) {\n    throw new Error(`Reregistered mode ${metadata.name}`);\n  }\n  const mode = new Mode(metadata);\n  MODES[metadata.name] = mode;\n  return mode;\n};\n\nconst deregisterMode = function(mode: ModeMetadata) {\n  delete MODES[mode.name];\n};\n\nconst transform_insert_key = function(key: Key) {\n  if (key === 'shift+enter') {\n    key = '\\n';\n  } else if (key === 'space' || key === 'shift+space') {\n    key = ' ';\n  }\n  return key;\n};\n\nregisterMode({\n  name: 'NORMAL',\n  cursorBetween: false,\n  async enter(session: Session) {\n    await session.cursor.backIfNeeded();\n  },\n  async every(_actionName: ActionName, { keyStream, session }: ActionContext) {\n    keyStream.save();\n    session.save();\n  },\n  key_transforms: [\n    async function(key, context) {\n      let newrepeat;\n      [newrepeat, key] = await context.keyHandler.getRepeat(context.keyStream, key);\n      context.repeat = context.repeat * newrepeat;\n      return [key, context];\n    },\n  ],\n});\n\nconst nonSavingInsertActions: {[key: string]: boolean} = {\n  'delete-char-before': true,\n  'delete-char-after': true,\n};\n\nregisterMode({\n  name: 'INSERT',\n  cursorBetween: true,\n  key_transforms: [\n    async function(key, context) {\n      key = transform_insert_key(key);\n      if (key.length === 1) {\n        // simply insert the key\n        await context.session.addCharsAtCursor([key]);\n        return [null, context];\n      }\n      return [key, context];\n    },\n  ],\n  async beforeEvery(actionName: ActionName, { session, keyStream }) {\n    if (actionName === 'exit-mode') {\n      keyStream.save();\n    } else if (!nonSavingInsertActions[actionName]) {\n      // NOTE: crucially, this doesn't happen if we transform a key into nothing\n      session.save();\n    }\n  },\n  async every(actionName: ActionName, { session }: ActionContext, oldMode) {\n    if ((!nonSavingInsertActions[actionName]) &&\n        (oldMode === 'INSERT')\n       ) {\n      // NOTE: crucially, this doesn't happen if we transform a key into nothing\n      session.save();\n    }\n  },\n  async exit(session: Session) {\n    await session.cursor.left();\n    // unlike other modes, esc in insert mode keeps changes\n    session.save();\n  },\n});\n\nregisterMode({\n  name: 'VISUAL',\n  cursorBetween: false,\n  async enter(session: Session) {\n    session.startAnchor();\n  },\n  async exit(session: Session, newMode?: ModeId) {\n    session.stopAnchor();\n    // NOTE: should we have keyStream.save()?\n    if (newMode === 'NORMAL') {\n      session.save();\n    }\n  },\n});\n\nregisterMode({\n  name: 'VISUAL_LINE',\n  cursorBetween: false,\n  async enter(session: Session) {\n    session.startAnchor();\n  },\n  async exit(session, newMode?: ModeId) {\n    session.stopAnchor();\n    // NOTE: should we have keyStream.save()?\n    if (newMode === 'NORMAL') {\n      session.save();\n    }\n  },\n  async transform_context(context) {\n    const { session } = context;\n    const [parent, index1, index2] = await session.getVisualLineSelections();\n    const children = await session.document.getChildren(parent);\n    context.visual_line = {\n      start_i: index1,\n      end_i: index2,\n      start: children[index1],\n      end: children[index2],\n      parent: parent,\n      selected: children.slice(index1, index2 + 1),\n      num_rows: (index2 - index1) + 1,\n    };\n    return context;\n  },\n});\n\nregisterMode({\n  name: 'SETTINGS',\n  cursorBetween: false,\n  // TODO: exit settings on any bad key press?\n});\n\nregisterMode({\n  name: 'SEARCH',\n  cursorBetween: true,\n  within_row: true,\n  async every(_actionName: ActionName, { session, keyStream }) {\n    if (session.menu == null) {\n      throw new Error('No menu in session');\n    }\n    await session.menu.update();\n    keyStream.drop();\n  },\n  async exit(session) {\n    session.menu = null;\n    // NOTE: should keyStream.drop() here?\n  },\n  key_transforms: [\n    async function(key, context) {\n      if (context.session.menu == null) {\n        throw new Error('No menu in session');\n      }\n      key = transform_insert_key(key);\n      if (key.length === 1) {\n        await context.session.menu.session.addCharsAtCursor([key]);\n        await context.session.menu.update();\n        context.keyStream.drop();\n        return [null, context];\n      }\n      return [key, context];\n    },\n  ],\n});\n\nconst getMode: (mode: ModeId) => Mode = (mode: ModeId) => MODES[mode];\n\nexport {\n  registerMode,\n  deregisterMode,\n  getMode,\n};\n","/*\nRepresents a yank register.  Holds saved data of one of several types -\neither nothing, a set of characters, a set of row ids, or a set of serialized rows\nImplements pasting for each of the types\n*/\nimport Session from './session';\nimport { Line, SerializedBlock, Row } from './types';\n\nexport enum RegisterTypes {\n  NONE = 0,\n  CHARS = 1,\n  SERIALIZED_ROWS = 2,\n  CLONED_ROWS = 3,\n}\n\nexport type RegisterValue = null | Line | Array<SerializedBlock> | Array<Row>;\nexport type SerializedRegister = {\n  type: RegisterTypes,\n  saved: RegisterValue,\n};\n\ntype PasteOptions = {before?: boolean};\n\nexport default class Register {\n  private session: Session;\n  private type: RegisterTypes = RegisterTypes.NONE;\n  private saved: RegisterValue = null;\n\n  constructor(session: Session) {\n    this.session = session;\n    this.saveNone();\n    return this;\n  }\n\n  public saveNone() {\n    this.type = RegisterTypes.NONE;\n    this.saved = null;\n  }\n\n  public saveChars(save: Line) {\n    this.type = RegisterTypes.CHARS;\n    this.saved = save;\n    this.session.emit('yank', {type: this.type, saved: this.saved});\n  }\n\n  public saveSerializedRows(save: Array<SerializedBlock>) {\n    this.type = RegisterTypes.SERIALIZED_ROWS;\n    this.saved = save;\n    this.session.emit('yank', {type: this.type, saved: this.saved});\n  }\n\n  public saveClonedRows(save: Array<Row>) {\n    this.type = RegisterTypes.CLONED_ROWS;\n    this.saved = save;\n    this.session.emit('yank', {type: this.type, saved: this.saved});\n  }\n\n  public serialize() {\n    return {type: this.type, saved: this.saved};\n  }\n\n  public deserialize(serialized: SerializedRegister) {\n    this.type = serialized.type;\n    this.saved = serialized.saved;\n  }\n\n  // Pasting\n\n  public async paste(options: PasteOptions = {}) {\n    if (this.type === RegisterTypes.CHARS) {\n      await this.pasteChars(options);\n    } else if (this.type === RegisterTypes.SERIALIZED_ROWS) {\n      await this.pasteSerializedRows(options);\n    } else if (this.type === RegisterTypes.CLONED_ROWS) {\n      await this.pasteClonedRows(options);\n    }\n  }\n\n  public async pasteChars(options: PasteOptions = {}) {\n    const chars = (this.saved as Line);\n    if (options.before) {\n      await this.session.addCharsAtCursor(chars);\n    } else {\n      await this.session.addCharsAfterCursor(chars);\n      await this.session.cursor.setCol(this.session.cursor.col + chars.length);\n    }\n  }\n\n  public async pasteSerializedRows(options: PasteOptions = {}) {\n    const path = this.session.cursor.path;\n    if (path.parent == null) {\n      throw new Error('Cursor was at root');\n    }\n    const parent = path.parent;\n    const index = await this.session.document.indexInParent(path);\n\n    const serialized_rows = (this.saved as Array<SerializedBlock>);\n\n    if (options.before) {\n      await this.session.addBlocks(parent, index, serialized_rows, {setCursor: 'first'});\n    } else {\n      if (path.is(this.session.viewRoot) ||\n          ((!await this.session.document.collapsed(path.row)) &&\n           (await this.session.document.hasChildren(path.row)))) {\n        await this.session.addBlocks(path, 0, serialized_rows, {setCursor: 'first'});\n      } else {\n        await this.session.addBlocks(parent, index + 1, serialized_rows, {setCursor: 'first'});\n      }\n    }\n  }\n\n  public async pasteClonedRows(options: PasteOptions = {}) {\n    const path = this.session.cursor.path;\n    if (path.parent == null) {\n      throw new Error('Cursor was at root');\n    }\n    const parent = path.parent;\n    const index = await this.session.document.indexInParent(path);\n\n    const cloned_rows = (this.saved as Array<Row>);\n\n    if (options.before) {\n      await this.session.attachBlocks(parent, cloned_rows, index, {setCursor: 'first'});\n    } else {\n      if (path.is(this.session.viewRoot) ||\n          ((!await this.session.document.collapsed(path.row)) &&\n           (await this.session.document.hasChildren(path.row)))) {\n        await this.session.attachBlocks(path, cloned_rows, 0, {setCursor: 'first'});\n      } else {\n        await this.session.attachBlocks(parent, cloned_rows, index + 1, {setCursor: 'first'});\n      }\n    }\n  }\n}\n","import $ from 'jquery';\nimport * as _ from 'lodash';\n\nimport * as browser_utils from './utils/browser';\nimport EventEmitter from './utils/eventEmitter';\nimport logger from '../../shared/utils/logger';\nimport { Key } from './types';\n\n/*\nKeyEmitter is an EventEmitter that emits keys\nA key corresponds to a keypress in the browser, including modifiers/special keys\n\nThe core function is to take browser keypress events, and normalize the key to have a string representation.\n\nFor more info, see its consumer, keyHandler.ts, as well as keyBindings.ts\nNote that one-character keys are treated specially, in that they are insertable in insert mode.\n*/\n\nconst shiftMap: {[key: string]: Key} = {\n  '`': '~',\n  '1': '!',\n  '2': '@',\n  '3': '#',\n  '4': '$',\n  '5': '%',\n  '6': '^',\n  '7': '&',\n  '8': '*',\n  '9': '(',\n  '0': ')',\n  '-': '_',\n  '=': '+',\n  '[': '{',\n  ']': '}',\n  ';': ':',\n  '\\'': '\"',\n  '\\\\': '|',\n  '.': '>',\n  ',': '<',\n  '/': '?',\n};\n\nconst ignoreMap: {[keyCode: number]: string} = {\n  16: 'shift alone',\n  17: 'ctrl alone',\n  18: 'alt alone',\n  91: 'left command alone',\n  93: 'right command alone',\n};\n\nconst keyCodeMap: {[keyCode: number]: Key} = {\n  8: 'backspace',\n  9: 'tab',\n  13: 'enter',\n  27: 'esc',\n  32: 'space',\n\n  33: 'page up',\n  34: 'page down',\n  35: 'end',\n  36: 'home',\n  37: 'left',\n  38: 'up',\n  39: 'right',\n  40: 'down',\n\n  46: 'delete',\n\n  48: '0',\n  49: '1',\n  50: '2',\n  51: '3',\n  52: '4',\n  53: '5',\n  54: '6',\n  55: '7',\n  56: '8',\n  57: '9',\n\n  186: ';',\n  187: '=',\n  188: ',',\n  189: '-',\n  190: '.',\n  191: '/',\n  192: '`',\n\n  219: '[',\n  220: '\\\\',\n  221: ']',\n  222: '\\'',\n};\n\nfor (let j = 1; j <= 26; j++) {\n  const keyCode = j + 64;\n  const letter = String.fromCharCode(keyCode);\n  const lower = letter.toLowerCase();\n  keyCodeMap[keyCode] = lower;\n  shiftMap[lower] = letter;\n}\n\nif (browser_utils.isFirefox()) {\n  keyCodeMap[173] = '-';\n}\n\nexport default class KeyEmitter extends EventEmitter {\n  constructor() {\n    super();\n  }\n\n  public listen() {\n    // IME event\n    $(document).on('compositionend', (e: any) => {\n      e.originalEvent.data.split('').forEach((key: string) => {\n        this.emit('keydown', key);\n      });\n    });\n\n    return $(document).keydown(e => {\n      // IME input keycode is 229\n      if (e.keyCode === 229) {\n        return false;\n      }\n      if (e.keyCode in ignoreMap) {\n        return true;\n      }\n      let key;\n      if (e.keyCode in keyCodeMap) {\n        key = keyCodeMap[e.keyCode];\n      } else {\n        // this is necessary for typing stuff..\n        key = String.fromCharCode(e.keyCode);\n      }\n\n      if (e.shiftKey) {\n        if (key in shiftMap) {\n          key = shiftMap[key];\n        } else {\n          key = `shift+${key}`;\n        }\n      }\n\n      if (e.altKey) {\n        key = `alt+${key}`;\n      }\n\n      if (e.ctrlKey) {\n        key = `ctrl+${key}`;\n      }\n\n      if (e.metaKey) {\n        key = `meta+${key}`;\n      }\n\n      logger.debug('keycode', e.keyCode, 'key', key);\n      const results = this.emit('keydown', key);\n      // return false to stop propagation, if any handler handled the key\n      if (_.some(results)) {\n        e.stopPropagation();\n        e.preventDefault();\n        return false;\n        // return browser_utils.cancel(e);\n      }\n      return true;\n    });\n  }\n}\n","// based on https://gist.github.com/contra/2759355\n\n// TODO: split eventEmitter and hooks into separate classes\n// TODO: get rid of all the anys in this file.  use new typescript feature, like\n// export default class EventEmitter<LTypes> {\n//   private listeners: {[K in keyof LTypes]: Array<(...args: LTypes[K]) => any>};\n//\n\nexport type Listener = (...args: any[]) => any;\nexport type Hook = (obj: any, info: any) => any;\n\nexport default class EventEmitter {\n  private listeners: {[key: string]: Array<Listener>};\n  private hooks: {[key: string]: Array<Hook>};\n\n  constructor() {\n    // mapping from event to list of listeners\n    this.listeners = {};\n    this.hooks = {};\n  }\n\n  // emit an event and return all responses from the listeners\n  public emit(event: string, ...args: Array<any>) {\n    return (this.listeners[event] || []).map((listener) => {\n      return listener.apply(listener, args);\n    });\n  }\n\n  public emitAsync(event: string, ...args: Array<any>) {\n    return Promise.all((this.listeners[event] || []).map(async (listener) => {\n      return await listener.apply(listener, args);\n    }));\n  }\n\n  public addListener(event: string, listener: Listener) {\n    this.emit('newListener', event, listener);\n    if (!this.listeners[event]) {\n      this.listeners[event] = [];\n    }\n    this.listeners[event].push(listener);\n    return this;\n  }\n\n  public on(event: string, listener: Listener) {\n    return this.addListener(event, listener);\n  }\n\n  public once(event: string, listener: Listener) {\n    const fn = (...args: Array<any>) => {\n      this.removeListener(event, fn);\n      return listener(args);\n    };\n    this.on(event, fn);\n    return this;\n  }\n\n  public removeListener(event: string, listener: Listener) {\n    if (!this.listeners[event]) { return this; }\n    this.listeners[event] = this.listeners[event].filter((l) => l !== listener);\n    return this;\n  }\n\n  public removeAllListeners(event: string) {\n    delete this.listeners[event];\n    return this;\n  }\n\n  public off(event: string, listener: Listener) {\n    return this.removeListener(event, listener);\n  }\n\n  // ordered set of hooks for mutating\n  // NOTE: a little weird for eventEmitter to be in charge of this\n\n  public addHook(event: string, transform: Hook) {\n    if (!this.hooks[event]) {\n      this.hooks[event] = [];\n    }\n    this.hooks[event].push(transform);\n    return this;\n  }\n\n  public removeHook(event: string, transform: Hook) {\n    if (!this.hooks[event]) { return this; }\n    this.hooks[event] = this.hooks[event].filter((t) => t !== transform);\n    return this;\n  }\n\n  public applyHook(event: string, obj: any, info: any) {\n    (this.hooks[event] || []).forEach((transform) => {\n      obj = transform(obj, info);\n    });\n    return obj;\n  }\n\n  public async applyHookAsync(event: string, obj: any, info: any) {\n    const hooks = (this.hooks[event] || []);\n    for (let i = 0; i < hooks.length; i++) {\n      const transform = hooks[i];\n      obj = await transform(obj, info);\n    }\n    return obj;\n  }\n}\n","import EventEmitter from './utils/eventEmitter';\nimport Session from './session';\nimport KeyHandler, { KeyStream } from './keyHandler';\nimport Cursor from './cursor';\nimport Path from './path';\nimport { ModeId, CursorOptions } from './types';\n\n// NOTE: this is a special key, which accepts any motion keys.\n// It causes definition functions to take an extra cursor argument.\n// For more info/context, see keyBindings.ts and definitions of CHANGE/DELETE/YANK\nexport const motionKey = '<motion>';\n\ntype MotionName = string;\nexport type MotionFn = (cursor: Cursor, options: CursorOptions) => Promise<void>;\n// a motion is a function taking a cursor and moving it\nexport type MotionDefinition = (\n  context: ActionContext\n) => Promise<MotionFn>;\n\nexport class Motion {\n  public name: MotionName;\n  public description: string;\n  public definition: MotionDefinition;\n  constructor(name: MotionName, description: string, definition: MotionDefinition) {\n    this.name = name;\n    this.description = description;\n    this.definition = definition;\n  }\n}\n\nexport enum SequenceAction {\n  DROP,\n  DROP_ALL,\n  KEEP,\n};\nexport type ActionContext = {\n  mode: ModeId;\n  session: Session;\n  repeat: number;\n  keyStream: KeyStream;\n  keyHandler: KeyHandler;\n  motion?: MotionFn;\n  visual_line?: {\n    start_i: number,\n    end_i: number,\n    start: Path,\n    end: Path,\n    selected: Array<Path>,\n    parent: Path,\n    num_rows: number,\n  },\n};\nexport type ActionDefinition = (context: ActionContext) => Promise<void>;\nexport type ActionName = string;\nexport type ActionMetadata = {\n  sequence?: SequenceAction;\n  acceptsMotion?: boolean;\n};\nexport class Action {\n  public name: ActionName;\n  public description: string;\n  public definition: ActionDefinition;\n  public metadata: ActionMetadata;\n  constructor(name: MotionName, description: string, definition: ActionDefinition, metadata?: ActionMetadata) {\n    this.name = name;\n    this.description = description;\n    this.definition = definition;\n    this.metadata = metadata || {};\n  }\n}\n\n// NOTE: doesn't compose metadata\nexport function composeActions(\n  name: ActionName, description: string,\n  parts: Array<Action | Motion>\n): Action {\n  const definition = async function(context: ActionContext) {\n    let i = 0;\n    while (i < parts.length) {\n      const part = parts[i];\n      if (part instanceof Motion) {\n        throw new Error('Cannot compose with motion without an action that accepts it');\n      }\n\n      if (part.metadata.acceptsMotion) {\n        i++;\n        const motion = parts[i];\n        if (motion instanceof Action) {\n          throw new Error(\n            `Error while composing action ${name}:\n            Action accepting motion was not followed by motion`\n          );\n        }\n        context.motion = await motion.definition.call(motion.definition, context);\n      }\n      await part.definition(context);\n      i++;\n    }\n  };\n  return new Action(name, description, definition);\n}\n\nexport class KeyDefinitions extends EventEmitter {\n  private registry: {[name: string]: Action | Motion};\n\n  constructor() {\n    super();\n    this.registry = {};\n  }\n\n  public getRegistration(name: string): Action | Motion | null {\n    return this.registry[name] || null;\n  }\n\n  public registerMotion(motion: Motion) {\n    if (this.registry[motion.name]) {\n      throw new Error(`${motion.name} already defined!`);\n    }\n    this.registry[motion.name] = motion;\n    this.emit('update');\n  }\n\n  public deregisterMotion(motionName: MotionName) {\n    const motion = this.registry[motionName];\n    if (!motion) {\n      throw new Error(`Tried to deregister motion ${motionName}, but it was not registered!`);\n    }\n    if (motion instanceof Action) {\n      throw new Error(`Tried to deregister motion ${motionName}, but it was registered as an action!`);\n    }\n    delete this.registry[motionName];\n    this.emit('update');\n  }\n\n  public registerComposedAction(\n    name: ActionName, description: string,\n    part_names: Array<string>\n  ) {\n    this.registerAction(composeActions(\n      name, description,\n      part_names.map((part_name) => {\n        const part = this.getRegistration(part_name);\n        if (part == null) {\n          throw new Error(\n            `Could not compose action ${name} with unregistered part ${part_name}`\n          );\n        }\n        return part;\n      })\n    ));\n  }\n\n  public registerAction(action: Action) {\n    if (this.registry[action.name]) {\n      throw new Error(`${action.name} already defined!`);\n    }\n    this.registry[action.name] = action;\n    this.emit('update');\n  }\n\n  public deregisterAction(actionName: ActionName) {\n    const action = this.registry[actionName];\n    if (!action) {\n      throw new Error(`Tried to deregister action ${actionName}, but it was not registered!`);\n    }\n    if (action instanceof Motion) {\n      throw new Error(`Tried to deregister action ${actionName}, but it was registered as a motion!`);\n    }\n    delete this.registry[actionName];\n    this.emit('update');\n  }\n}\n\nexport default new KeyDefinitions();\n","// Simple queue class where you can\n// enqueue synchronously, and dequeue asynchronously\n// (waiting for the next enqueue if nothing is available)\nexport default class Queue<T> {\n  private queue: Array<T>;\n  private resolveNext: ((val: T) => void) | null;\n  private nextProm: Promise<T> | null;\n\n  constructor(vals: Array<T> = []) {\n    this.queue = [];\n    this.resolveNext = null;\n    this.nextProm = null;\n    vals.forEach((val) => this.enqueue(val));\n  }\n\n  public empty() {\n    return this.queue.length === 0;\n  }\n\n  public dequeue(): Promise<T> {\n    if (!this.empty()) {\n      const val = this.queue.shift();\n      if (val === undefined) {\n        throw new Error('Unexpected empty queue');\n      }\n      return Promise.resolve(val);\n    }\n\n    if (this.nextProm != null) {\n      throw new Error('Cannot have multiple waiting on queue');\n      // return this.nextProm;\n    }\n    this.nextProm = new Promise((resolve) => {\n      this.resolveNext = resolve;\n    });\n    return this.nextProm;\n  }\n\n  public enqueue(val: T) {\n    if (this.resolveNext != null) {\n      this.resolveNext(val);\n      this.nextProm = null;\n      this.resolveNext = null;\n      return true;\n    } else {\n      this.queue.push(val);\n      return false;\n    }\n  }\n}\n","import * as _ from 'lodash';\n\nimport * as errors from '../../shared/utils/errors';\nimport EventEmitter from './utils/eventEmitter';\nimport logger from '../../shared/utils/logger';\nimport { KeyDefinitions, Motion, Action, motionKey } from './keyDefinitions';\nimport KeyMappings, { HotkeyMapping } from './keyMappings';\nimport { Key } from './types';\n\n// one of these per mode\nexport class KeyBindingsTree {\n  private children: {[key: string]: KeyBindingsTree | Motion | Action};\n  public hasMotion: boolean;\n  public hasAction: boolean;\n  private definitions: KeyDefinitions;\n  private lastAdded: [string, Motion | Action] | null;\n  private path: Array<Key>; // sequence of keys to get here\n\n  constructor(path: Array<Key>, definitions: KeyDefinitions) {\n    this.children = {};\n    this.hasMotion = false;\n    this.hasAction = false;\n    this.lastAdded = null;\n    this.path = path;\n    this.definitions = definitions;\n  }\n\n  public print(tabs = 0) {\n    const prefix = ' '.repeat(tabs * 2);\n    Object.keys(this.children).forEach((key) => {\n      const child: any = this.getKey(key);\n      if (child == null) { return; } // this shouldn't happen\n      if (child instanceof KeyBindingsTree) {\n        console.log(prefix, key, ':'); // tslint:disable-line:no-console\n        child.print(tabs + 1);\n      } else {\n        console.log(prefix, key, ':', child.name); // tslint:disable-line:no-console\n      }\n    });\n  }\n\n  public getKey(key: Key): KeyBindingsTree | Motion | Action | null {\n    return this.children[key] || null;\n  }\n\n  protected addMappingHelper(\n    keys: Array<Key>, index: number, name: string,\n    mapped: Action | Motion\n  ) {\n    const key = keys[index];\n\n    let child = this.children[key];\n    if (child instanceof Motion) {\n      throw new Error(\n        `Multiple registrations for key sequence ${keys.slice(0, index + 1)}:\n        ${name} and ${child.name}`\n      );\n    }\n    if (child instanceof Action) {\n      throw new Error(\n        `Multiple registrations for key sequence ${keys.slice(0, index + 1)}:\n        ${name} and ${child.name}`\n      );\n    }\n\n    if (key === motionKey) {\n      if (mapped instanceof Motion) {\n        throw new Error('Motions cannot accept motions in bindings');\n      } else {\n        if (!mapped.metadata.acceptsMotion) {\n          throw new Error(`Action ${mapped.name} does not accept motions`);\n        }\n      }\n    }\n\n    if (index === keys.length - 1) {\n      if (child != null) {\n        throw new errors.GenericError(\n          `Multiple registrations for key sequence ${keys.slice(0, index)}:\n          ${name} and ${child.lastAdded && child.lastAdded[0]}`\n        );\n      }\n\n      this.children[key] = mapped;\n    } else {\n      // need new variable for type safety\n      let childBindings: KeyBindingsTree;\n      if (child == null) {\n        childBindings = new KeyBindingsTree(this.path.concat([key]), this.definitions);\n        this.children[key] = childBindings;\n      } else {\n        childBindings = child;\n      }\n      childBindings.addMappingHelper(keys, index + 1, name, mapped);\n    }\n\n    if (mapped instanceof Motion) {\n      this.hasMotion = true;\n    } else {\n      this.hasAction = true;\n    }\n    this.lastAdded = [name, mapped];\n  }\n\n  public addMapping(name: string, keys: Array<Key>) {\n    const mapped = this.definitions.getRegistration(name);\n    if (mapped == null) {\n      // Ignore mappings if there's no definition\n      // This can happen if e.g. we saved keymappings but then turned off a plugin\n      logger.warn(`Attempted to register hotkey for ${name}, but no definition found`);\n      return;\n    }\n\n    this.addMappingHelper(keys, 0, name, mapped);\n  }\n}\n\nfunction makeBindings(definitions: KeyDefinitions, mappings: KeyMappings) {\n  const allBindings: {[mode: string]: KeyBindingsTree} = {};\n  _.map(mappings.mappings, (mapping: HotkeyMapping, mode: string) => {\n    const bindings = new KeyBindingsTree([], definitions);\n    _.map(mapping, (keySequences: Array<Array<Key>>, command: string) => {\n      keySequences.forEach((sequence) => {\n        bindings.addMapping(command, sequence);\n      });\n    });\n    allBindings[mode] = bindings;\n  });\n  return allBindings;\n}\n\nexport default class KeyBindings extends EventEmitter {\n  public definitions: KeyDefinitions;\n  public bindings: {[mode: string]: KeyBindingsTree} = {};\n  public mappings!: KeyMappings;\n\n  private update: () => void;\n\n  constructor(definitions: KeyDefinitions, mappings: KeyMappings) {\n    super();\n    this.definitions = definitions;\n\n    this.update = () => {\n      this.bindings = makeBindings(this.definitions, this.mappings);\n      this.emit('update');\n    };\n\n    this.definitions.on('update', this.update);\n    this.setMappings(mappings);\n  }\n\n  public setMappings(mappings: KeyMappings) {\n    if (this.mappings) {\n      this.mappings.off('update', this.update);\n    }\n    this.mappings = mappings;\n    this.mappings.on('update', this.update);\n    this.update();\n  }\n}\n","/*\nTakes in keys, and, based on the keybindings (see keyBindings.ts),\nmanipulates the session (see session.ts)\n\nThe KeyHandler class manages the state of what keys have been input, dealing with the logic for\n- handling multi-key sequences, i.e. a key that semantically needs another key (e.g. the GO command, `g` in vim)\n- handling motions and commands that take motions\n- combining together and saving sequences of commands\n  (important for the REPEAT command, `.` in vim, for macros, and for number prefixes, e.g. 3j)\n- dropping sequences of commands that are invalid\n- telling the session when to save (i.e. the proper checkpoints for undo and redo)\nIt maintains custom logic for this, for each mode.\n(NOTE: hopefully this logic can be more unified!  It is currently quite fragile)\n*/\n\n// TODO/NOTE: for now, macros/repeat sequences still save keys and not commands\n// it's tricky to fix due to\n// the commands not being serializable (e.g. in the case where arguments are motions)\n// or when the command awaits from keyStream\n\nimport EventEmitter from './utils/eventEmitter';\nimport logger from '../../shared/utils/logger';\nimport Queue from './utils/queue';\nimport Session from './session';\nimport KeyBindings, { KeyBindingsTree } from './keyBindings';\nimport { Motion, Action, ActionContext, motionKey, SequenceAction } from './keyDefinitions';\n// import Menu from './menu';\nimport * as Modes from './modes';\n// import * as constants from './constants';\n\nimport { Key } from './types';\n\n// Simple stream class where you can\n// enqueue synchronously, and dequeue asynchronously\n// (waiting for the next enqueue if nothing is available)\nexport class KeyStream extends EventEmitter {\n  private queue: Queue<Key>;\n\n  public lastSequence: Array<Key>;\n  private curSequence: Array<Key>;\n  // where up to curSequence to actually keep\n  private saveIndex: number;\n\n  constructor(keys: Array<Key> = []) {\n    super();\n    this.queue = new Queue<Key>(keys);\n\n    this.lastSequence = [];\n    this.curSequence = [];\n    this.saveIndex = 0;\n  }\n\n  public empty() {\n    return this.queue.empty();\n  }\n\n  public async dequeue(): Promise<Key> {\n    const val = await this.queue.dequeue();\n    this.curSequence.push(val);\n    this.emit('dequeue', val);\n    return val;\n  }\n\n  public enqueue(val: Key) {\n    this.queue.enqueue(val);\n  }\n\n  public keep() {\n    this.saveIndex = this.curSequence.length;\n  }\n\n  public drop() {\n    this.curSequence = this.curSequence.slice(0, this.saveIndex);\n  }\n\n  public dropAll() {\n    this.curSequence = [];\n  }\n\n  public save() {\n    if (this.curSequence.length) {\n      this.lastSequence = this.curSequence;\n      this.curSequence = [];\n      this.saveIndex = 0;\n    }\n  }\n}\n\ntype ActionRecord = {\n  action: Action,\n  motion: Motion | null,\n  context: ActionContext,\n};\n\nexport default class KeyHandler extends EventEmitter {\n  private session: Session;\n  private keyBindings: KeyBindings;\n  public keyStream: KeyStream;\n  private processQueue: Promise<any>;\n\n  constructor(session: Session, keyBindings: KeyBindings) {\n    super();\n    this.session = session;\n\n    this.keyBindings = keyBindings;\n\n    this.keyStream = new KeyStream();\n\n    this.processQueue = Promise.resolve();\n  }\n\n  public async playRecording(recording: Array<Key>) {\n    // the recording shouldn't save, (i.e. no @session.save)\n    const oldSave = this.session.save;\n    this.session.save = () => null;\n    const recordKeyStream = new KeyStream(recording);\n    await this._processKeys(recordKeyStream);\n    this.session.save = oldSave;\n  }\n\n  // general handling\n\n  public queueKey(key: Key) {\n    logger.info('Handling key:', key);\n    this.keyStream.enqueue(key);\n    this.processKeys(); // FIRE AND FORGET\n  }\n\n  private async handleRecord(keyStream: KeyStream, record: ActionRecord) {\n    const old_mode = this.session.mode;\n    const mode_obj = Modes.getMode(old_mode);\n    let { action, context, motion } = record;\n    context = await mode_obj.transform_context(context);\n    logger.info('Action:', action.name);\n    if (motion) {\n      logger.info('Motion:', motion.name);\n      context.motion = await motion.definition.call(motion.definition, context);\n    }\n    // logger.debug('Context:', context);\n    logger.debug(`Context: { repeat: ${context.repeat} }`);\n\n    await mode_obj.beforeEvery(action.name, context);\n    if (action.metadata.sequence === SequenceAction.DROP_ALL) {\n      keyStream.dropAll();\n    } else if (action.metadata.sequence === SequenceAction.DROP) {\n      keyStream.drop();\n    } else {\n      keyStream.keep();\n    }\n    await action.definition.call(action.definition, context);\n\n    const new_mode_obj = Modes.getMode(this.session.mode);\n    await new_mode_obj.every(action.name, context, old_mode);\n  }\n\n  private async _processKeys(keyStream: KeyStream) {\n    while (!keyStream.empty()) {\n      const record = await this.getCommand(keyStream);\n      if (record != null) {\n        await this.handleRecord(keyStream, record);\n      }\n      // NOTE: needs to be outside if statement\n      // in case of transformed key\n      this.session.emit('handledKey');\n      this.emit('handledKey');\n    }\n  }\n\n  public queue(next: () => void | Promise<void>) {\n    this.processQueue = this.processQueue.then(next);\n    return this.processQueue;\n  }\n\n  public processKeys() {\n    this.queue(async () => {\n      await this._processKeys(this.keyStream);\n    }).catch((err) => {\n      // expose any errors\n      setTimeout(() => { throw err; });\n    }).then(() => {\n      this.emit('processedQueue');\n    });\n  }\n\n  public async getCommand(keyStream: KeyStream): Promise<ActionRecord | null> {\n    const mode = this.session.mode;\n    const mode_obj = Modes.getMode(mode);\n\n    const bindings = this.keyBindings.bindings[this.session.mode];\n    let key: Key | null = await keyStream.dequeue();\n    let context: ActionContext = {\n      mode,\n      session: this.session,\n      repeat: 1,\n      keyStream,\n      keyHandler: this,\n    };\n\n    [key, context] = await mode_obj.transform_key(key, context);\n    if (key === null) {\n      // a transform acted (which, for now, we always consider not bad.  could change)\n      // TODO have transform key return an action?\n      return null;\n    }\n\n    return this.getAction(keyStream, key, bindings, context);\n  }\n\n  public async getAction(\n    keyStream: KeyStream, key: Key,\n    bindings: KeyBindingsTree, context: ActionContext\n  ): Promise<ActionRecord | null> {\n\n    let info: KeyBindingsTree | Motion | Action | null = bindings.getKey(key);\n    let action: Action;\n    let motion: Motion | null = null;\n\n    if (info instanceof KeyBindingsTree) {\n      if (!info.hasAction) {\n        return null;\n      }\n      key = await keyStream.dequeue();\n      return await this.getAction(keyStream, key, info, context);\n    }\n    if (info instanceof Action) {\n      action = info;\n    } else if (info instanceof Motion) {\n      motion = info;\n      // use original bindings' motion function\n      const moveInfo = this.keyBindings.bindings[context.mode].getKey(motionKey);\n      if (moveInfo == null) {\n        return null;\n      }\n      if (moveInfo instanceof KeyBindingsTree) {\n        throw new Error(`${motionKey} should be registered as the final key`);\n      }\n      if (moveInfo instanceof Motion) {\n        throw new Error(`${motionKey} should be registered for an action`);\n      }\n      action = moveInfo;\n    } else { // info is null\n      const moveInfo = bindings.getKey(motionKey);\n      if (moveInfo == null) { // no handler for motion\n        return null;\n      }\n      if (moveInfo instanceof KeyBindingsTree) {\n        throw new Error(`${motionKey} should be registered as the final key`);\n      }\n      if (moveInfo instanceof Motion) {\n        throw new Error(`${motionKey} should be registered for an action`);\n      }\n      action = moveInfo;\n      let motion_repeat;\n      [motion_repeat, key] = await this.getRepeat(keyStream, key);\n      context.repeat = context.repeat * motion_repeat;\n      motion = await this.getMotion(keyStream, key, this.keyBindings.bindings[context.mode]);\n      if (motion === null) {\n        return null;\n      }\n      motion = motion;\n    }\n\n    return {\n      motion,\n      action,\n      context,\n    };\n  }\n\n  // NOTE: this should maybe be normal-mode specific\n  //       but it would also need to be done for the motions\n  // takes keyStream, key, returns repeat number and key\n  public async getRepeat(\n    keyStream: KeyStream, key: string\n  ): Promise<[number, string]> {\n    const begins = [1, 2, 3, 4, 5, 6, 7, 8, 9].map((x => x.toString()));\n    const continues = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map((x => x.toString()));\n\n    if (begins.indexOf(key) === -1) {\n      return [1, key];\n    }\n    let numStr = '' + key;\n    while (true) {\n      key = await keyStream.dequeue();\n      if (continues.indexOf(key) === -1) {\n        break;\n      }\n      numStr += key;\n    }\n    return [parseInt(numStr, 10), key];\n  }\n\n  // useful when you expect a motion\n  private async getMotion(\n    keyStream: KeyStream, key: Key, bindings: KeyBindingsTree\n  ): Promise<Motion | null> {\n    const info = bindings.getKey(key);\n    if (info == null) {\n      return null;\n    } else if (info instanceof KeyBindingsTree) {\n      if (!info.hasMotion) {\n        return null;\n      }\n      key = await keyStream.dequeue();\n      return await this.getMotion(keyStream, key, info);\n    } else if (info instanceof Action) {\n      return null;\n    } else {\n      return info;\n    }\n  }\n}\n","import * as _ from 'lodash';\n\nimport EventEmitter from './utils/eventEmitter';\nimport logger from '../../shared/utils/logger';\nimport { Key } from './types';\n\nexport type HotkeyMapping = {\n  [name: string]: Array<Array<Key>>\n};\n\nexport type HotkeyMappingPerMode = {[mode: string]: HotkeyMapping};\n\n// for each mode, keeps a set of hotkeys\n// simple wrapper class, no sanity checks\nexport default class KeyMappings extends EventEmitter {\n  public mappings: HotkeyMappingPerMode;\n\n  public static merge(first: KeyMappings, second: KeyMappings) {\n    const getMerged = () => {\n      const mappings = _.cloneDeep(first.mappings);\n      Object.keys(second.mappings).forEach((mode) => {\n        mappings[mode] = Object.assign(mappings[mode] || {}, second.mappings[mode]);\n      });\n      return mappings;\n    };\n    const merged = new KeyMappings(getMerged());\n\n    first.on('update', () => merged.setMappings(getMerged()));\n    second.on('update', () => merged.setMappings(getMerged()));\n    return merged;\n  }\n\n  constructor(mappings: HotkeyMappingPerMode) {\n    super();\n    this.mappings = _.cloneDeep(mappings);\n  }\n\n  public setMappings(mappings: HotkeyMappingPerMode) {\n    this.mappings = mappings;\n    this.emit('update');\n  }\n\n  public serialize() {\n    return _.cloneDeep(this.mappings);\n  }\n\n  private _registerMapping(mode: string, keySequence: Array<Key>, name: string) {\n    let mappings_for_mode = this.mappings[mode];\n    if (!mappings_for_mode) {\n      mappings_for_mode = {};\n      this.mappings[mode] = mappings_for_mode;\n    }\n    let sequences_for_name = mappings_for_mode[name];\n    if (!sequences_for_name) {\n      sequences_for_name = [];\n      mappings_for_mode[name] = sequences_for_name;\n    }\n    sequences_for_name.push(keySequence);\n  }\n\n  public registerMapping(mode: string, keySequence: Array<Key>, name: string) {\n    this._registerMapping(mode, keySequence, name);\n    this.emit('update');\n  }\n\n  public registerModeMappings(mode: string, mappings: HotkeyMapping) {\n    Object.keys(mappings).forEach((name) => {\n      const keySequences = mappings[name];\n      keySequences.forEach((sequence) => this._registerMapping(mode, sequence, name));\n    });\n    this.emit('update');\n  }\n\n  // TODO: future dont require name for this\n  // also sanity check collisions in registration\n  private _deregisterMapping(mode: string, keySequence: Array<Key>, name: string) {\n    const mappings_for_mode = this.mappings[mode];\n    if (!mappings_for_mode) {\n      logger.warn(`Nothing to deregister for mode ${mode}`);\n      return;\n    }\n    let sequences_for_name = mappings_for_mode[name];\n    if (!(sequences_for_name && sequences_for_name.length)) {\n      logger.warn(`No sequences to deregister for ${name} in mode ${mode}`);\n      return;\n    }\n    sequences_for_name = sequences_for_name.filter((sequence) => {\n      return JSON.stringify(sequence) !== JSON.stringify(keySequence);\n    });\n    mappings_for_mode[name] = sequences_for_name;\n  }\n\n  public deregisterMapping(mode: string, keySequence: Array<Key>, name: string) {\n    this._deregisterMapping(mode, keySequence, name);\n    this.emit('update');\n  }\n\n  public deregisterModeMappings(mode: string, mappings: HotkeyMapping) {\n    Object.keys(mappings).forEach((name) => {\n      const keySequences = mappings[name];\n      keySequences.forEach((sequence) => this._deregisterMapping(mode, sequence, name));\n    });\n    this.emit('update');\n  }\n}\n","// grab bag of random functions, basically\n\nimport * as _ from 'lodash';\n\nexport function id<T>(x: T): T { return x; }\n\n// gets slice of an array, *inclusive*\nexport function getSlice<T>(array: Array<T>, min: number, max: number): Array<T> {\n  if (max === -1) {\n    if (array.length === 0) {\n      return [];\n    }\n    max = array.length - 1;\n  }\n  return array.slice(min, max + 1);\n}\n\n// NOTE: fn should not have side effects,\n// since we parallelize the calls\nexport async function asyncFilter<T>(\n  arr: Array<T>, fn: (el: T) => Promise<boolean>\n) {\n  const result: Array<{ el: T, i: number }> = [];\n  await Promise.all(\n    arr.map(async (el, i) => {\n      if (await fn(el)) {\n        result.push({ el, i });\n      }\n    })\n  );\n  return _.sortBy(result, (x) => x.i).map((x) => x.el);\n}\n\nexport function promiseDebounce(fn: (...args: Array<any>) => Promise<void>) {\n  let running = false;\n  let pending = false;\n  const run = (...args: Array<any>) => {\n    running = true;\n    fn(...args).then(() => {\n      if (pending) {\n        pending = false;\n        run(...args);\n      } else {\n        running = false;\n      }\n    });\n  };\n  return (...args: Array<any>) => {\n    if (!running) {\n      run(...args);\n    } else {\n      pending = true;\n    }\n  };\n};\n\nexport async function timeout(ns: number) {\n  await new Promise((resolve) => setTimeout(resolve, ns));\n}\n","import * as React from 'react';\n\nimport { ClientStore } from './datastore';\n\nexport type Theme = {\n  'theme-bg-primary': string,\n  'theme-bg-secondary': string,\n  'theme-bg-tertiary': string,\n  'theme-bg-highlight': string,\n\n  'theme-text-primary': string,\n  'theme-text-accent': string,\n  'theme-text-link': string,\n\n  'theme-trim': string,\n  'theme-trim-accent': string,\n\n  'theme-text-cursor': string,\n  'theme-bg-cursor': string,\n};\n\nexport type StyleProperty =\n  'theme-bg-primary' | 'theme-bg-secondary' | 'theme-bg-tertiary' | 'theme-bg-highlight' |\n  'theme-text-primary' | 'theme-text-accent' | 'theme-trim' | 'theme-trim-accent' |\n  'theme-link' | 'theme-cursor';\n\nexport function getStyles(clientStore: ClientStore, style_props: Array<StyleProperty>) {\n  const style: React.CSSProperties = {};\n  style_props.forEach((style_prop) => {\n    if (style_prop === 'theme-bg-primary') {\n      style.backgroundColor = clientStore.getClientSetting('theme-bg-primary');\n    } else if (style_prop === 'theme-bg-secondary') {\n      style.backgroundColor = clientStore.getClientSetting('theme-bg-secondary');\n    } else if (style_prop === 'theme-bg-tertiary') {\n      style.backgroundColor = clientStore.getClientSetting('theme-bg-tertiary');\n    } else if (style_prop === 'theme-bg-highlight') {\n      style.backgroundColor = clientStore.getClientSetting('theme-bg-highlight');\n    } else if (style_prop === 'theme-text-primary') {\n      style.color = clientStore.getClientSetting('theme-text-primary');\n    } else if (style_prop === 'theme-text-accent') {\n      style.color = clientStore.getClientSetting('theme-text-accent');\n      style.fontWeight = 'bold';\n    } else if (style_prop === 'theme-link') {\n      style.color = clientStore.getClientSetting('theme-text-link');\n      style.cursor = 'pointer';\n      style.textDecoration = 'none';\n    } else if (style_prop === 'theme-trim') {\n      style.border = `1px solid ${clientStore.getClientSetting('theme-trim')}`;\n    } else if (style_prop === 'theme-trim-accent') {\n      style.border = `2px solid ${clientStore.getClientSetting('theme-trim-accent')}`;\n    } else if (style_prop === 'theme-cursor') {\n      style.backgroundColor = clientStore.getClientSetting('theme-bg-cursor');\n      style.color = clientStore.getClientSetting('theme-text-cursor');\n    }\n  });\n  return style;\n}\n\nconst colors = {\n  black: '#000000',\n  white: '#ffffff',\n  yellow: '#ffff00',\n  solarized: {\n    base03: '#002b36',\n    base02: '#073642',\n    base01: '#586e75',\n    base00: '#657b83',\n    base0: '#839496',\n    base1: '#93a1a1',\n    base2: '#eee8d5',\n    base3: '#fdf6e3',\n    yellow: '#b58900',\n    orange: '#cb4b16',\n    red: '#dc322f',\n    magenta: '#d33682',\n    violet: '#6c71c4',\n    blue: '#268bd2',\n    cyan: '#2aa198',\n    green: '#859900',\n  },\n};\n\nexport const themes: {[key: string]: Theme} = {\n  'Default': {\n    'theme-bg-primary': colors.white,\n    'theme-bg-secondary': '#aaaaaa',\n    'theme-bg-tertiary': '#e0e0e0',\n    'theme-bg-highlight': '#ccc', // '#ffa' for yellowish\n\n    'theme-text-primary': colors.black,\n    'theme-text-accent': '#dd3388',\n    'theme-text-link': '#8888ff',\n\n    'theme-trim': colors.black,\n    'theme-trim-accent': '#dd3388',\n\n    'theme-text-cursor': colors.white,\n    'theme-bg-cursor': '#666',\n  },\n  'Dark': {\n    'theme-bg-primary': '#000000',\n    'theme-bg-secondary': '#333333',\n    'theme-bg-tertiary': '#404040',\n    'theme-bg-highlight': '#555', // '#770' for yellowish\n\n    'theme-text-primary': '#eeeeee',\n    'theme-text-accent': '#cccc00',\n    'theme-text-link': '#8888ff',\n\n    'theme-trim': '#eeeeee',\n    'theme-trim-accent': '#cccc00',\n\n    'theme-text-cursor': colors.black,\n    'theme-bg-cursor': '#ccc',\n  },\n  'Solarized Light': {\n    'theme-bg-primary': colors.solarized.base3,\n    'theme-bg-secondary': colors.solarized.base2,\n    'theme-bg-tertiary': '#e6dede',\n    'theme-bg-highlight': '#e2ebf3',\n\n    'theme-text-primary': colors.solarized.base00,\n    'theme-text-accent': colors.solarized.magenta,\n    'theme-text-link': colors.solarized.blue,\n\n    'theme-trim': colors.solarized.base01,\n    'theme-trim-accent': colors.solarized.magenta,\n\n    'theme-text-cursor': colors.solarized.base3,\n    'theme-bg-cursor': colors.solarized.cyan,\n  },\n  'Solarized Dark': {\n    'theme-bg-primary': colors.solarized.base02,\n    'theme-bg-secondary': colors.solarized.base03,\n    'theme-bg-tertiary': '#3C4446',\n    'theme-bg-highlight': '#384e55',\n\n    'theme-text-primary': colors.solarized.base1,\n    'theme-text-accent': colors.solarized.magenta,\n    'theme-text-link': colors.solarized.violet,\n\n    'theme-trim': colors.solarized.base1,\n    'theme-trim-accent': colors.solarized.yellow,\n\n    'theme-text-cursor': colors.solarized.base02,\n    'theme-bg-cursor': colors.solarized.base1,\n  },\n};\n\nexport const defaultTheme = themes.Default;\n","import EventEmitter from './utils/eventEmitter';\nimport * as fn_utils from './utils/functional';\nimport logger from '../../shared/utils/logger';\nimport DataBackend, { SynchronousDataBackend } from '../../shared/data_backend';\nimport * as ClientDataBackends from './data_backend';\nimport { Theme, defaultTheme } from './themes';\n\nimport { Row, Line, SerializedPath, MacroMap } from './types';\n\n/*\nDataStore abstracts the data layer, so that it can be swapped out.\nThere are many methods the each type of DataStore should implement to satisfy the API.\nHowever, in the case of a key-value store, one can simply implement `get` and `set` methods.\nCurrently, DataStore has a synchronous API.  This may need to change eventually...  :(\n*/\n\n// TODO: think this through more clearly.  for server case, we may want controlled behavior of how documents are stored\n// ClientSettings: settings specific to a client (stored locally, not per document)\n// LocalDocSettings: settings specific to a client and document name (stored locally, per document)\n// DocSettings: settings specific to a document (stored remotely, per document)\n\n// TODO: plugin enabling should get to choose if local or remote\n\nexport type ClientSettings = Theme & {\n  showKeyBindings: boolean;\n  hotkeys: any; // TODO\n  copyToClipboard: boolean;\n  formattedCopy: boolean;\n};\n\ntype ClientSetting = keyof ClientSettings;\n\nconst default_client_settings: ClientSettings =\n  Object.assign({}, defaultTheme, {\n    showKeyBindings: true,\n    hotkeys: {},\n    copyToClipboard: true,\n    formattedCopy: false,\n  });\n\nexport type LocalDocSettings = {\n  dataSource: ClientDataBackends.BackendType;\n  firebaseId: string | null;\n  firebaseApiKey: string | null;\n  firebaseUserEmail: string | null;\n  firebaseUserPassword: string | null;\n  socketServerHost: string | null;\n  socketServerPassword: string | null;\n  socketServerDocument: string | null,\n};\n\ntype LocalDocSetting = keyof LocalDocSettings;\n\nconst default_local_doc_settings: LocalDocSettings = {\n  dataSource: 'local',\n  firebaseId: null,\n  firebaseApiKey: null,\n  firebaseUserEmail: null,\n  firebaseUserPassword: null,\n  socketServerHost: null,\n  socketServerPassword: null,\n  socketServerDocument: null,\n};\n\nexport class ClientStore {\n  private prefix: string;\n  private docname: string;\n  private backend: SynchronousDataBackend;\n  private cache: {[key: string]: any} = {};\n  private use_cache: boolean = true;\n\n  constructor(backend: SynchronousDataBackend, docname = '') {\n    this.backend = backend;\n    this.docname = docname;\n    this.prefix = `${docname}save`;\n  }\n\n  private _get<T>(key: string, default_value: T): T {\n    if (this.use_cache) {\n      if (key in this.cache) {\n        return this.cache[key];\n      }\n    }\n    let value: any = this.backend.get(key);\n    try {\n      value = JSON.parse(value);\n    } catch (e) { /* do nothing - this shouldn't happen */ }\n    if (value === null) {\n      value = default_value;\n      logger.debug('tried getting', key, 'defaulted to', default_value);\n    } else {\n      logger.debug('got from storage', key, value);\n    }\n    if (this.use_cache) {\n      this.cache[key] = value;\n    }\n    return value;\n  }\n\n  private _set(key: string, value: any): void {\n    if (this.use_cache) {\n      this.cache[key] = value;\n    }\n    logger.debug('setting to storage', key, value);\n    this.backend.set(key, JSON.stringify(value));\n  }\n\n  // TODO: also have local pluginData\n\n  // no prefix, meaning it's global\n  private _settingKey_(setting: string): string {\n    return `settings:${setting}`;\n  }\n\n  // not using regular prefix, for backwards compatibility\n  private _docSettingKey_(setting: string): string {\n    return `settings:${this.docname}:${setting}`;\n  }\n\n  private _lastViewrootKey_(): string {\n    return `${this.prefix}:lastviewroot2`;\n  }\n  private _macrosKey_(): string {\n    return `${this.prefix}:macros`;\n  }\n\n  // get mapping of macro_key -> macro\n  public getMacros(): MacroMap {\n    return this._get(this._macrosKey_(), {});\n  }\n\n  // set mapping of macro_key -> macro\n  public setMacros(macros: MacroMap) {\n    this._set(this._macrosKey_(), macros);\n  }\n\n  public getClientSetting<S extends ClientSetting>(setting: S): ClientSettings[S] {\n    return this._get(this._settingKey_(setting), default_client_settings[setting]);\n  }\n\n  public setClientSetting<S extends ClientSetting>(setting: S, value: ClientSettings[S]) {\n    this._set(this._settingKey_(setting), value);\n  }\n\n  public getDocSetting<S extends LocalDocSetting>(setting: S): LocalDocSettings[S] {\n    const default_value = default_local_doc_settings[setting];\n    return this._get(this._docSettingKey_(setting), default_value);\n  }\n\n  public setDocSetting<S extends LocalDocSetting>(setting: S, value: LocalDocSettings[S]) {\n    this._set(this._docSettingKey_(setting), value);\n  }\n\n  // get last view (for page reload)\n  public setLastViewRoot(ancestry: SerializedPath) {\n    this._set(this._lastViewrootKey_(), ancestry);\n  }\n  public getLastViewRoot(): SerializedPath {\n    return this._get(this._lastViewrootKey_(), []);\n  }\n}\n\nexport type DocSettings = {\n  enabledPlugins: Array<string>,\n};\n\ntype DocSetting = keyof DocSettings;\n\nconst default_doc_settings: DocSettings = {\n  // TODO import these names from the plugins\n  enabledPlugins: ['Marks', 'HTML', 'LaTeX', 'Text Formatting', 'Todo'],\n};\n\nconst timeout = (ns: number) => {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ns);\n  });\n};\n// const simulateDelay = 10;\n// const simulateDelay = 1;\nconst simulateDelay: number = 0;\n\nconst decodeLine: (line: Line) => Line = (line: any) => {\n  if (typeof line === 'string') {\n    return line.split('');\n  }\n  return line.map((obj: any) => {\n    if (typeof obj === 'string') {\n      return obj;\n    }\n\n    // for backwards compatibility\n    return obj.char;\n  });\n};\n\nconst encodeLine: (line: Line) => string = (line) => line.join('');\n\n// for backwards compatibility, mainly\nconst decodeParents = (parents: number | Array<number>): Array<number> => {\n  if (typeof parents === 'number') {\n    parents = [ parents ];\n  }\n  return parents;\n};\n\nexport class DocumentStore {\n  private lastId: number | null;\n  private prefix: string;\n  private docname: string;\n  private cache: {[key: string]: any} = {};\n  private use_cache: boolean = true;\n  public events: EventEmitter = new EventEmitter();\n  private backend: DataBackend;\n\n  constructor(backend: DataBackend, docname = '') {\n    this.backend = backend;\n    this.docname = docname;\n    this.prefix = `${this.docname}save`;\n    this.lastId = null;\n  }\n\n  private async _get<T>(\n    key: string,\n    default_value: T,\n    decode: (value: any) => T = fn_utils.id\n  ): Promise<T> {\n    if (simulateDelay) { await timeout(simulateDelay * Math.random()); }\n\n    if (this.use_cache) {\n      if (key in this.cache) {\n        return this.cache[key];\n      }\n    }\n    let value: any = await this.backend.get(key);\n    try {\n      // need typeof check because of backwards compatibility plus stupidness like\n      // JSON.parse([106]) === 106\n      if (typeof value === 'string') {\n        value = JSON.parse(value);\n      }\n    } catch (e) { /* do nothing - this should only happen for historical reasons */ }\n    let decodedValue: T;\n    if (value === null) {\n      decodedValue = default_value;\n      logger.debug('tried getting', key, 'defaulted to', decodedValue);\n    } else {\n      decodedValue = decode(value);\n      logger.debug('got from storage', key, decodedValue);\n    }\n    if (this.use_cache) {\n      this.cache[key] = decodedValue;\n    }\n    return decodedValue;\n  }\n\n  private async _set(\n    key: string, value: any, encode: (value: any) => any = fn_utils.id\n  ): Promise<void> {\n    if (simulateDelay) { await timeout(simulateDelay * Math.random()); }\n\n    if (this.use_cache) {\n      this.cache[key] = value;\n    }\n    const encodedValue = encode(value);\n    logger.debug('setting to storage', key, encodedValue);\n    // NOTE: fire and forget\n    this.backend.set(key, JSON.stringify(encodedValue)).catch((err) => {\n      setTimeout(() => { throw err; });\n    });\n  }\n\n  private _lastIDKey_() {\n    return `${this.prefix}:lastID`;\n  }\n  private _lineKey_(row: Row): string {\n    return `${this.prefix}:${row}:line`;\n  }\n  private _parentsKey_(row: Row): string {\n    return `${this.prefix}:${row}:parent`;\n  }\n  private _childrenKey_(row: Row): string {\n    return `${this.prefix}:${row}:children`;\n  }\n  private _detachedParentKey_(row: Row): string {\n    return `${this.prefix}:${row}:detached_parent`;\n  }\n  private _collapsedKey_(row: Row): string {\n    return `${this.prefix}:${row}:collapsed`;\n  }\n\n  private _pluginDataKey_(plugin: string, key: string): string {\n    return `${this.prefix}:plugin:${plugin}:data:${key}`;\n  }\n\n  private _settingKey_(setting: string): string {\n    return `${this.prefix}:settings:${setting}`;\n  }\n\n  // get and set values for a given row\n  public async getLine(row: Row): Promise<Line> {\n    return await this._get(this._lineKey_(row), [], decodeLine);\n  }\n\n  public async setLine(row: Row, line: Line): Promise<void> {\n    return await this._set(this._lineKey_(row), line, encodeLine);\n  }\n\n  // for backwards compatibility - checks whether the line was struck through\n  // in the old-style format\n  public async _isStruckThroughOldFormat(row: Row): Promise<boolean> {\n    const line = await this._get<any>(this._lineKey_(row), []);\n    if (typeof line !== 'string' && line.length) {\n      let char_info = line[0];\n      if (char_info.properties && char_info.properties.strikethrough) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  public async getParents(row: Row): Promise<Array<Row>> {\n    return await this._get(this._parentsKey_(row), [], decodeParents);\n  }\n\n  public async setParents(row: Row, parents: Array<Row>): Promise<void> {\n    return await this._set(this._parentsKey_(row), parents);\n  }\n\n  public async getChildren(row: Row): Promise<Array<Row>> {\n    return await this._get(this._childrenKey_(row), []);\n  }\n  public async setChildren(row: Row, children: Array<Row>): Promise<void> {\n    return await this._set(this._childrenKey_(row), children);\n  }\n\n  public async getDetachedParent(row: Row): Promise<Row | null> {\n    return await this._get(this._detachedParentKey_(row), null);\n  }\n  public async setDetachedParent(row: Row, parent: Row | null): Promise<void> {\n    return await this._set(this._detachedParentKey_(row), parent);\n  }\n\n  public async getCollapsed(row: Row): Promise<boolean> {\n    return await this._get(this._collapsedKey_(row), false);\n  }\n  public async setCollapsed(row: Row, collapsed: boolean): Promise<void> {\n    return await this._set(this._collapsedKey_(row), collapsed || false);\n  }\n\n  public async getSetting<S extends DocSetting>(setting: S): Promise<DocSettings[S]> {\n    const default_value = default_doc_settings[setting];\n    return await this._get(this._settingKey_(setting), default_value);\n  }\n\n  public async setSetting<S extends DocSetting>(setting: S, value: DocSettings[S]): Promise<void> {\n    return await this._set(this._settingKey_(setting), value);\n  }\n\n  public async setPluginData(\n    plugin: string, key: string, data: any\n  ): Promise<void> {\n    await this._set(this._pluginDataKey_(plugin, key), data);\n  }\n  public async getPluginData(\n    plugin: string, key: string, default_value: any = undefined\n  ): Promise<any> {\n    return await this._get(this._pluginDataKey_(plugin, key), default_value);\n  }\n\n  // get next row ID\n  // public so test case can override\n  public async getId(): Promise<number> {\n    // suggest to override this for efficiency\n    let id;\n    if (this.lastId === null) {\n      id = 1 + await this._get(this._lastIDKey_(), 0);\n    } else {\n      id = this.lastId + 1;\n    }\n    // NOTE: fire and forget\n    this._set(this._lastIDKey_(), id);\n    this.lastId = id;\n    return id;\n  }\n\n  public async getNew() {\n    const id = await this.getId();\n    await Promise.all([\n      this.setLine(id, []),\n      this.setChildren(id, []),\n      this.setCollapsed(id, false),\n    ]);\n    return id;\n  }\n}\n","import * as errors from './utils/errors';\n\n/*\nDataBackend abstracts the data layer, so that it can be swapped out.\nTo implement a new backend, one simply has to implement a simple key-value store\nwith the two methods get and set.\n\nNote that the backend may want to protect against multiple clients writing/reading.\n*/\n\nexport default class DataBackend {\n  public async get(_key: string): Promise<string | null> {\n    throw new errors.NotImplemented();\n  }\n\n  public async set(_key: string, _value: string): Promise<void> {\n    throw new errors.NotImplemented();\n  }\n}\n\nexport class SynchronousDataBackend {\n  public get(_key: string): string | null {\n    throw new errors.NotImplemented();\n  }\n\n  public set(_key: string, _value: string): void {\n    throw new errors.NotImplemented();\n  }\n}\n\nexport class SynchronousInMemory extends SynchronousDataBackend {\n  private cache: {[key: string]: any} = {};\n  constructor() {\n    super();\n  }\n\n  public get(key: string): string | null {\n    if (key in this.cache) {\n      return this.cache[key];\n    }\n    return null;\n  }\n\n  public set(key: string, value: string): void {\n    this.cache[key] = value;\n  }\n}\n\nexport class InMemory extends DataBackend {\n  private sync_backend: SynchronousInMemory;\n  constructor() {\n    super();\n    this.sync_backend = new SynchronousInMemory();\n  }\n\n  public async get(key: string): Promise<string | null> {\n    return this.sync_backend.get(key);\n  }\n\n  public async set(key: string, value: string): Promise<void> {\n    this.sync_backend.set(key, value);\n  }\n}\n\n","import firebase from 'firebase';\n// import \"firebase/auth\";\n\nimport EventEmitter from '../utils/eventEmitter';\nimport DataBackend, { SynchronousDataBackend } from '../../../shared/data_backend';\nimport { ExtendableError } from '../../../shared/utils/errors';\nimport logger from '../../../shared/utils/logger';\n\nexport type BackendType = 'local' | 'firebase' | 'inmemory' | 'socketserver';\n\nexport class MultipleUsersError extends ExtendableError {\n  constructor() { super(\n    'This document has been modified (in another tab) since opening it in this tab. Please refresh to continue!'\n  ); }\n}\n\n// NOTE: not very elegant, but this won't collide with other keys\n// since prefix always contains either '*save' or 'settings:'.\n// Future backends don't need to use this, as long as they prefix the key passed to them.\n// Backends can prefix internal usage with internalPrefix to avoid namespace collision.\nconst internalPrefix: string = 'internal:';\n\nexport class SynchronousLocalStorageBackend extends SynchronousDataBackend {\n  constructor() {\n    super();\n  }\n\n  public get(key: string): string | null {\n    const val = localStorage.getItem(key);\n    if ((val == null) || (val === 'undefined')) {\n      return null;\n    }\n    return val;\n  }\n\n  public set(key: string, value: string): void {\n    return localStorage.setItem(key, value);\n  }\n}\n\nexport class LocalStorageBackend extends DataBackend {\n  private lastSave: number;\n  private docname: string;\n  private sync_backend: SynchronousLocalStorageBackend;\n\n  private _lastSaveKey_(): string {\n    return `${internalPrefix}${this.docname}:lastSave`;\n  }\n\n  constructor(docname = '') {\n    super();\n    this.docname = docname;\n    this.lastSave = Date.now();\n    this.sync_backend = new SynchronousLocalStorageBackend();\n  }\n\n  public async get(key: string): Promise<string | null> {\n    return this.sync_backend.get(key);\n  }\n\n  public async set(key: string, value: string): Promise<void> {\n    if (this.getLastSave() > this.lastSave) {\n      throw new MultipleUsersError();\n    }\n    this.lastSave = Date.now();\n    this.sync_backend.set(this._lastSaveKey_(), this.lastSave + '');\n    this.sync_backend.set(key, value);\n  }\n\n  // determine last time saved (for multiple tab detection)\n  // note that this doesn't cache!\n  public getLastSave(): number {\n    return JSON.parse(this.sync_backend.get(this._lastSaveKey_()) || '0');\n  }\n}\n\nexport class FirebaseBackend extends DataBackend {\n  public events: EventEmitter = new EventEmitter();\n\n  private fbase: firebase.database.Database;\n  private numPendingSaves: number = 0;\n  private docname: string;\n\n  constructor(docname = '', dbName: string, apiKey: string) {\n    super();\n    this.docname = docname;\n    this.fbase = firebase.initializeApp({\n      apiKey: apiKey,\n      databaseURL: `https://${dbName}.firebaseio.com`,\n    }).database();\n    // this.fbase.authWithCustomToken(token, (err, authdata) => {})\n  }\n\n  public async init(email: string, password: string) {\n    this.events.emit('saved');\n\n    await this.auth(email, password);\n\n    const clientId = Date.now() + '-' + ('' + Math.random()).slice(2);\n    const lastClientRef = this.fbase.ref(`${internalPrefix}${this.docname}:lastClient`);\n\n    await lastClientRef.set(clientId);\n\n    // Number of online users is the number of objects in the presence list.\n    lastClientRef.on('value', function(snap) {\n      if (snap == null) {\n        throw new Error('Failed to get listRef');\n      }\n      if (snap.val() !== clientId) {\n        throw new MultipleUsersError();\n      }\n    });\n  }\n\n  public async auth(email: string, password: string) { // : Promise<UserCredential | undefined>\n    try {\n        let credential = await firebase.auth().signInWithEmailAndPassword(email, password);\n        logger.info('Authenticated against Firebase.');\n        return credential;\n    } catch (x) {\n        logger.error('Authentication against Firebase failed: ' + x.code + ': ' + x.message);\n        return;\n    }\n  }\n\n  public get(key: string): Promise<string | null> {\n    logger.debug('Firebase: getting', key);\n    return new Promise((resolve: (result: string | null) => void, reject) => {\n      this.fbase.ref(key).once(\n        'value',\n        (data) => {\n          const exists = data.exists();\n          if (!exists) {\n            return resolve(null);\n          }\n          return resolve(data.val());\n        },\n        (err: Error) => {\n          return reject(err);\n        }\n      );\n    });\n  }\n\n  // TODO: make this set proper, and do the pending thing elsewhere\n  // same with for socket backend\n  public set(key: string, value: string): Promise<void> {\n    if (this.numPendingSaves === 0) {\n      this.events.emit('unsaved');\n    }\n    logger.debug('Firebase: setting', key, 'to', value);\n    this.numPendingSaves++;\n    // TODO: buffer these and batch them?\n    this.fbase.ref(key).set(\n      value,\n      (err) => {\n        if (err) { throw err; }\n        this.numPendingSaves--;\n        if (this.numPendingSaves === 0) {\n          this.events.emit('saved');\n        }\n      }\n    );\n    return Promise.resolve();\n  }\n}\n\nexport class ClientSocketBackend extends DataBackend {\n  public events: EventEmitter = new EventEmitter();\n  private numPendingSaves: number = 0;\n  private callback_table: {[id: string]: (result: any) => void} = {};\n\n  // init is like async constructor\n  private ws!: WebSocket;\n  private clientId: string;\n\n  constructor() {\n    super();\n    this.clientId = Date.now() + '-' + ('' + Math.random()).slice(2);\n  }\n\n  private async connect(host: string, password: string, docname: string) {\n    logger.info('Trying to connect', host);\n    this.ws = new WebSocket(`${host}/socket`);\n    this.ws.onerror = () => {\n      // throw new Error(`Socket connection error: ${err}`);\n      logger.info('Socket connection error!');\n    };\n    this.ws.onclose = () => {\n      // throw new Error('Socket connection closed!');\n      logger.info('Socket connection closed! Trying to reconnect...');\n      setTimeout(() => {\n        this.connect(host, password, docname);\n      }, 5000);\n    };\n\n    await new Promise((resolve, reject) => {\n      this.ws.onopen = resolve;\n      setTimeout(() => {\n        reject('Timed out trying to connect!');\n      }, 5000);\n    });\n    logger.info('Connected', host);\n\n    this.ws.onmessage = (event) => {\n      // tslint:disable-next-line no-console\n      const message = JSON.parse(event.data);\n      if (message.type === 'callback') {\n        const id: string = message.id;\n        if (!(id in this.callback_table)) {\n          throw new Error(`ID ${id} not found in callback table`);\n        }\n        const callback = this.callback_table[id];\n        delete this.callback_table[id];\n        callback(message.result);\n      } else if (message.type === 'joined') {\n        if (message.docname === docname) {\n          if (message.clientId !== this.clientId) {\n            throw new MultipleUsersError();\n          }\n        }\n      }\n    };\n\n    await this.sendMessage({\n      type: 'join',\n      password: password,\n      docname: docname,\n    });\n  }\n\n  public async init(host: string, password: string, docname = '') {\n    this.events.emit('saved');\n    await this.connect(host, password, docname);\n  }\n\n  private async sendMessage(message: Object): Promise<string | null> {\n    return new Promise((resolve: (result: string | null) => void, reject) => {\n      const id = Date.now() + '-' + ('' + Math.random()).slice(2);\n      if (id in this.callback_table) { throw new Error('Duplicate IDs!?'); }\n      this.callback_table[id] = (result) => {\n        if (result.error) {\n          reject(result.error);\n        } else {\n          resolve(result.value);\n        }\n      };\n      this.ws.send(JSON.stringify({\n        ...message,\n        id: id,\n        clientId: this.clientId\n      }));\n    });\n  }\n\n  public async get(key: string): Promise<string | null> {\n    logger.debug('Socket client: getting', key);\n    return await this.sendMessage({\n      type: 'get',\n      key: key,\n    });\n  }\n\n  public set(key: string, value: string): Promise<void> {\n    if (this.numPendingSaves === 0) {\n      this.events.emit('unsaved');\n    }\n    logger.debug('Socket client: setting', key, 'to', value);\n    this.numPendingSaves++;\n\n    this.sendMessage({\n      type: 'set',\n      key: key,\n      value: value,\n    }).then(() => {\n      this.numPendingSaves--;\n      if (this.numPendingSaves === 0) {\n        this.events.emit('saved');\n      }\n    });\n    return Promise.resolve();\n  }\n}\n","// TODO: is quite silly to consider undefined as whitespace...\nexport function isWhitespace(chr: string | undefined) {\n  return (chr === ' ') || (chr === '\\n') || (chr === undefined);\n}\n\n// NOTE: currently unused\nexport function isPunctuation(chr: string) {\n  return chr === '.' || chr === ',' || chr === '!' || chr === '?';\n}\n\nconst urlRegex = /^https?:\\/\\/([^\\s]+\\.[^\\s]+$|localhost)/;\nexport function isLink(text: string): boolean {\n  return urlRegex.test(text);\n}\n\n// Helpers to build up regex that finds the start of a word\n// Ignore the groups, for the sake of matching (TODO: do that in the caller?)\n//\n// Allow whitespace or beginning of line, then open paren\nexport const silentWordStartRegex = '(?:\\\\s|^)(?:\\\\()*';\n// Allow end parens, punctuation, then whitespace or end of line\nexport const silentWordEndRegex = '(?:\\\\))*(?:\\\\.|,|!|\\\\?|\\\\:|\\\\;)*(?:\\\\s|$)';\n\n// Returns regex whose first match is a \"word\" with certain properties (according to a regex string).\n// Note the word needn't be a word in the sense of containing no whitespace - that is up to the regex_str to decide.\n// It just needs to start on something like a word-start and end on something like a word-end.\nexport function matchWordRegex(regex_str: string) {\n  return new RegExp(silentWordStartRegex + '(' + regex_str + ')' + silentWordEndRegex);\n}\n","import * as React from 'react';\nimport * as _ from 'lodash';\n\nimport * as errors from '../../shared/utils/errors';\nimport EventEmitter, { Listener, Hook } from './utils/eventEmitter';\nimport logger, { Logger } from '../../shared/utils/logger';\nimport { registerMode, deregisterMode, ModeMetadata } from './modes';\nimport Document from './document';\nimport Cursor from './cursor';\nimport Session from './session';\nimport Config from './config';\nimport { HotkeyMapping } from './keyMappings';\nimport KeyBindings from './keyBindings';\nimport { Row, ModeId } from './types';\nimport {\n  KeyDefinitions, Action, Motion,\n  ActionDefinition, MotionDefinition, ActionMetadata\n} from './keyDefinitions';\n\ntype PluginMetadata = {\n  name: string;\n  version?: number;\n  author?: string;\n  description?: string | React.ReactNode;\n};\n\ntype PluginEnableFn<V = void> = (api: PluginApi) => Promise<V> | V;\ntype PluginDisableFn<V = void> =  (api: PluginApi, value: V) => Promise<void> | void;\ntype RegisteredPlugin<V = void> = {\n  name: string;\n  version?: number;\n  author?: string;\n  description?: string | React.ReactNode;\n  enable: PluginEnableFn<V>;\n  disable: PluginDisableFn<V>;\n};\n\n// global set of registered plugins\nconst PLUGINS: {[pluginName: string]: RegisteredPlugin<any>} = {};\n\nexport enum PluginStatus {\n  UNREGISTERED = 0,\n  DISABLING = 1,\n  DISABLED = 2,\n  ENABLING = 3,\n  ENABLED = 4,\n}\n\ntype Emitter = 'document' | 'session';\n\n// class for exposing plugin API\nexport class PluginApi {\n  public session: Session;\n  private metadata: PluginMetadata;\n  private pluginManager: PluginsManager;\n  private name: string;\n  private document: Document;\n  public cursor: Cursor;\n  public logger: Logger;\n  private bindings: KeyBindings;\n  private definitions: KeyDefinitions;\n  private config: Config;\n\n  private registrations: Array<() => void>;\n\n  constructor(config: Config, session: Session, bindings: KeyBindings, metadata: PluginMetadata, pluginManager: PluginsManager) {\n    this.session = session;\n    this.config = config;\n    this.metadata = metadata;\n    this.pluginManager = pluginManager;\n    this.name = this.metadata.name;\n    this.document = this.session.document;\n    this.cursor = this.session.cursor;\n    // TODO: Add subloggers and prefix all log messages with the plugin name\n    this.logger = logger;\n\n    this.bindings = bindings;\n    this.definitions = this.bindings.definitions;\n\n    this.registrations = [];\n  }\n\n  public async setData(key: string, value: any) {\n    return await this.document.store.setPluginData(this.name, key, value);\n  }\n\n  public async getData(key: string, default_value: any = null) {\n    return await this.document.store.getPluginData(this.name, key, default_value);\n  }\n\n  // marks row for re-rendering\n  public async updatedDataForRender(row: Row) {\n    // this is sort of a weird implementation,\n    // but it causes the cachedRowInfo to get updated\n    // and also updates pluginData, which is the typical use case\n    await this.document.updateCachedPluginData(row);\n  }\n\n  public registerMode(metadata: ModeMetadata) {\n    const mode = registerMode(metadata);\n    this.registrations.push(() => {\n      this.deregisterMode(metadata);\n    });\n    return mode;\n  }\n\n  public deregisterMode(metadata: ModeMetadata) {\n    deregisterMode(metadata);\n  }\n\n  public registerDefaultMappings(mode: ModeId, mappings: HotkeyMapping) {\n    this.config.defaultMappings.registerModeMappings(mode, mappings);\n    this.registrations.push(() => {\n      this.deregisterDefaultMappings(mode, mappings);\n    });\n  }\n\n  public deregisterDefaultMappings(mode: ModeId, mappings: HotkeyMapping) {\n    this.config.defaultMappings.deregisterModeMappings(mode, mappings);\n  }\n\n  public registerMotion(name: string, desc: string, def: MotionDefinition) {\n    const motion = new Motion(name, desc, def);\n    this.definitions.registerMotion(motion);\n    this.registrations.push(() => {\n      this.deregisterMotion(motion.name);\n    });\n    return motion;\n  }\n\n  public deregisterMotion(name: string) {\n    this.definitions.deregisterMotion(name);\n  }\n\n  public registerAction(name: string, desc: string, def: ActionDefinition, metadata: ActionMetadata = {}) {\n    const action = new Action(name, desc, def, metadata);\n    this.definitions.registerAction(action);\n    this.registrations.push(() => {\n      this.deregisterAction(action.name);\n    });\n    return action;\n  }\n\n  public deregisterAction(name: string) {\n    this.definitions.deregisterAction(name);\n  }\n\n  private _getEmitter(who: Emitter): Document | Session {\n    if (who === 'document') {\n      return this.document;\n    } else if (who === 'session') {\n      return this.session;\n    } else {\n      throw new errors.GenericError(`Unknown hook listener ${who}`);\n    }\n  }\n\n  public registerListener(who: Emitter, event: string, listener: Listener) {\n    const emitter = this._getEmitter(who);\n    emitter.on(event, listener);\n    this.registrations.push(() => {\n      this.deregisterListener(who, event, listener);\n    });\n  }\n\n  public deregisterListener(who: Emitter, event: string, listener: Listener) {\n    const emitter = this._getEmitter(who);\n    emitter.off(event, listener);\n  }\n\n  // TODO: type this better\n  public registerHook(who: Emitter, event: string, transform: Hook) {\n    const emitter = this._getEmitter(who);\n    emitter.addHook(event, transform);\n    this.registrations.push(() => {\n      this.deregisterHook(who, event, transform);\n    });\n    // pluginData can change for all rows (also could be render-related hook)\n    this.document.cache.clear();\n  }\n\n  public deregisterHook(who: Emitter, event: string, transform: Hook) {\n    const emitter = this._getEmitter(who);\n    emitter.removeHook(event, transform);\n    // pluginData can change for all rows (also could be render-related hook)\n    this.document.cache.clear();\n  }\n\n  public deregisterAll() {\n    this.registrations.reverse().forEach((deregisterFn) => {\n      deregisterFn();\n    });\n    this.registrations = [];\n  }\n\n  public async panic() {\n    this.pluginManager.disable(this.name); // Fire and forget\n    throw new Error(\n      `Plugin '${this.name}' has encountered a major problem.\n      Please report this problem to the plugin author.`\n    );\n  }\n}\n\nexport class PluginsManager extends EventEmitter {\n  private session: Session;\n  private config: Config;\n  private bindings: KeyBindings;\n  private plugin_infos: {\n    [key: string]: {\n      api?: PluginApi,\n      value?: any,\n      status?: PluginStatus,\n    }\n  };\n\n  constructor(session: Session, config: Config, bindings: KeyBindings) {\n    super();\n    this.session = session;\n    this.config = config;\n    this.bindings = bindings;\n    this.plugin_infos = {};\n  }\n\n  public getInfo(name: string) {\n    return this.plugin_infos[name];\n  }\n\n  public getStatus(name: string): PluginStatus {\n    if (!PLUGINS[name]) {\n      return PluginStatus.UNREGISTERED;\n    }\n    return (this.plugin_infos[name] && this.plugin_infos[name].status) || PluginStatus.DISABLED;\n  }\n\n  public setStatus(name: string, status: PluginStatus) {\n    logger.debug(`Plugin ${name} status: ${status}`);\n    if (!PLUGINS[name]) {\n      throw new Error(`Plugin ${name} was not registered`);\n    }\n    const plugin_info = this.plugin_infos[name] || {};\n    plugin_info.status = status;\n    this.plugin_infos[name] = plugin_info;\n    this.emit('status');\n  }\n\n  public updateEnabledPlugins() {\n    const enabled: Array<string> = [];\n    for (const name in this.plugin_infos) {\n      if ((this.getStatus(name)) === PluginStatus.ENABLED) {\n        enabled.push(name);\n      }\n    }\n    this.emit('enabledPluginsChange', enabled);\n  }\n\n  public async enable(name: string) {\n    const status = this.getStatus(name);\n    if (status === PluginStatus.UNREGISTERED) {\n      logger.error(`No plugin registered as ${name}`);\n      return;\n    }\n    if (status === PluginStatus.ENABLING) {\n      throw new errors.GenericError(`Already enabling plugin ${name}`);\n    }\n    if (status === PluginStatus.DISABLING) {\n      throw new errors.GenericError(`Still disabling plugin ${name}`);\n    }\n    if (status === PluginStatus.ENABLED) {\n      throw new errors.GenericError(`Plugin ${name} is already enabled`);\n    }\n\n    errors.assert(status === PluginStatus.DISABLED);\n    this.setStatus(name, PluginStatus.ENABLING);\n\n    const plugin = PLUGINS[name];\n    const api = new PluginApi(this.config, this.session, this.bindings, plugin, this);\n    const value = await plugin.enable(api);\n\n    this.plugin_infos[name] = { api, value };\n    this.setStatus(name, PluginStatus.ENABLED);\n    this.updateEnabledPlugins();\n  }\n\n  public async disable(name: string) {\n    const status = this.getStatus(name);\n    if (status === PluginStatus.UNREGISTERED) {\n      throw new errors.GenericError(`No plugin registered as ${name}`);\n    }\n    if (status === PluginStatus.ENABLING) {\n      throw new errors.GenericError(`Still enabling plugin ${name}`);\n    }\n    if (status === PluginStatus.DISABLING) {\n      throw new errors.GenericError(`Already disabling plugin ${name}`);\n    }\n    if (status === PluginStatus.DISABLED) {\n      throw new errors.GenericError(`Plugin ${name} already disabled`);\n    }\n\n    // TODO: require that no other plugin has this as a dependency, notify user otherwise\n    errors.assert(status === PluginStatus.ENABLED);\n    this.setStatus(name, PluginStatus.DISABLING);\n\n    const plugin_info = this.plugin_infos[name];\n    if (!plugin_info) {\n      throw new Error(`Enabled plugin ${name} missing from info?`);\n    }\n    if (!plugin_info.api) {\n      throw new Error(`Enabled plugin ${name} missing api?`);\n    }\n    const plugin = PLUGINS[name];\n    if (!plugin) {\n      throw new Error(`Enabled plugin ${name} missing from registration?`);\n    }\n    await plugin.disable(plugin_info.api, plugin_info.value);\n    delete this.plugin_infos[name];\n    this.updateEnabledPlugins();\n  }\n}\n\nexport const registerPlugin = function<V = void>(\n  plugin_metadata: PluginMetadata,\n  enable: PluginEnableFn<V>,\n  disable: PluginDisableFn<V>,\n) {\n  plugin_metadata.version = plugin_metadata.version || 1;\n  plugin_metadata.author = plugin_metadata.author || 'anonymous';\n\n  // Create the plugin object\n  // Plugin stores all data about a plugin, including metadata\n  // plugin.value contains the actual resolved value\n  const plugin: RegisteredPlugin<V> = {\n    ..._.cloneDeep(plugin_metadata),\n    enable,\n    disable: disable || _.once(function(api: PluginApi) {\n      api.deregisterAll();\n      throw new Error(\n        `The plugin '${plugin.name}' was disabled but doesn't support online disable functionality. Refresh to disable.`\n      );\n    }),\n  };\n  PLUGINS[plugin.name] = plugin;\n};\n\n// exports\nexport function all() { return PLUGINS; }\nexport function getPlugin(name: string) { return PLUGINS[name]; }\nexport function names() { return (_.keys(PLUGINS)).sort(); }\n","import * as errors from '../../shared/utils/errors';\n\nimport { Row, SerializedPath } from './types';\n\n// represents a tree-traversal starting from the root going down\n// should be immutable\nexport default class Path {\n  public readonly parent: Path | null;\n  public readonly row: Row;\n\n  public static rootRow(): Row {\n    return 0;\n  }\n\n  public static root() {\n    return new Path(null, Path.rootRow());\n  }\n\n  public static loadFromAncestry(ancestry: SerializedPath): Path {\n    if (ancestry.length === 0) {\n      return Path.root();\n    }\n    const row: Row = ancestry.pop() as Row;\n    const parent = Path.loadFromAncestry(ancestry);\n    return parent.child(row);\n  }\n\n  constructor(parent: Path | null, row: Row) {\n    this.parent = parent;\n    this.row = row;\n  }\n\n  public isRoot(): boolean {\n    return this.row === Path.rootRow();\n  }\n\n  // gets a list of IDs\n  public getAncestry(): SerializedPath {\n    if (this.parent == null) { // i.e. (this.isRoot())\n      return [];\n    }\n    const ancestors = this.parent.getAncestry();\n    ancestors.push(this.row);\n    return ancestors;\n  }\n\n  // returns an array representing the ancestry of a row,\n  // up until the ancestor specified by the `stop` parameter\n  // i.e. [stop, stop's child, ... , row's parent , row]\n  public getAncestryPaths(stop: Path = Path.root()): Array<Path> {\n    const ancestors: Array<Path> = [];\n    let path: Path = this;\n    while (!path.is(stop)) {\n      if (path.parent == null) {\n        throw new Error(`Failed to get ancestry for ${this} going up until ${stop}`);\n      }\n      ancestors.push(path);\n      path = path.parent;\n    }\n    ancestors.push(stop);\n    ancestors.reverse();\n    return ancestors;\n  }\n\n  // length() {\n  //   if this.parent === null {\n  //     return 0;\n  //   }\n  //   return 1 + this.parent.length();\n  // }\n\n  public child(row: Row): Path {\n    errors.assert(row !== this.row);\n    return new Path(this, row);\n  }\n\n  public isDescendant(other_path: Path): boolean {\n    return this.walkFrom(other_path) !== null;\n  }\n\n  public walkFrom(ancestor: Path): null | Array<Row> {\n    const my_ancestry = this.getAncestry();\n    const their_ancestry = ancestor.getAncestry();\n    if (my_ancestry.length < their_ancestry.length) {\n      return null;\n    }\n    for (let i = 0; i < their_ancestry.length; i++) {\n      if (my_ancestry[i] !== their_ancestry[i]) {\n        return null;\n      }\n    }\n    return my_ancestry.slice(their_ancestry.length);\n  }\n\n  public shedUntil(row: Row): [Array<Row>, Path] | null {\n    let ancestor: Path = this;\n    const path: Array<Row> = [];\n    while (ancestor.row !== row) {\n      if (!ancestor.parent) {\n        return null;\n      }\n      path.push(ancestor.row);\n      ancestor = ancestor.parent;\n    }\n    return [path.reverse(), ancestor];\n  }\n\n  public extend(walk: Array<Row>): Path {\n    let descendent: Path = this;\n    walk.forEach((row) => {\n      descendent = descendent.child(row);\n    });\n    return descendent;\n  }\n\n  // Represents the exact same row\n  public is(other: Path): boolean {\n    if (other === undefined) { return false; }\n    if (this.row !== other.row) { return false; }\n    if (this.parent == null) { return other.parent == null; }\n    if (other.parent == null) { return false; }\n    return this.parent.is(other.parent);\n  }\n}\n","import * as _ from 'lodash';\n// import 'core-js/shim';\n\nimport * as errors from '../../shared/utils/errors';\nimport EventEmitter from './utils/eventEmitter';\nimport * as fn_utils from './utils/functional';\n// import logger from './utils/logger';\nimport { isWhitespace } from './utils/text';\nimport Path from './path';\nimport { DocumentStore } from './datastore';\nimport { InMemory } from '../../shared/data_backend';\nimport {\n  Row, Col, Char, Line, SerializedLine, SerializedBlock\n} from './types';\n\ntype RowInfo = {\n  readonly line: Line;\n  readonly collapsed: boolean;\n  // TODO use Immutable.List?\n  readonly parentRows: Array<Row>;\n  readonly childRows: Array<Row>;\n  readonly pluginData: any;\n};\n\nexport type AttachedChildInfo = {\n  parent_row: Row,\n  parent_index: number,\n  row: Row,\n  child_index: number,\n};\n\n/*\n * Immutable representation of what we know about a row,\n * including all descendants (recursively) by reference.\n * Child is null, if we haven't loaded it yet\n */\n// TODO: rename this to cached Tree?\nexport class CachedRowInfo {\n  public readonly row: Row;\n  public readonly info: RowInfo;\n  // TODO: use immutable list?\n  public readonly children: Array<CachedRowInfo | null>;\n\n  constructor(\n    row: Row,\n    info: RowInfo,\n    children: Array<CachedRowInfo | null>,\n  ) {\n    this.row = row;\n    this.info = info;\n    this.children = children;\n  }\n\n  public clone() {\n    return new CachedRowInfo(\n      this.row, this.info, this.children\n    );\n  }\n\n  public get parentRows() {\n    return this.info.parentRows;\n  }\n  public get childRows() {\n    return this.info.childRows;\n  }\n  public get line() {\n    return this.info.line;\n  }\n  public get collapsed() {\n    return this.info.collapsed;\n  }\n  public get pluginData() {\n    return this.info.pluginData;\n  }\n\n  public setChildren(children: Array<CachedRowInfo | null>): CachedRowInfo {\n    return new CachedRowInfo(this.row, this.info, children);\n  }\n  private setInfo(info: RowInfo): CachedRowInfo {\n    return new CachedRowInfo(this.row, info, this.children);\n  }\n  public setLine(line: Line): CachedRowInfo {\n    const info: RowInfo = Object.assign({}, this.info, { line });\n    return this.setInfo(info);\n  }\n  public setCollapsed(collapsed: boolean): CachedRowInfo {\n    const info: RowInfo = Object.assign({}, this.info, { collapsed });\n    return this.setInfo(info);\n  }\n  public setChildRows(childRows: Array<Row>): CachedRowInfo {\n    const info: RowInfo = Object.assign({}, this.info, { childRows });\n    return this.setInfo(info);\n  }\n  public setParentRows(parentRows: Array<Row>): CachedRowInfo {\n    const info: RowInfo = Object.assign({}, this.info, { parentRows });\n    return this.setInfo(info);\n  }\n  public setPluginData(pluginData: any): CachedRowInfo {\n    const info: RowInfo = Object.assign({}, this.info, { pluginData });\n    return this.setInfo(info);\n  }\n}\n\nclass DocumentCache {\n  private cache: {[row: number]: CachedRowInfo};\n\n  constructor() {\n    this.cache = {};\n  }\n\n  public clear() {\n    this.cache = {};\n  }\n\n  public loadRow(row: Row, info: RowInfo) {\n    const cached = new CachedRowInfo(row, info, info.childRows.map((childRow) => {\n      return this.get(childRow);\n    }));\n    this.set(row, cached);\n    return cached;\n  }\n\n  public isCached(row: Row) {\n    return !!this.get(row);\n  }\n\n  /*\n   * Updates childRows for a given row\n   * Call this function if a row changed\n   */\n  private bubbleUpdate(row: Row) {\n    const cachedRow = this.get(row);\n    if (!cachedRow) {\n      return;\n    }\n    cachedRow.parentRows.forEach((parentRow) => {\n      const parentCachedRow = this.get(parentRow);\n      if (!parentCachedRow) {\n        return;\n      }\n      // NOTE: this will cause more bubbled updates\n      this.set(parentRow, this.updateChildren(parentCachedRow));\n    });\n  }\n\n  private set(row: Row, cachedRow: CachedRowInfo) {\n    this.cache[row] = cachedRow;\n    this.bubbleUpdate(row);\n  }\n\n  private update(row: Row, updateFn: (info: CachedRowInfo) => CachedRowInfo, force?: boolean) {\n    const cachedRow = this.get(row);\n    if (!cachedRow) {\n      if (force) {\n        throw new Error(`Updating failed - Row ${row} was not cached`);\n      }\n      return false;\n    }\n    this.set(row, updateFn(cachedRow));\n    return true;\n  }\n\n  public get(row: Row) {\n    const cachedRow = this.cache[row];\n    if (!cachedRow) {\n      return null;\n    }\n    return cachedRow;\n  }\n\n  private updateChildren(cachedRow: CachedRowInfo) {\n    return cachedRow.setChildren(\n      cachedRow.childRows.map((childRow) => this.get(childRow))\n    );\n  }\n\n  public setLine(row: Row, line: Line) {\n    this.update(row, (cachedRow) => cachedRow.setLine(line), true);\n  }\n  public setCollapsed(row: Row, collapsed: boolean) {\n    this.update(row, (cachedRow) => cachedRow.setCollapsed(collapsed), true);\n  }\n  public setChildRows(row: Row, childRows: Array<Row>) {\n    this.update(row, (cachedRow) =>\n      this.updateChildren(cachedRow.setChildRows(childRows))\n    , true);\n  }\n  public setParentRows(row: Row, parentRows: Array<Row>) {\n    this.update(row, (cachedRow) => cachedRow.setParentRows(parentRows), true);\n  }\n  public setPluginData(row: Row, pluginData: any) {\n    this.update(row, (cachedRow) => cachedRow.setPluginData(pluginData), true);\n  }\n}\n\n/*\nDocument is a wrapper class around the actual datastore, providing methods to manipulate the document\nthe document itself includes:\n  - the text in each line, including text properties like bold/italic\n  - the parent/child relationships and collapsed-ness of lines\nalso deals with loading the initial document from the datastore, and serializing the document to a string\n\nCurrently, the separation between the Session and Document classes is not very good.  (see session.ts)\n*/\n\ntype SearchOptions = {nresults?: number, case_sensitive?: boolean};\n\nexport default class Document extends EventEmitter {\n  public cache: DocumentCache;\n  public store: DocumentStore;\n  public name: string;\n  public root: Path;\n\n  constructor(store: DocumentStore, name = '') {\n    super();\n    this.cache = new DocumentCache();\n    this.store = store;\n    this.name = name;\n    this.root = Path.root();\n    return this;\n  }\n\n\n  public async _newChild(parent: Row, index = -1): Promise<AttachedChildInfo> {\n    const row = await this.store.getNew();\n\n    // NOTE: order is important for caching.\n    // - first emit async so plugins can prepare for what will happen\n    // - then load regular data (attach hooks can use cached plugin data)\n    // - lastly update plugin data (plugin data knows attached state)\n\n    await this.emitAsync('childAdded', { row, parent });\n\n    // necessary only for speed reasons\n    this.cache.loadRow(row, {\n      line: [], collapsed: false,\n      childRows: [], parentRows: [], // parent will get added\n      pluginData: {},\n    });\n\n    const [ info ] = await Promise.all([\n      this._attach(row, parent, index),\n      // purely to populate the cache\n      this.store.setDetachedParent(row, null),\n    ]);\n\n    await this.updateCachedPluginData(row);\n    return info;\n  }\n\n  public async getInfo(row: Row): Promise<CachedRowInfo> {\n    errors.assert(row != null, 'Cannot get info for undefined');\n    const cached = this.cache.get(row);\n    if (cached !== null) {\n      return cached;\n    }\n\n    const [\n      line, collapsed, children, parents, pluginData\n    ] = await Promise.all<Line, boolean, Array<Row>, Array<Row>, any>([\n      this.store.getLine(row),\n      this.store.getCollapsed(row),\n      this.store.getChildren(row),\n      this.store.getParents(row),\n      this.applyHookAsync('pluginRowContents', {}, { row }),\n    ]);\n    const info: RowInfo = {\n      line, collapsed,\n      parentRows: parents,\n      childRows: children,\n      pluginData,\n    };\n    return this.cache.loadRow(row, info);\n  }\n\n  public async forceLoadTree(row = this.root.row, ignoreCollapsed = false) {\n    const cachedRow = await this.getInfo(row);\n\n    if (ignoreCollapsed || !cachedRow.collapsed) {\n      await Promise.all(\n        cachedRow.childRows.map(\n          async (childRow) => await this.forceLoadTree(childRow)\n        )\n      );\n    }\n  }\n\n  // TODO: actually use this\n  public async forceLoadPath(path: Path) {\n    const ancestry = path.getAncestry();\n    await Promise.all(\n      ancestry.map(async (row) => {\n        await this.getInfo(row);\n      })\n    );\n  }\n\n  public async updateCachedPluginData(row: Row) {\n    if (this.cache.isCached(row)) {\n      const pluginData = await this.applyHookAsync('pluginRowContents', {}, { row });\n      this.cache.setPluginData(row, pluginData);\n    } else {\n      await this.getInfo(row);\n    }\n  }\n\n  public async getLine(row: Row) {\n    return (await this.getInfo(row)).line;\n  }\n\n  public async getText(row: Row) {\n    return (await this.getLine(row)).join('');\n  }\n\n  public async getChar(row: Row, col: Col) {\n    return (await this.getLine(row))[col];\n  }\n\n  public async setLine(row: Row, line: Line) {\n    this.cache.setLine(row, line);\n    await this.store.setLine(row, line);\n  }\n\n  // get word at this location\n  // if on a whitespace character, return nothing\n  public async getWord(row: Row, col: Col) {\n    const text = await this.getLine(row);\n\n    if (isWhitespace(text[col])) {\n      return '';\n    }\n\n    let start = col;\n    let end = col;\n    while ((start > 0) && !isWhitespace(text[start - 1])) {\n      start -= 1;\n    }\n    while ((end < text.length - 1) && !isWhitespace(text[end + 1])) {\n      end += 1;\n    }\n    let word = text.slice(start, end + 1).join('');\n    // remove leading and trailing punctuation\n    word = word.replace(/^[-.,()&$#!\\[\\]{}\"']+/g, '');\n    word = word.replace(/[-.,()&$#!\\[\\]{}\"']+$/g, '');\n    return word;\n  }\n\n  public async writeChars(row: Row, col: Col, chars: Array<Char>) {\n    const line = (await this.getLine(row)).slice();\n    line.splice(col, 0, ...chars);\n    return await this.setLine(row, line);\n  }\n\n  public async deleteChars(row: Row, col: Col, num: number): Promise<Line> {\n    const line = await this.getLine(row);\n    const deleted = line.splice(col, num);\n    await this.setLine(row, line);\n    return deleted;\n  }\n\n  public async getLength(row: Row) {\n    return (await this.getLine(row)).length;\n  }\n\n  // structure\n\n  public async _getChildren(row: Row, min = 0, max = -1): Promise<Array<Row>> {\n    const info = await this.getInfo(row);\n    return fn_utils.getSlice(info.childRows, min, max);\n  }\n\n  private async _setChildren(row: Row, children: Array<Row>) {\n    this.cache.setChildRows(row, children);\n    return await this.store.setChildren(row, children);\n  }\n\n\n  private async _getParents(row: Row): Promise<Array<Row>> {\n    const info = await this.getInfo(row);\n    return info.parentRows;\n  }\n\n  private async _setParents(row: Row, parent_rows: Array<Row>) {\n    this.cache.setParentRows(row, parent_rows);\n    return await this.store.setParents(row, parent_rows);\n  }\n\n  public async getChildren(parent_path: Path): Promise<Array<Path>> {\n    return (await this._getChildren(parent_path.row)).map(row => parent_path.child(row));\n  }\n\n  public async hasChildren(row: Row) {\n    return (await this._getChildren(row)).length > 0;\n  }\n\n  public async hasChild(parent_row: Row, row: Row): Promise<boolean> {\n    return (await this._getChildren(parent_row)).indexOf(row) !== -1;\n  }\n\n  public async getSiblings(path: Path) {\n    if (path.parent == null) { // i.e. (path.isRoot())\n      return [path];\n    }\n    return await this.getChildren(path.parent);\n  }\n\n  public async nextClone(path: Path): Promise<Path> {\n    if (path.parent == null) {\n      return path;\n    }\n    const parents = await this._getParents(path.row);\n    let i = parents.indexOf(path.parent.row);\n    errors.assert(i > -1);\n    let new_parent_path;\n    while (true) {\n      i = (i + 1) % parents.length;\n      let new_parent = parents[i];\n      new_parent_path = await this.canonicalPath(new_parent);\n      // this happens if the parent got detached\n      if (new_parent_path !== null) {\n        break;\n      }\n    }\n    return new_parent_path.child(path.row);\n  }\n\n  public async indexInParent(child: Path) {\n    const children = await this.getSiblings(child);\n    return _.findIndex(children, sib => sib.row === child.row);\n  }\n\n  public async collapsed(row: Row) {\n    return (await this.getInfo(row)).collapsed;\n  }\n\n  public async setCollapsed(row: Row, collapsed: boolean) {\n    this.cache.setCollapsed(row, collapsed);\n    await this.store.setCollapsed(row, collapsed);\n  }\n\n  public async toggleCollapsed(row: Row) {\n    this.setCollapsed(row, !await this.collapsed(row));\n  }\n\n  // last thing visible nested within row\n  public async walkToLastVisible(row: Row, pathsofar: Array<Row> = []): Promise<Array<Row>> {\n    if (await this.collapsed(row)) {\n      return pathsofar;\n    }\n    const children = await this._getChildren(row);\n    if (children.length === 0) {\n      return pathsofar;\n    }\n    const child = children[children.length - 1];\n    return [child].concat(await this.walkToLastVisible(child));\n  }\n\n  // a node is cloned only if it has multiple parents.\n  // note that this may return false even if it appears multiple times in the display (if its ancestor is cloned)\n  public async isClone(row: Row) {\n    const parents = await this._getParents(row);\n    if (parents.length < 2) { // for efficiency reasons\n      return false;\n    }\n    const attachedParents = await fn_utils.asyncFilter(\n      parents, async (parent) => await this.isAttached(parent));\n    return attachedParents.length > 1;\n  }\n\n  // Figure out which is the canonical one. Right now this is really 'arbitraryInstance'\n  // NOTE: this is not very efficient, in the worst case, but probably doesn't matter\n  public async canonicalPath(row: Row): Promise<Path | null> {\n    errors.assert(row !== null, 'Empty row passed to canonicalPath');\n    if (row === Path.rootRow()) {\n      return this.root;\n    }\n    const parents = await this._getParents(row);\n    for (let i = 0; i < parents.length; i++) {\n      const parentRow = parents[i];\n      const canonicalParent = await this.canonicalPath(parentRow);\n      if (canonicalParent !== null) {\n        return canonicalParent.child(row);\n      }\n    }\n    return null;\n  }\n\n  // Return all ancestor rows, topologically sorted (root is *last*).\n  // Excludes 'row' itself unless options.inclusive is specified\n  // NOTE: includes possibly detached nodes\n  public async allAncestors(\n    row: Row,\n    { inclusive = false }: { inclusive?: boolean } = { }\n  ) {\n    const visited: {[row: number]: boolean} = {};\n    const ancestors: Array<Row> = []; // 'visited' with preserved insert order\n    if (inclusive) {\n      ancestors.push(row);\n    }\n    const visit = async (n: Row) => { // DFS\n      visited[n] = true;\n      const parents = await this._getParents(n);\n      for (let i = 0; i < parents.length; i++) {\n        const parent = parents[i];\n        if (!(parent in visited)) {\n          ancestors.push(parent);\n          await visit(parent);\n        }\n      }\n      return null;\n    };\n    await visit(row);\n    return ancestors;\n  }\n\n  public async _hasChild(parent_row: Row, row: Row) {\n    const children = await this._getChildren(parent_row);\n    const ci = _.findIndex(children, sib => sib === row);\n    return ci !== -1;\n  }\n\n  private async _removeChild(parent_row: Row, row: Row) {\n    const children = await this._getChildren(parent_row);\n    const ci = _.findIndex(children, sib => sib === row);\n    errors.assert(ci !== -1);\n    children.splice(ci, 1);\n    await this._setChildren(parent_row, children);\n\n    const parents = await this._getParents(row);\n    const pi = _.findIndex(parents, par => par === parent_row);\n    parents.splice(pi, 1);\n    await this._setParents(row, parents);\n\n    const info = {\n      parent_row,\n      parent_index: pi,\n      row,\n      child_index: ci,\n    };\n    this.emit('childRemoved', info);\n    return info;\n  }\n\n  private async _addChild(parent_row: Row, row: Row, index: number): Promise<AttachedChildInfo> {\n    const children = await this._getChildren(parent_row);\n    errors.assert(index <= children.length);\n    if (index === -1) {\n      index = children.length;\n    }\n    children.splice(index, 0, row);\n    await this._setChildren(parent_row, children);\n\n    const parents = await this._getParents(row);\n    parents.push(parent_row);\n    await this._setParents(row, parents);\n    const info = {\n      parent_row,\n      parent_index: parents.length - 1,\n      row,\n      child_index: index,\n    };\n    return info;\n  }\n\n  public async _detach(row: Row, parent_row: Row) {\n    const wasLast = !(await this.isClone(row));\n\n    await this.emitAsync('beforeDetach', { row, parent_row, last: wasLast });\n    const info = await this._removeChild(parent_row, row);\n    if (wasLast) {\n      await this.store.setDetachedParent(row, parent_row);\n    }\n    await this.emitAsync('afterDetach', { row, parent_row, last: wasLast });\n    return info;\n  }\n\n  public async _attach(child_row: Row, parent_row: Row, index = -1): Promise<AttachedChildInfo> {\n    const isFirst = (await this._getParents(child_row)).length === 0;\n    await this.emitAsync('beforeAttach', { row: child_row, parent_row, first: isFirst});\n    const info = await this._addChild(parent_row, child_row, index);\n    const old_detached_parent = await this.store.getDetachedParent(child_row);\n    if (old_detached_parent !== null) {\n      errors.assert(isFirst);\n      await this.store.setDetachedParent(child_row, null);\n    }\n    await this.emitAsync('afterAttach', { row: child_row, parent_row, first: isFirst, old_detached_parent});\n    return info;\n  }\n\n  public async _move(child_row: Row, old_parent_row: Row, new_parent_row: Row, index = -1) {\n    await this.emitAsync('beforeMove', {\n      row: child_row, old_parent: old_parent_row, new_parent: new_parent_row,\n    });\n\n    const remove_info = await this._removeChild(old_parent_row, child_row);\n    if ((old_parent_row === new_parent_row) && (index > remove_info.child_index)) {\n      index = index - 1;\n    }\n    const add_info = await this._addChild(new_parent_row, child_row, index);\n\n    await this.emitAsync('afterMove', {\n      row: child_row, old_parent: old_parent_row, new_parent: new_parent_row,\n    });\n\n    return {\n      old: remove_info,\n      new: add_info,\n    };\n  }\n\n  // attaches a detached child to a parent\n  // the child should not have a parent already\n  public async attachChild(parent: Path, child: Path, index = -1): Promise<Path> {\n    return (await this.attachChildren(parent, [child], index))[0];\n  }\n\n  public async attachChildren(parent: Path, new_children: Array<Path>, index = -1): Promise<Array<Path>> {\n    await this._attachChildren(parent.row, new_children.map(x => x.row), index);\n    // for child in new_children\n    //   child.setParent parent\n    return new_children;\n  }\n\n  public async _attachChildren(parent: Row, new_children: Array<Row>, index = -1) {\n    for (let i = 0; i < new_children.length; i++) {\n      const child = new_children[i];\n      await this._attach(child, parent, index);\n      if (index >= 0) {\n        index += 1;\n      }\n    }\n    return null;\n  }\n\n  // given two paths, returns\n  // 1. the common ancestor of the paths\n  // 2. the array of ancestors between common ancestor and path1\n  // 3. the array of ancestors between common ancestor and path2\n  public async getCommonAncestor(path1: Path, path2: Path): Promise<[Path, Array<Path>, Array<Path>]> {\n    const ancestors1: Array<Path> = path1.getAncestryPaths();\n    const ancestors2: Array<Path> = path2.getAncestryPaths();\n\n    const commonAncestry = _.takeWhile(\n      _.zip(ancestors1, ancestors2),\n      (pair: any) => (pair[0] && pair[1] && pair[0].is(pair[1]))\n    ).map((pair) => pair[0]);\n\n    const lastCommon = _.last(commonAncestry);\n    if (lastCommon == null) {\n        throw new Error(`No common ancestor found between ${path1} and ${path2}`);\n    }\n    const firstDifference = commonAncestry.length;\n    return [lastCommon, ancestors1.slice(firstDifference), ancestors2.slice(firstDifference)];\n  }\n\n  // returns whether an row is actually reachable from the root node\n  // if something is not detached, it will have a parent, but the parent wont mention it as a child\n  public async isAttached(row: Row) {\n    return (await this.allAncestors(row, {inclusive: true})).indexOf(this.root.row) !== -1;\n  }\n\n  public async isValidPath(path: Path) {\n    let parent_row: Row = 0;\n    const ancestry = path.getAncestry();\n    for (let i = 0; i < ancestry.length; i++) {\n      const row = ancestry[i];\n      if (!await this.hasChild(parent_row, row)) {\n        return false;\n      }\n      parent_row = row;\n    }\n    return true;\n  }\n\n  public async getSiblingBefore(path: Path) {\n    return await this.getSiblingOffset(path, -1);\n  }\n\n  public async getSiblingAfter(path: Path) {\n    return await this.getSiblingOffset(path, 1);\n  }\n\n  public async getSiblingOffset(path: Path, offset: number) {\n    const arr = await this.getSiblingRange(path, offset, offset);\n    if (!arr.length) {\n      return null;\n    }\n    return arr[0];\n  }\n\n  public async getSiblingRange(path: Path, min_offset: number, max_offset: number) {\n    const [ index, siblings ] = await Promise.all([\n      this.indexInParent(path),\n      this.getSiblings(path),\n    ]);\n    if (index + max_offset < 0) { return []; }\n    const arr = fn_utils.getSlice(\n      siblings,\n      Math.max(index + min_offset, 0),\n      index + max_offset,\n    );\n    return arr;\n  }\n\n  public async getChildRange(path: Path, min: number, max: number): Promise<Array<Path>> {\n    return (await this._getChildren(path.row, min, max)).map(function(child_row) {\n      return path.child(child_row);\n    });\n  }\n\n  public async newChild(path: Path, index = -1) {\n    const { row } = await this._newChild(path.row, index);\n    return path.child(row);\n  }\n\n  private async* traverseSubtree(root: Path): AsyncIterableIterator<Path> {\n    const visited_rows: {[row: number]: boolean} = {};\n    let that = this;\n\n    async function* helper(path: Path): AsyncIterableIterator<Path> {\n      if (path.row in visited_rows) {\n        return;\n      }\n      visited_rows[path.row] = true;\n      yield path;\n      const children = await that.getChildren(path);\n      for (let i = 0; i < children.length; i++) {\n        yield* await helper(children[i]);\n      }\n    }\n    yield* await helper(root);\n  }\n\n  public async search(root: Path, query: string, options: SearchOptions = {}) {\n    const { nresults = 10, case_sensitive = false } = options;\n    const results: Array<{\n      path: Path,\n      matches: Array<number>,\n    }> = []; // list of (path, index) pairs\n\n    if (query.length === 0) {\n      return results;\n    }\n\n    const canonicalize = (x: string) => case_sensitive ? x : x.toLowerCase();\n    const query_words =\n      query.split(/\\s/g).filter(x => x.length).map(canonicalize);\n\n    const paths = this.traverseSubtree(root);\n    for await (let path of paths) {\n      const text = await this.getText(path.row);\n      const line = canonicalize(text);\n      const matches: Array<number> = [];\n      if (_.every(query_words.map((word) => {\n        const index = line.indexOf(word);\n        if (index === -1) { return false; }\n        for (let j = index; j < index + word.length; j++) {\n          matches.push(j);\n        }\n        return true;\n      }))) {\n        results.push({ path, matches });\n      }\n      if (nresults > 0 && results.length === nresults) {\n        break;\n      }\n    }\n    return results;\n  }\n\n  // important: serialized automatically garbage collects\n  public async serializeRow(row = this.root.row): Promise<SerializedLine> {\n    const text = await this.getText(row);\n\n    const struct: SerializedLine = {\n      text,\n    };\n    if (await this.collapsed(row)) {\n      struct.collapsed = true;\n    }\n    const plugins = await this.applyHookAsync('serializeRow', {}, {row});\n    if (Object.keys(plugins).length > 0) {\n      struct.plugins = plugins;\n    }\n\n    return struct;\n  }\n\n  public async serialize(\n    row = this.root.row,\n    options: {pretty?: boolean} = {},\n    serialized: {[row: number]: SerializedBlock} = {}\n  ): Promise<SerializedBlock> {\n    if (row in serialized) {\n      const clone_struct: any = serialized[row];\n      clone_struct.id = row;\n      return { clone: row };\n    }\n\n    const struct: any = await this.serializeRow(row);\n    // NOTE: this must be done in order due to cloning\n    // const children = await Promise.all((await this._getChildren(row)).map(\n    //   async (childrow) => await this.serialize(childrow, options, serialized)\n    // ));\n    const childRows = await this._getChildren(row);\n    let children: Array<any> = [];\n    for (let i = 0; i < childRows.length; i++) {\n      children.push(\n        await this.serialize(childRows[i], options, serialized)\n      );\n    }\n    if (children.length) {\n      struct.children = children;\n    }\n\n    serialized[row] = struct;\n\n    if (options.pretty) {\n      if ((children.length === 0) &&\n          (!await this.isClone(row)) &&\n          (!struct.plugins)\n         ) {\n        return struct.text;\n      }\n    }\n    return struct;\n  }\n\n  public async loadTo(\n    // TODO: serialized is a SerializedBlock\n    serialized: any, parent_path = this.root, index = -1,\n    id_mapping: {[key: number]: Row} = {}, replace_empty = false\n  ) {\n    if (serialized.clone) {\n      // NOTE: this assumes we load in the same order we serialize\n      errors.assert(serialized.clone in id_mapping);\n      const row = id_mapping[serialized.clone];\n      const clone_path = parent_path.child(row);\n      await this.attachChild(parent_path, clone_path, index);\n      return clone_path;\n    }\n\n    const children = await this.getChildren(parent_path);\n    // if parent_path has only one child and it's empty, delete it\n    let path;\n    if (replace_empty && children.length === 1 &&\n        ((await this.getLine(children[0].row)).length === 0)) {\n      path = children[0];\n    } else {\n      path = await this.newChild(parent_path, index);\n    }\n\n    if (typeof serialized === 'string') {\n      await this.setLine(path.row, serialized.split(''));\n    } else {\n      if (serialized.id) {\n        id_mapping[serialized.id] = path.row;\n      }\n      const line = serialized.text.split('');\n\n      await Promise.all([\n        this.setLine(path.row, line),\n        this.setCollapsed(path.row, serialized.collapsed),\n      ]);\n\n      if (serialized.children) {\n        for (let i = 0; i < serialized.children.length; i++) {\n          const serialized_child = serialized.children[i];\n          await this.loadTo(serialized_child, path, -1, id_mapping);\n        }\n      }\n    }\n\n    await this.emitAsync('loadRow', path, serialized.plugins || {});\n\n    return path;\n  }\n\n  public async load(serialized_rows: Array<SerializedBlock>) {\n    const id_mapping = {};\n    for (let i = 0; i < serialized_rows.length; i++) {\n      const serialized_row = serialized_rows[i];\n      await this.loadTo(serialized_row, this.root, -1, id_mapping, true);\n    }\n  }\n\n  public async loadEmpty() {\n    await this.load(['']);\n  }\n}\n\nexport class InMemoryDocument extends Document {\n  constructor() {\n    super(new DocumentStore(new InMemory()));\n  }\n}\n","/*\nmutations mutate a document within a session, and are undoable\neach mutation should implement a constructor, as well as the following methods:\n\n    str: () -> string\n        prints itself\n    async mutate: (session) -> void\n        takes a session and acts on it (mutates the session)\n    async rewind: (session) -> void\n        takes a session, assumed be in the state right after the mutation was applied,\n        and returns a list of mutations for undoing it\n\nthe mutation may also optionally implement\n\n    async validate: (session) -> bool\n        returns whether this action is valid at the time (i.e. whether it is okay to call mutate)\n    async remutate: (session) -> void\n        takes a session, and acts on it.  assumes that mutate has been called once already\n        by default, remutate is the same as mutate.\n        it should be implemented only if it is more efficient than the mutate implementation\n    async moveCursor: (cursor) -> void\n        takes a cursor, and moves it according to how the cursor should move\n*/\n\nimport * as _ from 'lodash';\n\nimport * as errors from '../../shared/utils/errors';\nimport Session from './session';\nimport Cursor from './cursor';\nimport { AttachedChildInfo } from './document';\nimport { Row, Col, Char, Chars, SerializedBlock, SerializedPath, Line } from './types';\nimport Path from './path';\n\n// validate inserting id as a child of parent_id\nconst validateRowInsertion = async function(\n  session: Session, parent_id: number, id: number,\n  options: {noSiblingCheck?: boolean} = {}\n) {\n  // check that there won't be doubled siblings\n  if (!options.noSiblingCheck) {\n    if (await session.document._hasChild(parent_id, id)) {\n      session.showMessage('Cloned rows cannot be inserted as siblings', {text_class: 'error'});\n      return false;\n    }\n  }\n\n  // check that there are no cycles\n  // Precondition: tree is not already circular\n  // It is sufficient to check if the row is an ancestor of the new parent,\n  // because if there was a clone underneath the row which was an ancestor of 'parent',\n  // then 'row' would also be an ancestor of 'parent'.\n  if (_.includes(await session.document.allAncestors(parent_id, { inclusive: true }), id)) {\n    session.showMessage('Cloned rows cannot be nested under themselves', {text_class: 'error'});\n    return false;\n  }\n  return true;\n};\n\nexport default class Mutation {\n  public str() {\n    return '';\n  }\n  public async validate(_session: Session): Promise<boolean> {\n    return true;\n  }\n  public async mutate(_session: Session): Promise<void> {\n    throw new errors.NotImplemented();\n  }\n  public async rewind(_session: Session): Promise<Array<Mutation>> {\n    return [];\n  }\n  public async remutate(session: Session): Promise<void> {\n    return this.mutate(session);\n  }\n  public async moveCursor(_cursor: Cursor): Promise<void> {\n    return;\n  }\n}\n\nexport class AddChars extends Mutation {\n  private row: Row;\n  private col: Col;\n  private chars: Array<Char>;\n\n  constructor(row: Row, col: Col, chars: Array<Char>) {\n    super();\n    this.row = row;\n    this.col = col;\n    this.chars = chars;\n  }\n\n  public str() {\n    return `row ${this.row}, col ${this.col}, nchars ${this.chars.length}`;\n  }\n\n  public async mutate(session: Session) {\n    await session.document.writeChars(this.row, this.col, this.chars);\n  }\n\n  public async rewind() {\n    return [\n      new DelChars(this.row, this.col, this.chars.length),\n    ];\n  }\n\n  public async moveCursor(cursor: Cursor) {\n    if (!(cursor.path.row === this.row)) {\n      return;\n    }\n    if (cursor.col >= this.col) {\n      await cursor.setCol(cursor.col + this.chars.length);\n    }\n  }\n}\n\nexport class DelChars extends Mutation {\n  private row: Row;\n  private col: Col;\n  private nchars: number;\n  public deletedChars: Line = [];\n\n  constructor(row: Row, col: Col, nchars: number) {\n    super();\n    this.row = row;\n    this.col = col;\n    this.nchars = nchars;\n  }\n\n  public str() {\n    return `row ${this.row}, col ${this.col}, nchars ${this.nchars}`;\n  }\n\n  public async mutate(session: Session) {\n    this.deletedChars = await session.document.deleteChars(this.row, this.col, this.nchars);\n  }\n\n  public async rewind() {\n    return [\n      new AddChars(this.row, this.col, this.deletedChars),\n    ];\n  }\n\n  public async moveCursor(cursor: Cursor) {\n    if (cursor.row !== this.row) {\n      return;\n    }\n    if (cursor.col < this.col) {\n      return;\n    } else if (cursor.col < this.col + this.nchars) {\n      await cursor.setCol(this.col);\n    } else {\n      await cursor.setCol(cursor.col - this.nchars);\n    }\n  }\n}\n\nexport class ChangeChars extends Mutation {\n  private row: Row;\n  private col: Col;\n  private nchars: number;\n  private transform?: (chars: Chars) => Chars;\n  private newChars?: Array<Char>;\n  private deletedChars: Array<Char> = [];\n  public ncharsDeleted: number = 0;\n\n  constructor(\n    row: Row, col: Col, nchars: number,\n    transform?: (chars: Array<Char>) => Array<Char>, newChars?: Array<Char>,\n  ) {\n    super();\n    this.row = row;\n    this.col = col;\n    this.nchars = nchars;\n    this.transform = transform;\n    this.newChars = newChars;\n  }\n\n  public str() {\n    return `change row ${this.row}, col ${this.col}, nchars ${this.nchars}`;\n  }\n\n  public async mutate(session: Session) {\n    this.deletedChars = await session.document.deleteChars(this.row, this.col, this.nchars);\n    this.ncharsDeleted = this.deletedChars.length;\n    if (this.transform) {\n      this.newChars = this.transform(this.deletedChars);\n      errors.assert(this.newChars.length === this.ncharsDeleted);\n    }\n    if (!this.newChars) {\n      throw new Error('Changechars should receive either transform or newChars');\n    }\n    await session.document.writeChars(this.row, this.col, this.newChars);\n  }\n\n  public async rewind() {\n    if (this.newChars == null) {\n      throw new Error('No new chars after mutation?');\n    }\n    return [\n      new ChangeChars(this.row, this.col, this.newChars.length, undefined, this.deletedChars),\n    ];\n  }\n\n  public async remutate(session: Session) {\n    if (this.newChars == null) {\n      throw new Error('No new chars after mutation?');\n    }\n    await session.document.deleteChars(this.row, this.col, this.ncharsDeleted);\n    await session.document.writeChars(this.row, this.col, this.newChars);\n  }\n\n  // doesn't move cursors\n}\n\nexport class MoveBlock extends Mutation {\n  private path: Path;\n  private parent: Path;\n  private old_parent: Path;\n  private index: number;\n  private old_index: number = -1;\n\n  constructor(path: Path, parent: Path, index: number) {\n    super();\n    this.path = path;\n    this.parent = parent;\n    if (this.path.parent == null) {\n      throw new Error('Can\\'t move root');\n    }\n    this.old_parent = this.path.parent;\n    if (index === undefined) {\n      this.index = -1;\n    } else {\n      this.index = index;\n    }\n  }\n\n  public str() {\n    return `move ${this.path.row} from ${this.old_parent.row} to ${this.parent.row}`;\n  }\n\n  public async validate(session: Session) {\n    if (this.path.isRoot()) {\n      session.showMessage('Cannot detach root', {text_class: 'error'});\n      return false;\n    }\n    // if parent is the same, don't do sibling clone validation\n    const sameParent = this.parent.row === this.old_parent.row;\n    return await validateRowInsertion(session, this.parent.row, this.path.row, {noSiblingCheck: sameParent});\n  }\n\n  public async mutate(session: Session) {\n    const info = await session.document._move(this.path.row, this.old_parent.row, this.parent.row, this.index);\n    this.old_index = info.old.child_index;\n  }\n\n  public async rewind() {\n    return [\n      new MoveBlock(this.parent.extend([this.path.row]), this.old_parent, this.old_index),\n    ];\n  }\n\n  public async moveCursor(cursor: Cursor) {\n    const walk = cursor.path.walkFrom(this.path);\n    if (walk === null) {\n      return;\n    }\n    // TODO: other cursors could also\n    // be on a relevant path..\n    await cursor._setPath((this.parent.extend([this.path.row])).extend(walk));\n  }\n}\n\nexport class AttachBlocks extends Mutation {\n  private parent: Row;\n  private cloned_rows: Array<Row>;\n  private nrows: number;\n  private index: number;\n\n  constructor(parent: Row, cloned_rows: Array<Row>, index: number) {\n    super();\n    this.parent = parent;\n    this.cloned_rows = cloned_rows;\n    this.nrows = this.cloned_rows.length;\n    if (index === undefined) {\n      this.index = -1;\n    } else {\n      this.index = index;\n    }\n  }\n\n  public str() {\n    return `parent ${this.parent}, index ${this.index}`;\n  }\n\n  public async validate(session: Session) {\n    for (let i = 0; i < this.cloned_rows.length; i++) {\n      const row = this.cloned_rows[i];\n      if (!await validateRowInsertion(session, this.parent, row)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  public async mutate(session: Session) {\n    await session.document._attachChildren(this.parent, this.cloned_rows, this.index);\n  }\n\n  public async rewind() {\n    return [\n      new DetachBlocks(this.parent, this.index, this.nrows),\n    ];\n  }\n}\n\ntype DetachBlocksOptions = {addNew?: boolean, noNew?: boolean};\nexport class DetachBlocks extends Mutation {\n  private parent: Row;\n  private index: number;\n  private nrows: number;\n  public deleted: Array<Row> = [];\n  private next: SerializedPath = [];\n  private created_info: AttachedChildInfo | null = null;\n  private options: DetachBlocksOptions;\n\n  constructor(parent: Row, index: number, nrows: number = 1, options: DetachBlocksOptions = {}) {\n    super();\n    this.parent = parent;\n    this.index = index;\n    this.nrows = nrows;\n    this.options = options;\n  }\n\n  public str() {\n    return `parent ${this.parent}, index ${this.index}, nrows ${this.nrows}`;\n  }\n\n  public async mutate(session: Session) {\n    this.deleted = await session.document._getChildren(this.parent, this.index, this.index + this.nrows - 1);\n\n    for (let i = 0; i < this.deleted.length; i++) {\n      const row = this.deleted[i];\n      await session.document._detach(row, this.parent);\n    }\n\n    this.created_info = null;\n    if (this.options.addNew) {\n      const info = await session.document._newChild(this.parent, this.index);\n      this.created_info = info;\n    }\n\n    const children = await session.document._getChildren(this.parent);\n\n    // a path, relative to the parent\n    let next: Array<Row>;\n\n    if (this.index < children.length) {\n      next = [children[this.index]];\n    } else {\n      if (this.index === 0) {\n        next = [];\n        if (this.parent === session.document.root.row) {\n          if (!this.options.noNew) {\n            const info = await session.document._newChild(this.parent);\n            this.created_info = info;\n            next = [info.row];\n          }\n        }\n      } else {\n        const child = children[this.index - 1];\n        const walk = await session.document.walkToLastVisible(child);\n        next = [child].concat(walk);\n      }\n    }\n\n    this.next = next;\n  }\n\n  public async rewind() {\n    const mutations: Array<Mutation> = [];\n    if (this.created_info !== null) {\n      mutations.push(new DetachBlocks(this.parent, this.created_info.child_index, 1, {noNew: true}));\n    }\n    mutations.push(new AttachBlocks(this.parent, this.deleted, this.index));\n    return mutations;\n  }\n\n  public async remutate(session: Session) {\n    for (let i = 0; i < this.deleted.length; i++) {\n      const row = this.deleted[i];\n      await session.document._detach(row, this.parent);\n    }\n    if (this.created_info !== null) {\n      await session.document._attach(this.created_info.row, this.parent, this.created_info.child_index);\n    }\n  }\n\n  public async moveCursor(cursor: Cursor) {\n    const result = cursor.path.shedUntil(this.parent);\n    if (result === null) {\n      return;\n    }\n    const [walk, ancestor] = result;\n    if (walk.length === 0) {\n      return;\n    }\n    const child = walk[0];\n    if ((this.deleted.indexOf(child)) === -1) {\n      return;\n    }\n    await cursor.setPosition(ancestor.extend(this.next), 0);\n  }\n}\n\n// creates new blocks (as opposed to attaching ones that already exist)\nexport class AddBlocks extends Mutation {\n  private parent: Path;\n  private serialized_rows: Array<SerializedBlock>;\n  private index: number;\n  private nrows: number;\n  public added_rows: Array<Path> = [];\n\n  constructor(parent: Path, index: number, serialized_rows: Array<SerializedBlock>) {\n    super();\n    this.parent = parent;\n    this.serialized_rows = serialized_rows;\n    if (index === undefined) {\n      this.index = -1;\n    } else {\n      this.index = index;\n    }\n    this.nrows = this.serialized_rows.length;\n  }\n\n  public str() {\n    return `parent ${this.parent.row}, index ${this.index}`;\n  }\n\n  public async mutate(session: Session) {\n    let index = this.index;\n\n    const id_mapping = {};\n    this.added_rows = [];\n    for (let i = 0; i < this.serialized_rows.length; i++) {\n      const serialized_row = this.serialized_rows[i];\n      const row = await session.document.loadTo(serialized_row, this.parent, index, id_mapping);\n      this.added_rows.push(row);\n      index += 1;\n    }\n  }\n\n  public async rewind() {\n    return [\n      new DetachBlocks(this.parent.row, this.index, this.nrows),\n    ];\n  }\n\n  public async remutate(session: Session) {\n    let index = this.index;\n    for (let i = 0; i < this.added_rows.length; i++) {\n      const sib = this.added_rows[i];\n      await session.document.attachChild(this.parent, sib, index);\n      index += 1;\n    }\n  }\n}\n\nexport class ToggleBlock extends Mutation {\n  private row: Row;\n\n  constructor(row: Row) {\n    super();\n    this.row = row;\n  }\n  public str() {\n    return `row ${this.row}`;\n  }\n  public async mutate(session: Session) {\n    await session.document.toggleCollapsed(this.row);\n  }\n  public async rewind() {\n    return [\n      this,\n    ];\n  }\n  // TODO: if a cursor is within the toggle block and their\n  // viewRoot isn't, do a moveCursor?\n}\n","import { isWhitespace } from './utils/text';\nimport EventEmitter from './utils/eventEmitter';\nimport { Row, Col, CursorOptions } from './types';\nimport Path from './path';\nimport Document from './document';\nimport Session from './session';\n\nconst wordRegex = /^[a-z0-9_]+$/i;\n\n// options for word movements, e.g. w/e/b/f/t\ntype WordMovementOptions = {\n  // whether the word should consider all non-whitespace characters\n  whitespaceWord?: boolean,\n  // whether to stop before the character found\n  beforeFound?: boolean,\n  cursor?: CursorOptions,\n};\n\n// TODO: make a view class which includes viewRoot and cursor\n/*\n   Cursor represents a cursor within a session\n   Handles movement logic\n */\nexport default class Cursor extends EventEmitter {\n  public col: Col;\n  public path: Path;\n  public session: Session;\n  public document: Document;\n\n  private moveCol: Col;\n\n  constructor(\n    session: Session, path: Path, col: Col = 0, moveCol: Col | null = null\n  ) {\n    super();\n    this.session = session;\n    this.document = session.document;\n    this.path = path;\n    this.col = col;\n\n    // -1 means last col\n    this.moveCol = moveCol !== null ? moveCol : col;\n  }\n\n  get row() {\n    return this.path.row;\n  }\n\n  public clone() {\n    // paths are immutable so this is okay\n    return new Cursor(this.session, this.path, this.col, this.moveCol);\n  }\n\n  public async _setPath(path: Path) {\n    await this.emitAsync('rowChange', this.path, path);\n    this.path = path;\n  }\n\n  private async _setCol(col: Col) {\n    await this.emitAsync('colChange', this.col, col);\n    this.col = col;\n  }\n\n  public async from(other: Cursor) {\n    await this._setPath(other.path);\n    await this._setCol(other.col);\n    this.moveCol = other.moveCol;\n  }\n\n  public async setPosition(path: Path, col: Col, cursorOptions?: CursorOptions) {\n    await this._setPath(path);\n    await this.setCol(col, cursorOptions);\n  }\n\n  public async setPath(path: Path, cursorOptions?: CursorOptions) {\n    await this._setPath(path);\n    await this._fromMoveCol(cursorOptions);\n  }\n\n  public async setCol(moveCol: Col, cursorOptions: CursorOptions = { pastEnd: true }) {\n    this.moveCol = moveCol;\n    await this._fromMoveCol(cursorOptions);\n    // if moveCol was too far, fix it\n    // NOTE: this should happen for setting column, but not path\n    if (this.moveCol >= 0) {\n      this.moveCol = this.col;\n    }\n  }\n\n  private async _fromMoveCol(cursorOptions: CursorOptions = {}) {\n    const len = await this.document.getLength(this.path.row);\n    const maxcol = len - (cursorOptions.pastEnd ? 0 : 1);\n    let col;\n    if (this.moveCol < 0) {\n      col = Math.max(0, len + this.moveCol + 1);\n    } else {\n      col = Math.max(0, Math.min(maxcol, this.moveCol));\n    }\n    await this._setCol(col);\n  }\n\n  private async _left() {\n    await this.setCol(this.col - 1);\n  }\n\n  private async _right() {\n    await this.setCol(this.col + 1);\n  }\n\n  public async left() {\n    if (this.col > 0) {\n      await this._left();\n    }\n  }\n\n  public async right(\n    cursorOptions: {pastEnd?: boolean} = {}\n  ) {\n    const shift = cursorOptions.pastEnd ? 0 : 1;\n    if (this.col < (await this.document.getLength(this.path.row)) - shift) {\n      await this._right();\n    }\n  }\n\n  public async backIfNeeded() {\n    if (this.col > (await this.document.getLength(this.path.row)) - 1) {\n      await this.left();\n      return true;\n    }\n    return false;\n  }\n\n  public async atVisibleEnd() {\n    if (this.col < (await this.document.getLength(this.path.row)) - 1) {\n      return false;\n    } else {\n      const nextpath = await this.session.nextVisible(this.path);\n      if (nextpath !== null) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  private async _nextChar() {\n    if (this.col < (await this.document.getLength(this.path.row)) - 1) {\n      await this._right();\n      return true;\n    } else {\n      const nextpath = await this.session.nextVisible(this.path);\n      if (nextpath !== null) {\n        await this.setPosition(nextpath, 0);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  public async atVisibleStart() {\n    if (this.col > 0) {\n      return false;\n    } else {\n      const prevpath = await this.session.prevVisible(this.path);\n      if (prevpath !== null) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  private async _prevChar() {\n    if (this.col > 0) {\n      await this._left();\n      return true;\n    } else {\n      const prevpath = await this.session.prevVisible(this.path);\n      if (prevpath !== null) {\n        await this.setPosition(prevpath, -1);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  public async home() {\n    await this.setCol(0);\n    return this;\n  }\n\n  public async end(cursorOptions: CursorOptions = {}) {\n    await this.setCol(cursorOptions.pastEnd ? -1 : -2);\n    return this;\n  }\n\n  public async visibleHome() {\n    let path;\n    if (this.session.viewRoot.isRoot()) {\n      const firstChild = await this.session.nextVisible(this.session.viewRoot);\n      if (firstChild == null) {\n        throw new Error('No next visible for root?');\n      }\n      if (firstChild.parent == null) {\n        throw new Error('Next visible of root was root?');\n      }\n      path = firstChild;\n    } else {\n      path = this.session.viewRoot;\n    }\n    await this.setPosition(path, 0);\n    return this;\n  }\n\n  public async visibleEnd() {\n    const path = await this.session.lastVisible();\n    await this.setPosition(path, 0);\n    return this;\n  }\n\n  public async isInWhitespace(path: Path, col: Col) {\n    const char = await this.document.getChar(path.row, col);\n    return isWhitespace(char);\n  }\n\n  public async isInWord(path: Path, col: Col, matchChar: string) {\n    if (isWhitespace(matchChar)) {\n      return false;\n    }\n\n    const char = await this.document.getChar(path.row, col);\n    if (isWhitespace(char)) {\n      return false;\n    }\n\n    if (wordRegex.test(char)) {\n      return wordRegex.test(matchChar);\n    } else {\n      return !(wordRegex.test(matchChar));\n    }\n  }\n\n  // return function that sees whether we're still in the word\n  private _getWordCheck(options: WordMovementOptions, matchChar: string) {\n    if (options.whitespaceWord) {\n      return async (path: Path, col: Col) => {\n        return !(await this.isInWhitespace(path, col));\n      };\n    } else {\n      return async (path: Path, col: Col) => await this.isInWord(path, col, matchChar);\n    }\n  }\n\n  public async beginningWord(options: WordMovementOptions = {}) {\n    if (await this.atVisibleStart()) {\n      return this;\n    }\n    await this._prevChar();\n    while ((!(await this.atVisibleStart())) &&\n           (await this.isInWhitespace(this.path, this.col))) {\n      await this._prevChar();\n    }\n\n    const wordcheck = this._getWordCheck(\n      options,\n      await this.document.getChar(this.path.row, this.col)\n    );\n    while ((this.col > 0) && (await wordcheck(this.path, this.col - 1))) {\n      await this._left();\n    }\n    return this;\n  }\n\n  public async endWord(options: WordMovementOptions = {}) {\n    if (await this.atVisibleEnd()) {\n      if (options.cursor && options.cursor.pastEnd) {\n        await this._right();\n      }\n      return this;\n    }\n\n    await this._nextChar();\n    while ((!(await this.atVisibleEnd())) &&\n           (await this.isInWhitespace(this.path, this.col))) {\n      await this._nextChar();\n    }\n\n    let end = (await this.document.getLength(this.path.row)) - 1;\n    const wordcheck = this._getWordCheck(\n      options,\n      await this.document.getChar(this.path.row, this.col)\n    );\n    while ((this.col < end) && (await wordcheck(this.path, this.col + 1))) {\n      await this._right();\n    }\n\n    if (options.cursor && options.cursor.pastEndWord) {\n      await this._right();\n    }\n\n    end = (await this.document.getLength(this.path.row)) - 1;\n    if (this.col === end && options.cursor && options.cursor.pastEnd) {\n      await this._right();\n    }\n    return this;\n  }\n\n  public async nextWord(options: WordMovementOptions = {}) {\n    if (await this.atVisibleEnd()) {\n      if (options.cursor && options.cursor.pastEnd) {\n        await this._right();\n      }\n      return this;\n    }\n\n    let end = (await this.document.getLength(this.path.row)) - 1;\n    const wordcheck = this._getWordCheck(\n      options,\n      await this.document.getChar(this.path.row, this.col)\n    );\n    while ((this.col < end) && (await wordcheck(this.path, this.col + 1))) {\n      await this._right();\n    }\n    await this._nextChar();\n\n    let found_next_word = false;\n    let found_whitespace = false;\n    while (true) {\n      if (!await this.isInWhitespace(this.path, this.col)) {\n        if (found_whitespace) {\n          found_next_word = true;\n        }\n        break;\n      }\n      found_whitespace = true;\n      if (await this.atVisibleEnd()) {\n        break;\n      }\n      await this._nextChar();\n    }\n\n    if (!found_next_word) {\n      if (options.cursor && options.cursor.pastEnd) {\n        end = (await this.document.getLength(this.path.row)) - 1;\n        if (this.col === end) {\n          await this._right();\n        }\n      }\n    }\n    return this;\n  }\n\n  public async findNextChar(char: string, options: WordMovementOptions = {}) {\n    const end = (await this.document.getLength(this.path.row)) - 1;\n    if (this.col === end) {\n      return;\n    }\n\n    let col = this.col;\n    if (options.beforeFound) {\n      col += 1;\n    }\n\n    let found: number | null = null;\n    while (col < end) {\n      col += 1;\n      if ((await this.document.getChar(this.path.row, col)) === char) {\n        found = col;\n        break;\n      }\n    }\n\n    if (found === null) {\n      return;\n    }\n\n    await this.setCol(found);\n    if (options.cursor && options.cursor.pastEnd) {\n      await this._right();\n    }\n    if (options.beforeFound) {\n      return await this._left();\n    }\n  }\n\n  public async findPrevChar(char: string, options: WordMovementOptions = {}) {\n    if (this.col === 0) {\n      return;\n    }\n\n    let col = this.col;\n    if (options.beforeFound) {\n      col -= 1;\n    }\n\n    let found: number | null  = null;\n    while (col > 0) {\n      col -= 1;\n      if ((await this.document.getChar(this.path.row, col)) === char) {\n        found = col;\n        break;\n      }\n    }\n\n    if (found === null) {\n      return;\n    }\n\n    await this.setCol(found);\n    if (options.beforeFound) {\n      await this._right();\n    }\n  }\n\n  public async up(cursorOptions: CursorOptions = {}) {\n    const path = await this.session.prevVisible(this.path);\n    if (path !== null) {\n      await this.setPath(path, cursorOptions);\n    }\n  }\n\n  public async down(cursorOptions: CursorOptions = {}) {\n    const path = await this.session.nextVisible(this.path);\n    if (path !== null) {\n      await this.setPath(path, cursorOptions);\n    }\n  }\n\n  public async parent(cursorOptions: CursorOptions = {}) {\n    const newpath = this.path.parent;\n    if (newpath == null) {\n      throw new Error('Cursor was at root');\n    }\n    if (newpath.parent == null) {\n      return;\n    }\n    if (this.path.is(this.session.viewRoot)) {\n      await this.session.changeViewRoot(newpath);\n    }\n    return await this.setPath(newpath, cursorOptions);\n  }\n\n  public async prevSibling(cursorOptions: CursorOptions = {}) {\n    const prevsib = await this.document.getSiblingBefore(this.path);\n    if (prevsib !== null) {\n      return await this.setPath(prevsib, cursorOptions);\n    }\n  }\n\n  public async nextSibling(cursorOptions: CursorOptions = {}) {\n    const nextsib = await this.document.getSiblingAfter(this.path);\n    if (nextsib !== null) {\n      return await this.setPath(nextsib, cursorOptions);\n    }\n  }\n}\n\n// NOTE: this doesnt go into the document tree since\n// 1. it doesnt deduplicate cloned rows\n// 2. implementation details, e.g. this isn't immutable\nexport class CursorsInfoTree {\n  public row: Row;\n\n  // actual cursor!\n  public cursor: Col | null;\n  // has regular selection\n  public selected: {[col: number]: boolean};\n  // is visually selected (entire row)\n  public visual: boolean;\n\n  // has children with selections\n  public children: {[row: number]: CursorsInfoTree};\n  public parent: CursorsInfoTree | null;\n  public hasSelection: boolean;\n\n  constructor(row: Row, parent: null | CursorsInfoTree = null) {\n    if (parent === null && (row !== Path.rootRow())) {\n      throw new Error('CursorsInfoTree rooted at non-root row');\n    }\n    this.row = row;\n    this.visual = false;\n    this.selected = {};\n    this.cursor = null;\n    this.children = {};\n    this.parent = parent;\n    this.hasSelection = false;\n  }\n\n  public getPath(path: Path): CursorsInfoTree {\n    let result = (this as CursorsInfoTree);\n    path.getAncestry().forEach((row) => {\n      result = result.getChild(row);\n    });\n    return result;\n  }\n\n  public getChild(row: Row): CursorsInfoTree {\n    const child = this.children[row];\n    if (child != null) {\n      return child;\n    }\n    const newChild =  new CursorsInfoTree(row, this);\n    this.children[row] = newChild;\n    return newChild;\n  }\n\n  private markSelected() {\n    if (!this.hasSelection) {\n      this.hasSelection = true;\n      if (this.parent) {\n        this.parent.markSelected();\n      }\n    }\n  }\n\n  public markCols(cols: Array<Col>) {\n    cols.forEach((col) => {\n      this.selected[col] = true;\n    });\n    this.markSelected();\n  }\n\n  public markCursor(col: Col) {\n    this.cursor = col;\n    this.markSelected();\n  }\n\n  public markVisual() {\n    this.visual = true;\n    this.markSelected();\n  }\n\n  public markChildrenVisual(childRows: Array<Row>) {\n    childRows.forEach((row) => {\n      const child = this.getChild(row);\n      child.markVisual();\n    });\n  }\n}\n\n","import * as browser_utils from './utils/browser';\nimport * as errors from '../../shared/utils/errors';\nimport EventEmitter from './utils/eventEmitter';\nimport logger from '../../shared/utils/logger';\nimport { ClientStore } from './datastore';\nimport { SynchronousInMemory } from '../../shared/data_backend';\nimport * as mutations from './mutations';\nimport Cursor from './cursor';\nimport Register from './register';\nimport Path from './path';\nimport Document, { InMemoryDocument } from './document';\nimport Mutation from './mutations';\nimport Menu from './menu';\n\nimport * as Modes from './modes';\n\nimport { ModeId, CursorOptions, Row, Col, Chars, SerializedBlock } from './types';\n\ntype SessionOptions = {\n  initialMode?: ModeId,\n  viewRoot?: Path,\n  cursorPath?: Path,\n  showMessage?: (message: string, options?: any) => void,\n  toggleBindingsDiv?: () => void,\n  getLinesPerPage?: () => number,\n};\ntype ViewState = {\n  cursor: Cursor,\n  viewRoot: Path,\n};\ntype HistoryLogEntry = {\n  index: number,\n  after?: ViewState,\n  before?: ViewState,\n};\ntype JumpLogEntry = {\n  viewRoot: Path,\n  cursor_before: Cursor,\n  cursor_after?: Cursor,\n};\n\ntype DelCharsOptions = {\n  yank?: boolean,\n};\n\ntype DelBlockOptions = {\n  noSave?: boolean,\n  addNew?: boolean,\n  noNew?: boolean,\n};\n\n/*\na Session represents a session with a vimflowy document\nIt holds a Cursor, a Document object\nIt exposes methods for manipulation of the document, and movement of the cursor\n\nCurrently, the separation between the Session and Document classes is not very good.  (see document.ts)\nIdeally, session shouldn't do much more than handle cursors and history\n*/\n\nexport default class Session extends EventEmitter {\n  public mode: ModeId;\n\n  public clientStore: ClientStore;\n  public document: Document;\n  public register: Register;\n  public cursor: Cursor;\n  private _anchor: Cursor | null;\n\n  public viewRoot: Path;\n\n  public menu: Menu | null = null;\n\n  private mutations: Array<Mutation> = [];\n  private history: Array<HistoryLogEntry> = [];\n  private historyIndex: number = 0;\n  public jumpHistory: Array<JumpLogEntry> = [];\n  public jumpIndex: number = 0;\n\n  private getLinesPerPage: () => number;\n  public showMessage: (message: string, options?: any) => void;\n  public toggleBindingsDiv: () => void;\n\n  private static swapCase(chars: Chars) {\n    return chars.map(function(chr) {\n      return chr.toLowerCase() === chr ? chr.toUpperCase() : chr.toLowerCase();\n    });\n  }\n  constructor(clientStore: ClientStore, doc: Document, options: SessionOptions = {}) {\n    super();\n\n    this.clientStore = clientStore;\n\n    this.document = doc;\n\n    this.showMessage = options.showMessage || ((message) => {\n      logger.info(`Showing message: ${message}`);\n    });\n    this.toggleBindingsDiv = options.toggleBindingsDiv || (() => null);\n    this.getLinesPerPage = options.getLinesPerPage || (() => 10);\n\n    this.register = new Register(this);\n\n    this.menu = null;\n\n    this.viewRoot = options.viewRoot || Path.root();\n    this.cursor = new Cursor(this, options.cursorPath || this.viewRoot, 0);\n    this._anchor = null;\n\n    this.reset_history();\n    this.reset_jump_history();\n\n    const mode = options.initialMode || 'NORMAL';\n    // NOTE: this is fire and forget\n    // this.setMode(mode);\n    this.mode = mode;\n    return this;\n  }\n\n  public async exit() {\n    await this.emitAsync('exit');\n  }\n\n  public async setMode(newmode: ModeId) {\n    if (newmode === this.mode) {\n      return;\n    }\n\n    const oldmode = this.mode;\n    if (oldmode) {\n      await Modes.getMode(oldmode).exit(this, newmode);\n    }\n\n    this.mode = newmode;\n    await Modes.getMode(this.mode).enter(this, oldmode);\n\n    this.emit('modeChange', oldmode, newmode);\n  }\n\n  ////////////////////////////////\n  // import/export\n  ////////////////////////////////\n\n  private parseJson(content: string) {\n    let root;\n    try {\n      root = JSON.parse(content);\n    } catch (error) {\n      this.showMessage('The uploaded file is not valid JSON', {text_class: 'error'});\n      return false;\n    }\n    const verify = function(node: any) {\n      if (node.clone) {\n        return true;\n      }\n      if (!node.text && node.text !== '') { return false; }\n      if (node.children) {\n        for (let i = 0; i < node.children.length; i++) {\n          const child = node.children[i];\n          if (!verify(child)) { return false; }\n        }\n      }\n      return true;\n    };\n    if (!verify(root)) {\n      this.showMessage('The uploaded file is not in a valid vimflowy format', {text_class: 'error'});\n      return false;\n    }\n    return root;\n  }\n\n  private parsePlaintext(content: string) {\n    // Step 1: parse into (int, string) pairs of indentation amounts.\n    let lines: Array<{\n      indent: number,\n      line: string,\n      annotation?: boolean,\n    }> = [];\n    const whitespace = /^\\s*/;\n    const content_lines = content.split('\\n');\n    content_lines.forEach((line) => {\n      const matches = line.match(whitespace);\n      const indent = matches ? matches[0].length : 0;\n      if (line.match(/^\\s*\".*\"$/)) { // Flag workflowy annotations as special cases\n        lines.push({\n          indent,\n          line: line.replace(/^\\s*\"(.*)\"$/, '$1'),\n          annotation: true,\n        });\n      } else {\n        // TODO: record whether COMPLETE and strikethrough line if so?\n        lines.push({\n          indent,\n          line: line.replace(whitespace, '').replace(/^(?:-\\s*)?(?:\\[COMPLETE\\] )?/, ''),\n        });\n      }\n    });\n    while (lines[lines.length - 1].line === '') { // Strip trailing blank line(s)\n      lines = lines.splice(0, lines.length - 1);\n    }\n\n    // Step 2: convert a list of (int, string, annotation?) into a forest format\n    const parseAllChildren = function(parentIndentation: number, lineNumber: number) {\n      const children: Array<any> = [];\n      if (lineNumber < lines.length && lines[lineNumber].annotation) {\n        // Each node can have an annotation immediately follow it\n        children.push({\n          text: lines[lineNumber].line,\n        });\n        lineNumber = lineNumber + 1;\n      }\n      while (lineNumber < lines.length && lines[lineNumber].indent > parentIndentation) {\n        // For [the first line of] each child\n        const child: any = { text: lines[lineNumber].line };\n        const result = parseAllChildren(lines[lineNumber].indent, lineNumber + 1);\n        ({ lineNumber } = result);\n        if (result.children !== null) {\n          child.children = result.children;\n          child.collapsed = result.children.length > 0;\n        }\n        children.push(child);\n      }\n      return { children, lineNumber };\n    };\n    const forest = (parseAllChildren(-1, 0)).children;\n    const root = {\n      text: '',\n      children: forest,\n      collapsed: forest.length > 0,\n    };\n    return root;\n  }\n\n  private parseContent(content: string, mimetype: string) {\n    if (mimetype === 'application/json') {\n      return this.parseJson(content);\n    } else if (mimetype === 'text/plain' || mimetype === 'Text') {\n      return this.parsePlaintext(content);\n    } else {\n      return null;\n    }\n  }\n\n  // TODO: make this use replace_empty = true?\n  public async importContent(content: string, mimetype: string) {\n    content = content.replace(/(?:\\r)/g, '');  // Remove \\r (Carriage Return) from each line\n    const root = this.parseContent(content, mimetype);\n    if (!root) { return false; }\n    const { path } = this.cursor;\n    if (root.text === '' && root.children) { // Complete export, not one node\n      await this.addBlocks(path, 0, root.children);\n    } else {\n      await this.addBlocks(path, 0, [root]);\n    }\n    this.save();\n    this.emit('importFinished');\n    return true;\n  }\n\n  public async exportContent(mimetype: string) {\n    const jsonContent = await this.document.serialize();\n    if (mimetype === 'application/json') {\n      return JSON.stringify(jsonContent, undefined, 2);\n    } else if (mimetype === 'text/plain') {\n      // Workflowy compatible plaintext export\n      //   Ignores 'collapsed' and viewRoot\n      const indent = '  ';\n      const exportLines = function(node: any) {\n        if (typeof(node) === 'string') {\n          return [`- ${node}`];\n        }\n        const lines: Array<string> = [];\n        lines.push(`- ${node.text}`);\n        const children = node.children || [];\n        children.forEach((child: any) => {\n          if (child.clone) { return; }\n          exportLines(child).forEach((line) => {\n            lines.push(`${indent}${line}`);\n          });\n        });\n        return lines;\n      };\n      return (exportLines(jsonContent)).join('\\n');\n    } else {\n      throw new errors.UnexpectedValue('mimetype', mimetype);\n    }\n  }\n\n  public async exportFile(type = 'json') {\n    this.showMessage('Exporting...', { time: 0 });\n    const filename = this.document.name === '' ?\n                   `vimflowy.${type}` :\n                   `${this.document.name}.${type}` ;\n    // Infer mimetype from file extension\n    const mimetype = browser_utils.mimetypeLookup(filename);\n    if (!mimetype) {\n      throw new Error('Invalid export type');\n    }\n    const content = await this.exportContent(mimetype);\n    browser_utils.downloadFile(filename, content, mimetype);\n    this.showMessage(`Exported to ${filename}!`, {text_class: 'success'});\n  }\n\n  ////////////////////////////////\n  // MUTATIONS\n  ////////////////////////////////\n\n  public reset_history() {\n    this.mutations = []; // full mutation history\n    this.history = [{\n      index: 0,\n    }];\n    this.historyIndex = 0; // index into indices\n  }\n\n  public save() {\n    if (this.historyIndex !== this.history.length - 1) {\n      // haven't acted, otherwise would've sliced\n      return;\n    }\n    if (this.history[this.historyIndex].index === this.mutations.length) {\n      // haven't acted, otherwise there would be more mutations\n      return;\n    }\n\n    const state = this.history[this.historyIndex];\n    state.after = {\n      cursor: this.cursor.clone(),\n      viewRoot: this.viewRoot,\n    };\n\n    this.historyIndex += 1;\n    this.history.push({\n      index: this.mutations.length,\n    });\n  }\n\n  private async _restoreViewState(state: ViewState) {\n    await this.cursor.from(state.cursor);\n    await this.fixCursorForMode();\n    await this.changeView(state.viewRoot);\n  }\n\n  public async undo() {\n    if (this.historyIndex > 0) {\n      const oldState = this.history[this.historyIndex];\n      this.historyIndex -= 1;\n      const newState = this.history[this.historyIndex];\n\n      logger.debug('UNDOING <');\n      for (let j = oldState.index - 1; j > newState.index - 1; j--) {\n        const mutation = this.mutations[j];\n        logger.debug(`  Undoing mutation ${mutation.constructor.name}(${mutation.str()})`);\n        const undo_mutations = await mutation.rewind(this);\n        for (let k = 0; k < undo_mutations.length; k++) {\n          const undo_mutation = undo_mutations[k];\n          logger.debug(`  Undo mutation ${undo_mutation.constructor.name}(${undo_mutation.str()})`);\n          await undo_mutation.mutate(this);\n          await undo_mutation.moveCursor(this.cursor);\n        }\n      }\n\n      logger.debug('> END UNDO');\n      if (!newState.before) {\n        throw new Error('No previous cursor state found while undoing');\n      }\n      await this._restoreViewState(newState.before);\n    }\n  }\n\n  public async redo() {\n    if (this.historyIndex < this.history.length - 1) {\n      const oldState = this.history[this.historyIndex];\n      this.historyIndex += 1;\n      const newState = this.history[this.historyIndex];\n\n      logger.debug('REDOING <');\n      for (let j = oldState.index; j < newState.index; j++) {\n        const mutation = this.mutations[j];\n        if (!await mutation.validate(this)) {\n          // this should not happen, since the state should be the same as before\n          throw new errors.GenericError(`Failed to redo mutation: ${mutation.str()}`);\n        }\n        logger.debug(`  Redoing mutation ${mutation.constructor.name}(${mutation.str()})`);\n        await mutation.remutate(this);\n        await mutation.moveCursor(this.cursor);\n      }\n      logger.debug('> END REDO');\n      if (!oldState.after) {\n        throw new Error('No after cursor state found while redoing');\n      }\n      await this._restoreViewState(oldState.after);\n    }\n  }\n\n  public async do(mutation: Mutation) {\n    if (!this.history) {\n      // NOTE: we let mutations through since some plugins may apply mutations on load\n      // these mutations won't be undoable, which is desired\n      logger.warn(`Tried mutation ${mutation} before init!`);\n      await mutation.mutate(this);\n      return true;\n    }\n\n    if (!await mutation.validate(this)) {\n      return false;\n    }\n\n    if (this.historyIndex !== this.history.length - 1) {\n      this.history = this.history.slice(0, this.historyIndex + 1);\n      this.mutations = this.mutations.slice(0, this.history[this.historyIndex].index);\n    }\n\n    const state = this.history[this.historyIndex];\n    if (this.mutations.length === state.index) {\n      state.before = {\n        cursor: this.cursor.clone(),\n        viewRoot: this.viewRoot,\n      };\n    }\n\n    logger.debug(`Applying mutation ${mutation.constructor.name}(${mutation.str()})`);\n    await mutation.mutate(this);\n    await mutation.moveCursor(this.cursor);\n    await this.fixCursorForMode();\n\n    this.mutations.push(mutation);\n    return true;\n  }\n\n  // TODO: do this in the mode\n  private async fixCursorForMode() {\n    if (!Modes.getMode(this.mode).metadata.cursorBetween) {\n      await this.cursor.backIfNeeded();\n    }\n  }\n\n  ////////////////////////////////\n  // viewability\n  ////////////////////////////////\n\n  // whether contents are currently viewable (i.e. subtree is visible)\n  public async viewable(path: Path) {\n    return path.is(this.viewRoot) || (\n            path.isDescendant(this.viewRoot) &&\n            (!await this.document.collapsed(path.row))\n           );\n  }\n\n  // whether a given path is visible\n  public async isVisible(path: Path) {\n    const visibleAncestor = await this.youngestVisibleAncestor(path);\n    return (visibleAncestor !== null) && path.is(visibleAncestor);\n  }\n\n  public async nextVisible(path: Path) {\n    if (await this.viewable(path)) {\n      const children = await this.document.getChildren(path);\n      if (children.length > 0) {\n        return children[0];\n      }\n    }\n    if (path.is(this.viewRoot)) {\n      return null;\n    }\n    while (true) {\n      const nextsib = await this.document.getSiblingAfter(path);\n      if (nextsib !== null) {\n        return nextsib;\n      }\n      if (path.parent == null) {\n        throw new Error('Did not encounter view root on way to root');\n      }\n      path = path.parent;\n      if (path.is(this.viewRoot)) {\n        return null;\n      }\n    }\n  }\n\n  // last thing visible nested within id\n  public async lastVisible(path: Path = this.viewRoot): Promise<Path> {\n    if (!(await this.viewable(path))) {\n      return path;\n    }\n    const children = await this.document.getChildren(path);\n    if (children.length > 0) {\n      return await this.lastVisible(children[children.length - 1]);\n    }\n    return path;\n  }\n\n  public async prevVisible(path: Path) {\n    if (path.parent == null) {\n      return null;\n    }\n    if (path.is(this.viewRoot)) {\n      return null;\n    }\n    const prevsib = await this.document.getSiblingBefore(path);\n    if (prevsib !== null) {\n      return await this.lastVisible(prevsib);\n    }\n    if (path.parent.is(this.viewRoot)) {\n      if (path.parent.is(this.document.root)) {\n        return null;\n      } else {\n        return this.viewRoot;\n      }\n    }\n    return path.parent;\n  }\n\n  // finds oldest ancestor that is visible *besides viewRoot*\n  // returns null if there is no visible ancestor (i.e. path is not under viewroot)\n  public async oldestVisibleAncestor(path: Path) {\n    let last = path;\n    while (true) {\n      if (last.parent == null) {\n        return null;\n      }\n      const cur = last.parent;\n      if (cur.is(this.viewRoot)) {\n        return last;\n      }\n      last = cur;\n    }\n  }\n\n  // finds closest ancestor that is visible\n  // returns null if there is no visible ancestor (i.e. path is not under viewroot)\n  public async youngestVisibleAncestor(path: Path) {\n    let answer = path;\n    let cur = path;\n    while (true) {\n      if (cur.is(this.viewRoot)) {\n        return answer;\n      }\n      if (cur.parent == null) {\n        return null;\n      }\n      if (await this.document.collapsed(cur.row)) {\n        answer = cur;\n      }\n      cur = cur.parent;\n    }\n  }\n\n  ////////////////////////////////\n  // View root\n  ////////////////////////////////\n\n  public async changeViewRoot(path: Path) {\n    this.viewRoot = path;\n    this.emit('changeViewRoot', path);\n  }\n\n  public reset_jump_history() {\n    this.jumpHistory = [{\n      viewRoot: this.viewRoot,\n      cursor_before: this.cursor.clone(),\n    }];\n    this.jumpIndex = 0; // index into jump history\n  }\n\n  // jump_fn is just some function that changes\n  // viewRoot and cursor\n  private async _addToJumpHistory(jump_fn: () => Promise<void>) {\n    const jump = this.jumpHistory[this.jumpIndex];\n    jump.cursor_after = this.cursor.clone();\n\n    this.jumpHistory = this.jumpHistory.slice(0, this.jumpIndex + 1);\n\n    await jump_fn();\n\n    this.jumpHistory.push({\n      viewRoot: this.viewRoot,\n      cursor_before: this.cursor.clone(),\n    });\n    this.jumpIndex += 1;\n  }\n\n  // try going to jump, return true if succeeds\n  private async tryJump(jump: JumpLogEntry) {\n    if (jump.viewRoot.row === this.viewRoot.row) {\n      return false; // not moving, don't jump\n    }\n\n    if (!await this.document.isAttached(jump.viewRoot.row)) {\n      return false; // invalid location\n    }\n\n    const children = await this.document.getChildren(jump.viewRoot);\n\n    await this.changeViewRoot(jump.viewRoot);\n    if (children.length) {\n      await this.cursor.setPath(children[0]);\n    } else {\n      await this.cursor.setPath(jump.viewRoot);\n    }\n\n    if (!jump.cursor_after) {\n      throw new Error('Jump should have had cursor_after');\n    }\n\n    if (await this.document.isAttached(jump.cursor_after.row)) {\n      // if the row is attached and under the view root, switch to it\n      const cursor_path = await this.youngestVisibleAncestor(jump.cursor_after.path);\n      if (cursor_path !== null) {\n        await this.cursor.setPath(cursor_path);\n      }\n    }\n    return true;\n  }\n\n  public async jumpPrevious() {\n    let jumpIndex = this.jumpIndex;\n\n    const jump = this.jumpHistory[jumpIndex];\n    jump.cursor_after = this.cursor.clone();\n\n    while (true) {\n      if (jumpIndex === 0) {\n        return false;\n      }\n      jumpIndex -= 1;\n      const oldjump = this.jumpHistory[jumpIndex];\n      if (await this.tryJump(oldjump)) {\n        this.jumpIndex = jumpIndex;\n        return true;\n      }\n    }\n  }\n\n  public async jumpNext() {\n    let jumpIndex = this.jumpIndex;\n\n    const jump = this.jumpHistory[jumpIndex];\n    jump.cursor_after = this.cursor.clone();\n\n    while (true) {\n      if (jumpIndex === this.jumpHistory.length - 1) {\n        return false;\n      }\n      jumpIndex += 1;\n      const newjump = this.jumpHistory[jumpIndex];\n      if (await this.tryJump(newjump)) {\n        this.jumpIndex = jumpIndex;\n        return true;\n      }\n    }\n  }\n\n  // try to change the view root to row\n  // fails if there is no child\n  // records in jump history\n  private async changeView(path: Path) {\n    if (path.is(this.viewRoot)) {\n      return; // not moving, do nothing\n    }\n    await this._addToJumpHistory(async () => {\n      await this.changeViewRoot(path);\n    });\n  }\n\n  // try to zoom into newroot, updating the cursor\n  public async zoomInto(newroot: Path) {\n    await this.changeView(newroot);\n    let newpath = await this.youngestVisibleAncestor(this.cursor.path);\n    if (newpath === null) { // not visible, need to reset cursor\n      newpath = newroot;\n    }\n    await this.cursor.setPath(newpath);\n  }\n\n  public async zoomOut() {\n    if (this.viewRoot.parent != null) {\n      await this.zoomInto(this.viewRoot.parent);\n    }\n  }\n\n  public async zoomIn() {\n    if (this.cursor.path.is(this.viewRoot)) {\n      return;\n    }\n    const newroot = await this.oldestVisibleAncestor(this.cursor.path);\n    if (newroot == null) {\n      throw new Error('Got error zooming in to cursor');\n    }\n    await this.zoomInto(newroot);\n  }\n\n  public async zoomDown() {\n    const sib = await this.document.getSiblingAfter(this.viewRoot);\n    if (sib === null) {\n      this.showMessage('No next sibling to zoom down to', {text_class: 'error'});\n      return;\n    }\n    await this.zoomInto(sib);\n  }\n\n  public async zoomUp() {\n    const sib = await this.document.getSiblingBefore(this.viewRoot);\n    if (sib === null) {\n      this.showMessage('No previous sibling to zoom up to', {text_class: 'error'});\n      return;\n    }\n    await this.zoomInto(sib);\n  }\n\n  ////////////////////////////////\n  // Text\n  ////////////////////////////////\n\n  public async curLine() {\n    return await this.document.getLine(this.cursor.row);\n  }\n\n  public async curText() {\n    return await this.document.getText(this.cursor.row);\n  }\n\n  public async curLineLength() {\n    return await this.document.getLength(this.cursor.row);\n  }\n\n  public async addChars(row: Row, col: Col, chars: Chars) {\n    if (col < 0) {\n      col = (await this.document.getLength(row)) + col + 1;\n    }\n    await this.do(new mutations.AddChars(row, col, chars));\n  }\n\n  public async addCharsAtCursor(chars: Chars) {\n    await this.addChars(this.cursor.row, this.cursor.col, chars);\n  }\n\n  public async addCharsAfterCursor(chars: Chars) {\n    let col = this.cursor.col;\n    if (col < (await this.document.getLength(this.cursor.row))) {\n      col += 1;\n    }\n    await this.addChars(this.cursor.row, col, chars);\n  }\n\n  public async delChars(row: Row, col: Col, nchars: number, options: DelCharsOptions = {}) {\n    const n = await this.document.getLength(row);\n    let deleted: Chars = [];\n    if (col < 0) { col = n + col; }\n    if ((n > 0) && (nchars > 0) && (col < n)) {\n      const mutation = new mutations.DelChars(row, col, nchars);\n      await this.do(mutation);\n      deleted = mutation.deletedChars;\n      if (options.yank) {\n        this.register.saveChars(deleted);\n      }\n    }\n    return deleted;\n  }\n\n  public async delCharsBeforeCursor(nchars: number, options: DelCharsOptions = {}) {\n    nchars = Math.min(this.cursor.col, nchars);\n    return await this.delChars(this.cursor.path.row, this.cursor.col - nchars, nchars, options);\n  }\n\n  public async delCharsAfterCursor(nchars: number, options: DelCharsOptions = {}) {\n    return await this.delChars(this.cursor.path.row, this.cursor.col, nchars, options);\n  }\n\n  private async changeChars(row: Row, col: Col, nchars: number, change_fn: (chars: Chars) => Chars) {\n    const mutation = new mutations.ChangeChars(row, col, nchars, change_fn);\n    await this.do(mutation);\n    return mutation.ncharsDeleted;\n  }\n\n  public async swapCaseAtCursor() {\n    await this.changeChars(this.cursor.row, this.cursor.col, 1, Session.swapCase);\n    await this.cursor.right();\n  }\n\n  public async swapCaseInVisual(cursor1: Cursor, cursor2: Cursor) {\n    if (!(cursor2.path.is(cursor1.path))) {\n      logger.warn('Not yet implemented');\n      return;\n    }\n\n    if (cursor2.col < cursor1.col) {\n      [cursor1, cursor2] = [cursor2, cursor1];\n    }\n\n    const nchars = cursor2.col - cursor1.col + 1;\n    await this.changeChars(cursor1.row, cursor1.col, nchars, Session.swapCase);\n    await this.cursor.from(cursor1);\n  }\n\n  public async swapCaseInVisualLine(rows: Array<Row>) {\n    await Promise.all(rows.map(async row => await this.changeChars(\n      row,\n      0,\n      await this.document.getLength(row),\n      Session.swapCase\n    )));\n  }\n\n  public async replaceCharsAfterCursor(char: string, nchars: number) {\n    const ndeleted = await this.changeChars(this.cursor.row, this.cursor.col, nchars, (chars =>\n      chars.map(function(_chr) { return char; })\n    ));\n    await this.cursor.setCol(this.cursor.col + ndeleted - 1);\n  }\n\n  public async clearRowAtCursor(options: {yank?: boolean}) {\n    if (options.yank) {\n      // yank as a row, not chars\n      await this.yankRowAtCursor();\n    }\n    return await this.delChars(this.cursor.path.row, 0, await this.curLineLength());\n  }\n\n  public async yankChars(path: Path, col: Col, nchars: number) {\n    const line = await this.document.getLine(path.row);\n    if (line.length > 0) {\n      this.register.saveChars(line.slice(col, col + nchars));\n    }\n  }\n\n  // options:\n  //   - includeEnd says whether to also delete cursor2 location\n  public async yankBetween(cursor1: Cursor, cursor2: Cursor, options: {includeEnd?: boolean} = {}) {\n    if (!cursor2.path.is(cursor1.path)) {\n      logger.warn('Not yet implemented');\n      return;\n    }\n\n    if (cursor2.col < cursor1.col) {\n      [cursor1, cursor2] = [cursor2, cursor1];\n    }\n\n    const offset = options.includeEnd ? 1 : 0;\n    await this.yankChars(cursor1.path, cursor1.col, cursor2.col - cursor1.col + offset);\n  }\n\n  public async yankRowAtCursor() {\n    const serialized_row = await this.document.serializeRow(this.cursor.row);\n    return this.register.saveSerializedRows([serialized_row]);\n  }\n\n  // options:\n  //   - includeEnd says whether to also delete cursor2 location\n  public async deleteBetween(cursor1: Cursor, cursor2: Cursor, options: {includeEnd?: boolean, yank?: boolean} = {}) {\n    if (!cursor2.path.is(cursor1.path)) {\n      logger.warn('Not yet implemented');\n      return;\n    }\n\n    if (cursor2.col < cursor1.col) {\n      [cursor1, cursor2] = [cursor2, cursor1];\n    }\n    const offset = options.includeEnd ? 1 : 0;\n    await this.delChars(cursor1.path.row, cursor1.col, cursor2.col - cursor1.col + offset, options);\n  }\n\n  public async newLineBelow(\n    options: {setCursor?: string, cursorOptions?: CursorOptions} = {}\n  ) {\n    options.setCursor = 'first';\n\n    const [ collapsed, hasChildren ] = await Promise.all([\n      this.document.collapsed(this.cursor.row),\n      this.document.hasChildren(this.cursor.row),\n    ]);\n\n    if (this.cursor.path.is(this.viewRoot)) {\n      if (!hasChildren) {\n        if (!collapsed) {\n          await this.toggleBlockCollapsed(this.cursor.row);\n        }\n      }\n\n      await this.addBlocks(this.cursor.path, 0, [''], options);\n    } else if ((!collapsed) && hasChildren) {\n      await this.addBlocks(this.cursor.path, 0, [''], options);\n    } else {\n      const parent = this.cursor.path.parent;\n      if (parent == null) {\n        throw new Error('Cursor was at viewroot?');\n      }\n      const index = await this.document.indexInParent(this.cursor.path);\n      await this.addBlocks(parent, index + 1, [''], options);\n    }\n  }\n\n  public async newLineAbove() {\n    if (this.cursor.path.is(this.viewRoot)) {\n      return;\n    }\n    const parent = this.cursor.path.parent;\n    if (parent == null) {\n      throw new Error('Cursor was at viewroot?');\n    }\n    const index = await this.document.indexInParent(this.cursor.path);\n    await this.addBlocks(parent, index, [''], {setCursor: 'first'});\n  }\n\n  // behavior of \"enter\", splitting a line\n  // If enter is not at the end:\n  //     insert a new node before with the first half of the content\n  //     note that this will always preserve child-parent relationships\n  // If enter is at the end:\n  //     insert a new node after\n  //     if the node has children, this is the new first child\n  public async newLineAtCursor() {\n    if (this.cursor.col === (await this.document.getLength(this.cursor.row))) {\n      await this.newLineBelow({cursorOptions: {}});\n    } else {\n      const mutation = new mutations.DelChars(this.cursor.row, 0, this.cursor.col);\n      await this.do(mutation);\n      const path = this.cursor.path;\n\n      await this.newLineAbove();\n      // cursor now is at inserted path, add the characters\n      await this.addCharsAfterCursor(mutation.deletedChars);\n      // restore cursor\n      await this.cursor.setPosition(path, 0, {});\n    }\n  }\n\n  // can only join if either:\n  // - first is previous sibling of second, AND has no children\n  // - second is first child of first, AND has no children\n  // returns whether a join successfully happened\n  private async _joinRows(first: Path, second: Path, options: {delimiter?: string} = {}) {\n    if (first.parent == null) {\n      throw new Error('Tried to join first as root?');\n    }\n    if (second.parent == null) {\n      throw new Error('Tried to join first as root?');\n    }\n    let addDelimiter: string | null = null;\n    const firstLine = await this.document.getLine(first.row);\n    const secondLine = await this.document.getLine(second.row);\n    if (options.delimiter) {\n      if (firstLine.length && secondLine.length) {\n        if (firstLine[firstLine.length - 1] !== options.delimiter) {\n          if (secondLine[0] !== options.delimiter) {\n            addDelimiter = options.delimiter;\n          }\n        }\n      }\n    }\n\n    if (!await this.document.hasChildren(second.row)) {\n      await this.cursor.setPosition(first, -1);\n      await this.delBlock(second, { noNew: true, noSave: true });\n      if (addDelimiter != null) {\n        await this.do(new mutations.AddChars(\n          first.row, firstLine.length, [addDelimiter]));\n      }\n      await this.do(new mutations.AddChars(\n        first.row, firstLine.length + (addDelimiter == null ? 0 : 1), secondLine));\n      await this.cursor.setPosition(first, firstLine.length);\n      return true;\n    }\n\n    if (await this.document.hasChildren(first.row)) {\n      this.showMessage('Cannot join when both rows have children', {text_class: 'error'});\n      return false;\n    }\n\n    if (second.parent.row !== first.parent.row) {\n      this.showMessage('Cannot join with non sibling/child', {text_class: 'error'});\n      return false;\n    }\n\n    await this.cursor.setPosition(second, 0);\n    await this.delBlock(first, {noNew: true, noSave: true});\n    if (addDelimiter != null) {\n      await this.do(new mutations.AddChars(second.row, 0, [addDelimiter]));\n    }\n    await this.do(new mutations.AddChars(second.row, 0, firstLine));\n\n    if (addDelimiter != null) {\n      await this.cursor.left();\n    }\n\n    return true;\n  }\n\n  public async joinAtCursor() {\n    const path = this.cursor.path;\n    const sib = await this.nextVisible(path);\n    if (sib === null) { return false; }\n    return await this._joinRows(path, sib, {delimiter: ' '});\n  }\n\n  // implements proper \"backspace\" behavior\n  public async deleteAtCursor() {\n    if (this.cursor.col > 0) {\n      await this.delCharsBeforeCursor(1);\n      return true;\n    }\n\n    const path = this.cursor.path;\n    const sib = await this.prevVisible(path);\n    if (sib === null) {\n      return false;\n    }\n\n    if (await this._joinRows(sib, path)) {\n      return true;\n    }\n\n    return false;\n  }\n\n  private async delBlock(path: Path, options: DelBlockOptions) {\n    if (path.parent == null) {\n      throw new Error('Cannot delete root');\n    }\n    return await this.delBlocks(path.parent.row, await this.document.indexInParent(path), 1, options);\n  }\n\n  public async delBlocks(\n    parent: Row, index: number, nrows: number,\n    options: DelBlockOptions = {}\n  ) {\n    const mutation = new mutations.DetachBlocks(parent, index, nrows, options);\n    await this.do(mutation);\n    if (!options.noSave) {\n      this.register.saveClonedRows(mutation.deleted);\n    }\n    if (!(await this.isVisible(this.cursor.path))) {\n      // view root got deleted\n      await this.zoomOut();\n    }\n  }\n\n  public async delBlocksAtCursor(nrows: number, options = {}) {\n    const parent = this.cursor.path.parent;\n    if (parent == null) {\n      throw new Error('Cursor was at root?');\n    }\n    const index = await this.document.indexInParent(this.cursor.path);\n    return await this.delBlocks(parent.row, index, nrows, options);\n  }\n\n  public async addBlocks(\n    parent: Path, index = -1, serialized_rows: Array<SerializedBlock>,\n    options: {cursorOptions?: CursorOptions, setCursor?: string} = {}\n  ) {\n    const mutation = new mutations.AddBlocks(parent, index, serialized_rows);\n    await this.do(mutation);\n    if (options.setCursor === 'first') {\n      await this.cursor.setPosition(mutation.added_rows[0], 0, options.cursorOptions);\n    } else if (options.setCursor === 'last') {\n      await this.cursor.setPosition(mutation.added_rows[mutation.added_rows.length - 1], 0, options.cursorOptions);\n    }\n  }\n\n  public async yankBlocks(path: Path, nrows: number) {\n    const siblings = await this.document.getSiblingRange(path, 0, nrows - 1);\n    const serialized = await Promise.all(siblings.map(\n      async (x) => await this.document.serialize(x.row)\n    ));\n    this.register.saveSerializedRows(serialized);\n  }\n\n  public async yankBlocksAtCursor(nrows: number) {\n    await this.yankBlocks(this.cursor.path, nrows);\n  }\n\n  public async yankBlocksClone(path: Path, nrows: number) {\n    const siblings = await this.document.getSiblingRange(path, 0, nrows - 1);\n    this.register.saveClonedRows(siblings.map(sibling => sibling.row));\n  }\n\n  public async yankBlocksCloneAtCursor(nrows: number) {\n    await this.yankBlocksClone(this.cursor.path, nrows);\n  }\n\n  public async attachBlocks(\n    parent: Path, ids: Array<Row>, index = -1, options: {setCursor?: string} = {}\n  ) {\n    const mutation = new mutations.AttachBlocks(parent.row, ids, index);\n    const will_work = await mutation.validate(this);\n    await this.do(mutation);\n\n    // TODO: do this more elegantly\n    if (will_work) {\n      if (options.setCursor === 'first') {\n        await this.cursor.setPosition(parent.child(ids[0]), 0);\n      } else if (options.setCursor === 'last') {\n        await this.cursor.setPosition(parent.child(ids[ids.length - 1]), 0);\n      }\n    }\n  }\n\n  private async moveBlock(path: Path, parent_path: Path, index = -1) {\n    return await this.do(new mutations.MoveBlock(path, parent_path, index));\n  }\n\n  public async indentBlocks(path: Path, numblocks = 1) {\n    if (path.is(this.viewRoot)) {\n      this.showMessage('Cannot indent view root', {text_class: 'error'});\n      return;\n    }\n    const newparent = await this.document.getSiblingBefore(path);\n    if (newparent === null) {\n      this.showMessage('Cannot indent without higher sibling', {text_class: 'error'});\n      return null;\n    }\n\n    if (await this.document.collapsed(newparent.row)) {\n      await this.toggleBlockCollapsed(newparent.row);\n    }\n\n    const siblings = await this.document.getSiblingRange(path, 0, numblocks - 1);\n    for (let i = 0; i < siblings.length; i++) {\n      const sib = siblings[i];\n      await this.moveBlock(sib, newparent, -1);\n    }\n    return newparent;\n  }\n\n  public async unindentBlocks(path: Path, numblocks = 1) {\n    if (path.row === this.viewRoot.row) {\n      this.showMessage('Cannot unindent view root', {text_class: 'error'});\n      return null;\n    }\n    if (path.parent == null) {\n      throw new Error('Tried to unindent root?');\n    }\n    const parent = path.parent;\n    if (parent.parent == null) {\n      this.showMessage('Cannot unindent past root', {text_class: 'error'});\n      return;\n    }\n\n    const siblings = await this.document.getSiblingRange(path, 0, numblocks - 1);\n\n    const newparent = parent.parent;\n    let pp_i = await this.document.indexInParent(parent);\n\n    for (let i = 0; i < siblings.length; i++) {\n      const sib = siblings[i];\n      pp_i += 1;\n      await this.moveBlock(sib, newparent, pp_i);\n    }\n    if (parent.is(this.viewRoot)) {\n      await this.zoomInto(newparent);\n    }\n    return newparent;\n  }\n\n  public async indent(path: Path = this.cursor.path) {\n    if (path.is(this.viewRoot)) {\n      this.showMessage('Cannot indent view root', {text_class: 'error'});\n      return;\n    }\n    if (await this.document.collapsed(path.row)) {\n      await this.indentBlocks(path);\n      return ;\n    }\n\n    const sib = await this.document.getSiblingBefore(path);\n    if (sib == null) {\n      this.showMessage('Cannot indent without higher sibling', {text_class: 'error'});\n      return;\n    }\n\n    const newparent = await this.indentBlocks(path);\n    if (newparent === null) { return; }\n\n    const children = await this.document.getChildren(path);\n    for (let i = 0; i < children.length; i++) {\n      const child = children[i];\n      await this.moveBlock(child, sib, -1);\n    }\n  }\n\n  public async unindent(path: Path = this.cursor.path) {\n    if (path.is(this.viewRoot)) {\n      this.showMessage('Cannot unindent view root', {text_class: 'error'});\n      return;\n    }\n\n    const parent = path.parent;\n    if (parent == null) {\n      throw new Error('Path was at root and yet not viewRoot?');\n    }\n\n    if (await this.document.collapsed(path.row)) {\n      await this.unindentBlocks(path);\n      return;\n    }\n\n    if (await this.document.hasChildren(path.row)) {\n      this.showMessage('Cannot unindent line with children', {text_class: 'error'});\n      return;\n    }\n\n    const p_i = await this.document.indexInParent(path);\n\n    const newparent = await this.unindentBlocks(path);\n    if (newparent === null) { return; }\n\n    const later_siblings = (await this.document.getChildren(parent)).slice(p_i);\n    for (let i = 0; i < later_siblings.length; i++) {\n      const sib = later_siblings[i];\n      await this.moveBlock(sib, path, -1);\n    }\n  }\n\n  public async swapDown(path: Path = this.cursor.path) {\n    const next = await this.nextVisible(await this.lastVisible(path));\n    if (next === null) { return; }\n    if (next.parent == null) {\n      throw new Error('Next visible should never return root');\n    }\n\n    if ((await this.document.hasChildren(next.row)) && (!await this.document.collapsed(next.row))) {\n      // make it the first child\n      return await this.moveBlock(path, next, 0);\n    } else {\n      // make it the next sibling\n      const parent = next.parent;\n      const p_i = await this.document.indexInParent(next);\n      return await this.moveBlock(path, parent, p_i + 1);\n    }\n  }\n\n  public async swapUp(path = this.cursor.path) {\n    const prev = await this.prevVisible(path);\n    if (prev === null) { return; }\n    if (prev.parent == null) {\n      throw new Error('Prev visible should never return root');\n    }\n    if (prev.is(this.viewRoot)) { return; }\n\n    // make it the previous sibling\n    const parent = prev.parent;\n    const p_i = await this.document.indexInParent(prev);\n    await this.moveBlock(path, parent, p_i);\n  }\n\n  public async toggleCurBlockCollapsed() {\n    await this.toggleBlockCollapsed(this.cursor.row);\n  }\n\n  public async toggleBlockCollapsed(row: Row) {\n    await this.do(new mutations.ToggleBlock(row));\n  }\n\n  public async setCurBlockCollapsed(collapsed: boolean) {\n    await this.setBlockCollapsed(this.cursor.row, collapsed);\n  }\n\n  public async setBlockCollapsed(row: Row, collapsed: boolean) {\n    if ((await this.document.collapsed(row)) !== collapsed) {\n      await this.do(new mutations.ToggleBlock(row));\n    }\n  }\n\n  public async pasteBefore() {\n    return await this.register.paste({before: true});\n  }\n\n  public async pasteAfter() {\n    return await this.register.paste({});\n  }\n\n  public get anchor(): Cursor {\n    if ((this.mode !== 'VISUAL_LINE') && (this.mode !== 'VISUAL')) {\n      throw new Error('Wanted visual line selections but not in visual or visual line mode');\n    }\n    if (this._anchor == null) {\n      throw new Error(`No anchor found in ${this.mode} mode!`);\n    }\n    return this._anchor;\n  }\n\n  public startAnchor() {\n    this._anchor = this.cursor.clone();\n  }\n\n  public stopAnchor() {\n    this._anchor = null;\n  }\n\n  // given an anchor and cursor, figures out the right blocks to be deleting\n  // returns a parent, minindex, and maxindex\n  public async getVisualLineSelections(): Promise<[Path, number, number]> {\n    const anchor = this.anchor;\n    const cursor = this.cursor;\n    const [common, ancestors1, ancestors2] =\n      await this.document.getCommonAncestor(cursor.path, anchor.path);\n    if (ancestors1.length === 0) {\n      if (common.parent == null) {\n        throw new Error('Invalid state: cursor was at root?');\n      }\n      // anchor is underneath cursor\n      const parent = common.parent;\n      const index = await this.document.indexInParent(cursor.path);\n      return [parent, index, index];\n    } else if (ancestors2.length === 0) {\n      if (common.parent == null) {\n        throw new Error('Invalid state: anchor was at root?');\n      }\n      // cursor is underneath anchor\n      const parent = common.parent;\n      const index = await this.document.indexInParent(anchor.path);\n      return [parent, index, index];\n    } else {\n      let index1 = await this.document.indexInParent(ancestors1[0] || cursor.path);\n      let index2 = await this.document.indexInParent(ancestors2[0] || anchor.path);\n      if (index2 < index1) {\n        [index1, index2] = [index2, index1];\n      }\n      return [common, index1, index2];\n    }\n  }\n\n  public async scroll(npages: number) {\n    let numlines = Math.round(npages * this.getLinesPerPage());\n    numlines = Math.max(Math.min(numlines, 1000), -1000); // guard against craziness\n\n    if (numlines > 0) {\n      for (let j = 0; j < numlines; j++) {\n        await this.cursor.down();\n      }\n    } else {\n      for (let j = 0; j < -numlines; j++) {\n        await this.cursor.up();\n      }\n    }\n\n    this.emit('scroll', numlines);\n  }\n\n  public async getTextRecusive(path: Path): Promise<[null, Array<string>] | [string, null]> {\n    let result: string[] = [];\n\n    let err: string | null = null;\n    if (await this.document.collapsed(path.row)) {\n        return ['Some blocks are folded!', null];\n    }\n\n    const text = await this.document.getText(path.row);\n    result.push(text);\n\n    if (await this.document.hasChildren(path.row)) {\n      let children = await this.document.getChildren(path);\n\n      const resultChildren = await Promise.all(\n        children.map(async (childrenPath) => {\n          return await this.getTextRecusive(childrenPath);\n        })\n      );\n\n      for (let [childErr, childResult] of resultChildren) {\n        if (childErr !== null) {\n          err = childErr;\n        } else {\n          result.push(...(childResult as Array<string>));\n        }\n      }\n\n    }\n\n    if (err === null) {\n      return [null, result];\n    } else {\n      return [err, null];\n    }\n  }\n}\n\nexport class InMemorySession extends Session {\n  constructor(options: SessionOptions = {}) {\n    const doc = new InMemoryDocument();\n    doc.loadEmpty(); // NOTE: should be async but is okay since in-memory\n    super(\n      new ClientStore(new SynchronousInMemory()), doc, options\n    );\n  }\n}\n\n","import keyDefinitions, { Motion } from '../keyDefinitions';\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-left',\n  'Move cursor left',\n  async function() {\n    return async (cursor, _options) => { await cursor.left(); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-right',\n  'Move cursor right',\n  async function() {\n    return async (cursor, options) => { await cursor.right(options); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-up',\n  'Move cursor up',\n  async function() {\n    return async (cursor, options) => { await cursor.up(options); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-down',\n  'Move cursor down',\n  async function() {\n    return async (cursor, options) => { await cursor.down(options); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-line-beginning',\n  'Move cursor to beginning of line',\n  async function() {\n    return async (cursor, _options) => { await cursor.home(); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-line-end',\n  'Move cursor to end of line',\n  async function() {\n    return async (cursor, options) => { await cursor.end(options); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-word-beginning',\n  'Move cursor to the first word-beginning before it',\n  async function() {\n    return async (cursor, options) => { await cursor.beginningWord({cursor: options}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-word-end',\n  'Move cursor to the first word-ending after it',\n  async function() {\n    return async (cursor, options) => { await cursor.endWord({cursor: options}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-word-next',\n  'Move cursor to the beginning of the next word',\n  async function() {\n    return async (cursor, options) => { await cursor.nextWord({cursor: options}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-Word-beginning',\n  'Move cursor to the first Word-beginning before it',\n  async function() {\n    return async (cursor, options) => { await cursor.beginningWord({cursor: options, whitespaceWord: true}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-Word-end',\n  'Move cursor to the first Word-ending after it',\n  async function() {\n    return async (cursor, options) => { await cursor.endWord({cursor: options, whitespaceWord: true}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-Word-next',\n  'Move cursor to the beginning of the next Word',\n  async function() {\n    return async (cursor, options) => { await cursor.nextWord({cursor: options, whitespaceWord: true}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-find-next-char',\n  'Move cursor to next occurrence of character in line',\n  async function({ keyStream }) {\n    const key = await keyStream.dequeue();\n    return async (cursor, options) => { await cursor.findNextChar(key, {cursor: options}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-find-prev-char',\n  'Move cursor to previous occurrence of character in line',\n  async function({ keyStream }) {\n    const key = await keyStream.dequeue();\n    return async (cursor, options) => { await cursor.findPrevChar(key, {cursor: options}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-to-next-char',\n  'Move cursor to just before next occurrence of character in line',\n  async function({ keyStream }) {\n    const key = await keyStream.dequeue();\n    return async (cursor, options) => { await cursor.findNextChar(key, {cursor: options, beforeFound: true}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-to-prev-char',\n  'Move cursor to just after previous occurrence of character in line',\n  async function({ keyStream }) {\n    const key = await keyStream.dequeue();\n    return async (cursor, options) => { await cursor.findPrevChar(key, {cursor: options, beforeFound: true}); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-visible-beginning',\n  'Go to the beginning of visible document',\n  async function() {\n    return async (cursor, _options) => { await cursor.visibleHome(); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-visible-end',\n  'Go to end of visible document',\n  async function() {\n    return async (cursor, _options) => { await cursor.visibleEnd(); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-parent',\n  'Go to the parent of current line',\n  async function() {\n    return async (cursor, options) => { await cursor.parent(options); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-next-sibling',\n  'Move cursor to the next sibling of the current line',\n  async function() {\n    return async (cursor, options) => { await cursor.nextSibling(options); };\n  },\n));\n\nkeyDefinitions.registerMotion(new Motion(\n  'motion-prev-sibling',\n  'Move cursor to the previous sibling of the current line',\n  async function() {\n    return async (cursor, options) => { await cursor.prevSibling(options); };\n  },\n));\n\nexport const SINGLE_LINE_MOTIONS = [\n  'motion-left',\n  'motion-right',\n  'motion-line-beginning',\n  'motion-line-end',\n  'motion-word-beginning',\n  'motion-word-end',\n  'motion-word-next',\n  'motion-Word-beginning',\n  'motion-Word-end',\n  'motion-Word-next',\n  'motion-find-next-char',\n  'motion-find-prev-char',\n  'motion-to-next-char',\n  'motion-to-prev-char',\n];\n","import * as _ from 'lodash';\n\nimport { SerializedBlock } from '../types';\nimport KeyMappings, { HotkeyMapping } from '../keyMappings';\nimport { motionKey } from '../keyDefinitions';\nimport { SINGLE_LINE_MOTIONS } from '../definitions/motions';\nimport Config from '../config';\n\n// TODO: 'next-sentence': [[')']]\n// TODO: 'prev-sentence': [['(']]\n\nexport const NORMAL_MOTION_MAPPINGS: HotkeyMapping = {\n  'motion-left': [['left'], ['h']],\n  'motion-right': [['right'], ['l']],\n  'motion-up': [['up'], ['k']],\n  'motion-down': [['down'], ['j']],\n  'motion-line-beginning': [['home'], ['0'], ['^']],\n  'motion-line-end': [['end'], ['$']],\n  'motion-word-beginning': [['b']],\n  'motion-word-end': [['e']],\n  'motion-word-next': [['w']],\n  'motion-Word-beginning': [['B']],\n  'motion-Word-end': [['E']],\n  'motion-Word-next': [['W']],\n\n  'motion-visible-beginning': [['g', 'g']],\n  'motion-visible-end': [['G'], ['g', 'G']],\n  'motion-parent': [['g', 'p']],\n  'motion-next-sibling': [['}']],\n  'motion-prev-sibling': [['{']],\n  // NOTE: should these work in insert mode also?\n  'motion-find-next-char': [['f']],\n  'motion-find-prev-char': [['F']],\n  'motion-to-next-char': [['t']],\n  'motion-to-prev-char': [['T']],\n};\n\nexport const INSERT_MOTION_MAPPINGS: HotkeyMapping = {\n  'motion-left': [['left']],\n  'motion-right': [['right']],\n  'motion-up': [['up']],\n  'motion-down': [['down']],\n  'motion-line-beginning': [['home'], ['ctrl+a'], ['meta+left']],\n  'motion-line-end': [['end'], ['ctrl+e'], ['meta+right']],\n  'motion-word-beginning': [['alt+b'], ['alt+left']],\n  'motion-word-end': [],\n  'motion-word-next': [['alt+f'], ['alt+right']],\n  'motion-Word-beginning': [],\n  'motion-Word-end': [],\n  'motion-Word-next': [],\n\n  'motion-visible-beginning': [['meta+home']],\n  'motion-visible-end': [['meta+end']],\n  'motion-parent': [['ctrl+g', 'p']],\n  'motion-next-sibling': [['alt+down']],\n  'motion-prev-sibling': [['alt+up']],\n};\n\nexport const NORMAL_MODE_MAPPINGS: HotkeyMapping = Object.assign({\n  'move-cursor-normal': [[motionKey]],\n  'toggle-help': [['?']],\n  'enter-visual-mode': [['v']],\n  'enter-visual-line-mode': [['V']],\n  'enter-insert-before-cursor': [['i']],\n  'enter-insert-after-cursor': [['a']],\n  'enter-insert-line-beginning': [['I']],\n  'enter-insert-line-end': [['A']],\n  'enter-insert-below-line': [['o']],\n  'enter-insert-above-line': [['O']],\n  'visit-link': [['g', 'x']],\n  'fold-toggle': [['z']],\n  'fold-open': [],\n  'fold-close': [],\n  'replace-char': [['r']],\n  'delete-blocks': [['d', 'd']],\n  'delete-motion': [['d', motionKey]],\n  'change-line': [['c', 'c']],\n  'change-to-line-end': [['C']],\n  'change-blocks': [['c', 'r']],\n  'change-motion': [['c', motionKey]],\n  'yank-line': [['y', 'y']],\n  'yank-to-line-end': [['Y']],\n  'yank-blocks': [['y', 'r']],\n  'yank-motion': [['y', motionKey]],\n  'yank-clone': [['y', 'c']],\n  'normal-delete-char': [['x']],\n  'normal-delete-char-before': [['X']],\n  'change-char': [['s']],\n  'delete-to-line-beginning': [],\n  'delete-to-line-end': [['D']],\n  'delete-to-word-beginning': [],\n  'paste-after': [['p']],\n  'paste-before': [['P']],\n  'join-line': [['J']],\n  'split-line': [['K']],\n  'scroll-down': [['page down'], ['ctrl+d']],\n  'scroll-up': [['page up'], ['ctrl+u']],\n  'undo': [['u']],\n  'redo': [['ctrl+r']],\n  'replay-command': [['.']],\n  'record-macro': [['q']],\n  'play-macro': [['@']],\n  'unindent-row': [['<']],\n  'indent-row': [['>']],\n  'unindent-blocks': [['shift+tab'], ['ctrl+h']],\n  'indent-blocks': [['tab'], ['ctrl+l']],\n  'swap-block-down': [['ctrl+j']],\n  'swap-block-up': [['ctrl+k']],\n  'search-local': [['ctrl+/'], ['ctrl+f']],\n  'search-global': [['/']],\n  'export-file': [['ctrl+s']],\n  'zoom-prev-sibling': [['alt+k']],\n  'zoom-next-sibling': [['alt+j']],\n  'zoom-in': [[']'], ['alt+l'], ['ctrl+right']],\n  'zoom-out': [['['], ['alt+h'], ['ctrl+left']],\n  'zoom-cursor': [['enter'], ['ctrl+shift+right']],\n  'zoom-root': [['shift+enter'], ['ctrl+shift+left']],\n  'jump-prev': [['ctrl+o']],\n  'jump-next': [['ctrl+i']],\n  'swap-case': [['~']],\n  'go-next-clone': [['g', 'c']],\n}, NORMAL_MOTION_MAPPINGS);\n\nexport const VISUAL_MODE_MAPPINGS: HotkeyMapping = Object.assign({\n  'move-cursor-visual': [[motionKey]],\n  'toggle-help': [['?']],\n  'exit-mode': [['esc'], ['ctrl+c'], ['ctrl+[']],\n  'swap-visual-cursor': [['o'], ['O']],\n  'visual-delete': [['d'], ['x']],\n  'visual-change': [['c']],\n  'visual-yank': [['y']],\n  'visual-swap-case': [['~']],\n}, _.pick(NORMAL_MOTION_MAPPINGS, SINGLE_LINE_MOTIONS));\n\nexport const VISUAL_LINE_MODE_MAPPINGS: HotkeyMapping = Object.assign({\n  'move-cursor-visual-line': [[motionKey]],\n  'toggle-help': [['?']],\n  'exit-mode': [['esc'], ['ctrl+c'], ['ctrl+[']],\n  'swap-visual-cursor': [['o'], ['O']],\n  'visual-line-delete': [['d'], ['x']],\n  'visual-line-change': [['c']],\n  'visual-line-join': [['J']],\n  'visual-line-yank': [['y']],\n  'visual-line-yank-clone': [['Y']],\n  'visual-line-indent': [['>'], ['tab'], ['ctrl+l']],\n  'visual-line-unindent': [['<'], ['shift+tab'], ['ctrl+h']],\n  'visual-line-swap-case': [['~']],\n}, NORMAL_MOTION_MAPPINGS);\n\nexport const INSERT_MODE_MAPPINGS: HotkeyMapping = Object.assign({\n  'move-cursor-insert': [[motionKey]],\n  'toggle-help': [['ctrl+?']],\n  'exit-mode': [['esc'], ['ctrl+c'], ['ctrl+[']],\n  'fold-toggle': [['ctrl+space']],\n  'fold-open': [['meta+down']],\n  'fold-close': [['meta+up']],\n  'delete-blocks': [['meta+shift+delete']],\n  'delete-char-after': [['delete']],\n  'delete-char-before': [['backspace'], ['shift+backspace']],\n  'delete-to-line-beginning': [['ctrl+u']],\n  'delete-to-line-end': [['ctrl+k']],\n  'delete-to-word-beginning': [['ctrl+w'], ['ctrl+backspace']],\n  // NOTE: paste-after doesn't make much sense for insert mode\n  'paste-before': [['ctrl+y']],\n  'split-line': [['enter']],\n  'scroll-down': [['page down']],\n  'scroll-up': [['page up']],\n  'undo': [['ctrl+z']],\n  'redo': [['ctrl+Z']],\n  'unindent-row': [],\n  'indent-row': [],\n  'unindent-blocks': [['shift+tab']],\n  'indent-blocks': [['tab']],\n  'swap-block-down': [],\n  'swap-block-up': [],\n  'zoom-prev-sibling': [['alt+k']],\n  'zoom-next-sibling': [['alt+j']],\n  'zoom-in': [['ctrl+right']],\n  'zoom-out': [['ctrl+left']],\n  'zoom-cursor': [['ctrl+shift+right']],\n  'zoom-root': [['ctrl+shift+left']],\n}, INSERT_MOTION_MAPPINGS);\n\nexport const SEARCH_MODE_MAPPINGS: HotkeyMapping = Object.assign({\n  'move-cursor-search': [[motionKey]],\n  'toggle-help': [['ctrl+?']],\n  'exit-mode': [['esc'], ['ctrl+c'], ['ctrl+[']],\n  'search-delete-char-after': [['delete']],\n  'search-delete-char-before': [['backspace'], ['shift+backspace']],\n  'search-select': [['enter']],\n  'search-up': [['ctrl+k'], ['up'], ['shift+tab']],\n  'search-down': [['ctrl+j'], ['down'], ['tab']],\n}, _.pick(INSERT_MOTION_MAPPINGS, SINGLE_LINE_MOTIONS));\n\nexport const SETTINGS_MODE_MAPPINGS: HotkeyMapping = {\n  'exit-mode': [['esc'], ['ctrl+c'], ['ctrl+[']],\n};\n\nexport const WORKFLOWY_MODE_MAPPINGS: HotkeyMapping = Object.assign({\n  'move-cursor-insert': [[motionKey]],\n  'toggle-help': [['ctrl+?'], ['meta+?']],\n  'fold-toggle': [],\n  'fold-open': [['meta+down']],\n  'fold-close': [['meta+up']],\n  'delete-blocks': [['meta+shift+delete']],\n  'delete-char-after': [['delete']],\n  'delete-char-before': [['backspace'], ['shift+backspace']],\n  'delete-to-line-beginning': [['ctrl+u']],\n  'delete-to-line-end': [['ctrl+k']],\n  'delete-to-word-beginning': [['ctrl+w'], ['ctrl+backspace']],\n  // NOTE: paste-after doesn't make much sense for insert mode\n  'paste-before': [['ctrl+y']],\n  'split-line': [['enter']],\n  'scroll-down': [['page down']],\n  'scroll-up': [['page up']],\n  'undo': [['ctrl+z'], ['meta+z']],\n  'redo': [['ctrl+Z'], ['meta+Z'], ['meta+y']],\n  'unindent-row': [],\n  'indent-row': [],\n  'unindent-blocks': [['shift+tab']],\n  'indent-blocks': [['tab']],\n  'swap-block-down': [['meta+shift+up']],\n  'swap-block-up': [['meta+shift+down']],\n  'zoom-prev-sibling': [],\n  'zoom-next-sibling': [],\n  'zoom-in': [],\n  'zoom-out': [['meta+<']],\n  'zoom-cursor': [['meta+>']],\n  'zoom-root': [],\n}, INSERT_MOTION_MAPPINGS);\n\nfunction getDefaultData(): Array<SerializedBlock> {\n  return [\n    'Welcome to vimflowy!',\n    'I hope you know to use j and k to move up and down!',\n    'If not, the cheat sheet on the right will be your friend.  Once you become an expert, you\\'ll know to use ? to hide it',\n    { text: 'Features', children: [\n      { text: 'Workflowy features', children: [\n        { text: 'Nested bullets', children: [\n          'Bullets with children can be collapsed to avoid clutter',\n          { text: 'Use enter to zoom into any bullet.  Try on this one', collapsed: true, children: [\n            'This bullet had children, but you can zoom into bullets with no children to start expanding upon them',\n            'Use shift+enter to zoom all the way back out',\n            'Use ] and [ to zoom in and out just one level',\n          ] },\n          { text: 'Use z to toggle collapsedness', collapsed: true, children: [\n            'You found me :)',\n          ] },\n          'Use tab and shift+tab to indent and unindent blocks',\n          'Use < and > to indent and unindent just a single line',\n        ] },\n      ] },\n      { text: 'Vim features', collapsed: true, children: [\n        'Most of vim\\'s movement commands',\n        'Modal editing (note visual mode only works on one line)',\n        'Undo/redo, jump history (ctrl+o to jump to previous location, ctrl+i to jump forward)',\n        'Repeat commands with . and record macros with q',\n        'Let the vimflowy devs know if anything major is missing',\n      ] },\n      'Press / to start searching for text',\n      { text: 'Marks', plugins: { mark: 'mark' }, collapsed: true, children: [\n        { text: 'I am marked!', plugins: { mark: 'im_a_mark' } },\n        'Press m to start marking a line, and enter to finish',\n        'Use \\' to search and jump to marks',\n        'Link to marks with the @ symbol, like this:  @im_a_mark.  Use gm to follow the link.',\n        'Delete marks by using dm, or just mark with empty string',\n      ] },\n      { text: 'Cloning', collapsed: true, children: [\n        { text: 'I am a clone!  Try editing me', id: 1 },\n        { text: 'Clones can\\'t be siblings or descendants of each other', children: [\n          { clone: 1 },\n        ] },\n        'Make new clones with yc, then p',\n      ] },\n      { text: 'Rich text', collapsed: true, children: [\n        { text: 'Text formatting', collapsed: true, children: [\n          '**Bold**, *italicized*, and _underlined_ text.  ** * _Emphatic_ * **!',\n          {\n            text: 'Strike through',\n            children: [\n              '~~Cross thing off todo list~~',\n              'Cross another thing off todo list',\n            ],\n          },\n        ] },\n        { text: 'LaTeX', collapsed: true, children: [\n          'Inline equations: $E = mc^2$ and $f(b) - f(a) = \\\\int_a^b f\\'(t) dt$',\n          'Block equations: $$\\\\max_{x \\\\ge 0, Ax \\\\le b} c^T x = \\\\min_{y \\\\ge 0, A^ty \\\\ge c} b^T y$$',\n        ] },\n        { text: 'HTML', collapsed: true, children: [\n          'Inline arbitrary HTML, such as images: <img src=\"/images/vimflowy-32.png\"/>',\n          'Or tables: <table><tr><th>Pros</th><th>Cons</th></tr><tr><td>Everything</td><td>Nothing</td></tr></table>',\n          'Or <span style=\\'color: blue\\'>colored</span> <span style=\\'color: orange\\'>text</span>',\n        ] },\n      ] },\n      { text: 'Customizability (see Settings menu)', collapsed: true, children: [\n        { text: 'Plugins system', collapsed: true, children: [\n          'If you\\'re interested in writing plugins, see here: ' +\n            'https://github.com/WuTheFWasThat/vimflowy/blob/master/docs/plugins.md',\n        ] },\n        'Customizable hotkeys (via downloading/uploading a json file)',\n        'Customizable color theme',\n      ] },\n    ] },\n    { text: 'Data', collapsed: true, children: [\n      { text: 'Backing storage', children: [\n        'Vimflowy was designed to be agnostic to the storage backend',\n        'As a user, you are in full control of your data',\n        'By default, all data is entirely local',\n        'There are no backups, and it is never sent over the internet',\n        'However, remote data storage is supported',\n        'For more details, visit https://github.com/WuTheFWasThat/vimflowy/blob/master/docs/storage/README.md',\n        'To manage your data, visit the Settings menu',\n      ] },\n      { text: 'Importing and exporting data', children: [\n        'Two import and export formats are supported.',\n        'Check out settings for more information.',\n        'You can regularly export your data in JSON format, as a form of backup',\n      ] },\n      'To make a new document with separate data, just add the \"doc\" query parameter. ' +\n        `For example, ${window.location.origin}/?doc=newdocname#`,\n    ] },\n    'Press i to enter insert mode and start adding your own content!',\n    'For more info, visit https://github.com/WuTheFWasThat/vimflowy (visit links under the cursor with gx)',\n  ];\n}\n\nconst config: Config = {\n  defaultMode: 'NORMAL',\n  getDefaultData: getDefaultData,\n  // TODO: get the keys from modes.ts\n  defaultMappings:\n    new KeyMappings({\n      [ 'NORMAL' ]: NORMAL_MODE_MAPPINGS,\n      [ 'INSERT' ]: INSERT_MODE_MAPPINGS,\n      [ 'VISUAL' ]: VISUAL_MODE_MAPPINGS,\n      [ 'VISUAL_LINE' ]: VISUAL_LINE_MODE_MAPPINGS,\n      [ 'SEARCH' ]: SEARCH_MODE_MAPPINGS,\n      [ 'SETTINGS' ]: SETTINGS_MODE_MAPPINGS,\n    }),\n};\nexport default config;\n","import { ServerConfig } from '../../shared/server_config';\n\nexport const SERVER_CONFIG: ServerConfig = JSON.parse(process.env.REACT_APP_SERVER_CONFIG || '{}');\n\n","import { isLink } from '../utils/text';\nimport keyDefinitions, { Action, ActionContext, SequenceAction } from '../keyDefinitions';\n\nkeyDefinitions.registerAction(new Action(\n  'move-cursor-normal',\n  'Move the cursor (according to the specified motion)',\n  async function(context) {\n    const { motion, session, repeat } = context;\n    if (motion == null) {\n      throw new Error('Motion command was not passed a motion');\n    }\n    const tmp = session.cursor.clone();\n    for (let j = 0; j < repeat; j++) {\n      await motion(tmp, {});\n    }\n    if (await session.isVisible(tmp.path)) {\n      await session.cursor.from(tmp);\n    }\n  },\n  { sequence: SequenceAction.DROP, acceptsMotion: true },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'move-cursor-insert',\n  'Move the cursor (according to the specified motion)',\n  async function(context) {\n    const { motion, session } = context;\n    if (motion == null) {\n      throw new Error('Motion command was not passed a motion');\n    }\n    await motion(session.cursor, {pastEnd: true});\n  },\n  { acceptsMotion: true },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'move-cursor-visual',\n  'Move the cursor (according to the specified motion)',\n  async function(context) {\n    const { motion, session, repeat } = context;\n    if (motion == null) {\n      throw new Error('Motion command was not passed a motion');\n    }\n    // this is necessary until we figure out multiline\n    const tmp = session.cursor.clone();\n    for (let j = 0; j < repeat; j++) {\n      await motion(tmp, {pastEnd: true});\n    }\n\n    if (!tmp.path.is(session.cursor.path)) { // only allow same-row movement\n      session.showMessage('Visual mode currently only works on one line', {text_class: 'error'});\n    } else {\n      await session.cursor.from(tmp);\n    }\n  },\n  { acceptsMotion: true },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'move-cursor-visual-line',\n  'Move the cursor (according to the specified motion)',\n  async function(context) {\n    const { motion, session, repeat } = context;\n    if (motion == null) {\n      throw new Error('Motion command was not passed a motion');\n    }\n    for (let j = 0; j < repeat; j++) {\n      await motion(session.cursor, {pastEnd: true});\n    }\n  },\n  { acceptsMotion: true },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'toggle-help',\n  'Show/hide key bindings (edit in settings)',\n  async function({ session }) {\n    session.toggleBindingsDiv();\n  },\n  { sequence: SequenceAction.DROP },\n));\n\n// TODO: have ':' in normal mode open set to SETTINGS?\nkeyDefinitions.registerAction(new Action(\n  'enter-insert-before-cursor',\n  'Insert at character',\n  async function({ session }) {\n    await session.setMode('INSERT');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'enter-insert-after-cursor',\n  'Insert after character',\n  async function({ session }) {\n    await session.setMode('INSERT');\n    await session.cursor.right({pastEnd: true});\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'enter-insert-line-beginning',\n  'Insert at beginning of line',\n  async function({ session }) {\n    await session.setMode('INSERT');\n    await session.cursor.home();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'enter-insert-line-end',\n  'Insert after end of line',\n  async function({ session }) {\n    await session.setMode('INSERT');\n    await session.cursor.end({pastEnd: true});\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'enter-insert-below-line',\n  'Insert on new line after current line',\n  async function({ session }) {\n    await session.setMode('INSERT');\n    await session.newLineBelow();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'enter-insert-above-line',\n  'Insert on new line before current line',\n  async function({ session }) {\n    await session.setMode('INSERT');\n    await session.newLineAbove();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'visit-link',\n  'Visit the link indicated by the cursor, in a new tab',\n  async function({ session }) {\n    const word = await session.document.getWord(session.cursor.row, session.cursor.col);\n    if (isLink(word)) {\n      window.open(word);\n    } else {\n      session.showMessage(`Tried to open non-link: ${word}`, {text_class: 'error'});\n    }\n  },\n  { sequence: SequenceAction.DROP },\n));\n\n// ACTIONS\nkeyDefinitions.registerAction(new Action(\n  'fold-toggle',\n  'Toggle whether a block is folded',\n  async function({ session }) {\n    await session.toggleCurBlockCollapsed();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'fold-open',\n  'Open a collapsed block',\n  async function({ session }) {\n    await session.setCurBlockCollapsed(false);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'fold-close',\n  'Close a collapsed block',\n  async function({ session }) {\n    await session.setCurBlockCollapsed(true);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'replace-char',\n  'Replace character(s)',\n  async function({ session, keyStream, repeat }) {\n    let key = await keyStream.dequeue();\n    // TODO: refactor keys so this is unnecessary\n    if (key === 'space') { key = ' '; }\n    await session.replaceCharsAfterCursor(key, repeat);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'visual-delete',\n  'Delete visual selection',\n  async function({ session }) {\n    const options = {includeEnd: true, yank: true};\n    await session.deleteBetween(session.cursor, session.anchor, options);\n    await session.setMode('NORMAL');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'visual-line-delete',\n  'Delete visual line selection',\n  async function({ session, visual_line }) {\n    if (visual_line == null) {\n      throw new Error('Visual_line mode arguments missing');\n    }\n    await session.delBlocks(visual_line.parent.row, visual_line.start_i, visual_line.num_rows, {addNew: false});\n    await session.setMode('NORMAL');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'delete-motion',\n  'Delete from cursor with motion',\n  async function({ motion, session, repeat }) {\n    if (motion == null) {\n      throw new Error('Delete motion command was not passed a motion');\n    }\n    const cursor = session.cursor.clone();\n    for (let j = 0; j < repeat; j++) {\n      await motion(cursor, {pastEnd: true, pastEndWord: true});\n    }\n\n    await session.deleteBetween(session.cursor, cursor, { yank: true });\n  },\n  { acceptsMotion: true },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'delete-blocks',\n  'Delete block',\n  async function({ session, repeat }) {\n    await session.delBlocksAtCursor(repeat, {addNew: false});\n  },\n));\n\n// change\n\nkeyDefinitions.registerAction(new Action(\n  'visual-change',\n  'Change',\n  async function({ session }) {\n    const options = {includeEnd: true, yank: true};\n    await session.deleteBetween(session.cursor, session.anchor, options);\n    await session.setMode('INSERT');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'visual-line-change',\n  'Change',\n  async function({ session, visual_line }) {\n    if (visual_line == null) {\n      throw new Error('Visual_line mode arguments missing');\n    }\n    await session.delBlocks(visual_line.parent.row, visual_line.start_i, visual_line.num_rows, {addNew: true});\n    await session.setMode('INSERT');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'visual-line-join',\n  'Join all selected rows',\n  async function({ session, visual_line }) {\n    if (visual_line == null) {\n      throw new Error('Visual_line mode arguments missing');\n    }\n\n    if (visual_line.num_rows < 1) {\n      return session.showMessage('No lines selected!?', {text_class: 'error'});\n    }\n\n    const resultArr = await Promise.all(\n      visual_line.selected.map(async (path) => {\n        return await session.getTextRecusive(path);\n      })\n    );\n\n    let result: string[] = [];\n    for (let [childErr, childResult] of resultArr) {\n      if (childErr !== null) {\n        return session.showMessage(childErr, {text_class: 'error'});\n      } else {\n        result.push(...(childResult as Array<string>));\n      }\n    }\n    const result_str = result.join('\\n');\n\n    if (result) {\n      await session.delBlocks(visual_line.parent.row, visual_line.start_i, visual_line.num_rows, {addNew: false});\n      await session.addBlocks(visual_line.parent, visual_line.start_i, [result_str]);\n    }\n\n    await session.setMode('NORMAL');\n  },\n));\n\n// TODO: support repeat?\nkeyDefinitions.registerAction(new Action(\n  'change-line',\n  'Delete row, and enter insert mode',\n  async function({ session }) {\n    await session.setMode('INSERT');\n    await session.clearRowAtCursor({yank: true});\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'change-blocks',\n  'Delete blocks, and enter insert mode',\n  async function({ session, repeat }) {\n    await session.setMode('INSERT');\n    await session.delBlocksAtCursor(repeat, {addNew: true});\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'change-motion',\n  'Delete from cursor with motion, and enter insert mode',\n  async function({ session, repeat, motion }) {\n    if (motion == null) {\n      throw new Error('Change motion command was not passed a motion');\n    }\n    const cursor = session.cursor.clone();\n    for (let j = 0; j < repeat; j++) {\n      await motion(cursor, {pastEnd: true, pastEndWord: true});\n    }\n    await session.setMode('INSERT');\n    await session.deleteBetween(session.cursor, cursor, {yank: true});\n  },\n  { acceptsMotion: true },\n));\n\nkeyDefinitions.registerComposedAction(\n  'change-to-line-end',\n  'Delete to the end of the line, and enter insert mode',\n  ['change-motion', 'motion-line-end']\n);\n\n// yank\n\nkeyDefinitions.registerAction(new Action(\n  'visual-yank',\n  'Yank',\n  async function({ session }) {\n    const options = {includeEnd: true};\n    await session.yankBetween(session.cursor, session.anchor, options);\n    await session.setMode('NORMAL');\n  },\n  { sequence: SequenceAction.DROP_ALL },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'visual-line-yank',\n  'Yank',\n  async function({ session, visual_line }) {\n    if (visual_line == null) {\n      throw new Error('Visual_line mode arguments missing');\n    }\n    await session.yankBlocks(visual_line.start, visual_line.num_rows);\n    await session.setMode('NORMAL');\n  },\n  { sequence: SequenceAction.DROP_ALL },\n));\n\n// TODO: support repeat?\nkeyDefinitions.registerAction(new Action(\n  'yank-line',\n  'Yank row',\n  async function({ session }) {\n    await session.yankRowAtCursor();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'yank-blocks',\n  'Yank blocks',\n  async function({ session, repeat }) {\n    await session.yankBlocksAtCursor(repeat);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'yank-motion',\n  'Yank from cursor with motion',\n  async function({ session, motion, repeat }) {\n    if (motion == null) {\n      throw new Error('Yank motion command was not passed a motion');\n    }\n    const cursor = session.cursor.clone();\n    for (let j = 0; j < repeat; j++) {\n      await motion(cursor, {pastEnd: true, pastEndWord: true});\n    }\n\n    await session.yankBetween(session.cursor, cursor, {});\n  },\n  { acceptsMotion: true },\n));\n\nkeyDefinitions.registerComposedAction(\n  'yank-to-line-end',\n  'Yank to the end of the line',\n  ['yank-motion', 'motion-line-end']\n);\n\nkeyDefinitions.registerAction(new Action(\n  'yank-clone',\n  'Yank blocks as a clone',\n  async function({ session, repeat }) {\n    await session.yankBlocksCloneAtCursor(repeat);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'visual-line-yank-clone',\n  'Yank blocks as a clone',\n  async function({ session, visual_line }) {\n    if (visual_line == null) {\n      throw new Error('Visual_line mode arguments missing');\n    }\n    await session.yankBlocksClone(visual_line.start, visual_line.num_rows);\n    await session.setMode('NORMAL');\n  },\n));\n\n// delete\n\nkeyDefinitions.registerAction(new Action(\n  'normal-delete-char',\n  'Delete character at the cursor',\n  async function({ session, repeat }) {\n    await session.delCharsAfterCursor(repeat, {yank: true});\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'delete-char-after',\n  'Delete character after the cursor (i.e. del key)',\n  async function({ session }) {\n    await session.delCharsAfterCursor(1);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'normal-delete-char-before',\n  'Delete previous character',\n  async function({ session, repeat }) {\n    const num = Math.min(session.cursor.col, repeat);\n    if (num > 0) {\n      await session.delCharsBeforeCursor(num, {yank: true});\n    }\n  },\n));\n// behaves like row delete, in visual line\n\nkeyDefinitions.registerAction(new Action(\n  'delete-char-before',\n  'Delete previous character (i.e. backspace key)',\n  async function({ session }) {\n    await session.deleteAtCursor();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'change-char',\n  'Change character',\n  async function({ session }) {\n    await session.setMode('INSERT');\n    await session.delCharsAfterCursor(1, {yank: true});\n  },\n));\n\nkeyDefinitions.registerComposedAction(\n  'delete-to-line-beginning',\n  'Delete to the beginning of the line',\n  ['delete-motion', 'motion-line-beginning']\n);\n\nkeyDefinitions.registerComposedAction(\n  'delete-to-line-end',\n  'Delete to the end of the line',\n  ['delete-motion', 'motion-line-end']\n);\n\nkeyDefinitions.registerComposedAction(\n  'delete-to-word-beginning',\n  'Delete to the beginning of the previous word',\n  ['delete-motion', 'motion-word-beginning']\n);\n\nkeyDefinitions.registerAction(new Action(\n  'paste-after',\n  'Paste after cursor',\n  async function({ session }) {\n    await session.pasteAfter();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'paste-before',\n  'Paste before cursor',\n  async function({ session }) {\n    await session.pasteBefore();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'join-line',\n  'Join current line with line below',\n  async function({ session }) {\n    await session.joinAtCursor();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'split-line',\n  'Split line at cursor',\n  async function({ session }) {\n    await session.newLineAtCursor();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'scroll-down',\n  'Scroll half window down',\n  async function({ session }) {\n    await session.scroll(0.5);\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'scroll-up',\n  'Scroll half window up',\n  async function({ session }) {\n    await session.scroll(-0.5);\n  },\n  { sequence: SequenceAction.DROP },\n));\n\n// for everything but normal mode\nkeyDefinitions.registerAction(new Action(\n  'exit-mode',\n  'Exit back to normal mode',\n  async function({ session }) {\n    await session.setMode('NORMAL');\n  },\n  // generally dont repeat actions not in normal mode\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'enter-visual-mode',\n  'Enter visual mode',\n  async function({ session }) {\n    await session.setMode('VISUAL');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'enter-visual-line-mode',\n  'Enter visual line mode',\n  async function({ session }) {\n    await session.setMode('VISUAL_LINE');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'swap-visual-cursor',\n  'Swap cursor to other end of selection, in visual and visual line mode',\n  async function({ session }) {\n    const tmp = session.anchor.clone();\n    await session.anchor.from(session.cursor);\n    await session.cursor.from(tmp);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'swap-case',\n  'Swap case',\n  async function({ session }) {\n    await session.swapCaseAtCursor();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'visual-swap-case',\n  'Swap case in VISUAL mode',\n  async function({ session }) {\n    await session.swapCaseInVisual(session.cursor, session.anchor);\n    await session.setMode('NORMAL');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'visual-line-swap-case',\n  'Swap case in VISUAL_LINE mode',\n  async function({ session, visual_line }: ActionContext) {\n    if (visual_line == null) {\n      throw new Error('Visual_line mode arguments missing');\n    }\n\n    const rows = (await session.document.getChildRange(\n      visual_line.parent, visual_line.start_i, visual_line.end_i\n    )).map(path => {\n      return path.row;\n    });\n\n    await session.swapCaseInVisualLine(rows);\n    await session.setMode('NORMAL');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'go-next-clone',\n  'Go to next copy of this clone',\n  async function({ session }) {\n    const newPath = await session.document.nextClone(session.cursor.path);\n    await session.cursor.setPath(newPath);\n    if (!(await session.isVisible(newPath))) {\n      await session.zoomInto(newPath);\n    }\n  },\n));\n","import keyDefinitions, { Action, SequenceAction } from '../keyDefinitions';\nimport { Key, Macro } from '../types';\n\nkeyDefinitions.registerAction(new Action(\n  'undo',\n  'Undo',\n  async function({ session, repeat }) {\n    for (let j = 0; j < repeat; j++) {\n      await session.undo();\n    }\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'redo',\n  'Redo',\n  async function({ session, repeat }) {\n    for (let j = 0; j < repeat; j++) {\n      await session.redo();\n    }\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'replay-command',\n  'Replay last command',\n  async function({ repeat, keyStream, keyHandler }) {\n    for (let j = 0; j < repeat; j++) {\n      await keyHandler.playRecording(keyStream.lastSequence);\n    }\n  },\n  { sequence: SequenceAction.DROP },\n));\n\n// TODO: store this on session?  dont assume global\nlet RECORDING: {\n  macro: Macro,\n  key: Key,\n} | null = null;\nconst RECORDING_LISTENER = (key: Key) => {\n  if (!RECORDING) {\n    throw new Error('Recording listener on while there was no recording');\n  }\n  // TODO avoid recording RECORD_MACRO itself?\n  // current record_macro implementation pops itself off\n  // and assumes it's only 1 key\n  RECORDING.macro.push(key);\n};\n\nkeyDefinitions.registerAction(new Action(\n  'record-macro',\n  'Begin/stop recording a macro',\n  async function({ keyStream, session }) {\n    if (RECORDING === null) {\n      const key = await keyStream.dequeue();\n      RECORDING = {\n        macro: [],\n        key: key,\n      };\n      keyStream.on('dequeue', RECORDING_LISTENER);\n    } else {\n      // pop off the RECORD_MACRO itself\n      RECORDING.macro.pop();\n      const macros = session.clientStore.getMacros();\n      const macro = RECORDING.macro;\n      macros[RECORDING.key] = macro;\n      session.clientStore.setMacros(macros);\n      RECORDING = null;\n      keyStream.off('dequeue', RECORDING_LISTENER);\n    }\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'play-macro',\n  'Play a macro',\n  async function({ keyStream, keyHandler, repeat, session }) {\n    const key = await keyStream.dequeue();\n    const macros = session.clientStore.getMacros();\n    const recording = macros[key];\n    if (recording == null) {\n      keyStream.drop();\n      return;\n    }\n    for (let j = 0; j < repeat; j++) {\n      await keyHandler.playRecording(recording);\n    }\n  },\n));\n","import keyDefinitions, { Action } from '../keyDefinitions';\n\nkeyDefinitions.registerAction(new Action(\n  'indent-row',\n  'Indent row right',\n  async function({ session }) {\n    await session.indent();\n  },\n));\n// NOTE: this matches block indent behavior, in visual line\nkeyDefinitions.registerAction(new Action(\n  'visual-line-indent',\n  'Indent blocks right',\n  async function({ session, visual_line }) {\n    if (visual_line == null) {\n      throw new Error('Visual_line mode arguments missing');\n    }\n    await session.indentBlocks(visual_line.start, visual_line.num_rows);\n    await session.setMode('NORMAL');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'unindent-row',\n  'Unindent row',\n  async function({ session }) {\n    await session.unindent();\n  },\n));\n\n// NOTE: this matches block indent behavior, in visual line\nkeyDefinitions.registerAction(new Action(\n  'visual-line-unindent',\n  'Unindent blocks',\n  async function({ session, visual_line }) {\n    if (visual_line == null) {\n      throw new Error('Visual_line mode arguments missing');\n    }\n    await session.unindentBlocks(visual_line.start, visual_line.num_rows);\n    await session.setMode('NORMAL');\n  }\n));\n\nkeyDefinitions.registerAction(new Action(\n  'indent-blocks',\n  'Indent blocks right',\n  async function({ session, repeat }) {\n    await session.indentBlocks(session.cursor.path, repeat);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'unindent-blocks',\n  'Move block left',\n  async function({ session, repeat }) {\n    await session.unindentBlocks(session.cursor.path, repeat);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'swap-block-down',\n  'Move block down',\n  async function({ session }) {\n    await session.swapDown();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'swap-block-up',\n  'Move block up',\n  async function({ session }) {\n    await session.swapUp();\n  },\n));\n","import Session, { InMemorySession } from './session';\nimport { Line } from './types';\n\n/*\nRepresents the menu shown in menu mode.\nFunctions for paging through and selecting results, and for rendering.\nInternally uses an entire session object (this is sorta weird..)\n*/\n\nexport type MenuResult = {\n  contents: Line;\n\n  // called when selected\n  fn: any; // TODO\n\n  // props for rendering LineComponent\n  renderOptions?: {\n    accents: {[column: number]: boolean}\n  };\n\n  // hook for rendering search result contents\n  renderHook?: (line: any) => any; // TODO\n};\n\ntype Query = string;\ntype SearchFn = (query: Query) => Promise<Array<MenuResult>>;\n\nexport default class Menu {\n  private searchFn: SearchFn;\n  public results: Array<MenuResult>;\n  public selection: number;\n\n  public session: Session;\n\n  private lastQuery: Query | null = null;\n\n  constructor(searchFn: SearchFn) {\n    this.searchFn = searchFn;\n\n    // a bit of a overkill-y hack, use an entire session object internally\n    this.session = new InMemorySession({ initialMode: 'INSERT' });\n    this.selection = 1;\n\n    this.results = [];\n  }\n\n  public up() {\n    if (!this.results.length) {\n      return;\n    }\n    if (this.selection <= 0) {\n      this.selection = this.results.length - 1;\n    } else {\n      this.selection = this.selection - 1;\n    }\n  }\n\n  public down() {\n    if (!this.results.length) {\n      return;\n    }\n    if (this.selection + 1 >= this.results.length) {\n      this.selection = 0;\n    } else {\n      this.selection = this.selection + 1;\n    }\n  }\n\n  public async update() {\n    const query = await this.session.curText();\n    if ((JSON.stringify(query)) !== (JSON.stringify(this.lastQuery))) {\n      this.lastQuery = query;\n      // const t = Date.now();\n      // console.log('updating results');\n      this.results = await this.searchFn(query);\n      // console.log('updating results took', Date.now() - t);\n      this.selection = 0;\n    }\n  }\n\n  public async select() {\n    if (!this.results.length) {\n      return;\n    }\n    const result = this.results[this.selection];\n    await result.fn();\n  }\n}\n","import * as React from 'react';\n\nimport Session from '../session';\nimport Path from '../path';\nimport Menu from '../menu';\nimport keyDefinitions, { Action } from '../keyDefinitions';\n\nasync function start_search(searchRoot: Path, session: Session) {\n  await session.setMode('SEARCH');\n  session.menu = new Menu(async (text) => {\n    const results = await session.document.search(searchRoot, text);\n    return Promise.all(\n      results.map(async ({ path, matches }) => {\n        const accents: {[column: number]: boolean} = {};\n        matches.forEach((i) => {\n          accents[i] = true;\n        });\n        return {\n          contents: await session.document.getLine(path.row),\n          renderHook(lineDiv: React.ReactElement<any>) {\n            const cachedRow = session.document.cache.get(path.row);\n            if (!cachedRow) {\n              throw new Error('Row wasnt cached despite search returning it');\n            }\n            const hooksInfo = {\n              path,\n              pluginData: cachedRow.pluginData,\n            };\n            return (\n              <span>\n              {\n                session.applyHook(\n                  'renderLineContents',\n                  [lineDiv],\n                  hooksInfo\n                )\n              }\n              </span>\n            );\n          },\n          renderOptions: { accents },\n          fn: async () => {\n            await session.zoomInto(path);\n            await session.cursor.setPath(path);\n          },\n        };\n      })\n    );\n  });\n}\n\nkeyDefinitions.registerAction(new Action(\n  'search-local',\n  'Search within view root',\n  async function({ session }) {\n    await start_search(session.viewRoot, session);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'search-global',\n  'Search within entire document',\n  async function({ session }) {\n    await start_search(session.document.root, session);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'move-cursor-search',\n  'Move the cursor within the search box (according to the specified motion)',\n  async function({ motion, session }) {\n    if (motion == null) {\n      throw new Error('Motion command was not passed a motion');\n    }\n    if (session.menu == null) {\n      throw new Error('Menu session missing');\n    }\n    await motion(session.menu.session.cursor, {pastEnd: true});\n  },\n  { acceptsMotion: true },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'search-delete-char-after',\n  'Delete character after the cursor (i.e. del key)',\n  async function({ session }) {\n    if (session.menu == null) {\n      throw new Error('Menu session missing');\n    }\n    await session.menu.session.delCharsAfterCursor(1);\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'search-delete-char-before',\n  'Delete previous character (i.e. backspace key)',\n  async function({ session }) {\n    if (session.menu == null) {\n      throw new Error('Menu session missing');\n    }\n    await session.menu.session.deleteAtCursor();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'search-select',\n  'Select current menu selection',\n  async function({ session }) {\n    if (session.menu == null) {\n      throw new Error('Menu session missing');\n    }\n    await session.menu.select();\n    return await session.setMode('NORMAL');\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'search-up',\n  'Select previous menu selection',\n  async function({ session }) {\n    if (session.menu == null) {\n      throw new Error('Menu session missing');\n    }\n    return session.menu.up();\n  },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'search-down',\n  'Select next menu selection',\n  async function({ session }) {\n    if (session.menu == null) {\n      throw new Error('Menu session missing');\n    }\n    return session.menu.down();\n  },\n));\n\n","import * as _ from 'lodash';\nimport * as React from 'react'; // tslint:disable-line no-unused-variable\nimport $ from 'jquery';\n\nimport Path from '../../assets/ts/path';\nimport { registerPlugin } from '../../assets/ts/plugins';\nimport * as browser_utils from '../../assets/ts/utils/browser';\nimport { getStyles } from '../../assets/ts/themes';\n\ntype EasyMotionMappings = {\n  key_to_path: {[key: string]: Path},\n  path_to_key: {[serialized_path: string]: string},\n};\n\nasync function getVisiblePaths() {\n  const paths: Array<Path> = [];\n  $.makeArray($('.bullet')).forEach((bullet) => {\n    // TODO: more proper way to expose $('#view') in API\n    if (!browser_utils.isScrolledIntoView($(bullet), $('#view'))) {\n      return;\n    }\n    if ($(bullet).hasClass('fa-clone')) {\n      return;\n    }\n    // NOTE: can't use $(x).data\n    // http://stackoverflow.com/questions/25876274/jquery-data-not-working\n    const ancestry = $(bullet).attr('data-ancestry');\n    if (!ancestry) { // as far as i know, this only happens because of menu mode\n      return;\n    }\n    const path = Path.loadFromAncestry(JSON.parse(ancestry));\n    paths.push(path);\n  });\n  return paths;\n}\n\nregisterPlugin(\n  {\n    name: 'Easy motion',\n    author: 'Jeff Wu',\n    description: (\n      <div>\n      Lets you easily jump between rows, by default with space key.\n      Based on <a href='https://github.com/easymotion/vim-easymotion'>this vim plugin</a>\n      </div>\n    ),\n  },\n  function(api) {\n    let EASY_MOTION_MAPPINGS: EasyMotionMappings | null = null;\n\n    api.registerMotion(\n      'easy-motion',\n      'Jump to a visible row (based on EasyMotion)',\n      async function({ session, keyStream, keyHandler }) {\n        let paths: Array<Path> = (await getVisiblePaths()).filter(\n          path => !path.is(session.cursor.path)\n        );\n\n        let keys = [\n          'Z', 'X', 'C', 'V',\n          'Q', 'W', 'E', 'R', 'T',\n          'A', 'S', 'D', 'F',\n          'z', 'x', 'c', 'v',\n          'q', 'w', 'e', 'r', 't',\n          'a', 's', 'd', 'f',\n          'g', 'h', 'j', 'k', 'l',\n          'y', 'u', 'i', 'o', 'p',\n          'b', 'n', 'm',\n          'G', 'H', 'J', 'K', 'L',\n          'Y', 'U', 'I', 'O', 'P',\n          'B', 'N', 'M',\n        ];\n\n        let start;\n        if (keys.length > paths.length) {\n          start = (keys.length - paths.length) / 2;\n          keys = keys.slice(start, start + paths.length);\n        } else {\n          start = (paths.length - keys.length) / 2;\n          paths = paths.slice(start, start + paths.length);\n        }\n\n        let mappings: EasyMotionMappings = {\n          key_to_path: {},\n          path_to_key: {},\n        };\n        // NOTE: _.zip has a stupid type definition\n        _.zip<Path | string>(paths, keys).forEach((pair: any) => {\n          const [path, jump_key]: [Path, string] = pair;\n          mappings.key_to_path[jump_key] = path;\n          mappings.path_to_key[JSON.stringify(path.getAncestry())] = jump_key;\n        });\n\n        EASY_MOTION_MAPPINGS = mappings;\n\n        await Promise.all(_.values(EASY_MOTION_MAPPINGS.key_to_path).map(\n          async (path) => await api.updatedDataForRender(path.row)\n        ));\n        // TODO hacky way to trigger re-render\n        keyHandler.emit('handledKey');\n\n        const key = await keyStream.dequeue();\n\n        return async function(cursor /*, options */) {\n          if (EASY_MOTION_MAPPINGS === null) {\n            throw new Error('Easy motion mappings were not set, as expected');\n          }\n          if (key in EASY_MOTION_MAPPINGS.key_to_path) {\n            let path = EASY_MOTION_MAPPINGS.key_to_path[key];\n            await cursor.setPosition(path, 0);\n          }\n          await Promise.all(_.values(EASY_MOTION_MAPPINGS.key_to_path).map(\n            async (path) => await api.updatedDataForRender(path.row)\n          ));\n          EASY_MOTION_MAPPINGS = null;\n        };\n      },\n    );\n\n    api.registerDefaultMappings(\n      'NORMAL',\n      {\n        'easy-motion': [['space']],\n      },\n    );\n\n    api.registerHook('session', 'renderBullet', function(bullet, info) {\n      let ancestry_str = JSON.stringify(info.path.getAncestry());\n      if (EASY_MOTION_MAPPINGS !== null) {\n        if (ancestry_str in EASY_MOTION_MAPPINGS.path_to_key) {\n          bullet = (\n            <span key='easymotion' className='bullet' style={{\n              ...getStyles(api.session.clientStore, ['theme-text-accent'])\n            }}>\n              {EASY_MOTION_MAPPINGS.path_to_key[ancestry_str]}\n            </span>\n          );\n        }\n      }\n      return bullet;\n    });\n  },\n  (api => api.deregisterAll()),\n);\n","// Unfolders do the opposite of folding: they take a type A and go to Array<B>.\n// For the case of Vimflowy rendering, we are interested in the special case of\n// taking a Token and getting Array<React.ReactNode> - in this case, we call it a Tokenizer.\n// This file contains the definitions and some useful combinators for these unfolders.\n\nimport * as React from 'react';\n\nexport type CharInfo = {\n  highlight: boolean,\n  cursor: boolean,\n  accent: boolean,\n  renderOptions: {\n    divType?: string,\n    style?: React.CSSProperties,\n    classes: {[key: string]: boolean},\n    href?: string,\n    onClick?: null | (() => void),\n  },\n};\n\nexport type Token = {\n  // index in the original text\n  index: number,\n  // length in the original text\n  length: number,\n  text: string,\n  info: Array<CharInfo>,\n};\n\nexport function SliceToken(token: Token, start: number, end: number = 0): Token {\n  if (end <= 0) {\n    end = token.length + end;\n  }\n  return {\n    index: token.index + start,\n    length: end - start,\n    text: token.text.slice(start, end),\n    info: token.info.slice(start, end),\n  };\n}\n\nexport function SplitToken(token: Token, split_index: number): [Token, Token] {\n  return [\n    SliceToken(token, 0, split_index),\n    SliceToken(token, split_index)\n  ];\n}\n\nexport type EmitFn<T> = (...output: Array<T>) => void;\nexport type UnfolderFn<A, B> = (input: A, emit: EmitFn<B>) => void;\n\nexport class Unfolder<A, B> {\n  public fn: UnfolderFn<A, B>;\n  constructor(fn: UnfolderFn<A, B>) {\n    this.fn = fn;\n  }\n\n  public unfold(input: A): Array<B> {\n    const results: Array<B> = [];\n    this.fn(input, (...outputs: Array<B>) => {\n      results.push(...outputs);\n    });\n    return results;\n  }\n\n  public then<C>(other: Unfolder<B, C>): Unfolder<A, C> {\n    return new Unfolder<A, C>((a: A, emit: EmitFn<C>) => {\n      this.unfold(a).forEach((b) => {\n        emit(...other.unfold(b));\n      });\n    });\n  }\n}\n\nexport class PartialUnfolder<A, B> {\n  public partial_fn: PartialUnfolderFn<A, B>;\n\n  public static trivial<A, B>() {\n    return new PartialUnfolder<A, B>((input: A, emit: EmitFn<B>, wrapped: Unfolder<A, B>) => {\n      emit(...wrapped.unfold(input));\n    });\n  }\n\n  constructor(fn: PartialUnfolderFn<A, B>) {\n    this.partial_fn = fn;\n  }\n\n  public then(other: PartialUnfolder<A, B>): PartialUnfolder<A, B> {\n    return new PartialUnfolder<A, B>((\n      input: A, emit: EmitFn<B>, wrapped: Unfolder<A, B>\n    ) => {\n      this.partial_fn(\n        input, emit,\n        new Unfolder<A, B>((input2: A, emit2: EmitFn<B>) => {\n          other.partial_fn(input2, emit2, wrapped);\n        })\n      );\n    });\n  }\n\n  public finish(other: Unfolder<A, B>): Unfolder<A, B> {\n    return new Unfolder<A, B>((input: A, emit: EmitFn<B>) => {\n      this.partial_fn(input, emit, other);\n    });\n  }\n}\n\nexport type Tokenizer<T = React.ReactNode> = Unfolder<Token, T>;\nexport type TokenizerFn<T = React.ReactNode> = UnfolderFn<Token, T>;\n\nexport type PartialUnfolderFn<A, B> = (input: A, emit: EmitFn<B>, wrapped: Unfolder<A, B>) => void;\nexport type PartialTokenizerFn<T = React.ReactNode> = PartialUnfolderFn<Token, T>;\n\nexport type PartialTokenizer<T = React.ReactNode> = PartialUnfolder<Token, T>;\n\n// captures first group of regex and allows emitting based on the value\nexport function RegexTokenizerSplitter<T = React.ReactNode>(\n  regex: RegExp, match_tokenizer: PartialTokenizerFn<T>,\n): PartialTokenizer<T> {\n  return new PartialUnfolder<Token, T>((\n    token: Token, emit: EmitFn<T>, wrapped: Tokenizer<T>\n  ) => {\n    let match = regex.exec(token.text);\n    while (match) {\n      // index of match, plus index of group in match\n      let index = match.index + match[0].indexOf(match[1]);\n\n      if (index > 0) {\n        let filler_token;\n        [filler_token, token] = SplitToken(token, index);\n        emit(...wrapped.unfold(filler_token));\n      }\n\n      let matched_token;\n      [matched_token, token] = SplitToken(token, match[1].length);\n      match_tokenizer(matched_token, emit, wrapped);\n\n      match = regex.exec(token.text);\n    }\n\n    // leftover\n    if (token.text.length) {\n      emit(...wrapped.unfold(token));\n    }\n  });\n};\n\n// captures first group of regex and allows modifying the tokens\nexport function RegexTokenizerModifier<T = React.ReactNode>(\n  regex: RegExp, change_info: (info: Array<CharInfo>) => void\n): PartialTokenizer<T> {\n  return new PartialUnfolder<Token, T>((\n    token: Token, emit: EmitFn<T>, wrapped: Tokenizer<T>\n  ) => {\n    let index = 0;\n    while (true) {\n      let match = regex.exec(token.text.slice(index));\n      if (!match) { break; }\n\n      // index of match, plus index of group in match\n      let start = index + match.index + match[0].indexOf(match[1]);\n      let end = start + match[1].length;\n\n      change_info(token.info.slice(start, end));\n      index = end;\n    }\n\n    emit(...wrapped.unfold(token));\n  });\n};\n\nconst hiddenClass = 'hidden';\n\nexport function hideBorderAndModify(\n  left_border_to_hide_size: number, right_border_to_hide_size: number,\n  changeCharInfo: (char_info: CharInfo) => void,\n) {\n  return function(info: Array<CharInfo>) {\n    info.slice(0, left_border_to_hide_size).forEach((char_info) => {\n      char_info.renderOptions.classes[hiddenClass] = true;\n    });\n    info.slice(left_border_to_hide_size, -right_border_to_hide_size).forEach(changeCharInfo);\n    info.slice(-right_border_to_hide_size).forEach((char_info) => {\n      char_info.renderOptions.classes[hiddenClass] = true;\n    });\n  };\n}\n\n","import keyDefinitions, { Action, SequenceAction } from '../keyDefinitions';\n\nkeyDefinitions.registerAction(new Action(\n  'export-file',\n  'Export as Json file',\n  async function({ session }) {\n    await session.exportFile('json');\n  },\n  {\n    sequence: SequenceAction.DROP,\n  },\n));\n\n","import keyDefinitions, { Action, SequenceAction } from '../keyDefinitions';\n\nkeyDefinitions.registerAction(new Action(\n  'zoom-prev-sibling',\n  'Zoom to view root\\'s previous sibling',\n  async function({ session }) {\n    await session.zoomUp();\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'zoom-next-sibling',\n  'Zoom to view root\\'s next sibling',\n  async function({ session }) {\n    await session.zoomDown();\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'zoom-in',\n  'Zoom in by one level',\n  async function({ session }) {\n    await session.zoomIn();\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'zoom-out',\n  'Zoom out by one level',\n  async function({ session }) {\n    await session.zoomOut();\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'zoom-cursor',\n  'Zoom in onto cursor',\n  async function({ session }) {\n    await session.zoomInto(session.cursor.path);\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'zoom-root',\n  'Zoom out to document root',\n  async function({ session }) {\n    await session.zoomInto(session.document.root);\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'jump-prev',\n  'Jump to previously visited location',\n  async function({ session }) {\n    await session.jumpPrevious();\n  },\n  { sequence: SequenceAction.DROP },\n));\n\nkeyDefinitions.registerAction(new Action(\n  'jump-next',\n  'Jump to next location',\n  async function({ session }) {\n    await session.jumpNext();\n  },\n  { sequence: SequenceAction.DROP },\n));\n","import * as React from 'react'; // tslint:disable-line no-unused-variable\n\nimport { Token, RegexTokenizerSplitter, EmitFn, Tokenizer } from '../../assets/ts/utils/token_unfolder';\nimport { registerPlugin } from '../../assets/ts/plugins';\n\nconst htmlTypes: Array<string> = [\n  'div',\n  'span',\n  'img',\n  'table'\n];\n\nconst htmlRegexParts: Array<string> = [];\nhtmlTypes.forEach((htmltype) => {\n  htmlRegexParts.push(\n    `<${htmltype}(.|\\\\n)*>(.|\\\\n)*</${htmltype}>`\n  );\n  // self-closing\n  htmlRegexParts.push(\n    `<${htmltype}(.|\\\\n)*/>`\n  );\n});\nconst htmlRegex = '(' + htmlRegexParts.map((part) => '(' + part + ')').join('|') + ')';\n\nregisterPlugin(\n  {\n    name: 'HTML',\n    author: 'Jeff Wu',\n    description: `\n      Lets you inline the following html tags:\n        ${ htmlTypes.map((htmltype) => '<' + htmltype + '>').join(' ') }\n    `,\n  },\n  function(api) {\n    api.registerHook('session', 'renderLineTokenHook', (tokenizer, info) => {\n      if (info.has_cursor) {\n        return tokenizer;\n      }\n      if (info.has_highlight) {\n        return tokenizer;\n      }\n      return tokenizer.then(RegexTokenizerSplitter(\n        new RegExp(htmlRegex),\n        (token: Token, emit: EmitFn<React.ReactNode>, wrapped: Tokenizer) => {\n          try {\n            emit(<span\n              key={`html-${token.index}`}\n              dangerouslySetInnerHTML={{__html: token.text}}\n            />);\n          } catch (e) {\n            api.session.showMessage(e.message, { text_class: 'error' });\n            emit(...wrapped.unfold(token));\n          }\n        }\n      ));\n    });\n  },\n  (api => api.deregisterAll()),\n);\n","import * as React from 'react'; // tslint:disable-line no-unused-variable\nimport * as katex from 'katex';\nimport 'katex/dist/katex.min.css';\n\nimport { Tokenizer, Token, RegexTokenizerSplitter, EmitFn } from '../../assets/ts/utils/token_unfolder';\nimport { registerPlugin } from '../../assets/ts/plugins';\nimport { matchWordRegex } from '../../assets/ts/utils/text';\n\nregisterPlugin(\n  {\n    name: 'LaTeX',\n    author: 'Jeff Wu',\n    description: `\n      Lets you inline LaTeX between $ delimiters,\n      or add block LaTeX between $$ delimiters.\n      Limited to what KaTeX supports.\n    `,\n  },\n  function(api) {\n    api.registerHook('session', 'renderLineTokenHook', (tokenizer, info) => {\n      if (info.has_cursor) {\n        return tokenizer;\n      }\n      if (info.has_highlight) {\n        return tokenizer;\n      }\n      return tokenizer.then(RegexTokenizerSplitter(\n        matchWordRegex('\\\\$\\\\$(\\\\n|.)+?\\\\$\\\\$'),\n        (token: Token, emit: EmitFn<React.ReactNode>, wrapped: Tokenizer) => {\n          try {\n            const html = katex.renderToString(token.text.slice(2, -2), { displayMode: true });\n            emit(<div key={`latex-${token.index}`} dangerouslySetInnerHTML={{__html: html}}/>);\n          } catch (e) {\n            api.session.showMessage(e.message, { text_class: 'error' });\n            emit(...wrapped.unfold(token));\n          }\n        }\n      )).then(RegexTokenizerSplitter(\n        matchWordRegex('\\\\$(\\\\n|.)+?\\\\$'),\n        (token: Token, emit: EmitFn<React.ReactNode>, wrapped: Tokenizer) => {\n          try {\n            const html = katex.renderToString(token.text.slice(1, -1), { displayMode: false });\n            emit(<span key={`latex-${token.index}`} dangerouslySetInnerHTML={{__html: html}}/>);\n          } catch (e) {\n            api.session.showMessage(e.message, { text_class: 'error' });\n            emit(...wrapped.unfold(token));\n          }\n        }\n      ));\n    });\n  },\n  (api => api.deregisterAll()),\n);\n","import * as React from 'react';\nimport * as _ from 'lodash';\n\nimport * as text_utils from '../utils/text';\nimport { Col, Line } from '../types';\nimport {\n  EmitFn, Token, Tokenizer, PartialTokenizer,\n  RegexTokenizerSplitter, CharInfo, Unfolder, PartialUnfolder\n} from '../utils/token_unfolder';\n\nexport type LineProps = {\n  lineData: Line;\n  cursors?: {[key: number]: boolean};\n  cursorStyle: React.CSSProperties;\n  highlights?: {[key: number]: boolean};\n  highlightStyle: React.CSSProperties;\n  accents?: {[key: number]: boolean};\n  accentStyle: React.CSSProperties;\n  linksStyle: React.CSSProperties;\n  lineHook?: PartialUnfolder<Token, React.ReactNode>;\n  wordHook?: PartialUnfolder<Token, React.ReactNode>;\n  onCharClick?: ((col: Col, e: Event) => void) | undefined;\n  cursorBetween?: boolean;\n};\n\n// NOTE: hacky! we don't include .:/?= since urls contain it\n// should instead make tokenizer for URLs\n// also not including @ for marks\nconst word_boundary_chars = '\\t\\r\\n ,!()\\\"\\'*+\\\\;<>\\\\[\\\\]`{}|';\n\nexport default class LineComponent extends React.Component<LineProps, {}> {\n\n  constructor(props: LineProps) {\n    super(props);\n  }\n\n  public render() {\n    const cursorBetween: boolean = this.props.cursorBetween || false;\n    const lineData = _.cloneDeep(this.props.lineData);\n    const cursors = this.props.cursors || {};\n    const highlights = this.props.highlights || {};\n    const accents = this.props.accents || {};\n\n    // ideally this takes up space but is unselectable (uncopyable)\n    const cursorChar = ' ';\n\n    // add cursor if at end\n    if (lineData.length in cursors) {\n      lineData.push(cursorChar);\n    }\n\n    if (lineData.length === 0) {\n      return <span></span>;\n    }\n\n    const cursorBetweenDiv = (i: number) => {\n      return (\n        <div key={`insert-cursor-${i}`}\n          className='cursor blink-background'\n          style={{\n            display: 'inline-block',\n            height: '1.2em', width: 2, marginLeft: -1, marginRight: -1,\n            ...this.props.cursorStyle,\n          }}>\n          {' '}\n        </div>\n      );\n    };\n\n    const DefaultTokenizer: Tokenizer = new Unfolder<Token, React.ReactNode>((\n      token: Token, emit: EmitFn<React.ReactNode>\n    ) => {\n      for (let i = 0; i < token.text.length; i++) {\n        const char_info = token.info[i];\n        const classes = Object.keys(char_info.renderOptions.classes);\n\n        const style: React.CSSProperties = char_info.renderOptions.style || {};\n        if (char_info.highlight) {\n          Object.assign(style, this.props.highlightStyle);\n        }\n        if (char_info.accent) {\n          Object.assign(style, this.props.accentStyle);\n        }\n        if (char_info.cursor) {\n          if (cursorBetween) {\n            emit(cursorBetweenDiv(token.index + i));\n          } else {\n            classes.push('cursor');\n            Object.assign(style, this.props.cursorStyle);\n          }\n        }\n\n        const column = token.index + i;\n        let href = null;\n        let target = null;\n        if (char_info.renderOptions.href) {\n          href = char_info.renderOptions.href;\n          target = '_blank';\n        }\n\n        let onClick = undefined;\n        if (href == null) {\n          if (char_info.renderOptions.onClick !== undefined) {\n            onClick = char_info.renderOptions.onClick;\n          } else if (this.props.onCharClick) {\n            onClick = this.props.onCharClick.bind(this, column);\n          }\n        }\n        const divType = char_info.renderOptions.divType || 'span';\n        emit(\n          React.createElement(\n            divType,\n            {\n              style: style,\n              key: `default-${column}`,\n              className: classes.join(' '),\n              onClick: onClick,\n              href: href,\n              target: target\n            } as React.DOMAttributes<any>,\n            token.text[i] as React.ReactNode\n          )\n        );\n      }\n\n    });\n\n    let lineHook;\n    if (this.props.lineHook) {\n      lineHook = this.props.lineHook;\n    } else {\n      lineHook = PartialUnfolder.trivial<Token, React.ReactNode>();\n    }\n    const LineTokenizer: PartialTokenizer = RegexTokenizerSplitter(\n      new RegExp('(\\n)'),\n      (token: Token, emit: EmitFn<React.ReactNode>) => {\n        if (token.text.length !== 1) {\n          throw new Error('Expected matched newline of length 1');\n        }\n        if (token.info.length !== 1) {\n          throw new Error('Expected matched newline with info of length 1');\n        }\n        const char_info = token.info[0];\n        const style: React.CSSProperties = char_info.renderOptions.style || {};\n        const classes = Object.keys(char_info.renderOptions.classes);\n        if (char_info.highlight) {\n          Object.assign(style, this.props.highlightStyle);\n        }\n        if (char_info.accent) {\n          Object.assign(style, this.props.accentStyle);\n        }\n        if (char_info.cursor) {\n          if (cursorBetween) {\n            emit(cursorBetweenDiv(token.index));\n          } else {\n            classes.push('cursor');\n            Object.assign(style, this.props.cursorStyle);\n            emit(React.createElement(\n              'span',\n              {\n                style: style,\n                key: `cursor-${token.index}`,\n                className: classes.join(' '),\n                onClick: undefined,\n              } as React.DOMAttributes<any>,\n              cursorChar as React.ReactNode\n            ));\n          }\n        }\n\n        emit(React.createElement(\n          'div',\n          {\n            key: `newline-${token.index}`,\n            className: classes.join(' '),\n            onClick: undefined,\n          } as React.DOMAttributes<any>,\n          '' as React.ReactNode\n        ));\n      }\n    );\n\n    let wordHook;\n    if (this.props.wordHook) {\n      wordHook = this.props.wordHook;\n    } else {\n      wordHook = PartialUnfolder.trivial<Token, React.ReactNode>();\n    }\n    wordHook = wordHook.then(new PartialUnfolder<Token, React.ReactNode>((\n      token: Token, emit: EmitFn<React.ReactNode>, wrapped: Tokenizer\n    ) => {\n      if (text_utils.isLink(token.text)) {\n        token.info.forEach((char_info) => {\n          char_info.renderOptions.divType = 'a';\n          char_info.renderOptions.style = char_info.renderOptions.style || {};\n          Object.assign(char_info.renderOptions.style, this.props.linksStyle);\n          char_info.renderOptions.onClick = null;\n          char_info.renderOptions.href = token.text;\n        });\n      }\n      emit(...wrapped.unfold(token));\n    }));\n\n    const WordTokenizer: PartialTokenizer = RegexTokenizerSplitter(\n      new RegExp('([^' + word_boundary_chars + ']+)'),\n      wordHook.partial_fn\n    );\n\n    let tokenizer = lineHook\n      .then(LineTokenizer)\n      .then(WordTokenizer)\n      .finish(DefaultTokenizer);\n\n    // NOTE: this doesn't seem to work for the breadcrumbs, e.g. try visual selecting word at end\n\n    // - start with a plain text string\n    // - allow custom \"sentence\" tokenization first\n    // - then tokenize into words\n    // - allow more custom \"word\" tokenization\n    const info: Array<CharInfo> = [];\n    for (let i = 0; i < lineData.length; i++) {\n      const char_info: CharInfo = {\n        highlight: i in highlights,\n        cursor: i in cursors,\n        accent: i in accents,\n        renderOptions: {\n          classes: {},\n        },\n      };\n      info.push(char_info);\n    }\n    let token: Token = {\n      index: 0,\n      length: lineData.length,\n      text: lineData.join(''),\n      info: info,\n    };\n    const results = tokenizer.unfold(token);\n    return (\n      <span>\n        {results}\n      </span>\n    );\n  }\n}\n","import * as _ from 'lodash';\nimport * as React from 'react'; // tslint:disable-line no-unused-variable\n\nimport * as errors from '../../shared/utils/errors';\nimport { Logger } from '../../shared/utils/logger';\nimport { PartialUnfolder, Token, EmitFn, Tokenizer } from '../../assets/ts/utils/token_unfolder';\n\nimport { registerPlugin, PluginApi } from '../../assets/ts/plugins';\nimport Menu from '../../assets/ts/menu';\nimport Document from '../../assets/ts/document';\nimport Session, { InMemorySession } from '../../assets/ts/session';\nimport LineComponent from '../../assets/ts/components/line';\nimport Mutation from '../../assets/ts/mutations';\nimport Path from '../../assets/ts/path';\nimport { Row } from '../../assets/ts/types';\nimport { getStyles } from '../../assets/ts/themes';\n\nimport { SINGLE_LINE_MOTIONS } from '../../assets/ts/definitions/motions';\nimport { INSERT_MOTION_MAPPINGS } from '../../assets/ts/configurations/vim';\nimport { motionKey } from '../../assets/ts/keyDefinitions';\n\n// TODO: do this elsewhere\ndeclare const process: any;\n\ntype Mark = string;\ntype MarksToRows = {[key: string]: Row};\ntype RowsToMarks = {[key: number]: Mark};\n\nconst markStyle = {\n  padding: '0px 8px',\n  marginRight: 8,\n  borderRadius: 5,\n};\n\n/*\n * ALGORITHMIC NOTE: maintaining the set of marks\n * Rather than trying to update the list\n * as rows get removed and added from the document (which is especially\n * tricky because of cloning),\n * we simply store all marks, even if attached to the document,\n * and then prune after looking them up.\n */\n\nexport class MarksPlugin {\n  private api: PluginApi;\n  private logger: Logger;\n  private session: Session;\n  private document: Document;\n  private markstate: {\n    session: Session,\n    path: Path,\n  } | null = null;\n  // hacky, these are only used when enabled\n  public SetMark!: new(row: Row, mark: Mark) => Mutation;\n  public UnsetMark!: new(row: Row) => Mutation;\n  private marks_to_paths: {[mark: string]: Path};\n\n  constructor(api: PluginApi) {\n    this.api = api;\n    this.logger = this.api.logger;\n    this.session = this.api.session;\n    this.document = this.session.document;\n    // NOTE: this may not be initialized correctly at first\n    // this only affects rendering @marklinks for now\n    this.marks_to_paths = {};\n  }\n\n  public async enable() {\n    const that = this;\n    this.logger.debug('Enabling marks');\n\n    class SetMark extends Mutation {\n      private row: Row;\n      private mark: Mark;\n\n      constructor(row: Row, mark: Mark) {\n        super();\n        this.row = row;\n        this.mark = mark;\n      }\n      public str() {\n        return `row ${this.row}, mark ${this.mark}`;\n      }\n      public async mutate(/* session */) {\n        await that._setMark(this.row, this.mark);\n        await that.api.updatedDataForRender(this.row);\n      }\n      public async rewind(/* session */) {\n        return [\n          new UnsetMark(this.row),\n        ];\n      }\n    }\n    this.SetMark = SetMark;\n\n    class UnsetMark extends Mutation {\n      private row: Row;\n      private mark: Mark | null = null;\n\n      constructor(row: Row) {\n        super();\n        this.row = row;\n      }\n      public str() {\n        return `row ${this.row}`;\n      }\n      public async mutate(/* session */) {\n        this.mark = await that._getMark(this.row);\n        await that._unsetMark(this.row, this.mark);\n        await that.api.updatedDataForRender(this.row);\n      }\n      public async rewind(/* session */) {\n        if (this.mark === null) {\n          throw new Error('Rewinding before mutating: UnsetMark');\n        }\n        return [\n          new SetMark(this.row, this.mark),\n        ];\n      }\n    }\n    this.UnsetMark = UnsetMark;\n\n    // Serialization #\n\n    this.api.registerHook('document', 'serializeRow', async (struct, info) => {\n      const mark = await this._getMark(info.row);\n      if (mark) {\n        struct.mark = mark;\n      }\n      return struct;\n    });\n\n    this.api.registerListener('document', 'loadRow', async (path, serialized) => {\n      if (serialized.mark != null) {\n        const err = await this.updateMark(path.row, serialized.mark);\n        if (err) { return this.session.showMessage(err, {text_class: 'error'}); }\n      }\n    });\n\n    // Commands #\n\n    this.markstate = null;\n\n    this.api.registerMode({\n      name: 'MARK',\n      cursorBetween: true,\n      within_row: true,\n      enter: async (session /*, newMode?: ModeId */) => {\n        // initialize marks stuff\n        this.markstate = {\n          session: new InMemorySession(),\n          path: session.cursor.path,\n        };\n        await this.markstate.session.setMode('INSERT');\n      },\n      exit: async (/*session, newMode?: ModeId */) => {\n        // do this, now that markstate is cleared\n        if (!this.markstate) {\n          throw new Error('Mark state null during exit');\n        }\n        const markedRow = this.markstate.path.row;\n        this.markstate = null;\n        await this.api.updatedDataForRender(markedRow);\n      },\n      every: async (/*session*/) => {\n        if (!this.markstate) {\n          throw new Error('Mark state null during every');\n        }\n        await this.api.updatedDataForRender(this.markstate.path.row);\n      },\n      key_transforms: [\n        async (key, context) => {\n          // must be non-whitespace\n          if (key.length === 1) {\n            if (/^\\S*$/.test(key)) {\n              if (this.markstate === null) {\n                throw new Error('Mark state null during key transform');\n              }\n              await this.markstate.session.addCharsAtCursor([key]);\n              await this.api.updatedDataForRender(this.markstate.path.row);\n              return [null, context];\n            }\n          }\n          return [key, context];\n        },\n      ],\n    });\n\n    this.api.registerAction(\n      'begin-mark',\n      'Mark a line',\n      async function({ session }) {\n        await session.setMode('MARK');\n      },\n    );\n\n    this.api.registerAction(\n      'finish-mark',\n      'Finish typing mark',\n      async function({ session, keyStream }) {\n        if (that.markstate === null) {\n          throw new Error('Mark state null in mark mode');\n        }\n        const mark = await that.markstate.session.curText();\n        const markedRow = that.markstate.path.row;\n        const err = await that.updateMark(markedRow, mark);\n        if (err) { session.showMessage(err, {text_class: 'error'}); }\n        await session.setMode('NORMAL');\n        keyStream.save();\n      }\n    );\n\n    this.api.registerMotion(\n      'go-mark',\n      'Go to the mark indicated by the cursor, if it exists',\n      async function({ session }) {\n        return async cursor => {\n          const word = await session.document.getWord(cursor.row, cursor.col);\n          if (word.length < 1 || word[0] !== '@') {\n            session.showMessage(`Cursor should be over a @mark link`);\n            return;\n          }\n          const mark = word.slice(1);\n          const allMarks = await that.listMarks();\n          if (mark in allMarks) {\n            const path = allMarks[mark];\n            await session.zoomInto(path);\n          } else {\n            session.showMessage(`No mark ${mark} to go to!`);\n          }\n        };\n      },\n    );\n\n    this.api.registerAction(\n      'delete-mark',\n      'Delete mark at cursor',\n      async function({ session, keyStream }) {\n        const err = await that.updateMark(session.cursor.row, '');\n        if (err) { session.showMessage(err, {text_class: 'error'}); }\n        keyStream.save();\n      },\n    );\n\n    this.api.registerAction(\n      'search-marks',\n      'Go to (search for) a mark',\n      async function({ session }) {\n        await session.setMode('SEARCH');\n        const marks = await that.listMarks();\n        session.menu = new Menu(async (text) => {\n          // find marks that start with the prefix\n          const findMarks = async (_document: Document, prefix: string, nresults = 10) => {\n            const results: Array<{\n              path: Path, mark: Mark,\n            }> = []; // list of paths\n            for (const mark in marks) {\n              const path = marks[mark];\n              if (mark.indexOf(prefix) === 0) {\n                results.push({ path, mark });\n                if (nresults > 0 && results.length === nresults) {\n                  break;\n                }\n              }\n            }\n            return results;\n          };\n\n          return await Promise.all(\n            (await findMarks(session.document, text)).map(\n              async ({ path, mark }) => {\n                const line = await session.document.getLine(path.row);\n                return {\n                  contents: line,\n                  renderHook(lineDiv: React.ReactElement<any>) {\n                    return (\n                      <span>\n                        <span key={`mark_${mark}`}\n                          style={{\n                            ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim']),\n                            ...markStyle\n                          }}\n                        >\n                          {mark}\n                        </span>\n                        {lineDiv}\n                      </span>\n                    );\n                  },\n                  fn: async () => await session.zoomInto(path),\n                };\n              }\n            )\n          );\n        });\n      }\n    );\n\n    this.api.registerAction(\n      'move-cursor-mark',\n      'Move the cursor within the mark being edited (according to the specified motion)',\n      async function({ motion }) {\n        if (motion == null) {\n          throw new Error('Expected a motion!');\n        }\n        if (that.markstate === null) {\n          throw new Error('Mark state null in mark mode');\n        }\n        await motion(that.markstate.session.cursor, {pastEnd: true});\n      },\n      { acceptsMotion: true },\n    );\n\n    this.api.registerAction(\n      'mark-delete-char-before',\n      'Delete last character (i.e. backspace key)',\n      async function() {\n        if (that.markstate === null) {\n          throw new Error('Mark state null in mark mode');\n        }\n        await that.markstate.session.deleteAtCursor();\n      },\n    );\n\n    this.api.registerAction(\n      'mark-delete-char-after',\n      'Delete character at the cursor (i.e. del key)',\n      async function() {\n        if (that.markstate === null) {\n          throw new Error('Mark state null in mark mode');\n        }\n        await that.markstate.session.delCharsAfterCursor(1);\n      },\n    );\n\n    this.api.registerDefaultMappings(\n      'MARK',\n      Object.assign({\n        'toggle-help': [['ctrl+?']],\n        'move-cursor-mark': [[motionKey]],\n        'finish-mark': [['enter']],\n        'mark-delete-char-after': [['delete']],\n        'mark-delete-char-before': [['backspace'], ['shift+backspace']],\n        'exit-mode': [['esc'], ['ctrl+c']],\n      }, _.pick(INSERT_MOTION_MAPPINGS, SINGLE_LINE_MOTIONS))\n    );\n\n    this.api.registerDefaultMappings(\n      'NORMAL',\n      {\n        'begin-mark': [['m']],\n        'go-mark': [['g', 'm']],\n        'delete-mark': [['d', 'm']],\n        'search-marks': [['\\''], ['`']],\n      },\n    );\n\n    this.api.registerHook('document', 'pluginRowContents', async (obj, { row }) => {\n      const mark = await this._getMark(row);\n      const marking = this.markstate && (this.markstate.path.row === row);\n      obj.marks = { mark, marking };\n      if (this.markstate && marking) {\n        obj.marks.markText = await this.markstate.session.document.getLine(\n          this.markstate.session.cursor.path.row\n        );\n        obj.marks.markCol = this.markstate.session.cursor.col;\n      }\n      return obj;\n    });\n\n    this.api.registerHook('session', 'renderLineOptions', (options, info) => {\n      if (info.pluginData.marks && info.pluginData.marks.marking) {\n        options.cursors = {};\n      }\n      return options;\n    });\n\n    this.api.registerHook('session', 'renderLineContents', (lineContents, info) => {\n      const { pluginData } = info;\n      if (pluginData.marks) {\n        if (pluginData.marks.marking) {\n          lineContents.unshift(\n            <span key='mark'\n              style={{\n                ...getStyles(this.api.session.clientStore, ['theme-bg-tertiary', 'theme-trim-accent']),\n                ...markStyle\n              }}\n            >\n              <LineComponent\n                lineData={pluginData.marks.markText}\n                cursors={{\n                  [pluginData.marks.markCol]: true,\n                }}\n                cursorStyle={getStyles(this.api.session.clientStore, ['theme-cursor'])}\n                highlightStyle={getStyles(this.api.session.clientStore, ['theme-bg-highlight'])}\n                linksStyle={getStyles(this.api.session.clientStore, ['theme-link'])}\n                accentStyle={getStyles(this.api.session.clientStore, ['theme-text-accent'])}\n                cursorBetween={true}\n              />\n            </span>\n          );\n        } else {\n          const mark = pluginData.marks.mark;\n          if (mark) {\n            lineContents.unshift(\n              <span key='mark'\n                style={{\n                  ...getStyles(this.api.session.clientStore, ['theme-bg-tertiary']),\n                  ...markStyle\n                }}\n              >\n                {mark}\n              </span>\n            );\n          }\n        }\n      }\n      return lineContents;\n    });\n\n    this.api.registerHook('session', 'renderWordTokenHook', (tokenizer) => {\n      return tokenizer.then(new PartialUnfolder<Token, React.ReactNode>((\n        token: Token, emit: EmitFn<React.ReactNode>, wrapped: Tokenizer\n      ) => {\n        if (this.session.mode === 'NORMAL') {\n          if (token.text[0] === '@') {\n            const mark = token.text.slice(1).replace(/(\\.|!|\\?)+$/g, '');\n            const path = this.marks_to_paths[mark];\n            if (path) {\n              token.info.forEach((char_info) => {\n                char_info.renderOptions.divType = 'a';\n                char_info.renderOptions.style = char_info.renderOptions.style || {};\n                Object.assign(char_info.renderOptions.style, getStyles(this.session.clientStore, ['theme-link']));\n                char_info.renderOptions.onClick = async () => {\n                  await this.session.zoomInto(path);\n                  this.session.save();\n                };\n              });\n            }\n          }\n        }\n        emit(...wrapped.unfold(token));\n      }));\n    });\n\n    this.api.registerListener('document', 'afterDetach', async () => {\n      this.computeMarksToPaths(); // FIRE AND FORGET\n    });\n    this.computeMarksToPaths(); // FIRE AND FORGET\n  }\n\n  // maintain global marks data structures\n  //   a map: row -> mark\n  //   and a second map: mark -> row\n  private async _getRowsToMarks(): Promise<RowsToMarks> {\n    return await this.api.getData('ids_to_marks', {});\n  }\n  private async _setRowsToMarks(rows_to_marks: RowsToMarks) {\n    return await this.api.setData('ids_to_marks', rows_to_marks);\n  }\n  private async _getMarksToRows(): Promise<MarksToRows> {\n    return await this.api.getData('marks_to_ids', {});\n  }\n  private async _setMarksToRows(mark_to_rows: MarksToRows) {\n    return await this.api.setData('marks_to_ids', mark_to_rows);\n  }\n\n  private async _sanityCheckMarks() {\n    if (process.env.NODE_ENV === 'production') {\n      return;\n    }\n    const [\n      marks_to_rows,\n      rows_to_marks,\n    ] = await Promise.all([\n      this._getMarksToRows(),\n      this._getRowsToMarks(),\n    ]);\n    const marks_to_rows2: MarksToRows = {};\n    for (const row in rows_to_marks) {\n      const mark = rows_to_marks[row];\n      marks_to_rows2[mark] = parseInt(row, 10);\n    }\n    errors.assert_deep_equals(marks_to_rows, marks_to_rows2, 'Inconsistent rows_to_marks');\n  }\n\n  // get mark for an row, '' if it doesn't exist\n  private async _getMark(row: Row) {\n    const marks = await this._getRowsToMarks();\n    return marks[row] || '';\n  }\n\n  private async _setMark(row: Row, mark: Mark) {\n    await this._sanityCheckMarks();\n    const marks_to_rows = await this._getMarksToRows();\n    const rows_to_marks = await this._getRowsToMarks();\n    errors.assert(!marks_to_rows.hasOwnProperty(mark));\n    errors.assert(!rows_to_marks.hasOwnProperty(row));\n    marks_to_rows[mark] = row;\n    rows_to_marks[row] = mark;\n    await this._setMarksToRows(marks_to_rows);\n    await this._setRowsToMarks(rows_to_marks);\n    await this._sanityCheckMarks();\n    this.computeMarksToPaths();\n  }\n\n  private async _unsetMark(row: Row, mark: Mark) {\n    await this._sanityCheckMarks();\n    const marks_to_rows = await this._getMarksToRows();\n    const rows_to_marks = await this._getRowsToMarks();\n    errors.assert_equals(marks_to_rows[mark], row);\n    errors.assert_equals(rows_to_marks[row], mark);\n    delete marks_to_rows[mark];\n    delete rows_to_marks[row];\n    await this._setMarksToRows(marks_to_rows);\n    await this._setRowsToMarks(rows_to_marks);\n    await this._sanityCheckMarks();\n    this.computeMarksToPaths();\n  }\n\n  // compute set of paths, used for rendering\n  // this is a fire and forget function.\n  // this.marks_to_paths  is used only for the marks word hook\n  // so we don't care if it's a bit out of date\n  private computeMarksToPaths() {\n    (async () => {\n      this.marks_to_paths = await this.listMarks();\n    })();\n  }\n\n  public async listMarks(): Promise<{[mark: string]: Path}> {\n    await this._sanityCheckMarks();\n    const marks_to_rows = await this._getMarksToRows();\n\n    const all_marks: {[mark: string]: Path} = {};\n    await Promise.all(\n      Object.keys(marks_to_rows).map(async (mark) => {\n        const row = marks_to_rows[mark];\n        const path = await this.document.canonicalPath(row);\n        if (path !== null) {\n          all_marks[mark] = path;\n        }\n      })\n    );\n    return all_marks;\n  }\n\n  // Set the mark for row\n  // Returns whether setting mark succeeded\n  private async updateMark(row: Row, mark: Mark = '') {\n    const marks_to_rows = await this._getMarksToRows();\n    const rows_to_marks = await this._getRowsToMarks();\n    const oldmark = rows_to_marks[row];\n\n    if (!(oldmark || mark)) {\n      return 'No mark to delete!';\n    }\n\n    if (mark in marks_to_rows) {\n      if (marks_to_rows[mark] === row) {\n        return 'Already marked, nothing to do!';\n      }\n\n      const other_row = marks_to_rows[mark];\n      if (await this.document.isAttached(other_row)) {\n        return `Mark '${mark}' was already taken!`;\n      } else {\n        await this.session.do(new this.UnsetMark(other_row));\n      }\n    }\n\n    if (oldmark) {\n      await this.session.do(new this.UnsetMark(row));\n    }\n\n    if (mark) {\n      await this.session.do(new this.SetMark(row, mark));\n    }\n\n    return null;\n  }\n}\n\n// NOTE: because listing marks filters, disabling is okay\n\nexport const pluginName = 'Marks';\n\nregisterPlugin<MarksPlugin>(\n  {\n    name: pluginName,\n    author: 'Jeff Wu',\n    description:\n      `Lets you tag a row with a string, and then reference that row with @markname.\n  Fast search for marked rows, using '.`,\n  },\n  async (api) => {\n    const marksPlugin = new MarksPlugin(api);\n    await marksPlugin.enable();\n    return marksPlugin;\n  },\n  (api) => api.deregisterAll(),\n);\n","/* Time-tracking keeps track of the amount of time spent in each subtree.\n\n  rowTotalTime:  The amount of time spent on a particular row\n  detachedTime:  The amount of time spent in children of a row,\n                 where the children were subsequently deleted from the\n                 document.\n  treeTotalTime: Total amount of time under a row.\n                 Cached sum of rowTotalTime, detachedTime, and\n                 (recursively) treeTotalTime of all current children.\n\nNOTES:\n- Clones are double-counted. This is known and will not be fixed.\n  That is, if A contains both B and C, which each have a copy of D cloned,\n  A's time will double-count D.\n  This probably bad behavior but there is no plan to fix it.\n- When a row is completely deleted, its time get counted in its parent\n  from right before it got detached.\n  If it then gets re-attached, that time gets taken away from the old parent.\n*/\n\nimport $ from 'jquery';\nimport * as React from 'react'; // tslint:disable-line no-unused-variable\n\nimport { registerPlugin, PluginApi } from '../../assets/ts/plugins';\nimport { Logger } from '../../shared/utils/logger';\nimport Path from '../../assets/ts/path';\nimport { Row } from '../../assets/ts/types';\n\nfunction pad(num: number, length: number, padChar: string = '0') {\n  const val = '' + num;\n  let numPads = length - val.length;\n  if (numPads === 0) { return val; }\n  return new Array(numPads + 1).join(padChar) + val;\n}\n\nclass TimeTrackingPlugin {\n  private api: PluginApi;\n  private logger: Logger;\n  private currentPath: {\n    row: Row,\n    time: number,\n  } | null;\n  private isLogging: boolean;\n\n  constructor(api: PluginApi) {\n    this.api = api;\n    this.logger = this.api.logger;\n    this.logger.info('Loading time tracking');\n    this.currentPath = null;\n    this.isLogging = false;\n\n    this.api.cursor.on('rowChange', async (_oldPath: Path, newPath: Path) => {\n      await this.onRowChange(newPath.row);\n    });\n\n    this.api.registerListener('document', 'childAdded', async ({ row }) => {\n      // for caching\n      await Promise.all([\n        this._setRowData(row, 'treeTotalTime', 0),\n        this._setRowData(row, 'rowTotalTime', 0),\n        this._setRowData(row, 'detachedTime', 0),\n      ]);\n    });\n\n    this.api.registerHook('document', 'pluginRowContents', async (obj, { row }) => {\n      obj.timeTracked = await this.rowTime(row);\n      return obj;\n    });\n\n    this.api.registerHook('session', 'renderAfterLine', (elements, renderData) => {\n      const { path, pluginData } = renderData;\n      const time = pluginData.timeTracked;\n      if (time == null) {\n        elements.push(\n          <span key='time' style={{color: 'lightgray'}}>{' '}Loading...</span>\n        );\n      } else {\n        const isCurRow = (this.currentPath !== null) && (path.row === this.currentPath.row);\n\n        if (isCurRow || time > 1000) {\n          let timeStr = ' ';\n          timeStr += (this.printTime(time));\n          if (isCurRow) {\n            timeStr += ' + ';\n          }\n          elements.push(\n            <span key='time' style={{color: 'lightgray'}}>{timeStr}</span>\n          );\n\n          if ((this.currentPath !== null) && isCurRow) {\n            const curTime = Date.now() - this.currentPath.time;\n            elements.push(\n              <span key='curtime' style={{color: 'lightgray'}} className='curtime'>\n                {this.printTime(curTime)}\n              </span>\n            );\n          }\n        }\n      }\n      return elements;\n    });\n\n    this.api.registerListener('document', 'afterMove', async (info) => {\n      await this._rebuildTreeTime(info.row);\n      await this._rebuildTreeTime(info.old_parent, true);\n    });\n\n    this.api.registerListener('document', 'afterAttach', async (info) => {\n      if (info.old_detached_parent) {\n        const treeTime = await this.getRowData(info.row, 'treeTotalTime', 0);\n        await this.transformRowData(info.old_detached_parent, 'detachedTime', current => (current - treeTime), 0);\n        await this._rebuildTreeTime(info.old_detached_parent, true);\n      }\n      await this._rebuildTreeTime(info.row);\n    });\n\n    this.api.registerListener('document', 'afterDetach', async (info) => {\n      if (info.last) {\n        const treeTime = await this.getRowData(info.row, 'treeTotalTime', 0);\n        await this.transformRowData(info.parent_row, 'detachedTime', current => (current + treeTime), 0);\n      }\n      await this._rebuildTreeTime(info.row);\n    });\n\n    this.api.registerListener('session', 'exit', async () => {\n      // NOTE: this probably doesn't work\n      await this.onRowChange(null);\n    });\n\n    this.api.registerAction(\n      'toggle-time-tracking',\n      'Toggle whether time is being logged',\n      async () => {\n        await this.toggleLogging();\n      },\n    );\n    this.api.registerAction(\n      'clear-row-time',\n      'Clear current row time',\n      async () => {\n        await this.resetCurrentPath();\n      },\n    );\n    this.api.registerAction(\n      'add-row-time',\n      'Add time to current row (in minutes)',\n      async ({ repeat }) => {\n        await this.changeTimeCurrentPath(repeat);\n      },\n    );\n    this.api.registerAction(\n      'subtract-row-time',\n      'Subtract time from current row (in minutes)',\n      async ({ repeat }) => {\n        await this.changeTimeCurrentPath(-repeat);\n      },\n    );\n\n    this.api.registerDefaultMappings(\n      'NORMAL',\n      {\n        'toggle-time-tracking': [['Z', 'l']],\n        'clear-row-time': [['Z', 'c']],\n        'add-row-time': [['Z', 'a'], ['Z', '>']],\n        'subtract-row-time': [['Z', 's'], ['Z', '<']],\n      },\n    );\n\n    setInterval(() => {\n      if (this.currentPath === null) { return; }\n      let curTime = Date.now() - this.currentPath.time;\n      $('.curtime').text(this.printTime(curTime));\n    }, 1000);\n  }\n\n  private async changeTimeCurrentPath(delta_minutes: number) {\n    if (this.currentPath !== null) {\n      let curTime = Date.now() - this.currentPath.time;\n      curTime += delta_minutes * 60 * 1000;\n      if (curTime < 0) {\n        this.currentPath.time = Date.now();\n        await this.modifyTimeForRow(this.currentPath.row, curTime);\n      } else {\n        this.currentPath.time = Date.now() - curTime;\n      }\n      await this.api.updatedDataForRender(this.currentPath.row);\n    }\n  }\n\n  private async getRowData(row: Row, keytype: string, default_value: any = null) {\n    let key = `${row}:${keytype}`;\n    return await this.api.getData(key, default_value);\n  }\n\n  private async _setRowData(row: Row, keytype: string, value: any) {\n    let key = `${row}:${keytype}`;\n    await this.api.setData(key, value);\n  }\n\n  private async setRowData(row: Row, keytype: string, value: any) {\n    await this._setRowData(row, keytype, value);\n    await this.api.updatedDataForRender(row);\n  }\n\n  private async transformRowData(\n    row: Row, keytype: string,\n    transform: (val: number) => number, default_value: any = null) {\n    await this.setRowData(\n      row, keytype,\n      transform(await this.getRowData(row, keytype, default_value))\n    );\n  }\n\n  public async toggleLogging(forceValue?: boolean) {\n    // toggle, by default\n    let isLogging = !this.isLogging;\n    if (forceValue != null) {\n      isLogging = forceValue;\n    }\n\n    if (isLogging) {\n      this.logger.info('Turning logging on');\n      await this.api.setData('isLogging', true);\n      if (!this.isLogging) {\n        await this.onRowChange(this.api.cursor.row); // Initial setup\n      }\n    } else {\n      this.logger.info('Turning logging off');\n      if (this.isLogging) {\n        await this.onRowChange(null); // Final close\n      }\n      await this.api.setData('isLogging', false);\n    }\n    this.isLogging = isLogging;\n  }\n\n  private async onRowChange(to: Row | null) {\n    const from: Row | null = (this.currentPath && this.currentPath.row) || null;\n    if (!this.isLogging) {\n      this.currentPath = null;\n      if (from) {\n        await this.api.updatedDataForRender(from);\n      }\n      return;\n    }\n    if ((from != null) && (from === to)) {\n      return;\n    }\n    this.logger.debug(`Switching from row ${from} to row ${to}`);\n    let time = Date.now();\n    if (this.currentPath != null) { // if (from != null) doesn't typecheck :(\n      await this.modifyTimeForRow(this.currentPath.row, time - this.currentPath.time);\n      await this.api.updatedDataForRender(from as Row);\n    }\n    if (to !== null) {\n      this.currentPath = { row: to, time };\n      await this.api.updatedDataForRender(to);\n    } else {\n      this.currentPath = null;\n    }\n  }\n\n  private async resetCurrentPath() {\n    if (this.currentPath) {\n      this.currentPath.time = Date.now();\n      await this.api.updatedDataForRender(this.currentPath.row);\n    }\n  }\n\n  private async modifyTimeForRow(row: Row, delta: number) {\n    await this.transformRowData(row, 'rowTotalTime', current => (current + delta), 0);\n    await this._rebuildTreeTime(row, true);\n  }\n\n  private async _rebuildTotalTime(row: Row) {\n    let children = await this.api.session.document._getChildren(row);\n    const times = await Promise.all(\n      children.map(\n        async (child_row) => {\n          return await this.getRowData(child_row, 'treeTotalTime', 0);\n        }\n      ).concat([\n        this.getRowData(row, 'detachedTime', 0),\n        this.getRowData(row, 'rowTotalTime', 0),\n      ])\n    );\n\n    const totalTime = times.reduce((a, b) => (a + b), 0);\n    await this.setRowData(row, 'treeTotalTime', totalTime);\n  }\n\n  private async _rebuildTreeTime(row: Row, inclusive = false) {\n    const ancestors = await this.api.session.document.allAncestors(row, { inclusive });\n    for (let i = 0; i < ancestors.length; i++) {\n      const ancestor_row = ancestors[i];\n      await this._rebuildTotalTime(ancestor_row);\n    }\n  }\n\n  private async rowTime(row: Row) {\n    return await this.getRowData(row, 'treeTotalTime', 0);\n  }\n\n  private printTime(ms: number) {\n    let sign = '';\n    if (ms < 0) {\n      sign = '-';\n      ms = - ms;\n    }\n    let seconds = Math.floor((ms /     1000) % 60);\n    let minutes = Math.floor((ms /    60000) % 60);\n    let hours   = Math.floor( ms /  3600000);\n    if (hours > 0) {\n      return `${sign}${hours}h:${pad(minutes, 2)}m`;\n    } else if (minutes > 0) {\n      return `${sign}${minutes}m:${pad(seconds, 2)}s`;\n    } else {\n      return `${sign}${seconds}s`;\n    }\n  }\n}\n\nregisterPlugin<TimeTrackingPlugin>(\n  {\n    name: 'Time Tracking',\n    author: 'Zachary Vance',\n    description: `\n    Keeps track of how much time has been spent in each row\n    (including its descendants)\n    `,\n    version: 3,\n  },\n  async (api) => {\n    const timeTracking = new TimeTrackingPlugin(api);\n    // Initial setup\n    await timeTracking.toggleLogging(\n      await api.getData('isLogging', true)\n    );\n    return timeTracking;\n  },\n  (api => api.deregisterAll())\n);\n\n","import * as React from 'react'; // tslint:disable-line no-unused-variable\n\nimport './index.sass';\n\nimport { hideBorderAndModify, RegexTokenizerModifier } from '../../assets/ts/utils/token_unfolder';\nimport { registerPlugin } from '../../assets/ts/plugins';\nimport { matchWordRegex } from '../../assets/ts/utils/text';\n\nconst boldClass = 'bold';\nconst italicsClass = 'italic';\nconst underlineClass = 'underline';\nconst codeClass = 'code';\n\nregisterPlugin(\n  {\n    name: 'Text Formatting',\n    author: 'Jeff Wu',\n    description: (\n      <div>\n      Lets you:\n      <ul>\n        <li> <span className='italic'>italicize</span> text by surrounding with *asterisks* </li>\n        <li> <span className='bold'>bold</span> text by surrounding with **double asterisks** </li>\n        <li> <span className='underline'>underline</span> text by surrounding with _underscores_ </li>\n        <li> <span className='code'>code</span> text by surrounding with `back-ticks` </li>\n      </ul>\n      </div>\n    ),\n  },\n  function(api) {\n    api.registerHook('session', 'renderLineTokenHook', (tokenizer, hooksInfo) => {\n      if (hooksInfo.has_cursor) {\n        return tokenizer;\n      }\n      if (hooksInfo.has_highlight) {\n        return tokenizer;\n      }\n      return tokenizer.then(RegexTokenizerModifier(\n        // triple asterisk means both bold and italic\n        matchWordRegex('\\\\*\\\\*\\\\*(\\\\n|.)+?\\\\*\\\\*\\\\*'),\n        hideBorderAndModify(3, 3, (char_info) => {\n          char_info.renderOptions.classes[italicsClass] = true;\n          char_info.renderOptions.classes[boldClass] = true;\n        })\n      )).then(RegexTokenizerModifier(\n        matchWordRegex('(?:(\\\\*\\\\*_)|(_\\\\*\\\\*))(\\\\n|.)+?(?:(\\\\*\\\\*_)|(_\\\\*\\\\*))'),\n        hideBorderAndModify(3, 3, (char_info) => {\n          char_info.renderOptions.classes[boldClass] = true;\n          char_info.renderOptions.classes[underlineClass] = true;\n        })\n      )).then(RegexTokenizerModifier(\n        matchWordRegex('(?:(\\\\*_)|(_\\\\*))(\\\\n|.)+?(?:(\\\\*_)|(_\\\\*))'),\n        hideBorderAndModify(2, 2, (char_info) => {\n          char_info.renderOptions.classes[italicsClass] = true;\n          char_info.renderOptions.classes[underlineClass] = true;\n        })\n      )).then(RegexTokenizerModifier(\n        // middle is either a single character, or both sides have a non-* character\n        matchWordRegex('\\\\*((\\\\n|[^\\\\*])|[^\\\\*](\\\\n|.)+?[^\\\\*])?\\\\*'),\n        hideBorderAndModify(1, 1, (char_info) => {\n          char_info.renderOptions.classes[italicsClass] = true;\n        })\n      )).then(RegexTokenizerModifier(\n        matchWordRegex('\\\\*\\\\*(\\\\n|.)+?\\\\*\\\\*'),\n        hideBorderAndModify(2, 2, (char_info) => {\n          char_info.renderOptions.classes[boldClass] = true;\n        })\n      )).then(RegexTokenizerModifier(\n        matchWordRegex('(?:[\\\\*]*)_(\\\\n|.)+?_(?:[\\\\*]*)'),\n        hideBorderAndModify(1, 1, (char_info) => {\n          char_info.renderOptions.classes[underlineClass] = true;\n        })\n        )).then(RegexTokenizerModifier(\n          // code\n          matchWordRegex('\\\\`(\\\\n|.)+?\\\\`'),\n          hideBorderAndModify(1, 1, (char_info) => {\n            char_info.renderOptions.classes[codeClass] = true;\n          })\n      ));\n    });\n  },\n  (api => api.deregisterAll()),\n);\n","import * as _ from 'lodash';\n\nimport './index.sass';\n\nimport { hideBorderAndModify, RegexTokenizerModifier } from '../../assets/ts/utils/token_unfolder';\nimport { registerPlugin } from '../../assets/ts/plugins';\nimport { matchWordRegex } from '../../assets/ts/utils/text';\nimport { Row } from '../../assets/ts/types';\nimport Session from '../../assets/ts/session';\n\nconst strikethroughClass = 'strikethrough';\n\nexport const pluginName = 'Todo';\n\nregisterPlugin(\n  {\n    name: pluginName,\n    author: 'Jeff Wu',\n    description: `Lets you strike out bullets (by default with ctrl+enter)`,\n  },\n  function(api) {\n    api.registerHook('session', 'renderLineTokenHook', (tokenizer, hooksInfo) => {\n      if (hooksInfo.has_cursor) {\n        return tokenizer;\n      }\n      if (hooksInfo.has_highlight) {\n        return tokenizer;\n      }\n      return tokenizer.then(RegexTokenizerModifier(\n        matchWordRegex('\\\\~\\\\~(\\\\n|.)+?\\\\~\\\\~'),\n        hideBorderAndModify(2, 2, (char_info) => { char_info.renderOptions.classes[strikethroughClass] = true; })\n      ));\n    });\n\n    async function isStruckThrough(session: Session, row: Row) {\n      // for backwards compatibility\n      const isStruckThroughOldStyle = await session.document.store._isStruckThroughOldFormat(row);\n      if (isStruckThroughOldStyle) { return true; }\n\n      const text = await session.document.getText(row);\n      return (text.slice(0, 2) === '~~') && (text.slice(-2) === '~~');\n    }\n\n    async function addStrikeThrough(session: Session, row: Row) {\n      await session.addChars(row, -1, ['~', '~']);\n      await session.addChars(row, 0, ['~', '~']);\n    }\n\n    async function removeStrikeThrough(session: Session, row: Row) {\n      await session.delChars(row, -2, 2);\n      await session.delChars(row, 0, 2);\n    }\n\n    api.registerAction(\n      'toggle-strikethrough',\n      'Toggle strikethrough for a row',\n      async function({ session }) {\n        if (await isStruckThrough(session, session.cursor.row)) {\n          await removeStrikeThrough(session, session.cursor.row);\n        } else {\n          await addStrikeThrough(session, session.cursor.row);\n        }\n      },\n    );\n\n    // TODO: this should maybe strikethrough children, since UI suggests it?\n    api.registerAction(\n      'visual-line-toggle-strikethrough',\n      'Toggle strikethrough for rows',\n      async function({ session, visual_line }) {\n        if (visual_line == null) {\n          throw new Error('Visual_line mode arguments missing');\n        }\n\n        const is_struckthrough = await Promise.all(\n          visual_line.selected.map(async (path) => {\n            return await isStruckThrough(session, path.row);\n          })\n        );\n        if (_.every(is_struckthrough)) {\n          await Promise.all(\n            visual_line.selected.map(async (path) => {\n              await removeStrikeThrough(session, path.row);\n            })\n          );\n        } else {\n          await Promise.all(\n            visual_line.selected.map(async (path, i) => {\n              if (!is_struckthrough[i]) {\n                await addStrikeThrough(session, path.row);\n              }\n            })\n          );\n        }\n        await session.setMode('NORMAL');\n      },\n    );\n\n    api.registerDefaultMappings(\n      'NORMAL',\n      {\n        'toggle-strikethrough': [['ctrl+enter']],\n      },\n    );\n\n    api.registerDefaultMappings(\n      'INSERT',\n      {\n        'toggle-strikethrough': [['ctrl+enter', 'meta+enter']],\n      },\n    );\n\n    api.registerDefaultMappings(\n      'VISUAL_LINE',\n      {\n        'visual-line-toggle-strikethrough': [['ctrl+enter']],\n      },\n    );\n\n    // TODO for workflowy mode\n    // NOTE: in workflowy, this also crosses out children\n    // 'toggle-strikethrough': [['meta+enter']],\n  },\n  (api => api.deregisterAll()),\n);\n","import * as _ from 'lodash';\n\nimport { registerPlugin } from '../../assets/ts/plugins';\nimport Session from '../../assets/ts/session';\nimport logger from '../../shared/utils/logger';\nimport Path from '../../assets/ts/path';\n\nexport const pluginName = 'Recursive-Expand';\n\nregisterPlugin(\n    {\n        name: pluginName,\n        author: 'Nikhil Sonti',\n        description: `Lets you recursively expand or collapse a node`,\n    },\n    function (api) {\n\n        async function toggleRecursiveCollapse(session: Session, path: Path, collapse: boolean) {\n            logger.debug('Toggle state: ' + collapse + ' row = ' + path.row);\n            await session.document.setCollapsed(path.row, collapse);\n\n            if (await session.document.hasChildren(path.row)) {\n                let children = await session.document.getChildren(path);\n                logger.debug('No of children: ' + children.length);\n\n                children.forEach(async (child_path) => {\n                    await toggleRecursiveCollapse(session, child_path, collapse);\n                });\n            }\n        }\n\n        api.registerAction(\n            'toggle-expand',\n            'Toggle expand/collapse recursively',\n            async function ({ session }) {\n                let is_collapsed = await session.document.collapsed(session.cursor.row);\n                await toggleRecursiveCollapse(session, session.cursor.path, !is_collapsed);\n                await session.document.forceLoadTree(session.cursor.row, false);\n            },\n        );\n\n        api.registerDefaultMappings(\n            'NORMAL',\n            {\n                'toggle-expand': [['Z']],\n            },\n        );\n    },\n    (api => api.deregisterAll()),\n);\n","import * as React from 'react'; // tslint:disable-line no-unused-variable\nimport * as _ from 'lodash';\nimport { registerPlugin, PluginApi } from '../../assets/ts/plugins';\nimport { Logger } from '../../shared/utils/logger';\nimport Path from '../../assets/ts/path';\nimport { SerializedBlock } from '../../assets/ts/types';\nimport { CachedRowInfo } from '../../assets/ts/document';\nimport { matchWordRegex } from '../../assets/ts/utils/text';\n\nregisterPlugin<DailyNotesPlugin>(\n  {\n    name: 'Daily Notes',\n    author: 'shady2k',\n    description: (\n    <div>\n    How to use:\n    <ul>\n      <li>\n          This plugin automatically creates a \"Daily Notes\" node at the root.\n          Sub-nodes are created automatically every day (if missing, they can also be manually created).\n          Paths to sub-nodes have YYYY, YYYY-MM and YYYY-MM-DD date formats.\n      </li>\n      <li> Marks plugin required: easy navigation between today, tommorrow and yesterday nodes (created every day automatically)</li>\n      <li> All new records will be automatically cloned in the today node</li>\n      <li> Adding a date in format YYYY-MM-DD will create that day in the Daily Notes subtree as a Linked node</li>\n    </ul>\n    </div>\n    ),\n    version: 1,\n  },\n  async (api) => {\n    const dailyNotes = new DailyNotesPlugin(api);\n    // Initial setup\n    if (process.env.NODE_ENV === 'production') {\n      await api.setData('isLogging', false);\n    } else {\n      await api.setData('isLogging', true);\n    }\n    await dailyNotes.init();\n    return dailyNotes;\n  },\n  (api => api.deregisterAll())\n);\n\nclass DailyNotesPlugin {\n  private api: PluginApi;\n  private logger: Logger;\n  private isLogging: boolean;\n  private dailyMarks: any;\n  private childAddedArr: Array<number>;\n  private dailyNotesRoot: Path | null;\n  private lastRowText: string | null;\n  private detachTimer: any;\n\n  constructor(api: PluginApi) {\n    this.api = api;\n    this.logger = this.api.logger;\n    this.logger.info('Loading Daily notes');\n    this.isLogging = false;\n    this.childAddedArr = [];\n    this.dailyNotesRoot = null;\n    this.lastRowText = null;\n    this.detachTimer = null;\n\n    this.setLogging();\n\n    this.api.cursor.on('rowChange', async (_oldPath: Path, newPath: Path) => {\n      this.log('rowChange', _oldPath, newPath);\n      this.checkNewDay();\n      this.checkRowTextChanged(_oldPath, newPath);\n    });\n\n    this.api.registerListener('document', 'childAdded', async ({ row }) => {\n      this.log('childAdded', row);\n      this.childAddedArr.push(row);\n    });\n\n    this.api.registerListener('document', 'loadRow', async (path, serialized) => {\n      const ci = _.findIndex(this.childAddedArr, ce => ce === path.row);\n      if (ci !== -1) {\n        this.log('loadRow', path, serialized);\n        this.childAddedArr.splice(ci, 1);\n        this.addCreatedToday(path.row);\n      }\n    });\n\n    this.api.registerListener('document', 'afterDetach', async (info) => {\n      let that = this;\n      if (this.detachTimer) {\n        clearTimeout(this.detachTimer);\n      }\n      this.detachTimer = setTimeout(async function() {\n        await that.checkDeleted(info);\n      }, 1000);\n    });\n\n    /*this.api.registerListener('session', 'exit', async () => {\n      this.log('exit');\n    });*/\n  }\n\n  public async setLogging() {\n    this.isLogging = await this.api.getData('isLogging', false);\n  }\n\n  public async init() {\n    this.log('init');\n    await this.initDailyMarks();\n    await this.checkDailyMarks();\n\n    for (const item of this.dailyMarks) {\n      if (item.date && item.mark) {\n        await this.createDailyNode(item.id, item.date, item.mark);\n      }\n    }\n  }\n\n  private async initDailyMarks() {\n    const dt = new Date();\n    let dt_tomorrow = new Date();\n    dt_tomorrow.setDate(dt.getDate() + 1);\n    let dt_yesterday = new Date();\n    dt_yesterday.setDate(dt.getDate() - 1);\n\n    this.dailyMarks = [\n      { id: 'tomorrow', mark: 'tomorrow', date: dt_tomorrow, node: null, linkedNode: null },\n      { id: 'today', mark: 'today', date: dt, node: null, linkedNode: null },\n      { id: 'yesterday', mark: 'yesterday', date: dt_yesterday, node: null,  linkedNode: null },\n    ];\n  }\n\n  private async checkNewDay() {\n    this.log('checkNewDay');\n    if (this.isNewDay()) {\n      this.log('New day comes');\n      this.initDailyMarks();\n      await this.init();\n    } else {\n      this.log('Same day');\n    }\n  }\n\n  private isNewDay() {\n    this.log('isNewDay');\n    const te = this.dailyMarks.find((e: any) => {\n      return e.id === 'today';\n    });\n    let dt = new Date();\n    let dt2 = te.date;\n\n    if (dt && dt2) {\n      if (dt.setHours(0, 0, 0, 0) === dt2.setHours(0, 0, 0, 0)) {\n        return false;\n      } else {\n        return true;\n      }\n    } else {\n      throw new Error('Can\\'t get dates');\n    }\n  }\n\n  private async checkRowTextChanged(oldPath: Path, newPath: Path) {\n    if (oldPath !== newPath) {\n      const rowTextOld = await this.api.session.document.getText(oldPath.row);\n      if (this.lastRowText !== null && this.lastRowText !== rowTextOld) {\n        this.log('Row text changed', oldPath);\n        this.checkForDates(oldPath, rowTextOld);\n      }\n      this.lastRowText = await this.api.session.document.getText(newPath.row);\n    }\n  }\n\n  private isValidDate(year: number, month: number, day: number) {\n    const d = new Date(year, month, day);\n    if (d.getFullYear() === year && d.getMonth() === month && d.getDate() === day) {\n        return true;\n    }\n    return false;\n  }\n\n  private async checkForDates(path: Path, text?: string) {\n    if (!text) {\n      text = await this.api.session.document.getText(path.row);\n    }\n    if (!text) {\n      return;\n    }\n    const regex = matchWordRegex('\\\\d{4}\\\\-\\\\d{2}\\\\-\\\\d{2}');\n    let match = regex.exec(text);\n    if (match) {\n      this.log('Matched', match);\n      const dateStr = match[1];\n      const date = new Date(Date.parse(dateStr));\n      const d = match[1].split('-');\n      if (d.length === 3) {\n        const isValidDate = this.isValidDate(Number.parseInt(d[0]), Number.parseInt(d[1]), Number.parseInt(d[2]));\n        if (isValidDate) {\n          const newDay = { id: dateStr, mark: null, date: date, node: null,  linkedNode: null };\n          this.dailyMarks.push(newDay);\n          await this.createDailyNode(dateStr, date, null);\n          const linkedNode = this.getLinkedNode(dateStr);\n          await this.addLinked(linkedNode, path.row, true);\n        }\n      }\n    }\n  }\n\n  private async checkDeleted(info: CachedRowInfo) {\n    this.log('checkDeleted', info);\n    let needReInit = false;\n    const root = await this.getDailyNotesRoot();\n    for (const item of this.dailyMarks) {\n      if (item.node) {\n        if (info.row === item.node.row) {\n          needReInit = true;\n        }\n      }\n      if (item.linkedNode) {\n        if (info.row === item.linkedNode.row) {\n          needReInit = true;\n        }\n      }\n    }\n    if (root) {\n      if (info.row === root.row) {\n        needReInit = true;\n      }\n    }\n    if (needReInit) {\n      this.log('needReInit', true);\n      this.dailyNotesRoot = null;\n      await this.init();\n    }\n  }\n\n  private isHasRows(path: Path | null, searchRows: number[]): any {\n    if (path) {\n      let isFound = false;\n      for (const element of searchRows) {\n        if (path.row === element) {\n          isFound = true;\n          break;\n        }\n      }\n      if (isFound) {\n        return true;\n      } else {\n        if (path.parent) {\n          return this.isHasRows(path.parent, searchRows);\n        } else {\n          return false;\n        }\n      }\n    } else {\n      return false;\n    }\n  }\n\n  private async addLinked(linkedNode: Path, row: number, createInDailyNode: boolean = false) {\n    this.log('addLinked', row);\n    let foundInDailyNode = false;\n    let can = await this.api.session.document.canonicalPath(row);\n\n    // Check row in Daily node\n    if (!createInDailyNode) {\n      const rootNode = await this.getDailyNotesRoot();\n      foundInDailyNode = this.isHasRows(can, [rootNode.row]);\n    }\n\n    // Check row in Linked node\n    let foundLinked = false;\n    let linkedNodeChildren = await this.getChildren(linkedNode);\n    if (linkedNodeChildren) {\n      let linkedNodeChildrenArr: number[] = [];\n      linkedNodeChildren.map(element => linkedNodeChildrenArr.push(element.row));\n      foundLinked = this.isHasRows(can, linkedNodeChildrenArr);\n    }\n\n    if (!foundInDailyNode && !foundLinked) {\n      this.log('Create clone', row);\n      let rowsToClone: number[] = [];\n      rowsToClone.push(row);\n      if (linkedNode) {\n        this.api.session.attachBlocks(linkedNode, rowsToClone, 0);\n      }\n    }\n  }\n\n  private async addCreatedToday(row: number) {\n    this.log('addCreatedToday', row);\n    const linkedNode = this.getLinkedNode('today');\n    await this.addLinked(linkedNode, row);\n  }\n\n  /*private getNode(id: string) {\n    this.log('getNode', id);\n    const found = this.dailyMarks.find((e: any) => {\n      return e.id === id;\n    });\n    return found.node;\n  }*/\n\n  private setNode(id: string, path: Path) {\n    this.log('setNode', id, path);\n    const found = this.dailyMarks.find((e: any) => {\n      return e.id === id;\n    });\n    found.node = path;\n  }\n\n  private getLinkedNode(id: string) {\n    this.log('getLinkedNode', id);\n    const found = this.dailyMarks.find((e: any) => {\n      return e.id === id;\n    });\n    return found.linkedNode;\n  }\n\n  private setLinkedNode(id: string, path: Path) {\n    this.log('setLinkedNode', id, path);\n    const found = this.dailyMarks.find((e: any) => {\n      return e.id === id;\n    });\n    found.linkedNode = path;\n  }\n\n  private async checkDailyMarks() {\n    this.log('checkDailyMarks');\n    const paths = this.traverseSubtree(await this.getDailyNotesRoot());\n    for await (let path of paths) {\n      const info = await this.api.session.document.getInfo(path.row);\n      if (info.pluginData.marks && info.pluginData.marks.mark && info.pluginData.marks.mark !== '') {\n        const found = this.dailyMarks.find((e: any) => {\n          return e.mark === info.pluginData.marks.mark;\n        });\n\n        if (found) {\n          this.log('checkDailyMarks', 'Clear mark', found.mark);\n          await this.setMark(path, '');\n        }\n      }\n    }\n  }\n\n  private getNodeText(dt: Date, mode: string) {\n    const year = dt.getFullYear().toString();\n    const month = ('0' + (dt.getMonth() + 1).toString()).slice(-2);\n    const day = ('0' + dt.getDate().toString()).slice(-2);\n    if (mode === 'year') {\n      return year;\n    } else if (mode === 'month') {\n      return [year, month].join('-');\n    } else {\n      return [year, month, day].join('-');\n    }\n  }\n\n  public async log(...args: any[]) {\n    if (this.isLogging) {\n      this.logger.info('Daily notes: ', ...args);\n    }\n  }\n\n  private async getNodeWithText(root: Path, text: String): Promise<Path | null> {\n    this.log('getNodeWithText', root, text);\n    const document = this.api.session.document;\n    if (await document.hasChildren(root.row)) {\n      const children = await document.getChildren(root);\n      for await (let child of children) {\n        if (await document.getText(child.row) === text) {\n          return child;\n        }\n      }\n    }\n    return null;\n  }\n\n  private async getDailyNotesRoot() {\n    this.log('getDailyNotesRoot');\n    if (this.dailyNotesRoot && this.api.session.document.isValidPath(this.dailyNotesRoot!)) {\n      this.log('getDailyNotesRoot from cache');\n      return this.dailyNotesRoot!;\n    } else {\n      let dailyNotesRoot = await this.getNodeWithText(this.api.session.document.root, 'Daily Notes');\n      if (!dailyNotesRoot) {\n        await this.createDailyNotesRoot();\n        dailyNotesRoot = await this.getNodeWithText(this.api.session.document.root, 'Daily Notes');\n        if (!dailyNotesRoot) {\n          throw new Error('Error while creating node');\n        }\n      }\n      this.dailyNotesRoot = dailyNotesRoot;\n      return dailyNotesRoot!;\n    }\n  }\n\n  private async setMark(path: Path, mark: string) {\n    this.log('setMark', path, mark);\n    let info = await this.api.session.document.getInfo(path.row);\n    if (info.pluginData && info.pluginData.marks && info.pluginData.marks.mark !== mark) {\n      this.log('Change mark', path, mark);\n      info.pluginData.marks.mark = mark;\n      await this.api.session.document.emitAsync('loadRow', path, info.pluginData.marks || {});\n      await this.api.updatedDataForRender(path.row);\n    }\n  }\n\n  private async* traverseSubtree(root: Path): AsyncIterableIterator<Path> {\n    const visited_rows: {[row: number]: boolean} = {};\n    let that = this;\n\n    async function* helper(path: Path): AsyncIterableIterator<Path> {\n      if (path.row in visited_rows) {\n        return;\n      }\n      visited_rows[path.row] = true;\n      yield path;\n      const children = await that.getChildren(path);\n      for (let i = 0; i < children.length; i++) {\n        yield* await helper(children[i]);\n      }\n    }\n    yield* await helper(root);\n  }\n\n  public async getChildren(parent_path: Path): Promise<Array<Path>> {\n    if (!parent_path) {\n      return [];\n    }\n    return (await this.api.session.document.getChildren(parent_path)).map(path => parent_path.child(path.row));\n  }\n\n  private async createBlock(path: Path, text: string, isCollapsed: boolean = true, plugins?: any) {\n    let serialzed_row: SerializedBlock = {\n      text: text,\n      collapsed: isCollapsed,\n      plugins: plugins,\n      children: [],\n    };\n    this.log('createBlock', path, text, isCollapsed, plugins, serialzed_row);\n    await this.api.session.addBlocks(path, 0, [serialzed_row]);\n    const result = await this.getNodeWithText(path, text);\n    this.log('Block created', path, text);\n    if (!result) {\n      throw new Error('Error while creating block');\n    }\n    await this.api.updatedDataForRender(path.row);\n    return result;\n  }\n\n  private async createDailyNotesRoot() {\n    this.log('createDailyNotes');\n    await this.createBlock(this.api.session.document.root, 'Daily Notes');\n  }\n\n  private async createDailyNode(id: string, dt: Date, mark: string | null) {\n    this.log('createDailyNode', dt, mark);\n    const root = await this.getDailyNotesRoot();\n\n    const yearNode = this.getNodeText(dt, 'year');\n    const monthNode = this.getNodeText(dt, 'month');\n    const dayNode = this.getNodeText(dt, 'day');\n\n    let yearPath = await this.getNodeWithText(root, yearNode);\n    if (!yearPath) {\n      yearPath = await this.createBlock(root, yearNode);\n    }\n\n    let monthPath = await this.getNodeWithText(yearPath, monthNode);\n    if (!monthPath) {\n      monthPath = await this.createBlock(yearPath, monthNode);\n    }\n\n    let dayPath = await this.getNodeWithText(monthPath, dayNode);\n    if (!dayPath) {\n      dayPath = await this.createBlock(monthPath, dayNode, true, { mark: mark });\n    } else {\n      if (mark) {\n        this.setMark(dayPath, mark);\n      }\n    }\n    this.setNode(id, dayPath);\n\n    let linkedPath = await this.getNodeWithText(dayPath, 'Linked');\n    if (!linkedPath) {\n      linkedPath = await this.createBlock(dayPath, 'Linked', false);\n    }\n    this.setLinkedNode(id, linkedPath);\n  }\n}\n","import * as React from 'react';\nimport * as _ from 'lodash';\n\nimport { ChromePicker } from 'react-color';\n\nimport * as browser_utils from '../utils/browser';\nimport logger from '../../../shared/utils/logger';\nimport { MODES } from '../modes';\n\nimport Path from '../path';\nimport Document from '../document';\nimport { DocumentStore, ClientStore } from '../datastore';\nimport { InMemory } from '../../../shared/data_backend';\nimport Session from '../session';\nimport Menu from '../menu';\nimport Config from '../config';\nimport KeyBindings from '../keyBindings';\nimport KeyMappings from '../keyMappings';\nimport { PluginsManager } from '../plugins';\nimport { BackendType } from '../data_backend';\nimport { Theme, getStyles, themes } from '../themes';\nimport { SERVER_CONFIG } from '../constants';\n\nimport SessionComponent from './session';\nimport SpinnerComponent from './spinner';\nimport MenuComponent from './menu';\nimport HotkeysTableComponent from './hotkeysTable';\nimport PluginsTableComponent from './pluginTable';\nimport BackendSettingsComponent from './settings/backendSettings';\nimport FileInput from './fileInput';\nimport BehaviorSettingsComponent from './settings/behaviorSettings';\n\nenum TABS {\n  DATA,\n  THEME,\n  BEHAVIOR,\n  HOTKEYS,\n  PLUGIN,\n  ABOUT,\n}\n\ntype Props = {\n  session: Session;\n  config: Config;\n  keyBindings: KeyBindings;\n  pluginManager: PluginsManager;\n  initialBackendType: BackendType;\n  onExport: () => void;\n  rerenderAll: () => void;\n};\ntype State = {\n  currentTab: TABS,\n  themeProperty: keyof Theme, // color theme property currently being changed\n  presetTheme: string,\n};\n\nfunction getCurrentTheme(clientStore: ClientStore) {\n  const theme: Theme = {} as Theme;\n  Object.keys(themes.Default).forEach((theme_property: string) => {\n    theme[theme_property as keyof Theme] = clientStore.getClientSetting(theme_property as keyof Theme);\n  });\n  return theme;\n}\n\nexport default class SettingsComponent extends React.Component<Props, State> {\n  private keyBindingsUpdate: () => void;\n  private preview_session: Session | null = null;\n  private preview_menu: Menu | null = null;\n  private initial_theme: Theme;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      currentTab: TABS.DATA,\n      themeProperty: 'theme-bg-primary',\n      presetTheme: 'Default',\n    };\n    this.keyBindingsUpdate = () => {\n      this.forceUpdate();\n    };\n\n    this.initial_theme = getCurrentTheme(props.session.clientStore);\n\n    (async () => {\n      const preview_document = new Document(new DocumentStore(new InMemory()));\n      await preview_document.load([\n        { text: 'Preview document', children: [\n          { text: 'Breadcrumbs', children: [\n            { text: 'Header', children: [\n              'This is a preview document',\n              'This is a link: http://www.google.com',\n              'Here is a visual selection',\n              /*\n              { text: 'This is marked, if marks are on', plugins: { mark: 'mark' } },\n               */\n            ] }\n          ] }\n        ] }\n      ]);\n      this.preview_session = new Session(\n        this.props.session.clientStore, preview_document,\n        { viewRoot: Path.loadFromAncestry([1, 2, 3]) }\n      );\n      const cursorPath = Path.loadFromAncestry([1, 2, 3, 6]);\n      await this.preview_session.cursor.setPosition(cursorPath, 10);\n      await this.preview_session.setMode('VISUAL');\n      await this.preview_session.anchor.setPosition(cursorPath, 4);\n      this.preview_session.document.cache.clear();\n\n      function makeAccents(min: number, max: number) {\n        const accents: {[key: number]: boolean} = {};\n        for (let i = min; i <= max; i++) { accents[i] = true; }\n        return accents;\n      }\n\n      this.preview_menu = new Menu(async (_query) => {\n        return [\n          {\n            contents: 'Some blah result'.split(''),\n            renderOptions: { accents: makeAccents(5, 8) },\n            fn: () => null\n          },\n          {\n            contents: 'Another blah result'.split(''),\n            renderOptions: { accents: makeAccents(8, 11) },\n            fn: () => null\n          },\n        ];\n      });\n      await this.preview_menu.session.addCharsAtCursor('blah'.split(''));\n      await this.preview_menu.update();\n\n      this.forceUpdate();\n    })();\n  }\n\n  public componentDidMount() {\n    // set up listener for keybindings\n    this.props.keyBindings.on('update', this.keyBindingsUpdate);\n  }\n\n  public componentWillUnmount() {\n    this.props.keyBindings.off('update', this.keyBindingsUpdate);\n  }\n\n  public render() {\n    const session = this.props.session;\n    const keyBindings = this.props.keyBindings;\n\n    const updateAll = () => {\n      if (this.preview_session) {\n        this.preview_session.document.cache.clear();\n      }\n      this.props.rerenderAll();\n    };\n    const applyTheme = (theme: Theme) => {\n      Object.keys(theme).forEach((theme_prop: string) => {\n        session.clientStore.setClientSetting(theme_prop as keyof Theme, theme[theme_prop as keyof Theme]);\n      });\n      updateAll();\n    };\n\n    const colorPickerRow = (name: string, theme_property: keyof Theme) => {\n      const hex_color = session.clientStore.getClientSetting('theme-bg-primary');\n      const rgb = parseInt(hex_color.substring(1), 16);\n      // tslint:disable no-bitwise\n      const r = (rgb >> 16) & 0xff;  // extract red\n      const g = (rgb >>  8) & 0xff;  // extract green\n      const b = (rgb >>  0) & 0xff;  // extract blue\n      // tslint:enable no-bitwise\n      const luma = 0.2126 * r + 0.7152 * g + 0.0722 * b; // per ITU-R BT.709\n\n      const style = { fontSize: 11, padding: 10, cursor: 'pointer' };\n      if (theme_property === this.state.themeProperty) {\n        Object.assign(style, getStyles(session.clientStore, ['theme-bg-highlight']));\n      }\n      return (\n        <tr style={style} onClick={\n          () => this.setState({themeProperty: theme_property} as State)\n        }>\n          <td style = {{\n            width: '50px',\n            border: `1px solid ${luma > 40 ? 'black' : 'white'}`,\n            backgroundColor: session.clientStore.getClientSetting(theme_property)\n          }}/>\n          <td style={{ paddingLeft: 10 }}> {name} </td>\n        </tr>\n      );\n    };\n\n    const tabs_info = [\n      {\n        tab: TABS.DATA,\n        heading: 'Data',\n        div: (\n          <div>\n            {\n              SERVER_CONFIG.socketserver ? (\n                <div style={{\n                  marginBottom: 20, padding: 10,\n                  ...getStyles(session.clientStore, ['theme-trim-accent'])\n                }}>\n                  NOTE: Since you are using a Vimflowy server,\n                  you can simply back up the data server-side,\n                  assuming you have access to the server.\n                </div>\n              ) : (\n                <div>\n                  <div className='settings-header'\n                    style={{\n                      ...getStyles(session.clientStore, ['theme-bg-secondary', 'theme-trim'])\n                    }}\n                    >\n                    Data storage\n                  </div>\n                  <div className='settings-content'>\n                    <BackendSettingsComponent\n                      clientStore={session.clientStore}\n                      initialBackendType={this.props.initialBackendType}\n                    />\n                  </div>\n                </div>\n              )\n            }\n\n            <div className='settings-header'\n              style={{\n                ...getStyles(session.clientStore, ['theme-bg-secondary', 'theme-trim'])\n              }}>\n              Export Data\n            </div>\n            <div className='settings-content'>\n              <table><tbody>\n                <tr>\n                  <td>\n                    <div className='btn'\n                      style={{\n                        ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                      }}\n                      onClick={() => session.exportFile('json')} >\n                      Export as JSON\n                    </div>\n                  </td>\n                  <td>\n                    Best for vimflowy backups, re-imports preserving all features.\n                  </td>\n                </tr>\n                <tr>\n                  <td>\n                    <div className='btn'\n                      style={{\n                        ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                      }}\n                      onClick={() => session.exportFile('txt')}>\n                      Export as plaintext\n                    </div>\n                  </td>\n                  <td>\n                    Workflowy compatible.\n                    Does not support all features (e.g. vimflowy's marks/clones, or workflowy's tags, etc.)\n                  </td>\n                </tr>\n              </tbody></table>\n            </div>\n            <div className='settings-header'\n              style={{\n                ...getStyles(session.clientStore, ['theme-bg-secondary', 'theme-trim'])\n              }}\n              >\n              Import Data\n            </div>\n            <div className='settings-content'>\n              <FileInput\n                onSelect={(filename) => {\n                  session.showMessage(`Reading in file ${filename}...`);\n                }}\n                onLoad={async (filename, contents) => {\n                  const mimetype = browser_utils.mimetypeLookup(filename);\n                  if (!mimetype) {\n                    session.showMessage('Invalid filetype!', { time: 0 });\n                    return;\n                  }\n                  session.showMessage('Importing contents...', { time: 0 });\n                  if (await session.importContent(contents, mimetype)) {\n                    session.showMessage('Imported!', {text_class: 'success'});\n                    await session.setMode('NORMAL');\n                  } else {\n                    session.showMessage('Import failed due to parsing issue', {text_class: 'error'});\n                  }\n                }}\n                onError={(error) => {\n                  logger.error('Data file input error', error);\n                  session.showMessage(`Error reading data: ${error}`, {text_class: 'error'});\n                }}\n              >\n                <div className='btn'\n                  style={{\n                    ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                  }}\n                >\n                  Import from file\n                </div>\n              </FileInput>\n            </div>\n          </div>\n        ),\n      },\n      {\n        tab: TABS.THEME,\n        heading: 'Visual theme',\n        div: (\n          <div style={{ display: 'flex' }}>\n            <div style={{ padding: 5, flexBasis: 1, flexGrow: 1 }}>\n              <div className='settings-header'\n                style={{\n                  ...getStyles(session.clientStore, ['theme-bg-secondary', 'theme-trim'])\n                }}\n              >\n                Colors\n              </div>\n              <div className='settings-content' style={{ display: 'flex' }}>\n                <div>\n                  <div style={{ paddingTop: 10 }}>\n                    <table style={{ borderCollapse: 'collapse' }}><tbody>\n                      {colorPickerRow('Main background color', 'theme-bg-primary')}\n                      {colorPickerRow('Secondary background color', 'theme-bg-secondary')}\n                      {colorPickerRow('Tertiary background color', 'theme-bg-tertiary')}\n                      {colorPickerRow('Highlight background color', 'theme-bg-highlight')}\n                      {colorPickerRow('Main text color', 'theme-text-primary')}\n                      {colorPickerRow('Accented text color', 'theme-text-accent')}\n                      {colorPickerRow('Trim color', 'theme-trim')}\n                      {colorPickerRow('Accented trim color', 'theme-trim-accent')}\n                      {colorPickerRow('Cursor text color', 'theme-text-cursor')}\n                      {colorPickerRow('Cursor background color', 'theme-bg-cursor')}\n                      {colorPickerRow('Link text color', 'theme-text-link')}\n                    </tbody></table>\n                  </div>\n\n                  <div style={{padding: 10}}>\n                    <span className='btn' style={{\n                        ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                      }}\n                      onClick={() => applyTheme(this.initial_theme) }>\n                      Reset\n                    </span>\n                    <span className='btn' style={{\n                        ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                      }} onClick={() => {\n                        browser_utils.downloadFile(\n                          'vimflowy_colors.json',\n                          JSON.stringify(getCurrentTheme(session.clientStore)),\n                          'application/json') ;\n                      }}>\n                      Download\n                    </span>\n                  </div>\n                  <div>\n                    <select\n                      value={this.state.presetTheme}\n                      onChange={(e) => {\n                        const theme_name = (e.target as HTMLSelectElement).value;\n                        this.setState({ presetTheme: theme_name } as State);\n                      }}\n                    >\n                      {\n                        Object.keys(themes).map((theme_name) => {\n                          return (\n                            <option value={theme_name} key={theme_name}>\n                              {theme_name}\n                            </option>\n                          );\n                        })\n                      }\n                    </select>\n                    <span className='btn' style={{\n                        ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                      }}\n                      onClick={() => applyTheme(themes[this.state.presetTheme]) }>\n                      Apply preset theme\n                    </span>\n                    <div style={{marginTop: 5}}>\n                      <FileInput\n                        onSelect={(filename) => {\n                          session.showMessage(`Reading in file ${filename}...`);\n                        }}\n                        onLoad={(_filename, contents) => {\n                          let theme;\n                          try {\n                            theme = JSON.parse(contents);\n                          } catch (e) {\n                            session.showMessage(`Failed to parse JSON: ${e}`, {text_class: 'error'});\n                            return;\n                          }\n                          applyTheme(theme);\n                        }}\n                        onError={(error) => {\n                          logger.error('Theme file input error', error);\n                          session.showMessage(`Error reading theme: ${error}`, {text_class: 'error'});\n                        }}\n                        style={{float: 'left', position: 'relative'}}\n                      >\n                        <div className='btn'\n                          style={{\n                            ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                          }}\n                        >\n                          Import theme from file\n                        </div>\n                      </FileInput>\n                    </div>\n                  </div>\n                </div>\n                <div style={{ marginLeft: 50 }}>\n                  <ChromePicker\n                    color={ session.clientStore.getClientSetting(this.state.themeProperty) }\n                    onChangeComplete={({ hex: hexColor }: any) => {\n                      session.clientStore.setClientSetting(this.state.themeProperty, hexColor);\n                      updateAll();\n                    }}\n                  />\n                </div>\n              </div>\n            </div>\n            <div style={{ padding: 5, flexBasis: 1, flexGrow: 1 }}>\n              <div className='settings-header'\n                style={{\n                  ...getStyles(session.clientStore, ['theme-bg-secondary', 'theme-trim'])\n                }}\n              >\n                Preview\n              </div>\n              <div className='settings-content' style={{\n                ...getStyles(session.clientStore, ['theme-trim-accent']),\n                padding: 10, marginTop: 10, pointerEvents: 'none'\n              }}>\n                { this.preview_session ?\n                  <SessionComponent\n                    session={this.preview_session}\n                  /> : <SpinnerComponent/>\n                }\n              </div>\n\n              <div className='settings-content' style={{\n                ...getStyles(session.clientStore, ['theme-trim-accent']),\n                padding: 10, marginTop: 10, pointerEvents: 'none'\n              }}>\n                { (this.preview_menu && this.preview_session) ?\n                  <MenuComponent\n                    menu={this.preview_menu}\n                    session={this.preview_session}\n                  /> : <SpinnerComponent/>\n                }\n              </div>\n            </div>\n          </div>\n        ),\n      },\n      {\n        tab: TABS.BEHAVIOR,\n        heading: 'Yank behavior',\n        div: (\n          <div>\n            {\n              <div className='settings-content'>\n                <BehaviorSettingsComponent\n                  clientStore={session.clientStore}\n                />\n              </div>\n            }\n          </div>\n        ),\n      },\n      {\n        tab: TABS.HOTKEYS,\n        heading: 'Hotkeys',\n        div: (\n          <div>\n            <div className='settings-content'>\n              <div className='clearfix' style={{marginBottom: 10}}>\n                <div className='btn'\n                  style={{\n                    float: 'left',\n                    ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                  }}\n                  onClick={this.props.onExport} >\n                  Export as file\n                </div>\n                <div className='btn'\n                  style={{\n                    float: 'left',\n                    ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                  }}\n                  onClick={() => {\n                    keyBindings.setMappings(this.props.config.defaultMappings);\n                    return session.showMessage('Loaded defaults!', {text_class: 'success'});\n                  }}>\n\n                  Load defaults\n                </div>\n                <FileInput\n                  onSelect={(filename) => {\n                    session.showMessage(`Reading in file ${filename}...`);\n                  }}\n                  onLoad={(_filename, contents) => {\n                    let hotkey_settings;\n                    try {\n                      hotkey_settings = JSON.parse(contents);\n                    } catch (e) {\n                      session.showMessage(`Failed to parse JSON: ${e}`, {text_class: 'error'});\n                      return;\n                    }\n                    const mappings = new KeyMappings(hotkey_settings);\n                    keyBindings.setMappings(mappings);\n                    // TODO: validation of mappings?\n                    // if (err) {\n                    //   session.showMessage(err, {text_class: 'error'});\n                    // } else {\n                    //   session.showMessage('Loaded new hotkey settings!', {text_class: 'success'});\n                    // }\n                    session.clientStore.setClientSetting('hotkeys', hotkey_settings);\n                  }}\n                  onError={(error) => {\n                    logger.error('Hotkeys file input error', error);\n                    session.showMessage(`Error reading hotkeys: ${error}`, {text_class: 'error'});\n                  }}\n                  style={{float: 'left', position: 'relative'}}\n                >\n                  <div className='btn'\n                    style={{\n                      ...getStyles(session.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n                    }}\n                  >\n                    Import from file\n                  </div>\n                </FileInput>\n              </div>\n              <div>\n                {\n                  Object.keys(MODES).map((mode) => {\n                    return (\n                      <div key={mode}>\n                        {mode}\n                        <HotkeysTableComponent\n                          keyMap={keyBindings.mappings.mappings[mode]}\n                          definitions={keyBindings.definitions}\n                          clientStore={session.clientStore}\n                        />\n                      </div>\n                    );\n\n                  })\n                }\n              </div>\n            </div>\n          </div>\n        ),\n      },\n      {\n        tab: TABS.PLUGIN,\n        heading: 'Plugins',\n        div: (\n          <PluginsTableComponent\n            clientStore={session.clientStore}\n            pluginManager={this.props.pluginManager}\n          />\n        ),\n      },\n      {\n        tab: TABS.ABOUT,\n        heading: 'About',\n        div: (\n          <div>\n            For more info, or to contact the maintainers, please visit\n            {' '}\n            <a href='https://github.com/WuTheFWasThat/vimflowy' style={{\n              ...getStyles(session.clientStore, ['theme-link'])\n            }}>\n              the github website\n            </a>.\n          </div>\n        ),\n      },\n    ];\n\n    return (\n      <div>\n        {/* NOTE: must have theme as well so that inherit works for tabs*/}\n        <ul className='tabs' style={{\n          margin: 20,\n          ...getStyles(session.clientStore, ['theme-bg-primary'])\n        }}>\n          {\n            (() => {\n              return _.map(tabs_info, (info) => {\n                const isActive = info.tab === this.state.currentTab;\n                return (\n                  <li className={isActive ? 'active' : ''} key={info.tab}\n                      style={{\n                        ...getStyles(session.clientStore, ['theme-bg-secondary', 'theme-trim'])\n                      }}\n                      onClick={() => this.setState({currentTab: info.tab} as State)}>\n                    {info.heading}\n                  </li>\n                );\n              });\n            })()\n          }\n        </ul>\n        {\n          (() => {\n            return _.map(tabs_info, (info) => {\n              const isActive = info.tab === this.state.currentTab;\n              return (\n                <div key={info.tab}\n                  className={isActive ? '' : 'hidden'} style={{padding: 20}}\n                >\n                  {info.div}\n                </div>\n              );\n            });\n          })()\n        }\n\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\n\nimport Path from '../path';\nimport Session from '../session';\nimport { getStyles } from '../themes';\n\ntype CrumbProps = {\n  onClick: ((...args: any[]) => void) | undefined,\n  session: Session,\n};\nclass CrumbComponent extends React.PureComponent<CrumbProps, {}> {\n  public render() {\n    const style = {};\n    if (this.props.onClick) {\n      Object.assign(style, getStyles(this.props.session.clientStore, ['theme-link']));\n    }\n    return (\n      <span>\n        <span style={style} onClick={this.props.onClick}>\n          {this.props.children}\n        </span>\n        <i className='fa fa-angle-right'\n          style={{marginRight: 15, marginLeft: 15}}/>\n      </span>\n    );\n  }\n}\n\ntype BreadcrumbsProps = {\n  session: Session;\n  viewRoot: Path;\n  crumbContents: {[row: number]: string};\n  onCrumbClick: ((...args: any[]) => void) | undefined;\n};\ntype BreadcrumbsState = {\n  loaded: boolean;\n};\nexport default class BreadcrumbsComponent extends React.Component<BreadcrumbsProps, BreadcrumbsState> {\n  constructor(props: BreadcrumbsProps) {\n    super(props);\n    this.state = {\n      loaded: false,\n    };\n  }\n\n  public render() {\n    const session = this.props.session;\n\n    const crumbNodes: Array<React.ReactNode> = [];\n    let path = this.props.viewRoot;\n    if (path.parent == null) {\n      throw new Error('Shouldn\\'t render breadcrumbs at root');\n    }\n    path = path.parent;\n    while (path.parent != null) {\n      const cachedRow = session.document.cache.get(path.row);\n      if (!cachedRow) {\n        throw new Error('Row wasnt cached despite being in crumbs');\n      }\n      const hooksInfo = {\n        path,\n        pluginData: cachedRow.pluginData,\n      };\n\n      crumbNodes.push(\n        <CrumbComponent key={path.row} session={session}\n          onClick={this.props.onCrumbClick && this.props.onCrumbClick.bind(this, path)}\n        >\n        {\n          session.applyHook(\n            'renderLineContents',\n            [this.props.crumbContents[path.row]],\n            hooksInfo\n          )\n        }\n        </CrumbComponent>\n      );\n      path = path.parent;\n    }\n    crumbNodes.push(\n      <CrumbComponent key={path.row} session={session}\n        onClick={this.props.onCrumbClick && this.props.onCrumbClick.bind(this, path)}\n      >\n        <i className='fa fa-home'/>\n      </CrumbComponent>\n    );\n    crumbNodes.reverse();\n\n    return (\n      <div key='breadcrumbs' style={{ fontSize: 20, marginBottom: 10 }} >\n        {crumbNodes}\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\n\ntype Props = {\n  fontSize?: number;\n  loadingText?: string;\n};\nexport default class Spinner extends React.PureComponent<Props, {}> {\n  public render() {\n    const style = {\n      fontSize: this.props.fontSize || 20,\n      marginRight: this.props.loadingText ? 10 : 0,\n    };\n\n    return (\n      <span>\n        <i className='fa fa-spin fa-spinner'\n          style={style}\n        />\n        {this.props.loadingText}\n      </span>\n    );\n  }\n}\n\n","import * as React from 'react';\n\nimport LineComponent, { LineProps } from './line';\nimport Spinner from './spinner';\n\nimport Session from '../session';\nimport { CachedRowInfo } from '../document';\nimport Path from '../path';\nimport { CursorsInfoTree } from '../cursor';\nimport { Col } from '../types';\nimport { PartialUnfolder, Token } from '../utils/token_unfolder';\nimport { getStyles } from '../themes';\n\ntype RowProps = {\n  session: Session;\n  path: Path;\n  cached: CachedRowInfo;\n  onCharClick: ((path: Path, column: Col, e: Event) => void) | undefined;\n  onClick: ((path: Path) => void) | undefined;\n  style: React.CSSProperties;\n  cursorsTree: CursorsInfoTree;\n  cursorBetween: boolean;\n};\nclass RowComponent extends React.Component<RowProps, {}> {\n  private onClick: (() => void) | undefined = undefined;\n  private onCharClick: ((column: Col, e: Event) => void) | undefined = undefined;\n\n  constructor(props: RowProps) {\n    super(props);\n    this.init(props);\n  }\n\n  private init(props: RowProps) {\n    if (props.onClick) {\n      this.onClick = () => {\n        if (!props.onClick) {\n          throw new Error('onClick disappeared');\n        }\n        props.onClick(props.path);\n      };\n    }\n\n    if (props.onCharClick) {\n      this.onCharClick = (column: Col, e: Event) => {\n        if (!props.onCharClick) {\n          throw new Error('onCharClick disappeared');\n        }\n        props.onCharClick(props.path, column, e);\n      };\n    }\n  }\n\n  public componentWillReceiveProps(props: RowProps) {\n    this.init(props);\n  }\n\n  public render() {\n    const session = this.props.session;\n    const path = this.props.path;\n    const lineData = this.props.cached.line;\n    const cursorsTree = this.props.cursorsTree;\n\n    const cursors: {[col: number]: boolean} = {};\n    let has_cursor = false;\n    const highlights: {[col: number]: boolean} = {};\n    let has_highlight = false;\n\n    if (cursorsTree.cursor != null) {\n      cursors[cursorsTree.cursor] = true;\n      has_cursor = true;\n    }\n    // TODO: Object.keys alternative that returns Array<number>?\n    (Object.keys(cursorsTree.selected)).forEach((col: any) => {\n      highlights[col] = true;\n      has_highlight = true;\n    });\n    // TODO: React.ReactNode vs React.ReactElement<any>?\n    const results: Array<React.ReactNode> = [];\n\n    let lineoptions: LineProps = {\n      lineData,\n      cursors,\n      cursorStyle: getStyles(session.clientStore, ['theme-cursor']),\n      highlights,\n      highlightStyle: getStyles(session.clientStore, ['theme-bg-highlight']),\n      linksStyle: getStyles(session.clientStore, ['theme-link']),\n      accentStyle: getStyles(session.clientStore, ['theme-text-accent']),\n      cursorBetween: this.props.cursorBetween,\n    };\n\n    const hooksInfo = {\n      path, pluginData: this.props.cached.pluginData,\n      has_cursor, has_highlight\n    };\n\n    lineoptions.lineHook = PartialUnfolder.trivial<Token, React.ReactNode>();\n    lineoptions.lineHook = session.applyHook(\n      'renderLineTokenHook', lineoptions.lineHook, hooksInfo\n    );\n\n    lineoptions.wordHook = PartialUnfolder.trivial<Token, React.ReactNode>();\n    lineoptions.wordHook = session.applyHook(\n      'renderWordTokenHook', lineoptions.wordHook, hooksInfo\n    );\n\n    lineoptions = session.applyHook('renderLineOptions', lineoptions, hooksInfo);\n    let lineContents = [\n      <LineComponent key='line'\n        onCharClick={this.onCharClick}\n        {...lineoptions}\n      />,\n    ];\n    lineContents = session.applyHook('renderLineContents', lineContents, hooksInfo);\n    results.push(...lineContents);\n\n    const infoChildren = session.applyHook('renderAfterLine', [], hooksInfo);\n\n    return (\n      <div key='text' className='node-text'\n        onClick={this.onClick}\n        style={this.props.style}\n      >\n        {results}\n        {infoChildren}\n      </div>\n    );\n  }\n}\n\ntype BlockProps = {\n  session: Session;\n  path: Path;\n\n  cached: CachedRowInfo | null;\n  cursorsTree: CursorsInfoTree;\n  cursorBetween: boolean;\n  onCharClick: ((path: Path, column: Col, e: Event) => void) | undefined;\n  onLineClick: ((path: Path) => void) | undefined;\n  onBulletClick: ((path: Path) => void) | undefined;\n  topLevel: boolean;\n  fetchData: () => void;\n};\nexport default class BlockComponent extends React.Component<BlockProps, {}> {\n\n  constructor(props: BlockProps) {\n    super(props);\n  }\n\n  public shouldComponentUpdate(nextProps: BlockProps) {\n    if (this.props.cursorsTree.hasSelection) {\n      return true;\n    }\n    if (nextProps.cursorsTree.hasSelection) {\n      return true;\n    }\n    if (nextProps.topLevel !== this.props.topLevel) {\n      return true;\n    }\n    if (nextProps.cached !== this.props.cached) {\n      return true;\n    }\n    if (!nextProps.path.is(this.props.path)) {\n      // NOTE: this can happen e.g. when you zoom out\n      return true;\n    }\n    if (nextProps.cursorBetween !== this.props.cursorBetween) {\n      return true;\n    }\n    if (nextProps.onCharClick !== this.props.onCharClick) {\n      return true;\n    }\n    if (nextProps.onLineClick !== this.props.onLineClick) {\n      return true;\n    }\n    if (nextProps.onBulletClick !== this.props.onBulletClick) {\n      return true;\n    }\n    // NOTE: it's assumed that session and fetchData never change\n\n    return false;\n  }\n\n\n  public render() {\n    const session = this.props.session;\n    const parent = this.props.path;\n    const cached = this.props.cached;\n    const cursorsTree = this.props.cursorsTree;\n\n    const pathElements: Array<React.ReactNode> = [];\n\n    if (cached === null) {\n      this.props.fetchData();\n      return <Spinner/>;\n    }\n\n    if (!parent.isRoot()) {\n      const elLine = (\n        <RowComponent key='row'\n          style={{\n            fontSize: this.props.topLevel ? 20 : undefined,\n            marginBottom: this.props.topLevel ? 10 : undefined,\n          }}\n          cursorsTree={cursorsTree}\n          cursorBetween={this.props.cursorBetween}\n          session={session} path={parent}\n          onCharClick={this.props.onCharClick}\n          cached={cached}\n          onClick={this.props.onLineClick}\n        />\n      );\n      pathElements.push(elLine);\n    }\n\n    const children = cached.childRows;\n    const collapsed = cached.collapsed;\n\n    if (this.props.topLevel && !children.length) {\n      let message = 'Nothing here yet.';\n      if (session.mode === 'NORMAL') {\n        // TODO move this\n        message += ' Press `o` to start adding content!';\n      }\n      pathElements.push(\n        <div key='nothing' className='center'\n             style={{padding: 20, fontSize: 20, opacity: 0.5}}>\n          { message }\n        </div>\n      );\n    } else if (children.length && ((!collapsed) || this.props.topLevel)) {\n      let childrenLoaded = true;\n      let childrenDivs = cached.children.map((cachedChild) => {\n        if (cachedChild === null) {\n          childrenLoaded = false;\n          return null;\n        }\n\n        const row = cachedChild.row;\n        const path = parent.child(row);\n\n        let cloneIcon: React.ReactNode | null = null;\n\n        const parents = cachedChild.parentRows;\n        // NOTE: this is not actually correct!\n        // should use isClone, which is different since a parent may be detached\n        if (parents.length > 1) {\n          cloneIcon = (\n            <i key='clone' className='fa fa-clone bullet clone-icon' title='Cloned'/>\n          );\n        }\n\n        const style: React.CSSProperties = {};\n\n        let icon = 'fa-circle';\n\n        let onBulletClick: (() => void) | undefined = undefined;\n        if (cachedChild.childRows.length) {\n          icon = cachedChild.collapsed ? 'fa-plus-circle' : 'fa-minus-circle';\n          const onBulletClickProp = this.props.onBulletClick;\n          if (onBulletClickProp != null) {\n            onBulletClick = () => onBulletClickProp(path);\n            style.cursor = 'pointer';\n          }\n        }\n\n        let bullet = (\n          <i className={`fa ${icon} bullet`} key='bullet'\n            style={style} onClick={onBulletClick}\n            data-ancestry={JSON.stringify(path.getAncestry())}\n          >\n          </i>\n        );\n        bullet = session.applyHook('renderBullet', bullet, { path });\n\n        return (\n          <div key={path.row}>\n            {cloneIcon}\n            {bullet}\n            <BlockComponent key='block'\n             cached={cachedChild}\n             topLevel={false}\n             cursorsTree={cursorsTree.getChild(path.row)}\n             onCharClick={this.props.onCharClick}\n             onLineClick={this.props.onLineClick}\n             onBulletClick={this.props.onBulletClick}\n             session={session} path={path}\n             cursorBetween={this.props.cursorBetween}\n             fetchData={this.props.fetchData}\n           />\n          </div>\n        );\n      });\n\n      if (!childrenLoaded) {\n        this.props.fetchData();\n        childrenDivs = [<Spinner key='spinner'/>];\n      }\n\n      pathElements.push(\n        <div key='children' className='block'>\n          {childrenDivs}\n        </div>\n      );\n    }\n\n    const style = {};\n    if (cursorsTree.visual) {\n      Object.assign(style, getStyles(session.clientStore, ['theme-bg-highlight']));\n    }\n    return (\n      <div className='node' style={style}>\n        {pathElements}\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\n\nimport { promiseDebounce } from '../utils/functional';\nimport logger from '../../../shared/utils/logger';\n\nimport * as Modes from '../modes';\nimport BreadcrumbsComponent from './breadcrumbs';\nimport BlockComponent from './block';\nimport Spinner from './spinner';\nimport Session from '../session';\nimport { Col } from '../types';\nimport Path from '../path';\nimport { CursorsInfoTree } from '../cursor';\n\n// TODO: move mode-specific logic into mode render functions\n\ntype Props = {\n  session: Session;\n};\ntype State = {\n  loaded: boolean;\n\n  // set after data is loaded\n  cursorsTree?: CursorsInfoTree;\n  crumbContents?: {[row: number]: string };\n};\n\ntype Profiler = (profilerMessage: string) => () => void;\n\nexport default class SessionComponent extends React.Component<Props, State> {\n  private update: () => void; // this is promise debounced\n\n  private profileRender: boolean; // for debugging\n  private getProfiler: (profileRender: boolean) => Profiler;\n  private onCharClick: (path: Path, column: number, e: Event) => void;\n  private onLineClick: (path: Path) => Promise<void>;\n  private onBulletClick: (path: Path) => Promise<void>;\n  private onCrumbClick: (path: Path) => Promise<void>;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      loaded: false,\n    };\n\n    this.onCharClick = (path, column, e) => {\n      const session = this.props.session;\n\n      // NOTE: this is fire and forget\n      session.cursor.setPosition(path, column).then(() => {\n        this.update();\n      });\n\n      // prevent overall path click\n      e.stopPropagation();\n      return false;\n    };\n\n    this.onLineClick = async (path) => {\n      const session = this.props.session;\n\n      // if clicking outside of text, but on the row,\n      // move cursor to the end of the row\n      let col = this.cursorBetween() ? -1 : -2;\n      await session.cursor.setPosition(path, col);\n      this.update();\n    };\n\n    this.onBulletClick = async (path) => {\n      const session = this.props.session;\n\n      await session.toggleBlockCollapsed(path.row);\n      session.save();\n      this.update();\n    };\n\n    this.onCrumbClick = async (path) => {\n      const session = this.props.session;\n\n      await session.zoomInto(path);\n      session.save();\n      this.update();\n    };\n\n    this.fetchAndRerender = this.fetchAndRerender.bind(this);\n\n    // make true to output time taken to get render contents\n    this.profileRender = true;\n\n    this.getProfiler = (profileRender) => {\n      if (!profileRender) {\n        return () => () => null;\n      }\n\n      return (profilerMessage) => {\n        const t0 = Date.now();\n\n        return () => {\n          logger.info(profilerMessage, Date.now() - t0);\n        };\n      };\n    };\n\n    this.update = promiseDebounce(async () => {\n      const session = this.props.session;\n      const finishProfiling = this.getProfiler(this.profileRender)('Update took');\n\n      const cursorsTree = new CursorsInfoTree(Path.rootRow());\n      const cursor = session.cursor;\n      const cursorNode = cursorsTree.getPath(cursor.path);\n      cursorNode.markCursor(cursor.col);\n      if (session.mode === 'VISUAL_LINE') {\n        // mirrors logic of finishes_visual_line in keyHandler.js\n        const [parent, index1, index2] = await session.getVisualLineSelections();\n        const children = await session.document.getChildRange(parent, index1, index2);\n        children.forEach((child) => {\n          cursorsTree.getPath(child).markVisual();\n        });\n      } else if (session.mode === 'VISUAL') {\n        const anchor = session.anchor;\n        if (anchor.path && cursor.path.is(anchor.path)) {\n          const start = Math.min(cursor.col, anchor.col);\n          const end = Math.max(cursor.col, anchor.col);\n          let cols: Array<Col> = [];\n          for (let j = start; j <= end; j++) {\n            cols.push(j);\n          }\n          cursorNode.markCols(cols);\n        } else {\n          logger.warn('Multiline not yet implemented');\n        }\n      }\n\n      const crumbContents: {[row: number]: string} = {};\n      let path = session.viewRoot;\n      while (path.parent != null) {\n        path = path.parent;\n        crumbContents[path.row] = await session.document.getText(path.row);\n      }\n\n      this.setState({\n        crumbContents,\n        cursorsTree,\n        loaded: true,\n      });\n\n      finishProfiling();\n    });\n  }\n\n  private async fetchAndRerender() {\n    const session = this.props.session;\n    const finishProfiling = this.getProfiler(this.profileRender)('forceLoadTree took');\n\n    await session.document.forceLoadTree(session.viewRoot.row, true);\n\n    finishProfiling();\n    this.update();\n  }\n\n  public componentWillReceiveProps() {\n    this.update();\n  }\n\n  public componentDidMount() {\n    this.update();\n  }\n\n  private cursorBetween() {\n    const mode = this.props.session.mode;\n    return Modes.getMode(mode).metadata.cursorBetween;\n  }\n\n  public render() {\n    const session = this.props.session;\n    if (!this.state.loaded) { return <Spinner/>; }\n\n    const crumbContents = this.state.crumbContents;\n    if (crumbContents == null) {\n      throw new Error('crumbContents should have been loaded');\n    }\n\n    const cursorsTree = this.state.cursorsTree;\n    if (cursorsTree == null) {\n      throw new Error('cursorsTree should have been loaded');\n    }\n\n    const mode = session.mode;\n    const viewRoot = session.viewRoot;\n    const cachedRow = session.document.cache.get(viewRoot.row);\n    if (cachedRow === null) {\n      this.fetchAndRerender();\n      return <Spinner/>;\n    }\n\n    const cursorBetween = this.cursorBetween();\n\n    let onLineClick: ((path: Path) => void) | undefined = undefined;\n    let onCharClick: ((path: Path, column: number, e: Event) => void) | undefined = undefined;\n    if (mode === 'NORMAL' ||\n        mode === 'INSERT' ||\n        mode === 'VISUAL' ||\n        mode === 'VISUAL_LINE'\n       ) {\n      onCharClick = this.onCharClick;\n      onLineClick = this.onLineClick;\n    }\n\n    let onCrumbClick: ((...args: any[]) => void) | undefined = undefined;\n    if (mode === 'NORMAL') {\n      onCrumbClick = this.onCrumbClick;\n    }\n\n    // TODO: have an extra breadcrumb indicator when not at viewRoot?\n    return (\n      <div>\n        {\n          (() => {\n            if (viewRoot.isRoot()) {\n              return null;\n            }\n            return [\n              <BreadcrumbsComponent key='crumbs'\n                session={session}\n                viewRoot={viewRoot}\n                onCrumbClick={onCrumbClick}\n                crumbContents={crumbContents}\n              />,\n              <hr key='bar' style={{opacity: 0.5, marginBottom: 10}}/>,\n            ];\n          })()\n        }\n        <BlockComponent\n          session={session}\n          cursorsTree={cursorsTree.getPath(viewRoot)}\n          cached={session.document.cache.get(viewRoot.row)}\n          path={viewRoot}\n          cursorBetween={cursorBetween}\n          topLevel={true}\n          onCharClick={onCharClick}\n          onLineClick={onLineClick}\n          onBulletClick={this.onBulletClick}\n          fetchData={this.fetchAndRerender}\n        />\n      </div>\n    );\n  }\n}\n\n","import * as React from 'react';\n\nimport LineComponent from './line';\nimport SpinnerComponent from './spinner';\nimport Session from '../session';\nimport Menu from '../menu';\nimport { Line } from '../types';\nimport { getStyles } from '../themes';\n\ntype Props = {\n  session: Session;\n  menu: Menu;\n};\ntype State = {\n  query: Line | null;\n};\nexport default class MenuComponent extends React.Component<Props, State> {\n  private updateFn?: () => Promise<void>;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      query: null,\n    };\n  }\n\n  public componentDidMount() {\n    const menu = this.props.menu;\n    this.updateFn = async () => {\n      const query = await menu.session.curLine();\n      this.setState({ query });\n    };\n    this.props.session.on('handledKey', this.updateFn);\n    this.updateFn();\n  }\n\n  public componentWillUnmount() {\n    if (!this.updateFn) {\n      throw new Error('Unmounting before mounting!?');\n    }\n    this.props.session.off('handledKey', this.updateFn);\n  }\n\n  public render() {\n    const menu = this.props.menu;\n    const query = this.state.query;\n    const session = this.props.session;\n\n    const searchBox = (\n      <div className='searchBox' style={{\n        ...getStyles(session.clientStore, ['theme-trim']),\n      }}>\n        <i className='fa fa-search' style={{'marginRight': 10}}/>\n        <span>\n          {\n            (() => {\n              if (query === null) {\n                return <SpinnerComponent/>;\n              } else {\n                return <LineComponent\n                  lineData={query}\n                  cursors={{\n                    [menu.session.cursor.col]: true,\n                  }}\n                  cursorStyle={getStyles(session.clientStore, ['theme-cursor'])}\n                  highlightStyle={getStyles(session.clientStore, ['theme-bg-highlight'])}\n                  linksStyle={getStyles(session.clientStore, ['theme-link'])}\n                  accentStyle={getStyles(session.clientStore, ['theme-text-accent'])}\n                  cursorBetween={true}\n                />;\n              }\n            })()\n          }\n        </span>\n      </div>\n    );\n\n    let searchResults;\n\n    if (menu.results.length === 0) {\n      let message = '';\n      if (!(query && query.length)) {\n        message = 'Type something to search!';\n      } else {\n        message = 'No results!  Try typing something else';\n      }\n      searchResults = (\n        <div style={{fontSize: 20, opacity: 0.5}} className='center'>\n          {message}\n        </div>\n      );\n    } else {\n      searchResults = menu.results.map((result, i) => {\n        const selected = i === menu.selection;\n\n        const renderOptions = result.renderOptions || {};\n        let contents = (\n          <LineComponent key={`line_${i}`}\n            lineData={result.contents}\n            cursorStyle={getStyles(session.clientStore, ['theme-cursor'])}\n            highlightStyle={getStyles(session.clientStore, ['theme-bg-highlight'])}\n            linksStyle={getStyles(session.clientStore, ['theme-link'])}\n            accentStyle={getStyles(session.clientStore, ['theme-text-accent'])}\n            {...renderOptions}\n          />\n        );\n        if (result.renderHook) {\n          contents = result.renderHook(contents);\n        }\n\n        const style = { marginBottom: 10 };\n        if (selected) {\n          Object.assign(style, getStyles(session.clientStore, ['theme-bg-highlight']));\n        }\n        return (\n          <div key={i} style={style}>\n            <i style={{marginRight: 20}}\n              className={`fa ${selected ? 'fa-arrow-circle-right' : 'fa-circle'} bullet`}/>\n            {contents}\n          </div>\n        );\n      });\n    }\n\n    return (\n      <div>\n        {searchBox}\n        {searchResults}\n      </div>\n    );\n  }\n}\n\n","import * as React from 'react';\n\nimport { HotkeyMapping } from '../keyMappings';\nimport { KeyDefinitions, Motion, Action } from '../keyDefinitions';\nimport { getStyles } from '../themes';\nimport { ClientStore } from '../datastore';\n\ntype HotkeysTableProps = {\n  clientStore: ClientStore;\n  keyMap: HotkeyMapping | null;\n  definitions: KeyDefinitions;\n  ignoreEmpty?: boolean;\n};\n\nexport default class HotkeysTableComponent extends React.Component<HotkeysTableProps, {}> {\n  public render() {\n    const keyMap = this.props.keyMap;\n    if (!keyMap) {\n      return <div>No hotkeys!</div>;\n    }\n    const definitions = this.props.definitions;\n    const ignoreEmpty = this.props.ignoreEmpty;\n\n    const actionRows: Array<React.ReactNode> = [];\n    const motionRows: Array<React.ReactNode> = [];\n\n    Object.keys(keyMap).forEach((name) => {\n      const registration = definitions.getRegistration(name);\n      if (registration === null) { return; }\n      const mappings_for_name = keyMap[name];\n      if (mappings_for_name.length === 0 && ignoreEmpty) {\n        return;\n      }\n\n      const cellStyle = { fontSize: 10, border: '1px solid', padding: 5 };\n\n      const el = (\n        <tr key={name}>\n          <td style={cellStyle}>\n            { registration.name }\n            <i className='fa fa-question-circle tooltip'\n               title={registration.description} style={{float: 'right'}}/>\n          </td>\n          <td style={cellStyle}>\n            {\n              mappings_for_name.map((sequence, i) => {\n                return (\n                  <span key={i}>\n                    {\n                      (i > 0)\n                      ? <span key='or'> OR </span>\n                      : null\n                    }\n                    {\n                      sequence.map((key, j) => {\n                        return (\n                          <span key={j}\n                            style={{\n                              ...getStyles(this.props.clientStore, ['theme-trim', 'theme-bg-primary']),\n                              padding: 1,\n                              borderRadius: 3,\n                              margin: 1,\n                            }}\n                          >\n                            {key}\n                          </span>\n                        );\n                      })\n                    }\n                  </span>\n                );\n              })\n            }\n\n          </td>\n        </tr>\n      );\n\n      if (registration instanceof Motion) {\n        motionRows.push(el);\n      } else if (registration instanceof Action) {\n        actionRows.push(el);\n      } else {\n        throw new Error(\n          `Unexpected: unknown registration type for ${registration}`\n        );\n      }\n    });\n\n    return (\n      <div>\n        {\n          (() => {\n            return [\n              {label: 'Motions', rows: motionRows},\n              {label: 'Actions', rows: actionRows},\n            ].map(({label, rows}) => {\n              return [\n                <h5 key={label + '_header'} style={{margin: '5px 10px'}}>\n                  {label}\n                </h5>\n                ,\n                <table key={label + '_table'}\n                  style={{\n                    width: '100%',\n                    ...getStyles(this.props.clientStore, ['theme-bg-secondary'])\n                  }}\n                >\n                  <tbody>\n                    {rows}\n                  </tbody>\n                </table>,\n              ];\n            });\n          })()\n        }\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\n\nimport { PluginsManager, PluginStatus, names as PluginNames, getPlugin } from '../plugins';\nimport { getStyles } from '../themes';\nimport { ClientStore } from '../datastore';\n\ntype Props = {\n  clientStore: ClientStore;\n  pluginManager: PluginsManager;\n};\nexport default class PluginsTableComponent extends React.Component<Props, {}> {\n  public render() {\n    const pluginManager = this.props.pluginManager;\n    return (\n      <table style={{width: '100%', borderCollapse: 'collapse'}}>\n        <thead>\n          <tr>\n            <th style={{\n              ...getStyles(this.props.clientStore, ['theme-trim']),\n            }}>\n              Plugin\n            </th>\n            <th style={{\n              ...getStyles(this.props.clientStore, ['theme-trim']),\n            }}>\n              Description\n            </th>\n            <th style={{\n              ...getStyles(this.props.clientStore, ['theme-trim']),\n              maxWidth: '10%',\n            }}>\n              Version\n            </th>\n            <th style={{\n              ...getStyles(this.props.clientStore, ['theme-trim']),\n              maxWidth: '15%',\n            }}>\n              Author\n            </th>\n            <th style={{\n              ...getStyles(this.props.clientStore, ['theme-trim']),\n              maxWidth: '10%',\n            }}>\n              Status\n            </th>\n            <th style={{\n              ...getStyles(this.props.clientStore, ['theme-trim']),\n              maxWidth: '20%',\n            }}>\n              Actions\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          {\n            PluginNames().map(\n              name => {\n                const status = pluginManager.getStatus(name);\n                const actions: Array<React.ReactNode> = [];\n                let btnClick;\n                let btnText;\n                if (status === PluginStatus.ENABLED) {\n                  btnClick = async () => {\n                    return await pluginManager.disable(name);\n                  };\n                  btnText = 'Disable';\n                } else if (status === PluginStatus.DISABLED) {\n                  btnClick = async () => {\n                    return await pluginManager.enable(name);\n                  };\n                  btnText = 'Enable';\n                }\n                if (btnText) {\n                  actions.push(\n                    <div key={btnText} onClick={btnClick} className='btn'\n                      style={{\n                        ...getStyles(this.props.clientStore, ['theme-trim']),\n                        width: 60\n                      }}\n                    >\n                      {btnText}\n                    </div>\n                  );\n                }\n\n                let color = 'inherit';\n                if (status === PluginStatus.ENABLED) {\n                  color = 'green';\n                } else if (status === PluginStatus.ENABLING ||\n                           status === PluginStatus.DISABLING) {\n                  color = 'yellow';\n                } else if (status === PluginStatus.UNREGISTERED ||\n                           status === PluginStatus.DISABLED) {\n                  color = 'red';\n                }\n\n                let statusText;\n                if (status === PluginStatus.ENABLED) {\n                  statusText = 'Enabled';\n                } else if (status === PluginStatus.ENABLING) {\n                  statusText = 'Enabling';\n                } else if (status === PluginStatus.DISABLED) {\n                  statusText = 'Disabled';\n                } else if (status === PluginStatus.DISABLING) {\n                  statusText = 'Disabling';\n                } else if (status === PluginStatus.UNREGISTERED) {\n                  statusText = 'Unregistered';\n                }\n\n                const plugin = getPlugin(name) || {};\n                const tdStyle = { padding: 5};\n                return (\n                  <tr key={name}\n                      style={{\n                        ...getStyles(this.props.clientStore, ['theme-bg-secondary'])\n                      }}\n                  >\n                    <td className='center plugin-name'\n                      style={{\n                        ...getStyles(this.props.clientStore, ['theme-trim']),\n                        ...tdStyle,\n                      }}\n                    >\n                      { name }\n                    </td>\n                    <td\n                      style={{\n                        ...getStyles(this.props.clientStore, ['theme-trim']),\n                        ...tdStyle,\n                        fontSize: 12\n                      }}\n                    >\n                      { plugin.description || '' }\n                    </td>\n                    <td className='center'\n                      style={{\n                        ...getStyles(this.props.clientStore, ['theme-trim']),\n                        ...tdStyle\n                      }}\n                    >\n                      { (plugin.version || '') + '' }\n                    </td>\n                    <td className='center'\n                      style={{\n                        ...getStyles(this.props.clientStore, ['theme-trim']),\n                        ...tdStyle,\n                        fontSize: 12\n                      }}\n                    >\n                      { plugin.author || '' }\n                    </td>\n                    <td className='center'\n                      style={{\n                        ...getStyles(this.props.clientStore, ['theme-trim']),\n                        ...tdStyle,\n                       boxShadow: `inset 0px 0px 0px 2px ${color}`\n                      }}\n                    >\n                      {statusText}\n                    </td>\n                    <td className='center'\n                      style={{\n                        ...getStyles(this.props.clientStore, ['theme-trim']),\n                        ...tdStyle,\n                      }}\n                    >\n                      {actions}\n                    </td>\n                  </tr>\n                );\n              }\n            )\n          }\n        </tbody>\n      </table>\n    );\n  }\n}\n","import * as React from 'react';\n\nimport { BackendType } from '../../data_backend';\nimport { ClientStore } from '../../datastore';\nimport { getStyles } from '../../themes';\n\ntype Props = {\n  clientStore: ClientStore;\n  initialBackendType: BackendType;\n};\ntype State = {\n  backendType: BackendType,\n  firebaseId: string,\n  firebaseApiKey: string,\n  firebaseUserEmail: string,\n  firebaseUserPassword: string,\n  socketServerHost: string,\n  socketServerPassword: string,\n  socketServerDocument: string,\n};\nexport default class BackendSettingsComponent extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const clientStore = props.clientStore;\n    this.state = {\n      backendType: props.initialBackendType,\n      firebaseId: clientStore.getDocSetting('firebaseId') || '',\n      firebaseApiKey: clientStore.getDocSetting('firebaseApiKey') || '',\n      firebaseUserEmail: clientStore.getDocSetting('firebaseUserEmail') || '',\n      firebaseUserPassword: clientStore.getDocSetting('firebaseUserPassword') || '',\n      socketServerHost: clientStore.getDocSetting('socketServerHost') || '',\n      socketServerPassword: clientStore.getDocSetting('socketServerPassword') || '',\n      socketServerDocument: clientStore.getDocSetting('socketServerDocument') || '',\n    };\n  }\n\n  private async saveDataSettings() {\n    const clientStore = this.props.clientStore;\n    const backendType = this.state.backendType;\n    clientStore.setDocSetting('dataSource', backendType);\n    if (backendType === 'firebase') {\n      clientStore.setDocSetting('firebaseId', this.state.firebaseId);\n      clientStore.setDocSetting('firebaseApiKey', this.state.firebaseApiKey);\n      clientStore.setDocSetting('firebaseUserEmail', this.state.firebaseUserEmail);\n      clientStore.setDocSetting('firebaseUserPassword', this.state.firebaseUserPassword);\n    } else if (backendType === 'socketserver') {\n      clientStore.setDocSetting('socketServerHost', this.state.socketServerHost);\n      clientStore.setDocSetting('socketServerPassword', this.state.socketServerPassword);\n      clientStore.setDocSetting('socketServerDocument', this.state.socketServerDocument);\n    }\n    window.location.reload();\n  }\n\n  private setBackendType(backendType: BackendType) {\n    this.setState({ backendType } as State);\n  }\n\n  private setFirebaseId(firebaseId: string) {\n    this.setState({ firebaseId } as State);\n  }\n\n  private setFirebaseApiKey(firebaseApiKey: string) {\n    this.setState({ firebaseApiKey } as State);\n  }\n\n  private setFirebaseUserEmail(firebaseUserEmail: string) {\n    this.setState({ firebaseUserEmail } as State);\n  }\n\n  private setFirebaseUserPassword(firebaseUserPassword: string) {\n    this.setState({ firebaseUserPassword } as State);\n  }\n\n  private setSocketServerHost(socketServerHost: string) {\n    this.setState({ socketServerHost } as State);\n  }\n\n  private setSocketServerPassword(socketServerPassword: string) {\n    this.setState({ socketServerPassword } as State);\n  }\n\n  private setSocketServerDocument(socketServerDocument: string) {\n    this.setState({ socketServerDocument } as State);\n  }\n\n  public render() {\n    const firebaseBaseUrl = `https://console.firebase.google.com/project/${this.state.firebaseId || '${firebaseProjectId}'}`;\n\n    const backendTypes: Array<{\n      name: string,\n      type: 'Remote' | 'Local',\n      value: BackendType,\n      info: React.ReactElement<any> | string,\n      config?: React.ReactElement<any>,\n    }> = [\n      {\n        name: 'HTML5 Local Storage (default)',\n        type: 'Local',\n        value: 'local',\n        info: `\n          Stores data on your computer, through standard browser APIs.\n          No backups, so you should export regularly.\n          Clearing local storage will result in data loss.\n        `,\n      },\n      {\n        name: 'In-memory',\n        type: 'Local',\n        value: 'inmemory',\n        info: `\n          Not saved at all!\n          Data loss as soon as you close the tab.\n          Good for testing with complete throw-away data.\n        `,\n      },\n      {\n        name: 'Firebase',\n        type: 'Remote',\n        value: 'firebase',\n        info: (\n          <div>\n            Stores data in Google's Firebase cloud service.\n            Regular backups can be turned on.\n            {' '}\n            <a href={'https://github.com/WuTheFWasThat/vimflowy/tree/master/docs/storage/Firebase.md'}>\n              Details here\n            </a>.\n          </div>\n        ),\n        config: (\n          <div>\n            For details on configuration, <a href={'https://github.com/WuTheFWasThat/vimflowy/tree/master/docs/storage/firebase.md'}>\n              see here\n            </a>.\n            <br/>\n            <table><tbody>\n              <tr>\n                <td>\n                  Firebase ID\n                </td>\n                <td>\n                  <input type='text'\n                    value={this.state.firebaseId}\n                    placeholder='e.g. something-fiery-2222'\n                    onChange={(ev) => this.setFirebaseId((ev.target as HTMLInputElement).value)}\n                    style={{float: 'right'}}\n                  />\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  Firebase API Key\n                  (found {' '}\n                  <a href={`${firebaseBaseUrl}/settings/general/`}>\n                    here\n                  </a>\n                  )\n                </td>\n                <td>\n                  <input type='text'\n                    value={this.state.firebaseApiKey}\n                    placeholder='should be a long string of alphanumeric digits and dashes'\n                    onChange={(ev) => this.setFirebaseApiKey((ev.target as HTMLInputElement).value)}\n                    style={{float: 'right'}}\n                  />\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  Firebase User Email\n                  (added {' '}\n                  <a href={`${firebaseBaseUrl}/authentication/users`}>\n                    here\n                  </a>\n                  )\n                </td>\n                <td>\n                  <input type='text'\n                    value={this.state.firebaseUserEmail}\n                    onChange={(ev) => this.setFirebaseUserEmail((ev.target as HTMLInputElement).value)}\n                    style={{float: 'right'}}\n                  />\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  Firebase User Password\n                </td>\n                <td>\n                  <input type='password'\n                    value={this.state.firebaseUserPassword}\n                    onChange={(ev) => this.setFirebaseUserPassword((ev.target as HTMLInputElement).value)}\n                    style={{float: 'right'}}\n                  />\n                </td>\n              </tr>\n            </tbody></table>\n            <br/>\n          </div>\n        ),\n      },\n      {\n        name: 'Vimflowy server',\n        type: 'Remote',\n        value: 'socketserver',\n        info: `\n          Client talks to a server over websockets.\n          Server stores data in SQLite.\n        `,\n        config: (\n          <div>\n            For details on configuration, <a href={'https://github.com/WuTheFWasThat/vimflowy/tree/master/docs/storage/socket_server.md'}>\n              see here\n            </a>.\n            <br/>\n            <table><tbody>\n              <tr>\n                <td>\n                  Server\n                </td>\n                <td>\n                  <input type='text'\n                    value={this.state.socketServerHost}\n                    placeholder='e.g. ws://localhost:3000 or wss://54.0.0.1:3000'\n                    onChange={(ev) => this.setSocketServerHost((ev.target as HTMLInputElement).value)}\n                    style={{float: 'right'}}\n                  />\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  Password\n                </td>\n                <td>\n                  <input type='password'\n                    value={this.state.socketServerPassword}\n                    onChange={(ev) => this.setSocketServerPassword((ev.target as HTMLInputElement).value)}\n                    style={{float: 'right'}}\n                  />\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  Document\n                </td>\n                <td>\n                  <input type='text'\n                    value={this.state.socketServerDocument}\n                    onChange={(ev) => this.setSocketServerDocument((ev.target as HTMLInputElement).value)}\n                    style={{float: 'right'}}\n                  />\n                </td>\n              </tr>\n            </tbody></table>\n            <br/>\n          </div>\n        ),\n      },\n    ];\n\n    return (\n      <div>\n        <div style={{marginBottom: 10}}>\n          <b> Local </b> data sources:\n          <ul>\n            <li>\n              Offline access supported\n            </li>\n            <li>\n              Data is never sent over the internet\n            </li>\n            <li>\n              Can only be accessed from this browser\n            </li>\n          </ul>\n        </div>\n        <div style={{marginBottom: 10}}>\n          <b> Remote </b> data sources:\n          <ul>\n            <li>\n              Can be accessed from multiple devices or browsers\n            </li>\n            <li>\n              No offline support\n            </li>\n          </ul>\n        </div>\n\n        <table style={{width: '100%', borderCollapse: 'collapse'}}>\n          <thead>\n            <tr>\n              <th></th>\n              <th style={{\n                padding: 10,\n                ...getStyles(this.props.clientStore, ['theme-trim'])\n              }}>\n                Storage Type\n              </th>\n              <th style={{\n                padding: 10,\n                ...getStyles(this.props.clientStore, ['theme-trim'])\n              }}>\n                Local/Remote\n              </th>\n              <th style={{\n                padding: 10,\n                ...getStyles(this.props.clientStore, ['theme-trim'])\n              }}>\n                Info\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            { (() => {\n              const rows: Array<React.ReactElement<any>> = [];\n              backendTypes.forEach((backendTypeInfo) => {\n                const selected = this.state.backendType === backendTypeInfo.value;\n                rows.push(\n                  <tr key={backendTypeInfo.value}>\n                    <td style={{padding: 10}}>\n                      <input type='radio' name='backendType'\n                        value={backendTypeInfo.value} checked={selected} readOnly\n                        onClick={(ev) => this.setBackendType((ev.target as HTMLInputElement).value as BackendType)}\n                      />\n                    </td>\n                    <td style={{padding: 10}}>\n                      <b>{backendTypeInfo.name}</b>\n                    </td>\n                    <td style={{padding: 10}}>\n                      {backendTypeInfo.type}\n                    </td>\n                    <td style={{padding: 10}}>\n                      {backendTypeInfo.info}\n                    </td>\n                  </tr>\n                );\n\n                if (selected && backendTypeInfo.config) {\n                  rows.push(\n                    <tr key='selected'>\n                      <td></td>\n                      <td colSpan={999}>\n                        {backendTypeInfo.config}\n                      </td>\n                    </tr>\n                  );\n                }\n              });\n              return rows;\n            })() }\n          </tbody>\n        </table>\n\n        <div className='btn'\n          style={{\n            ...getStyles(this.props.clientStore, ['theme-bg-tertiary', 'theme-trim'])\n          }}\n          onClick={() => this.saveDataSettings()} >\n          Load Data Settings\n        </div>\n        <h5 style={{display: 'inline-block'}}>\n        (WARNING: will reload page)\n        </h5>\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\nimport $ from 'jquery';\n\ntype Props = {\n  onSelect?: (filename: string) => void;\n  onLoad?: (filename: string, contents: string) => void;\n  onError?: (error: string) => void;\n  style?: React.CSSProperties;\n};\n\nexport const load_file = function(file: File): Promise<{name: string, contents: string}> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsText(file, 'UTF-8');\n    reader.onload = function(evt) {\n      const content = (evt.target as any).result;\n      return resolve({\n        name: file.name,\n        contents: content,\n      });\n    };\n    reader.onerror = function(err) {\n      reject(`Failed to reading file: ${err}`);\n    };\n  });\n};\n\nexport default class FileInput extends React.Component<Props, {}> {\n  private id: string;\n\n  constructor(props: Props) {\n    super(props);\n    this.id = `fileinput.${Math.random()}`;\n  }\n\n  private handleChange(e: React.FormEvent<HTMLInputElement>) {\n    // TODO: what is the right type here?\n    const file = (e.target as any).files[0];\n    if (!file) { return; } // do nothing, they canceled\n\n    if (this.props.onSelect) {\n      this.props.onSelect(file.name);\n    }\n    load_file(file).then(({ name, contents }) => {\n      if (this.props.onLoad) {\n        this.props.onLoad(name, contents);\n      }\n      $(`#${this.id}`).val('');\n    }).catch((err: string) => {\n      if (this.props.onError) {\n        this.props.onError(err);\n      }\n      $(`#${this.id}`).val('');\n    });\n  }\n\n  public render() {\n    return (\n      <div\n        style={this.props.style || {position: 'relative'}}\n      >\n        <input type='file' id={this.id}\n          style={{\n            position: 'absolute',\n            opacity: 0,\n            width: '100%', height: '100%',\n            zIndex: 1,\n            cursor: 'pointer',\n          }}\n          onChange={(e) => this.handleChange(e)}\n        />\n\n        {this.props.children}\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\n\nimport { ClientStore } from '../../datastore';\n\ntype Props = {\n  clientStore: ClientStore;\n};\n\ntype State = {\n  copyToClipboard: boolean;\n  formattedCopy: boolean;\n};\n\nexport default class BehaviorSettingsComponent extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const clientStore = props.clientStore;\n    this.state = {\n      copyToClipboard: clientStore.getClientSetting('copyToClipboard'),\n      formattedCopy: clientStore.getClientSetting('formattedCopy'),\n    };\n    this.setCopyToClipboard = this.setCopyToClipboard.bind(this);\n    this.setFormattedCopy = this.setFormattedCopy.bind(this);\n  }\n\n  private setCopyToClipboard(copyToClipboard: boolean): boolean {\n    this.setState({ copyToClipboard: copyToClipboard });\n    this.props.clientStore.setClientSetting('copyToClipboard', copyToClipboard);\n    return this.state.copyToClipboard;\n  }\n\n  private setFormattedCopy(formattedCopy: boolean): boolean {\n    this.setState({ formattedCopy: formattedCopy });\n    this.props.clientStore.setClientSetting('formattedCopy', formattedCopy);\n    return this.state.formattedCopy;\n  }\n\n  public render() {\n    return (\n      <div style={{ fontSize: '1.3em' }}>\n        <SettingsCheckbox id={'copyToClipboard'}\n          fn={this.setCopyToClipboard}\n          checked={this.state.copyToClipboard}\n          name='Copy to system clipboard'\n          desc='copy yanked text to system clipboard'\n        />\n        <SettingsCheckbox id={'formattedCopy'}\n          fn={this.setFormattedCopy}\n          checked={this.state.formattedCopy}\n          name='Formatted block copy'\n          desc='format with indents and hyphens when copying bullets with children to system clipboard'\n        />\n      </div>\n    );\n  }\n}\n\ninterface SettingsCheckboxProps {\n  id: string;\n  name: string;\n  desc: string;\n  fn: (val: boolean) => void;\n  checked: boolean;\n}\n\nclass SettingsCheckbox extends React.Component<SettingsCheckboxProps, {}> {\n  constructor(props: SettingsCheckboxProps) {\n    super(props);\n  }\n\n  public render() {\n    return (\n      <div style={{ fontSize: '0.9em', marginBottom: '0.3em' }}>\n        <input type='checkbox' id={this.props.id} checked={this.props.checked} onChange={(e) => {\n          this.props.fn(e.target.checked);\n        }} />\n        <label htmlFor={this.props.id} style={{ marginLeft: '0.5rem' }}>\n          {this.props.name + ' - '}\n          <span style={{ fontSize: '0.9em' }}>{this.props.desc}</span>\n        </label>\n      </div>\n    );\n  }\n}\n","import * as React from 'react';\n\nimport * as browser_utils from '../utils/browser';\nimport * as errors from '../../../shared/utils/errors';\nimport * as Modes from '../modes';\nimport { BackendType } from '../data_backend';\nimport { PluginsManager } from '../plugins';\nimport Session from '../session';\nimport Config from '../config';\nimport KeyBindings from '../keyBindings';\nimport { getStyles } from '../themes';\n\nimport SettingsComponent from './settings';\nimport SessionComponent from './session';\nimport MenuComponent from './menu';\nimport HotkeysTableComponent from './hotkeysTable';\n\nexport type TextMessage = { message?: string, text_class?: string };\n\ntype Props = {\n  pluginManager: PluginsManager;\n  session: Session;\n  config: Config;\n  message: TextMessage | null;\n  saveMessage: TextMessage | null;\n  showingKeyBindings: boolean;\n  keyBindings: KeyBindings;\n  initialBackendType: BackendType;\n  error: Error | null;\n};\n\nexport default class AppComponent extends React.Component<Props, {}> {\n  public render() {\n    if (this.props.error !== null) {\n      const wasExpected = this.props.error instanceof errors.ExpectedError;\n\n      let message;\n      if (wasExpected) {\n        message = (\n          <div>\n            {this.props.error.message}\n          </div>\n        );\n      } else {\n        message = (\n          <div>\n            An unexpected error was caught!\n            <br/>\n            <br/>\n            Please help out Vimflowy and report the bug.\n            Report the issue {' '}\n            <a href='https://github.com/WuTheFWasThat/vimflowy/issues/new'>\n              here\n            </a>\n            {' '} with:\n            <ul>\n              <li>\n                a description of what you did\n              </li>\n              <li>\n                a copy of the Javascript console output (ideally, but be careful if data privacy is important)\n              </li>\n              <li>\n                a copy of the following error message\n              </li>\n            </ul>\n            <h3>\n              Error:\n            </h3>\n            <pre style={{marginLeft: 20}}>\n              {this.props.error.message}\n              <br/>\n              <br/>\n              {this.props.error.stack}\n            </pre>\n            <br/>\n            Refresh the page to continue.\n          </div>\n        );\n      }\n\n      return (\n        <div style={{padding: 50}}>\n          {message}\n        </div>\n      );\n    }\n    const pluginManager = this.props.pluginManager;\n    const session = this.props.session;\n    const keyBindings = this.props.keyBindings;\n    const settingsMode = session.mode === 'SETTINGS';\n    const userMessage: TextMessage = this.props.message || {};\n    const saveMessage: TextMessage = this.props.saveMessage || {};\n\n    return (\n      <div style={{\n          ...getStyles(session.clientStore, ['theme-text-primary'])\n      }}>\n        {/* hack for firefox paste */}\n        <div id='paste-hack' contentEditable={true} className='offscreen'>\n        </div>\n\n        <div id='contents' style={{\n          ...getStyles(session.clientStore, ['theme-bg-primary'])\n        }}>\n          <div id='menu'\n            className={session.mode === 'SEARCH' ? '' : 'hidden'}\n          >\n            {\n              (() => {\n                if (session.menu) {\n                  return <MenuComponent menu={session.menu} session={session}/>;\n                }\n                return null;\n              })()\n            }\n          </div>\n\n          <div id='view'\n            style={{\n              flex: '1 1 auto', fontSize: 10,\n              ...getStyles(session.clientStore, ['theme-bg-primary'])\n            }}\n            className={session.mode === 'SEARCH' ? ' hidden' : ''}\n          >\n            {/* NOTE: maybe always showing session would be nice?\n              * Mostly works to never have 'hidden',\n              * but would be cool if it mirrored selected search result\n              */}\n              <SessionComponent\n                session={session}\n              />\n            </div>\n\n            <div\n              className='transition-ease-width'\n              style={{\n                overflowY: 'auto',\n                height: '100%',\n                flex: '0 1 auto',\n                position: 'relative',\n                width: this.props.showingKeyBindings ? 500 : '0%',\n                ...getStyles(session.clientStore, ['theme-bg-secondary'])\n              }}\n            >\n              <HotkeysTableComponent\n                clientStore={session.clientStore}\n                keyMap={keyBindings.mappings.mappings[session.mode]}\n                definitions={keyBindings.definitions}\n                ignoreEmpty={true}\n              />\n            </div>\n          </div>\n\n          <div id='settings' className={settingsMode ? '' : 'hidden'}\n            style={{\n              ...getStyles(session.clientStore, ['theme-bg-primary'])\n            }}>\n\n            <SettingsComponent\n              session={session}\n              config={this.props.config}\n              keyBindings={keyBindings}\n              pluginManager={pluginManager}\n              initialBackendType={this.props.initialBackendType}\n              rerenderAll={() => {\n                // TODO: this doesn't actually update everything.. use a better way to do this?\n                // See: https://github.com/facebook/react/issues/3038\n                // Maybe could do session.document.cache.clear(), but that's inefficient\n                this.forceUpdate();\n              }}\n              onExport={() => {\n                const filename = 'vimflowy_hotkeys.json';\n                const content = JSON.stringify(keyBindings.mappings.serialize(), null, 2);\n                browser_utils.downloadFile(filename, content, 'application/json');\n                session.showMessage(`Downloaded hotkeys to ${filename}!`, {text_class: 'success'});\n              }}\n            />\n          </div>\n\n          <div id='bottom-bar'\n            style={{\n              display: 'flex',\n              ...getStyles(session.clientStore, ['theme-bg-primary', 'theme-trim'])\n            }}>\n            <a className='center'\n              onClick={async () => {\n                await session.setMode(settingsMode ? 'NORMAL' : 'SETTINGS');\n              }}\n              style={{\n                flexBasis: 100, flexGrow: 0,\n                cursor: 'pointer', textDecoration: 'none',\n                ...getStyles(session.clientStore, ['theme-bg-secondary'])\n              }}\n            >\n              <div>\n                <span style={{marginRight: 10}}\n                  className={`fa ${settingsMode ? 'fa-arrow-left' : 'fa-cog'}`}>\n                </span>\n                <span>{settingsMode ? 'Back' : 'Settings'}</span>\n              </div>\n            </a>\n            <div style={{flexBasis: 0, flexGrow: 1, overflowX: 'hidden'}}\n              className={userMessage.text_class}>\n              {userMessage.message}\n            </div>\n            <div style={{flexBasis: 0, flexGrow: 0}}\n              className={saveMessage.text_class}>\n              {saveMessage.message}\n            </div>\n            {/* should be wide enough to fit the words 'VISUAL LINE'*/}\n            <div className='center'\n              style={{\n                flexBasis: 80, flexGrow: 0,\n                ...getStyles(session.clientStore, ['theme-bg-secondary'])\n              }}\n            >\n              {Modes.getMode(session.mode).name}\n            </div>\n          </div>\n        </div>\n    );\n  }\n}\n","/*\nInitialize the main page.  Rather messy logic for a bunch of stuff:\n- handle button clicks (import/export/hotkey stuff)\n- handle clipboard paste\n- handle errors\n- load document from localStorage (fall back to plain in-memory datastructures)\n- initialize objects (session, etc.)\n- handle rendering logic\n*/\n\nimport $ from 'jquery';\nimport * as React from 'react'; // tslint:disable-line no-unused-variable\nimport * as ReactDOM from 'react-dom';\n\nimport 'font-awesome/css/font-awesome.min.css';\nimport '../css/utils.sass';\nimport '../css/index.sass';\nimport '../css/view.sass';\n\nimport * as browser_utils from './utils/browser';\nimport * as errors from '../../shared/utils/errors';\nimport logger from '../../shared/utils/logger';\n\nimport { SerializedBlock } from './types';\nimport * as Modes from './modes';\nimport { RegisterTypes } from './register';\nimport KeyEmitter from './keyEmitter';\nimport KeyHandler from './keyHandler';\nimport KeyMappings from './keyMappings';\nimport { ClientStore, DocumentStore } from './datastore';\nimport { SynchronousInMemory, InMemory } from '../../shared/data_backend';\nimport {\n  BackendType, SynchronousLocalStorageBackend,\n  LocalStorageBackend, FirebaseBackend, ClientSocketBackend\n} from './data_backend';\nimport Document from './document';\nimport { PluginsManager } from './plugins';\nimport Path from './path';\nimport Session from './session';\nimport Config from './config';\nimport vimConfig from './configurations/vim';\nimport { SERVER_CONFIG } from './constants';\n\nimport keyDefinitions from './keyDefinitions';\n// load actual definitions\nimport './definitions';\n// load all plugins\nimport '../../plugins';\nimport KeyBindings from './keyBindings';\n\nimport AppComponent, { TextMessage } from './components/app';\n\ndeclare const window: any; // because we attach globals for debugging\n\nconst appEl = $('#app')[0];\n\nReactDOM.render(\n  <div style={{\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: '100%',\n  }}>\n    <div style={{ flexGrow: 3 }}/>\n    <div style={{\n      textAlign: 'center',\n      alignSelf: 'center',\n      color: '#999',\n    }}>\n      <i className='fa fa-5x fa-spin fa-spinner'/>\n      <p>Loading... this can take a minute the first time</p>\n    </div>\n    <div style={{ flexGrow: 8 }}/>\n  </div>,\n  appEl\n);\n\n$(document).ready(async () => {\n  let docname: string = browser_utils.getParameterByName('doc') || '';\n  if (docname !== '') { document.title = `${docname} - Vimflowy`; }\n\n  // random global state.  these things should be managed by redux maybe\n  let caughtErr: null | Error = null;\n  let userMessage: null | TextMessage = null;\n  let saveMessage: null | TextMessage = null;\n\n  window.onerror = function(msg: string, url: string, line: number, _col: number, err: Error) {\n    logger.error(`Caught error: '${msg}' from  ${url}:${line}`);\n    if (err) {\n      logger.error('Error: ', msg, err, err.stack, JSON.stringify(err));\n      caughtErr = err;\n    } else {\n      logger.error('Error: ', msg, JSON.stringify(msg));\n      caughtErr = new Error(msg);\n    }\n    renderMain(); // fire and forget\n  };\n\n  const noLocalStorage = (typeof localStorage === 'undefined' || localStorage === null);\n  let clientStore: ClientStore;\n  let docStore: DocumentStore;\n  let backend_type: BackendType;\n  let doc;\n\n  // TODO: consider using modernizr for feature detection\n  // probably also want to check flexbox support\n  if (noLocalStorage) {\n    alert('You need local storage support for data to be persisted!');\n    clientStore = new ClientStore(new SynchronousInMemory());\n    backend_type = 'inmemory';\n  } else {\n    clientStore = new ClientStore(new SynchronousLocalStorageBackend(), docname);\n    if (SERVER_CONFIG.socketserver) {\n      backend_type = 'socketserver';\n    } else {\n      backend_type = clientStore.getDocSetting('dataSource');\n    }\n  }\n\n  const config: Config = vimConfig;\n\n  function getLocalStore(): DocumentStore {\n     return new DocumentStore(new LocalStorageBackend(docname), docname);\n  }\n\n  async function getFirebaseStore(): Promise<DocumentStore> {\n    const firebaseId = clientStore.getDocSetting('firebaseId');\n    const firebaseApiKey = clientStore.getDocSetting('firebaseApiKey');\n    const firebaseUserEmail = clientStore.getDocSetting('firebaseUserEmail');\n    const firebaseUserPassword = clientStore.getDocSetting('firebaseUserPassword');\n\n    if (!firebaseId) {\n      throw new Error('No firebase ID found');\n    }\n    if (!firebaseApiKey) {\n      throw new Error('No firebase API key found');\n    }\n    const fb_backend = new FirebaseBackend(docname, firebaseId, firebaseApiKey);\n    const dStore = new DocumentStore(fb_backend, docname);\n    await fb_backend.init(firebaseUserEmail || '', firebaseUserPassword || '');\n\n    logger.info(`Successfully initialized firebase connection: ${firebaseId}`);\n    return dStore;\n  }\n\n  async function getSocketServerStore(): Promise<DocumentStore> {\n    let socketServerHost;\n    let socketServerDocument;\n    let socketServerPassword;\n    if (SERVER_CONFIG.socketserver) { // server is fixed!\n      socketServerHost = window.location.origin.replace(/^http/, 'ws');\n      socketServerDocument = docname;\n      socketServerPassword = clientStore.getDocSetting('socketServerPassword');\n    } else {\n      socketServerHost = clientStore.getDocSetting('socketServerHost');\n      socketServerDocument = clientStore.getDocSetting('socketServerDocument');\n      socketServerPassword = clientStore.getDocSetting('socketServerPassword');\n    }\n\n    if (!socketServerHost) {\n      throw new Error('No socket server host found');\n    }\n    const socket_backend = new ClientSocketBackend();\n    // NOTE: we don't pass docname to DocumentStore since we want keys\n    // to not have prefixes\n    const dStore = new DocumentStore(socket_backend);\n    while (true) {\n      try {\n        await socket_backend.init(\n          socketServerHost, socketServerPassword || '', socketServerDocument || '');\n        break;\n      } catch (e) {\n        if (e === 'Wrong password!') {\n          socketServerPassword = prompt(\n            socketServerPassword ?\n              'Password incorrect!  Please try again: ' :\n              'Please enter the password',\n            '');\n        } else {\n          throw e;\n        }\n      }\n    }\n    clientStore.setDocSetting('socketServerPassword', socketServerPassword);\n    logger.info(`Successfully initialized socked connection: ${socketServerHost}`);\n    return dStore;\n  }\n\n  if (backend_type === 'firebase') {\n    try {\n      docStore = await getFirebaseStore();\n    } catch (e) {\n      alert(`\n        Error loading firebase datastore:\n\n        ${e.message}\n\n        ${e.stack}\n\n        Falling back to localStorage default.\n      `);\n\n      docStore = getLocalStore();\n      backend_type = 'local';\n    }\n  } else if (backend_type === 'inmemory') {\n    docStore = new DocumentStore(new InMemory());\n  } else if (backend_type === 'socketserver') {\n    try {\n      docStore = await getSocketServerStore();\n    } catch (e) {\n      alert(`\n        Error loading socket server datastore:\n\n        ${e.message}\n\n        ${e.stack}\n\n        Falling back to localStorage default.\n      `);\n\n      clientStore.setDocSetting('socketServerPassword', '');\n      docStore = getLocalStore();\n      backend_type = 'local';\n    }\n  } else {\n    docStore = getLocalStore();\n    backend_type = 'local';\n  }\n\n  doc = new Document(docStore, docname);\n\n  let to_load: any = null;\n  if ((await docStore.getChildren(Path.rootRow())).length === 0) {\n    to_load = config.getDefaultData();\n  }\n\n  let showingKeyBindings = clientStore.getClientSetting('showKeyBindings');\n\n  doc.store.events.on('saved', () => {\n    saveMessage = { message: 'Saved!', text_class: 'text-success' };\n    renderMain(); // fire and forget\n  });\n  doc.store.events.on('unsaved', () => {\n    saveMessage = { message: 'Saving....', text_class: 'text-error' };\n    renderMain(); // fire and forget\n  });\n\n  // hotkeys and key bindings\n  const saved_mappings = clientStore.getClientSetting('hotkeys');\n  const mappings = KeyMappings.merge(config.defaultMappings, new KeyMappings(saved_mappings));\n  const keyBindings = new KeyBindings(keyDefinitions, mappings);\n\n  // session\n  if (!await doc.hasChildren(doc.root.row)) {\n    // HACKY: should load the actual data now, but since plugins aren't enabled...\n    await doc.loadEmpty();\n  }\n\n  let viewRoot;\n  if (window.location.hash.length > 1) {\n    try {\n      const row = parseInt(window.location.hash.slice(1), 10);\n      if (await doc.isAttached(row)) {\n        viewRoot = await doc.canonicalPath(row);\n      }\n    } catch (e) {\n      logger.error(`Invalid hash: ${window.location.hash}`);\n    }\n  }\n  if (!viewRoot) {\n    viewRoot = Path.loadFromAncestry(await clientStore.getLastViewRoot());\n  }\n  let cursorPath;\n  if (viewRoot.isRoot() || !await doc.isValidPath(viewRoot)) {\n    viewRoot = Path.root();\n    cursorPath = (await doc.getChildren(viewRoot))[0];\n    window.location.hash = '';\n  } else {\n    cursorPath = viewRoot;\n  }\n\n  function getLineHeight() {\n    const line_height = $('.node-text').height() || 21;\n    errors.assert(line_height > 0);\n    return line_height;\n  }\n\n  const session = new Session(clientStore, doc, {\n    viewRoot: viewRoot,\n    cursorPath: cursorPath,\n    showMessage: (() => {\n      let messageDivTimeout: null | number = null;\n      return (message: string, options: {time?: number, text_class?: string} = {}) => {\n        const { time = 5000, text_class = '' } = options;\n\n        logger.info(`Showing message: ${message}`);\n\n        userMessage = {\n          message,\n          text_class: text_class ? 'text-' + text_class : '',\n        };\n        renderMain(); // fire and forget\n\n        if (messageDivTimeout !== null) {\n          clearTimeout(messageDivTimeout);\n        }\n\n        if (time !== 0) {\n          messageDivTimeout = window.setTimeout(() => {\n            userMessage = null;\n            renderMain(); // fire and forget\n          }, time);\n        }\n      };\n    })(),\n    toggleBindingsDiv: () => {\n      showingKeyBindings = !showingKeyBindings;\n      clientStore.setClientSetting('showKeyBindings', showingKeyBindings);\n      renderMain(); // fire and forget\n    },\n    getLinesPerPage: () => {\n      const line_height = getLineHeight();\n      const page_height = $(document).height() as number;\n      return page_height / line_height;\n    },\n  });\n\n  // load plugins\n\n  const pluginManager = new PluginsManager(session, config, keyBindings);\n  let enabledPlugins = await docStore.getSetting('enabledPlugins');\n  if (typeof enabledPlugins.slice === 'undefined') { // for backwards compatibility\n    enabledPlugins = Object.keys(enabledPlugins);\n  }\n  for (let i = 0; i < enabledPlugins.length; i++) {\n    const plugin_name = enabledPlugins[i];\n    await pluginManager.enable(plugin_name);\n  }\n\n  // load data\n  if (to_load !== null) {\n    await doc.load(to_load);\n    // a bit hacky.  without this, you can undo initial marks, for example\n    session.cursor.setPosition(\n      (await doc.getChildren(viewRoot))[0], 0\n    );\n    session.reset_history();\n    session.reset_jump_history();\n    await renderMain();\n  }\n\n  const keyHandler = new KeyHandler(session, keyBindings);\n  const keyEmitter = new KeyEmitter();\n\n  // expose globals, for debugging\n  window.Modes = Modes;\n  window.session = session;\n  window.logger = logger;\n  window.keyHandler = keyHandler;\n  window.keyEmitter = keyEmitter;\n  window.keyBindings = keyBindings;\n\n  async function renderMain() {\n    await new Promise((resolve) => {\n      ReactDOM.render(\n        <AppComponent\n          error={caughtErr}\n          message={userMessage}\n          saveMessage={saveMessage}\n          config={config}\n          session={session}\n          pluginManager={pluginManager}\n          showingKeyBindings={showingKeyBindings}\n          keyBindings={keyBindings}\n          initialBackendType={backend_type}\n        /> as any, // TODO\n        appEl,\n        resolve as any // TODO\n      );\n    });\n\n    const cursorDiv = $('#view .cursor')[0];\n    if (cursorDiv) {\n      browser_utils.scrollIntoView(cursorDiv, $('#view'), 50);\n    }\n  }\n  window.renderMain = renderMain;\n\n  await renderMain();\n\n  session.on('scroll', (numlines) => {\n    const line_height = getLineHeight();\n    browser_utils.scrollDiv($('#view'), line_height * numlines);\n  });\n\n  session.on('yank', (info) => {\n    if (clientStore.getClientSetting('copyToClipboard')) {\n      let content: string, richContent: string;\n      if (info.type === RegisterTypes.CHARS) {\n        content = info.saved.join('');\n        richContent = info.saved.join('');\n      } else if (info.type === RegisterTypes.SERIALIZED_ROWS) {\n        const formatted = clientStore.getClientSetting('formattedCopy');\n        const contents: Array<string> = [];\n        const richContents: Array<string> = ['<ul>'];\n        const cache: {[id: number]: SerializedBlock} = {};\n        const recurse = (p: any, depth: number) => {\n          if (typeof p === 'string') { throw new Error('Expected non-pretty serialization');\n          } else if (p.clone) { p = cache[p.clone];\n          } else { cache[p.id] = p; } // in case it's cloned\n\n          if (formatted) { contents.push(' '.repeat(depth * 4) + (p.collapsed ? '+ ' : '- ') + p.text);\n          } else { contents.push(p.text); }\n          richContents.push('<li>' + p.text + '</li>');\n\n          if (p.collapsed || !p.children) { return; }\n          richContents.push('<ul>');\n          p.children.forEach((child: SerializedBlock) => recurse(child, depth + 1));\n          richContents.push('</ul>');\n        };\n        info.saved.forEach((p: SerializedBlock) => recurse(p, 0));\n        content = contents.join('\\n');\n        richContents.push('</ul>');\n        if (contents.length <= 1) { richContent = content; } else {\n          richContent = richContents.join('\\n');\n        }\n      } else if (info.type === RegisterTypes.CLONED_ROWS) {\n        // For now, this does not copy, for efficiency reasons\n        return;\n      } else {\n        throw Error(`Unexpected yank with invalid info ${info}`);\n      }\n\n      copyToClipboard(content, richContent);\n      // session.showMessage('Copied to clipboard!'\n      //   + (content.length > 10 ? content.substr(0, 10) + '...' : content));\n    }\n  });\n\n  session.on('importFinished', renderMain); // fire and forget\n\n  session.on('changeViewRoot', async (path: Path) => {\n    await clientStore.setLastViewRoot(path.getAncestry());\n    window.location.hash = `#${path.row}`;\n  });\n\n  keyEmitter.listen();\n  keyEmitter.on('keydown', (key) => {\n    keyHandler.queueKey(key);\n    // NOTE: this is just a best guess... e.g. the mode could be wrong\n    // problem is that we process asynchronously, but need to return synchronously\n    return keyBindings.bindings[session.mode].getKey(key) != null;\n  });\n\n  keyHandler.on('handledKey', renderMain); // fire and forget\n\n  session.on('modeChange', renderMain); // fire and forget\n\n  keyBindings.on('applied_hotkey_settings', (hotkey_settings) => {\n    clientStore.setClientSetting('hotkeys', hotkey_settings);\n    renderMain(); // fire and forget\n  });\n\n  pluginManager.on('status', renderMain); // fire and forget\n\n  pluginManager.on('enabledPluginsChange', function(enabled) {\n    docStore.setSetting('enabledPlugins', enabled);\n    renderMain(); // fire and forget\n  });\n\n  // needed for safari\n  const $pasteHack = $('#paste-hack');\n  $pasteHack.focus();\n  $(document).on('click', function() {\n    // if settings menu is up, we don't want to blur (the dropdowns need focus)\n    if (session.mode === 'SETTINGS') { return; }\n    // if user is trying to copy, we don't want to blur\n    if (window.getSelection().toString()) { return; }\n    $pasteHack.focus();\n  });\n\n  $(document).on('paste', async (e) => {\n    if (session.mode === 'SETTINGS') { return; }\n\n    e.preventDefault();\n    let text: string = ((e.originalEvent || e) as any).clipboardData.getData('text/plain');\n    text = text.replace(/(?:\\r)/g, '');  // Remove \\r (Carriage Return) from each line\n    await keyHandler.queue(async () => {\n      // TODO: deal with this better when there are multiple lines\n      // maybe put in insert mode?\n      const lines = text.split('\\n');\n      for (let i = 0; i < lines.length; i++) {\n        const line = lines[i];\n        if (i !== 0) {\n          await session.newLineAtCursor();\n        }\n        await session.addCharsAtCursor(line.split(''));\n      }\n      session.save();\n    });\n    renderMain(); // fire and forget\n  });\n\n  $(window).on('unload', () => {\n    session.exit(); // fire and forget\n  });\n\n  // NOTE: problem is that this is very slow!\n  //   Also, to make it work, needs bluebird\n  // (Promise as any).onPossiblyUnhandledRejection(function(error) {\n  //   throw error;\n  // });\n});\n\nfunction copyToClipboard(text: string, richText?: string) {\n  // https://stackoverflow.com/a/33928558/5937230\n\n  // https://stackoverflow.com/questions/23934656/javascript-copy-rich-text-contents-to-clipboard\n  function listener(e: ClipboardEvent) {\n    if (!e.clipboardData) {\n      return;\n    }\n    if (richText) {\n      e.clipboardData.setData('text/html', richText);\n    }\n    e.clipboardData.setData('text/plain', text);\n    e.preventDefault();\n  }\n\n  if (window.clipboardData && window.clipboardData.setData) {\n    // IE specific code path to prevent textarea being shown while dialog is visible.\n    return window.clipboardData.setData('Text', text);\n  } else if (document.queryCommandSupported && document.queryCommandSupported('copy')) {\n    const textarea = document.createElement('textarea');\n    textarea.textContent = text;\n    textarea.style.position = 'fixed';  // Prevent scrolling to bottom of page in MS Edge.\n    document.body.appendChild(textarea);\n    textarea.select();\n\n\n    try {\n      document.addEventListener('copy', listener);\n      return document.execCommand('copy');  // Security exception may be thrown by some browsers.\n    } catch (ex) {\n      console.warn('Copy to clipboard failed.', ex);\n      return false;\n    } finally {\n      document.body.removeChild(textarea);\n      document.removeEventListener('copy', listener);\n    }\n  }\n  return false;\n}\n"],"sourceRoot":""}