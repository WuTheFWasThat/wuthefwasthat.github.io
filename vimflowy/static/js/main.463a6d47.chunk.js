(this.webpackJsonpvimflowy=this.webpackJsonpvimflowy||[]).push([[0],{121:function(e,t,n){},122:function(e,t,n){},123:function(e,t,n){},127:function(e,t,n){},128:function(e,t,n){},237:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"default",(function(){return H})),n.d(r,"MODES",(function(){return F})),n.d(r,"registerMode",(function(){return U})),n.d(r,"deregisterMode",(function(){return V})),n.d(r,"getMode",(function(){return K}));var a=n(0),s=n.n(a),i=n(1),o=n(4),c=n(16),u=n.n(c),h=n(3),l=n(77),p=(n(120),n(121),n(122),n(123),n(107));function f(e,t){return e.scrollTop(e.scrollTop()+t)}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=e.getBoundingClientRect().top,a=e.getBoundingClientRect().bottom,s=n,i=n+u()("#bottom-bar").height();return r<s?f(t,r-s):a>window.innerHeight-i?f(t,a-window.innerHeight+i):void 0}function v(e,t){var n=t.offset().top,r=n+t.outerHeight(),a=e.offset().top;return a+e.height()<=r&&a>=n}function b(e){e=e.replace(/[[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(window.location.href);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function x(e,t,n){var r=new Blob([t],{type:"".concat(n,";charset=utf-8")});Object(p.saveAs)(r,e)}function w(e){var t=e.split(".");return{json:"application/json",txt:"text/plain","":"text/plain"}[(t.length>1?t[t.length-1]:"").toLowerCase()]}var g=n(6),k=n(11),m=n(12),y=n(113),j=n(14),O=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r){var a;return Object(g.a)(this,n),(a=t.call(this,e)).name=r||a.constructor.name,a.stack=new Error(e).stack,a}return n}(Object(y.a)(Error)),C=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(g.a)(this,n),t.call(this,e?"Not implemented: ".concat(e,"!"):"Not implemented!")}return n}(O),_=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r){return Object(g.a)(this,n),t.call(this,"Unexpected value for `".concat(e,"`: ").concat(r))}return n}(O),S=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return n}(O),R=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return n}(O),D=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){return Object(g.a)(this,n),t.call(this,"Assertion error: ".concat(e))}return n}(O);function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"assert error";if(!e)throw new D("".concat(t,"\nExpected ").concat(e," to be true"))}function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"assert_equals error";if(e!==t)throw new D("".concat(n,"\nExpected ").concat(e," == ").concat(t))}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"assert_deep_equals error";if(!j.isEqual(e,t))throw new D("".concat(n,"\n      \nExpected:\n      \n").concat(JSON.stringify(e,null,2),"\n      \nBut got:\n      \n").concat(JSON.stringify(t,null,2),"\n    "))}var M,N=n(7);!function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.FATAL=4]="FATAL"}(M||(M={}));var L,P=["DEBUG","INFO","WARN","ERROR","FATAL"];!function(e){e[e.STDOUT=0]="STDOUT",e[e.STDERR=1]="STDERR",e[e.QUEUE=2]="QUEUE"}(L||(L={}));var I=new(function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M.INFO,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:L.STDOUT;Object(g.a)(this,e),this.stream=void 0,this.level=void 0,this.queue=[],this.info=void 0,this.debug=void 0,this.warn=void 0,this.error=void 0,this.fatal=void 0,this.setLevel(n),this.setStream(r);var a=function(e,n){return t[e.toLowerCase()]=function(){if(this.level<=n)return this.log.apply(this,arguments)}};P.forEach((function(e){var t=M[e];a(e,t)}))}return Object(N.a)(e,[{key:"log",value:function(){return this.stream===L.STDOUT?console.log.apply(console,arguments):this.stream===L.STDERR?console.error.apply(console,arguments):this.stream===L.QUEUE?this.queue.push(arguments):void 0}},{key:"setLevel",value:function(e){this.level=e}},{key:"off",value:function(){this.level=1/0}},{key:"setStream",value:function(e){this.stream=e,this.stream===L.QUEUE&&(this.queue=[])}},{key:"flush",value:function(){if(this.stream===L.QUEUE)return this.queue.forEach((function(e){console.log.apply(console,e)})),this.empty()}},{key:"empty",value:function(){this.queue=[]}}]),e}())(M.INFO),B=n(15),H=function(){function e(t){Object(g.a)(this,e),this.metadata=void 0,this.name=void 0,this.id=void 0,this.metadata=t,this.name=t.name,this.id=t.name}return Object(N.a)(e,[{key:"enter",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.metadata.enter){e.next=4;break}return e.next=3,this.metadata.enter(t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"every",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.metadata.every){e.next=4;break}return e.next=3,this.metadata.every(t,n,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"beforeEvery",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.metadata.beforeEvery){e.next=4;break}return e.next=3,this.metadata.beforeEvery(t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"exit",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.metadata.exit){e.next=4;break}return e.next=3,this.metadata.exit(t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"transform_context",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.metadata.transform_context){e.next=4;break}return e.next=3,this.metadata.transform_context(t);case 3:return e.abrupt("return",e.sent);case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"transform_key",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.metadata.key_transforms){e.next=15;break}r=0;case 2:if(!(r<this.metadata.key_transforms.length)){e.next=15;break}if(null!=t){e.next=5;break}return e.abrupt("break",15);case 5:return a=this.metadata.key_transforms[r],e.next=8,a(t,n);case 8:i=e.sent,o=Object(B.a)(i,2),t=o[0],n=o[1];case 12:r++,e.next=2;break;case 15:return e.abrupt("return",[t,n]);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),F={},U=function(e){if(F[e.name])throw new Error("Reregistered mode ".concat(e.name));var t=new H(e);return F[e.name]=t,t},V=function(e){delete F[e.name]},z=function(e){return"shift+enter"===e?e="\n":"space"!==e&&"shift+space"!==e||(e=" "),e};U({name:"NORMAL",cursorBetween:!1,enter:function(e){return Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.cursor.backIfNeeded();case 2:case"end":return t.stop()}}),t)})))()},every:function(e,t){return Object(i.a)(s.a.mark((function e(){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.keyStream,r=t.session,n.save(),r.save();case 3:case"end":return e.stop()}}),e)})))()},key_transforms:[function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.keyHandler.getRepeat(n.keyStream,t);case 2:return a=e.sent,i=Object(B.a)(a,2),r=i[0],t=i[1],n.repeat=n.repeat*r,e.abrupt("return",[t,n]);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()]});var W={"delete-char-before":!0,"delete-char-after":!0};U({name:"INSERT",cursorBetween:!0,key_transforms:[function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==(t=z(t)).length){e.next=5;break}return e.next=4,n.session.addCharsAtCursor([t]);case 4:return e.abrupt("return",[null,n]);case 5:return e.abrupt("return",[t,n]);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()],beforeEvery:function(e,t){return Object(i.a)(s.a.mark((function n(){var r,a;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t.session,a=t.keyStream,"exit-mode"===e?a.save():W[e]||r.save();case 2:case"end":return n.stop()}}),n)})))()},every:function(e,t,n){return Object(i.a)(s.a.mark((function r(){var a;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=t.session,W[e]||"INSERT"!==n||a.save();case 2:case"end":return r.stop()}}),r)})))()},exit:function(e){return Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.cursor.left();case 2:e.save();case 3:case"end":return t.stop()}}),t)})))()}}),U({name:"VISUAL",cursorBetween:!1,enter:function(e){return Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.startAnchor();case 1:case"end":return t.stop()}}),t)})))()},exit:function(e,t){return Object(i.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.stopAnchor(),"NORMAL"===t&&e.save();case 2:case"end":return n.stop()}}),n)})))()}}),U({name:"VISUAL_LINE",cursorBetween:!1,enter:function(e){return Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.startAnchor();case 1:case"end":return t.stop()}}),t)})))()},exit:function(e,t){return Object(i.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.stopAnchor(),"NORMAL"===t&&e.save();case 2:case"end":return n.stop()}}),n)})))()},transform_context:function(e){return Object(i.a)(s.a.mark((function t(){var n,r,a,i,o,c,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.session,t.next=3,n.getVisualLineSelections();case 3:return r=t.sent,a=Object(B.a)(r,3),i=a[0],o=a[1],c=a[2],t.next=10,n.document.getChildren(i);case 10:return u=t.sent,e.visual_line={start_i:o,end_i:c,start:u[o],end:u[c],parent:i,selected:u.slice(o,c+1),num_rows:c-o+1},t.abrupt("return",e);case 13:case"end":return t.stop()}}),t)})))()}}),U({name:"SETTINGS",cursorBetween:!1}),U({name:"SEARCH",cursorBetween:!0,within_row:!0,every:function(e,t){return Object(i.a)(s.a.mark((function e(){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,r=t.keyStream,null!=n.menu){e.next=3;break}throw new Error("No menu in session");case 3:return e.next=5,n.menu.update();case 5:r.drop();case 6:case"end":return e.stop()}}),e)})))()},exit:function(e){return Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.menu=null;case 1:case"end":return t.stop()}}),t)})))()},key_transforms:[function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n.session.menu){e.next=2;break}throw new Error("No menu in session");case 2:if(1!==(t=z(t)).length){e.next=10;break}return e.next=6,n.session.menu.session.addCharsAtCursor([t]);case 6:return e.next=8,n.session.menu.update();case 8:return n.keyStream.drop(),e.abrupt("return",[null,n]);case 10:return e.abrupt("return",[t,n]);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()]});var q,K=function(e){return F[e]};!function(e){e[e.NONE=0]="NONE",e[e.CHARS=1]="CHARS",e[e.SERIALIZED_ROWS=2]="SERIALIZED_ROWS",e[e.CLONED_ROWS=3]="CLONED_ROWS"}(q||(q={}));for(var G=function(){function e(t){return Object(g.a)(this,e),this.session=void 0,this.type=q.NONE,this.saved=null,this.session=t,this.saveNone(),this}return Object(N.a)(e,[{key:"saveNone",value:function(){this.type=q.NONE,this.saved=null}},{key:"saveChars",value:function(e){this.type=q.CHARS,this.saved=e,this.session.emit("yank",{type:this.type,saved:this.saved})}},{key:"saveSerializedRows",value:function(e){this.type=q.SERIALIZED_ROWS,this.saved=e,this.session.emit("yank",{type:this.type,saved:this.saved})}},{key:"saveClonedRows",value:function(e){this.type=q.CLONED_ROWS,this.saved=e,this.session.emit("yank",{type:this.type,saved:this.saved})}},{key:"serialize",value:function(){return{type:this.type,saved:this.saved}}},{key:"deserialize",value:function(e){this.type=e.type,this.saved=e.saved}},{key:"paste",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},this.type!==q.CHARS){e.next=6;break}return e.next=4,this.pasteChars(t);case 4:e.next=14;break;case 6:if(this.type!==q.SERIALIZED_ROWS){e.next=11;break}return e.next=9,this.pasteSerializedRows(t);case 9:e.next=14;break;case 11:if(this.type!==q.CLONED_ROWS){e.next=14;break}return e.next=14,this.pasteClonedRows(t);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pasteChars",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},n=this.saved,!t.before){e.next=7;break}return e.next=5,this.session.addCharsAtCursor(n);case 5:e.next=11;break;case 7:return e.next=9,this.session.addCharsAfterCursor(n);case 9:return e.next=11,this.session.cursor.setCol(this.session.cursor.col+n.length);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pasteSerializedRows",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},null!=(n=this.session.cursor.path).parent){e.next=4;break}throw new Error("Cursor was at root");case 4:return r=n.parent,e.next=7,this.session.document.indexInParent(n);case 7:if(a=e.sent,i=this.saved,!t.before){e.next=14;break}return e.next=12,this.session.addBlocks(r,a,i,{setCursor:"first"});case 12:e.next=31;break;case 14:if(e.t0=n.is(this.session.viewRoot),e.t0){e.next=24;break}return e.next=18,this.session.document.collapsed(n.row);case 18:if(e.t1=!e.sent,!e.t1){e.next=23;break}return e.next=22,this.session.document.hasChildren(n.row);case 22:e.t1=e.sent;case 23:e.t0=e.t1;case 24:if(!e.t0){e.next=29;break}return e.next=27,this.session.addBlocks(n,0,i,{setCursor:"first"});case 27:e.next=31;break;case 29:return e.next=31,this.session.addBlocks(r,a+1,i,{setCursor:"first"});case 31:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pasteClonedRows",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},null!=(n=this.session.cursor.path).parent){e.next=4;break}throw new Error("Cursor was at root");case 4:return r=n.parent,e.next=7,this.session.document.indexInParent(n);case 7:if(a=e.sent,i=this.saved,!t.before){e.next=14;break}return e.next=12,this.session.attachBlocks(r,i,a,{setCursor:"first"});case 12:e.next=31;break;case 14:if(e.t0=n.is(this.session.viewRoot),e.t0){e.next=24;break}return e.next=18,this.session.document.collapsed(n.row);case 18:if(e.t1=!e.sent,!e.t1){e.next=23;break}return e.next=22,this.session.document.hasChildren(n.row);case 22:e.t1=e.sent;case 23:e.t0=e.t1;case 24:if(!e.t0){e.next=29;break}return e.next=27,this.session.attachBlocks(n,i,0,{setCursor:"first"});case 27:e.next=31;break;case 29:return e.next=31,this.session.attachBlocks(r,i,a+1,{setCursor:"first"});case 31:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),J=function(){function e(){Object(g.a)(this,e),this.listeners=void 0,this.hooks=void 0,this.listeners={},this.hooks={}}return Object(N.a)(e,[{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return(this.listeners[e]||[]).map((function(e){return e.apply(e,n)}))}},{key:"emitAsync",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Promise.all((this.listeners[e]||[]).map(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.apply(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))}},{key:"addListener",value:function(e,t){return this.emit("newListener",e,t),this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),this}},{key:"on",value:function(e,t){return this.addListener(e,t)}},{key:"once",value:function(e,t){var n=this;return this.on(e,(function r(){n.removeListener(e,r);for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return t(s)})),this}},{key:"removeListener",value:function(e,t){return this.listeners[e]?(this.listeners[e]=this.listeners[e].filter((function(e){return e!==t})),this):this}},{key:"removeAllListeners",value:function(e){return delete this.listeners[e],this}},{key:"off",value:function(e,t){return this.removeListener(e,t)}},{key:"addHook",value:function(e,t){return this.hooks[e]||(this.hooks[e]=[]),this.hooks[e].push(t),this}},{key:"removeHook",value:function(e,t){return this.hooks[e]?(this.hooks[e]=this.hooks[e].filter((function(e){return e!==t})),this):this}},{key:"applyHook",value:function(e,t,n){return(this.hooks[e]||[]).forEach((function(e){t=e(t,n)})),t}},{key:"applyHookAsync",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.hooks[t]||[],i=0;case 2:if(!(i<a.length)){e.next=10;break}return o=a[i],e.next=6,o(n,r);case 6:n=e.sent;case 7:i++,e.next=2;break;case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),Y={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+","[":"{","]":"}",";":":","'":'"',"\\":"|",".":">",",":"<","/":"?"},$={16:"shift alone",17:"ctrl alone",18:"alt alone",91:"left command alone",93:"right command alone"},Z={8:"backspace",9:"tab",13:"enter",27:"esc",32:"space",33:"page up",34:"page down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Q=1;Q<=26;Q++){var X=Q+64,ee=String.fromCharCode(X),te=ee.toLowerCase();Z[X]=te,Y[te]=ee}"undefined"!==typeof InstallTrigger&&(Z[173]="-");var ne,re=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"listen",value:function(){var e=this;return u()(document).on("compositionend",(function(t){t.originalEvent.data.split("").forEach((function(t){e.emit("keydown",t)}))})),u()(document).keydown((function(t){if(229===t.keyCode)return!1;if(t.keyCode in $)return!0;var n;n=t.keyCode in Z?Z[t.keyCode]:String.fromCharCode(t.keyCode),t.shiftKey&&(n=n in Y?Y[n]:"shift+".concat(n)),t.altKey&&(n="alt+".concat(n)),t.ctrlKey&&(n="ctrl+".concat(n)),t.metaKey&&(n="meta+".concat(n)),I.debug("keycode",t.keyCode,"key",n);var r=e.emit("keydown",n);return!j.some(r)||(t.stopPropagation(),t.preventDefault(),!1)}))}}]),n}(J),ae=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"QueueStoppedError";return Object(g.a)(this,n),t.call(this,e?"Queue stopped: ".concat(e,"!"):"Queue stopped!",r)}return n}(O),se=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object(g.a)(this,e),this.queue=void 0,this.resolveNext=void 0,this.nextProm=void 0,this.id=void 0,this.stopped=void 0,this.queue=[],this.resolveNext=null,this.nextProm=null,n.forEach((function(e){return t.enqueue(e)})),this.id=Math.random(),this.stopped=!1}return Object(N.a)(e,[{key:"empty",value:function(){return 0===this.queue.length}},{key:"stop",value:function(){this.stopped=!0}},{key:"dequeue",value:function(){var e=this;if(!this.empty()){var t=this.queue.shift();if(void 0===t)throw new Error("Unexpected empty queue");return Promise.resolve(t)}if(this.stopped)throw new ae("queue is stopped!");if(null!=this.nextProm)throw new Error("Cannot have multiple waiting on queue");return this.nextProm=new Promise((function(t){e.resolveNext=function(e){t(e)}})),this.nextProm}},{key:"enqueue",value:function(e){if(this.stopped)throw new ae("queue is stopped, cannot enqueue!");return null!=this.resolveNext?(this.resolveNext(e),this.nextProm=null,this.resolveNext=null,!0):(this.queue.push(e),!1)}}]),e}(),ie="<motion>",oe=function e(t,n,r){Object(g.a)(this,e),this.name=void 0,this.description=void 0,this.definition=void 0,this.name=t,this.description=n,this.definition=r};!function(e){e[e.DROP=0]="DROP",e[e.DROP_ALL=1]="DROP_ALL",e[e.KEEP=2]="KEEP"}(ne||(ne={}));var ce=function e(t,n,r,a){Object(g.a)(this,e),this.name=void 0,this.description=void 0,this.definition=void 0,this.metadata=void 0,this.name=t,this.description=n,this.definition=r,this.metadata=a||{}};var ue=new(function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e;return Object(g.a)(this,n),(e=t.call(this)).registry=void 0,e.registry={},e}return Object(N.a)(n,[{key:"getRegistration",value:function(e){return this.registry[e]||null}},{key:"registerMotion",value:function(e){if(this.registry[e.name])throw new Error("".concat(e.name," already defined!"));this.registry[e.name]=e,this.emit("update")}},{key:"deregisterMotion",value:function(e){var t=this.registry[e];if(!t)throw new Error("Tried to deregister motion ".concat(e,", but it was not registered!"));if(t instanceof ce)throw new Error("Tried to deregister motion ".concat(e,", but it was registered as an action!"));delete this.registry[e],this.emit("update")}},{key:"registerComposedAction",value:function(e,t,n){var r=this;this.registerAction(function(e,t,n){return new ce(e,t,function(){var t=Object(i.a)(s.a.mark((function t(r){var a,i,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=0;case 1:if(!(a<n.length)){t.next=18;break}if(!((i=n[a])instanceof oe)){t.next=5;break}throw new Error("Cannot compose with motion without an action that accepts it");case 5:if(!i.metadata.acceptsMotion){t.next=13;break}if(a++,!((o=n[a])instanceof ce)){t.next=10;break}throw new Error("Error while composing action ".concat(e,":\n            Action accepting motion was not followed by motion"));case 10:return t.next=12,o.definition.call(o.definition,r);case 12:r.motion=t.sent;case 13:return t.next=15,i.definition(r);case 15:a++,t.next=1;break;case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}(e,t,n.map((function(t){var n=r.getRegistration(t);if(null==n)throw new Error("Could not compose action ".concat(e," with unregistered part ").concat(t));return n}))))}},{key:"registerAction",value:function(e){if(this.registry[e.name])throw new Error("".concat(e.name," already defined!"));this.registry[e.name]=e,this.emit("update")}},{key:"deregisterAction",value:function(e){var t=this.registry[e];if(!t)throw new Error("Tried to deregister action ".concat(e,", but it was not registered!"));if(t instanceof oe)throw new Error("Tried to deregister action ".concat(e,", but it was registered as a motion!"));delete this.registry[e],this.emit("update")}}]),n}(J)),he=function(){function e(t,n){Object(g.a)(this,e),this.children=void 0,this.hasMotion=void 0,this.hasAction=void 0,this.definitions=void 0,this.lastAdded=void 0,this.path=void 0,this.children={},this.hasMotion=!1,this.hasAction=!1,this.lastAdded=null,this.path=t,this.definitions=n}return Object(N.a)(e,[{key:"print",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=" ".repeat(2*n);Object.keys(this.children).forEach((function(a){var s=t.getKey(a);null!=s&&(s instanceof e?(console.log(r,a,":"),s.print(n+1)):console.log(r,a,":",s.name))}))}},{key:"getKey",value:function(e){return this.children[e]||null}},{key:"addMappingHelper",value:function(t,n,r,a){var s=t[n],i=this.children[s];if(i instanceof oe)throw new Error("Multiple registrations for key sequence ".concat(t.slice(0,n+1),":\n        ").concat(r," and ").concat(i.name));if(i instanceof ce)throw new Error("Multiple registrations for key sequence ".concat(t.slice(0,n+1),":\n        ").concat(r," and ").concat(i.name));if(s===ie){if(a instanceof oe)throw new Error("Motions cannot accept motions in bindings");if(!a.metadata.acceptsMotion)throw new Error("Action ".concat(a.name," does not accept motions"))}if(n===t.length-1){if(null!=i)throw new S("Multiple registrations for key sequence ".concat(t.slice(0,n),":\n          ").concat(r," and ").concat(i.lastAdded&&i.lastAdded[0]));this.children[s]=a}else{var o;null==i?(o=new e(this.path.concat([s]),this.definitions),this.children[s]=o):o=i,o.addMappingHelper(t,n+1,r,a)}a instanceof oe?this.hasMotion=!0:this.hasAction=!0,this.lastAdded=[r,a]}},{key:"addMapping",value:function(e,t){var n=this.definitions.getRegistration(e);null!=n?this.addMappingHelper(t,0,e,n):I.warn("Attempted to register hotkey for ".concat(e,", but no definition found"))}}]),e}();var le=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r){var a;return Object(g.a)(this,n),(a=t.call(this)).definitions=void 0,a.bindings={},a.mappings=void 0,a.update=void 0,a.definitions=e,a.update=function(){a.bindings=function(e,t){var n={};return j.map(t.mappings,(function(t,r){var a=new he([],e);j.map(t,(function(e,t){e.forEach((function(e){a.addMapping(t,e)}))})),n[r]=a})),n}(a.definitions,a.mappings),a.emit("update")},a.definitions.on("update",a.update),a.setMappings(r),a}return Object(N.a)(n,[{key:"setMappings",value:function(e){this.mappings&&this.mappings.off("update",this.update),this.mappings=e,this.mappings.on("update",this.update),this.update()}}]),n}(J),pe=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(g.a)(this,n),(e=t.call(this)).queue=void 0,e.lastSequence=void 0,e.curSequence=void 0,e.saveIndex=void 0,e.queue=new se(r),e.lastSequence=[],e.curSequence=[],e.saveIndex=0,e}return Object(N.a)(n,[{key:"empty",value:function(){return this.queue.empty()}},{key:"dequeue",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queue.dequeue();case 2:return t=e.sent,this.curSequence.push(t),this.emit("dequeue",t),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"enqueue",value:function(e){this.queue.enqueue(e)}},{key:"stop",value:function(){this.queue.stop()}},{key:"keep",value:function(){this.saveIndex=this.curSequence.length}},{key:"drop",value:function(){this.curSequence=this.curSequence.slice(0,this.saveIndex)}},{key:"dropAll",value:function(){this.curSequence=[]}},{key:"save",value:function(){this.curSequence.length&&(this.lastSequence=this.curSequence,this.curSequence=[],this.saveIndex=0)}}]),n}(J),fe=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r){var a;return Object(g.a)(this,n),(a=t.call(this)).session=void 0,a.keyBindings=void 0,a.keyStream=void 0,a.processQueue=void 0,a.session=e,a.keyBindings=r,a.keyStream=new pe,a.processQueue=Promise.resolve(),a}return Object(N.a)(n,[{key:"playRecording",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.session.save,this.session.save=function(){return null},(r=new pe(t)).stop(),e.prev=4,e.next=7,this._processKeys(r);case 7:e.next=15;break;case 9:if(e.prev=9,e.t0=e.catch(4),"QueueStoppedError"!==e.t0.name){e.next=14;break}e.next=15;break;case 14:throw e.t0;case 15:this.session.save=n;case 16:case"end":return e.stop()}}),e,this,[[4,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"queueKey",value:function(e){I.info("Handling key:",e),this.keyStream.enqueue(e),this.processKeys()}},{key:"handleRecord",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.session.mode,a=K(r),i=n.action,o=n.context,c=n.motion,e.next=5,a.transform_context(o);case 5:if(o=e.sent,I.info("Action:",i.name),!c){e.next=12;break}return I.info("Motion:",c.name),e.next=11,c.definition.call(c.definition,o);case 11:o.motion=e.sent;case 12:return I.debug("Context: { repeat: ".concat(o.repeat," }")),e.next=15,a.beforeEvery(i.name,o);case 15:return i.metadata.sequence===ne.DROP_ALL?t.dropAll():i.metadata.sequence===ne.DROP?t.drop():t.keep(),e.next=18,i.definition.call(i.definition,o);case 18:return u=K(this.session.mode),e.next=21,u.every(i.name,o,r);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_processKeys",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.empty()){e.next=11;break}return e.next=3,this.getCommand(t);case 3:if(null==(n=e.sent)){e.next=7;break}return e.next=7,this.handleRecord(t,n);case 7:this.session.emit("handledKey"),this.emit("handledKey"),e.next=0;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queue",value:function(e){return this.processQueue=this.processQueue.then(e),this.processQueue}},{key:"processKeys",value:function(){var e=this;this.queue(Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._processKeys(e.keyStream);case 2:case"end":return t.stop()}}),t)})))).catch((function(e){setTimeout((function(){throw e}))})).then((function(){e.emit("processedQueue")}))}},{key:"getCommand",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.session.mode,r=K(n),a=this.keyBindings.bindings[this.session.mode],e.next=5,t.dequeue();case 5:return i=e.sent,o={mode:n,session:this.session,repeat:1,keyStream:t,keyHandler:this},e.next=9,r.transform_key(i,o);case 9:if(c=e.sent,u=Object(B.a)(c,2),i=u[0],o=u[1],null!==i){e.next=15;break}return e.abrupt("return",null);case 15:return e.abrupt("return",this.getAction(t,i,a,o));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAction",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r,a){var i,o,c,u,h,l,p,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.getKey(n),c=null,!(i instanceof he)){e.next=11;break}if(i.hasAction){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,t.dequeue();case 7:return n=e.sent,e.next=10,this.getAction(t,n,i,a);case 10:return e.abrupt("return",e.sent);case 11:if(!(i instanceof ce)){e.next=15;break}o=i,e.next=47;break;case 15:if(!(i instanceof oe)){e.next=27;break}if(c=i,null!=(u=this.keyBindings.bindings[a.mode].getKey(ie))){e.next=20;break}return e.abrupt("return",null);case 20:if(!(u instanceof he)){e.next=22;break}throw new Error("".concat(ie," should be registered as the final key"));case 22:if(!(u instanceof oe)){e.next=24;break}throw new Error("".concat(ie," should be registered for an action"));case 24:o=u,e.next=47;break;case 27:if(null!=(h=r.getKey(ie))){e.next=30;break}return e.abrupt("return",null);case 30:if(!(h instanceof he)){e.next=32;break}throw new Error("".concat(ie," should be registered as the final key"));case 32:if(!(h instanceof oe)){e.next=34;break}throw new Error("".concat(ie," should be registered for an action"));case 34:return o=h,e.next=37,this.getRepeat(t,n);case 37:return p=e.sent,f=Object(B.a)(p,2),l=f[0],n=f[1],a.repeat=a.repeat*l,e.next=44,this.getMotion(t,n,this.keyBindings.bindings[a.mode]);case 44:if(null!==(c=e.sent)){e.next=47;break}return e.abrupt("return",null);case 47:return e.abrupt("return",{motion:c,action:o,context:a});case 48:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getRepeat",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[1,2,3,4,5,6,7,8,9].map((function(e){return e.toString()})),a=[0,1,2,3,4,5,6,7,8,9].map((function(e){return e.toString()})),-1!==r.indexOf(n)){e.next=4;break}return e.abrupt("return",[1,n]);case 4:i=""+n;case 5:return e.next=8,t.dequeue();case 8:if(n=e.sent,-1!==a.indexOf(n)){e.next=11;break}return e.abrupt("break",14);case 11:i+=n,e.next=5;break;case 14:return e.abrupt("return",[parseInt(i,10),n]);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMotion",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(a=r.getKey(n))){e.next=5;break}return e.abrupt("return",null);case 5:if(!(a instanceof he)){e.next=16;break}if(a.hasMotion){e.next=8;break}return e.abrupt("return",null);case 8:return e.next=10,t.dequeue();case 10:return n=e.sent,e.next=13,this.getMotion(t,n,a);case 13:return e.abrupt("return",e.sent);case 16:if(!(a instanceof ce)){e.next=20;break}return e.abrupt("return",null);case 20:return e.abrupt("return",a);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(J),de=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this)).mappings=void 0,r.mappings=j.cloneDeep(e),r}return Object(N.a)(n,null,[{key:"merge",value:function(e,t){var r=function(){var n=j.cloneDeep(e.mappings);return Object.keys(t.mappings).forEach((function(e){n[e]=Object.assign(n[e]||{},t.mappings[e])})),n},a=new n(r());return e.on("update",(function(){return a.setMappings(r())})),t.on("update",(function(){return a.setMappings(r())})),a}}]),Object(N.a)(n,[{key:"setMappings",value:function(e){this.mappings=e,this.emit("update")}},{key:"serialize",value:function(){return j.cloneDeep(this.mappings)}},{key:"_registerMapping",value:function(e,t,n){var r=this.mappings[e];r||(r={},this.mappings[e]=r);var a=r[n];a||(a=[],r[n]=a),a.push(t)}},{key:"registerMapping",value:function(e,t,n){this._registerMapping(e,t,n),this.emit("update")}},{key:"registerModeMappings",value:function(e,t){var n=this;Object.keys(t).forEach((function(r){t[r].forEach((function(t){return n._registerMapping(e,t,r)}))})),this.emit("update")}},{key:"_deregisterMapping",value:function(e,t,n){var r=this.mappings[e];if(r){var a=r[n];a&&a.length?(a=a.filter((function(e){return JSON.stringify(e)!==JSON.stringify(t)})),r[n]=a):I.warn("No sequences to deregister for ".concat(n," in mode ").concat(e))}else I.warn("Nothing to deregister for mode ".concat(e))}},{key:"deregisterMapping",value:function(e,t,n){this._deregisterMapping(e,t,n),this.emit("update")}},{key:"deregisterModeMappings",value:function(e,t){var n=this;Object.keys(t).forEach((function(r){t[r].forEach((function(t){return n._deregisterMapping(e,t,r)}))})),this.emit("update")}}]),n}(J);function ve(e){return e}function be(e,t,n){if(-1===n){if(0===e.length)return[];n=e.length-1}return e.slice(t,n+1)}function xe(e,t){return we.apply(this,arguments)}function we(){return(we=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.next=3,Promise.all(t.map(function(){var e=Object(i.a)(s.a.mark((function e(t,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(t);case 2:if(!e.sent){e.next=4;break}r.push({el:t,i:a});case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",j.sortBy(r,(function(e){return e.i})).map((function(e){return e.el})));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e,t){var n={};return t.forEach((function(t){"theme-bg-primary"===t?n.backgroundColor=e.getClientSetting("theme-bg-primary"):"theme-bg-secondary"===t?n.backgroundColor=e.getClientSetting("theme-bg-secondary"):"theme-bg-tertiary"===t?n.backgroundColor=e.getClientSetting("theme-bg-tertiary"):"theme-bg-highlight"===t?n.backgroundColor=e.getClientSetting("theme-bg-highlight"):"theme-text-primary"===t?n.color=e.getClientSetting("theme-text-primary"):"theme-text-accent"===t?(n.color=e.getClientSetting("theme-text-accent"),n.fontWeight="bold"):"theme-link"===t?(n.color=e.getClientSetting("theme-text-link"),n.cursor="pointer",n.textDecoration="none"):"theme-trim"===t?n.border="1px solid ".concat(e.getClientSetting("theme-trim")):"theme-trim-accent"===t?n.border="2px solid ".concat(e.getClientSetting("theme-trim-accent")):"theme-cursor"===t&&(n.backgroundColor=e.getClientSetting("theme-bg-cursor"),n.color=e.getClientSetting("theme-text-cursor"))})),n}var ke="#000000",me="#ffffff",ye={base03:"#002b36",base02:"#073642",base01:"#586e75",base00:"#657b83",base0:"#839496",base1:"#93a1a1",base2:"#eee8d5",base3:"#fdf6e3",yellow:"#b58900",orange:"#cb4b16",red:"#dc322f",magenta:"#d33682",violet:"#6c71c4",blue:"#268bd2",cyan:"#2aa198",green:"#859900"},je={Default:{"theme-bg-primary":me,"theme-bg-secondary":"#aaaaaa","theme-bg-tertiary":"#e0e0e0","theme-bg-highlight":"#ccc","theme-text-primary":ke,"theme-text-accent":"#dd3388","theme-text-link":"#8888ff","theme-trim":ke,"theme-trim-accent":"#dd3388","theme-text-cursor":me,"theme-bg-cursor":"#666"},Dark:{"theme-bg-primary":"#000000","theme-bg-secondary":"#333333","theme-bg-tertiary":"#404040","theme-bg-highlight":"#555","theme-text-primary":"#eeeeee","theme-text-accent":"#cccc00","theme-text-link":"#8888ff","theme-trim":"#eeeeee","theme-trim-accent":"#cccc00","theme-text-cursor":ke,"theme-bg-cursor":"#ccc"},"Solarized Light":{"theme-bg-primary":ye.base3,"theme-bg-secondary":ye.base2,"theme-bg-tertiary":"#e6dede","theme-bg-highlight":"#e2ebf3","theme-text-primary":ye.base00,"theme-text-accent":ye.magenta,"theme-text-link":ye.blue,"theme-trim":ye.base01,"theme-trim-accent":ye.magenta,"theme-text-cursor":ye.base3,"theme-bg-cursor":ye.cyan},"Solarized Dark":{"theme-bg-primary":ye.base02,"theme-bg-secondary":ye.base03,"theme-bg-tertiary":"#3C4446","theme-bg-highlight":"#384e55","theme-text-primary":ye.base1,"theme-text-accent":ye.magenta,"theme-text-link":ye.violet,"theme-trim":ye.base1,"theme-trim-accent":ye.yellow,"theme-text-cursor":ye.base02,"theme-bg-cursor":ye.base1}},Oe=je.Default,Ce=Object.assign({},Oe,{showKeyBindings:!0,hotkeys:{},copyToClipboard:!0,formattedCopy:!1}),_e={dataSource:"local",firebaseId:null,firebaseApiKey:null,firebaseUserEmail:null,firebaseUserPassword:null,socketServerHost:null,socketServerPassword:null,socketServerDocument:null},Se=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(g.a)(this,e),this.prefix=void 0,this.docname=void 0,this.backend=void 0,this.cache={},this.use_cache=!0,this.backend=t,this.docname=n,this.prefix="".concat(n,"save")}return Object(N.a)(e,[{key:"_get",value:function(e,t){if(this.use_cache&&e in this.cache)return this.cache[e];var n=this.backend.get(e);try{n=JSON.parse(n)}catch(r){}return null===n?(n=t,I.debug("tried getting",e,"defaulted to",t)):I.debug("got from storage",e,n),this.use_cache&&(this.cache[e]=n),n}},{key:"_set",value:function(e,t){this.use_cache&&(this.cache[e]=t),I.debug("setting to storage",e,t),this.backend.set(e,JSON.stringify(t))}},{key:"_settingKey_",value:function(e){return"settings:".concat(e)}},{key:"_docSettingKey_",value:function(e){return"settings:".concat(this.docname,":").concat(e)}},{key:"_lastViewrootKey_",value:function(){return"".concat(this.prefix,":lastviewroot2")}},{key:"_macrosKey_",value:function(){return"".concat(this.prefix,":macros")}},{key:"getMacros",value:function(){return this._get(this._macrosKey_(),{})}},{key:"setMacros",value:function(e){this._set(this._macrosKey_(),e)}},{key:"getClientSetting",value:function(e){return this._get(this._settingKey_(e),Ce[e])}},{key:"setClientSetting",value:function(e,t){this._set(this._settingKey_(e),t)}},{key:"getDocSetting",value:function(e){var t=_e[e];return this._get(this._docSettingKey_(e),t)}},{key:"setDocSetting",value:function(e,t){this._set(this._docSettingKey_(e),t)}},{key:"setLastViewRoot",value:function(e){this._set(this._lastViewrootKey_(),e)}},{key:"getLastViewRoot",value:function(){return this._get(this._lastViewrootKey_(),[])}}]),e}(),Re={enabledPlugins:["Marks","HTML","LaTeX","Text Formatting","Todo","Tags"]},De=function(e){return"string"===typeof e?e.split(""):e.map((function(e){return"string"===typeof e?e:e.char}))},Ee=function(e){return e.join("")},Ae=function(e){return"number"===typeof e&&(e=[e]),e},Te=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(g.a)(this,e),this.lastId=void 0,this.prefix=void 0,this.docname=void 0,this.cache={},this.use_cache=!0,this.events=new J,this.backend=void 0,this.backend=t,this.docname=n,this.prefix="".concat(this.docname,"save"),this.lastId=null}return Object(N.a)(e,[{key:"_get",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=o.length>2&&void 0!==o[2]?o[2]:ve,e.next=4;break;case 4:if(!this.use_cache){e.next=7;break}if(!(t in this.cache)){e.next=7;break}return e.abrupt("return",this.cache[t]);case 7:return e.next=9,this.backend.get(t);case 9:a=e.sent;try{"string"===typeof a&&(a=JSON.parse(a))}catch(s){}return null===a?(i=n,I.debug("tried getting",t,"defaulted to",i)):(i=r(a),I.debug("got from storage",t,i)),this.use_cache&&(this.cache[t]=i),e.abrupt("return",i);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_set",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=i.length>2&&void 0!==i[2]?i[2]:ve,e.next=4;break;case 4:this.use_cache&&(this.cache[t]=n),a=r(n),I.debug("setting to storage",t,a),this.backend.set(t,JSON.stringify(a)).catch((function(e){setTimeout((function(){throw e}))}));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_lastIDKey_",value:function(){return"".concat(this.prefix,":lastID")}},{key:"_lineKey_",value:function(e){return"".concat(this.prefix,":").concat(e,":line")}},{key:"_parentsKey_",value:function(e){return"".concat(this.prefix,":").concat(e,":parent")}},{key:"_childrenKey_",value:function(e){return"".concat(this.prefix,":").concat(e,":children")}},{key:"_detachedParentKey_",value:function(e){return"".concat(this.prefix,":").concat(e,":detached_parent")}},{key:"_collapsedKey_",value:function(e){return"".concat(this.prefix,":").concat(e,":collapsed")}},{key:"_pluginDataKey_",value:function(e,t){return"".concat(this.prefix,":plugin:").concat(e,":data:").concat(t)}},{key:"_settingKey_",value:function(e){return"".concat(this.prefix,":settings:").concat(e)}},{key:"getLine",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get(this._lineKey_(t),[],De);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setLine",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._set(this._lineKey_(t),n,Ee);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_isStruckThroughOldFormat",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get(this._lineKey_(t),[]);case 2:if("string"===typeof(n=e.sent)||!n.length){e.next=7;break}if(!(r=n[0]).properties||!r.properties.strikethrough){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getParents",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get(this._parentsKey_(t),[],Ae);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setParents",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._set(this._parentsKey_(t),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get(this._childrenKey_(t),[]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._set(this._childrenKey_(t),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDetachedParent",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get(this._detachedParentKey_(t),null);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setDetachedParent",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._set(this._detachedParentKey_(t),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCollapsed",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._get(this._collapsedKey_(t),!1);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setCollapsed",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._set(this._collapsedKey_(t),n||!1);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSetting",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Re[t],e.next=3,this._get(this._settingKey_(t),n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSetting",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._set(this._settingKey_(t),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setPluginData",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._set(this._pluginDataKey_(t,n),r);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getPluginData",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:void 0,e.next=3,this._get(this._pluginDataKey_(t,n),r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getId",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.lastId){e.next=7;break}return e.next=3,this._get(this._lastIDKey_(),0);case 3:e.t0=e.sent,t=1+e.t0,e.next=8;break;case 7:t=this.lastId+1;case 8:return this._set(this._lastIDKey_(),t),this.lastId=t,e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNew",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getId();case 2:return t=e.sent,e.next=5,Promise.all([this.setLine(t,[]),this.setChildren(t,[]),this.setCollapsed(t,!1)]);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Me=function(){function e(){Object(g.a)(this,e)}return Object(N.a)(e,[{key:"get",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C;case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Ne=function(){function e(){Object(g.a)(this,e)}return Object(N.a)(e,[{key:"get",value:function(e){throw new C}},{key:"set",value:function(e,t){throw new C}}]),e}(),Le=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(g.a)(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).cache={},e}return Object(N.a)(n,[{key:"get",value:function(e){return e in this.cache?this.cache[e]:null}},{key:"set",value:function(e,t){this.cache[e]=t}}]),n}(Ne),Pe=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e;return Object(g.a)(this,n),(e=t.call(this)).sync_backend=void 0,e.sync_backend=new Le,e}return Object(N.a)(n,[{key:"get",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sync_backend.get(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sync_backend.set(t,n);case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Me),Ie=n(8),Be=n(80),He=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.call(this,"This document has been modified (in another tab) since opening it in this tab. Please refresh to continue!")}return n}(O),Fe="internal:",Ue=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"get",value:function(e){var t=localStorage.getItem(e);return null==t||"undefined"===t?null:t}},{key:"set",value:function(e,t){return localStorage.setItem(e,t)}}]),n}(Ne),Ve=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object(g.a)(this,n),(e=t.call(this)).lastSave=void 0,e.docname=void 0,e.sync_backend=void 0,e.docname=r,e.lastSave=Date.now(),e.sync_backend=new Ue,e}return Object(N.a)(n,[{key:"_lastSaveKey_",value:function(){return"".concat(Fe).concat(this.docname,":lastSave")}}]),Object(N.a)(n,[{key:"get",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sync_backend.get(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getLastSave()>this.lastSave)){e.next=2;break}throw new He;case 2:this.lastSave=Date.now(),this.sync_backend.set(this._lastSaveKey_(),this.lastSave+""),this.sync_backend.set(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getLastSave",value:function(){return JSON.parse(this.sync_backend.get(this._lastSaveKey_())||"0")}}]),n}(Me),ze=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;return Object(g.a)(this,n),(e=t.call(this)).events=new J,e.fbase=void 0,e.numPendingSaves=0,e.docname=void 0,e.docname=r,e.fbase=Be.a.initializeApp({apiKey:s,databaseURL:"https://".concat(a,".firebaseio.com")}).database(),e}return Object(N.a)(n,[{key:"init",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.events.emit("saved"),e.next=3,this.auth(t,n);case 3:return r=Date.now()+"-"+(""+Math.random()).slice(2),a=this.fbase.ref("".concat(Fe).concat(this.docname,":lastClient")),e.next=7,a.set(r);case 7:a.on("value",(function(e){if(null==e)throw new Error("Failed to get listRef");if(e.val()!==r)throw new He}));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"auth",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Be.a.auth().signInWithEmailAndPassword(t,n);case 3:return r=e.sent,I.info("Authenticated against Firebase."),e.abrupt("return",r);case 8:return e.prev=8,e.t0=e.catch(0),I.error("Authentication against Firebase failed: "+e.t0.code+": "+e.t0.message),e.abrupt("return");case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"get",value:function(e){var t=this;return I.debug("Firebase: getting",e),new Promise((function(n,r){t.fbase.ref(e).once("value",(function(e){var t=e.exists();return n(t?e.val():null)}),(function(e){return r(e)}))}))}},{key:"set",value:function(e,t){var n=this;return 0===this.numPendingSaves&&this.events.emit("unsaved"),I.debug("Firebase: setting",e,"to",t),this.numPendingSaves++,this.fbase.ref(e).set(t,(function(e){if(e)throw e;n.numPendingSaves--,0===n.numPendingSaves&&n.events.emit("saved")})),Promise.resolve()}}]),n}(Me),We=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e;return Object(g.a)(this,n),(e=t.call(this)).events=new J,e.numPendingSaves=0,e.callback_table={},e.ws=void 0,e.clientId=void 0,e.clientId=Date.now()+"-"+(""+Math.random()).slice(2),e}return Object(N.a)(n,[{key:"connect",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I.info("Trying to connect",t),this.ws=new WebSocket("".concat(t,"/socket")),this.ws.onerror=function(){I.info("Socket connection error!")},this.ws.onclose=function(){I.info("Socket connection closed! Trying to reconnect..."),setTimeout((function(){a.connect(t,n,r)}),5e3)},e.next=6,new Promise((function(e,t){a.ws.onopen=e,setTimeout((function(){t("Timed out trying to connect!")}),5e3)}));case 6:return I.info("Connected",t),this.ws.onmessage=function(e){var t=JSON.parse(e.data);if("callback"===t.type){var n=t.id;if(!(n in a.callback_table))throw new Error("ID ".concat(n," not found in callback table"));var s=a.callback_table[n];delete a.callback_table[n],s(t.result)}else if("joined"===t.type&&t.docname===r&&t.clientId!==a.clientId)throw new He},e.next=10,this.sendMessage({type:"join",password:n,docname:r});case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:"",this.events.emit("saved"),e.next=4,this.connect(t,n,r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var a=Date.now()+"-"+(""+Math.random()).slice(2);if(a in n.callback_table)throw new Error("Duplicate IDs!?");n.callback_table[a]=function(t){t.error?r(t.error):e(t.value)},n.ws.send(JSON.stringify(Object(Ie.a)(Object(Ie.a)({},t),{},{id:a,clientId:n.clientId})))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I.debug("Socket client: getting",t),e.next=3,this.sendMessage({type:"get",key:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){var n=this;return 0===this.numPendingSaves&&this.events.emit("unsaved"),I.debug("Socket client: setting",e,"to",t),this.numPendingSaves++,this.sendMessage({type:"set",key:e,value:t}).then((function(){n.numPendingSaves--,0===n.numPendingSaves&&n.events.emit("saved")})),Promise.resolve()}}]),n}(Me),qe=n(20),Ke=n(39),Ge=n(24),Je=n(41),Ye=n(25),$e=n(29),Ze=n(40);function Qe(e){return" "===e||"\n"===e||void 0===e}var Xe=/^https?:\/\/([^\s]+\.[^\s]+$|localhost)/;function et(e){return Xe.test(e)}function tt(e){return new RegExp("(?:\\s|^)(?:\\()*("+e+")(?:\\))*(?:\\.|,|!|\\?|\\:|\\;)*(?:\\s|$)")}var nt,rt=function(){function e(t,n){Object(g.a)(this,e),this.parent=void 0,this.row=void 0,this.parent=t,this.row=n}return Object(N.a)(e,null,[{key:"rootRow",value:function(){return 0}},{key:"root",value:function(){return new e(null,e.rootRow())}},{key:"loadFromAncestry",value:function(t){if(0===t.length)return e.root();var n=t.pop();return e.loadFromAncestry(t).child(n)}}]),Object(N.a)(e,[{key:"isRoot",value:function(){return this.row===e.rootRow()}},{key:"getAncestry",value:function(){if(null==this.parent)return[];var e=this.parent.getAncestry();return e.push(this.row),e}},{key:"getAncestryPaths",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.root(),n=[],r=this;!r.is(t);){if(null==r.parent)throw new Error("Failed to get ancestry for ".concat(this," going up until ").concat(t));n.push(r),r=r.parent}return n.push(t),n.reverse(),n}},{key:"child",value:function(t){return E(t!==this.row),new e(this,t)}},{key:"isDescendant",value:function(e){return null!==this.walkFrom(e)}},{key:"walkFrom",value:function(e){var t=this.getAncestry(),n=e.getAncestry();if(t.length<n.length)return null;for(var r=0;r<n.length;r++)if(t[r]!==n[r])return null;return t.slice(n.length)}},{key:"shedUntil",value:function(e){for(var t=this,n=[];t.row!==e;){if(!t.parent)return null;n.push(t.row),t=t.parent}return[n.reverse(),t]}},{key:"extend",value:function(e){var t=this;return e.forEach((function(e){t=t.child(e)})),t}},{key:"is",value:function(e){return void 0!==e&&(this.row===e.row&&(null==this.parent?null==e.parent:null!=e.parent&&this.parent.is(e.parent)))}}]),e}(),at=function(){function e(t,n,r){Object(g.a)(this,e),this.row=void 0,this.info=void 0,this.children=void 0,this.row=t,this.info=n,this.children=r}return Object(N.a)(e,[{key:"clone",value:function(){return new e(this.row,this.info,this.children)}},{key:"setChildren",value:function(t){return new e(this.row,this.info,t)}},{key:"setInfo",value:function(t){return new e(this.row,t,this.children)}},{key:"setLine",value:function(e){var t=Object.assign({},this.info,{line:e});return this.setInfo(t)}},{key:"setCollapsed",value:function(e){var t=Object.assign({},this.info,{collapsed:e});return this.setInfo(t)}},{key:"setChildRows",value:function(e){var t=Object.assign({},this.info,{childRows:e});return this.setInfo(t)}},{key:"setParentRows",value:function(e){var t=Object.assign({},this.info,{parentRows:e});return this.setInfo(t)}},{key:"setPluginData",value:function(e){var t=Object.assign({},this.info,{pluginData:e});return this.setInfo(t)}},{key:"parentRows",get:function(){return this.info.parentRows}},{key:"childRows",get:function(){return this.info.childRows}},{key:"line",get:function(){return this.info.line}},{key:"collapsed",get:function(){return this.info.collapsed}},{key:"pluginData",get:function(){return this.info.pluginData}}]),e}(),st=function(){function e(){Object(g.a)(this,e),this.cache=void 0,this.cache={}}return Object(N.a)(e,[{key:"clear",value:function(){this.cache={}}},{key:"loadRow",value:function(e,t){var n=this,r=new at(e,t,t.childRows.map((function(e){return n.get(e)})));return this.set(e,r),r}},{key:"isCached",value:function(e){return!!this.get(e)}},{key:"bubbleUpdate",value:function(e){var t=this,n=this.get(e);n&&n.parentRows.forEach((function(e){var n=t.get(e);n&&t.set(e,t.updateChildren(n))}))}},{key:"set",value:function(e,t){this.cache[e]=t,this.bubbleUpdate(e)}},{key:"update",value:function(e,t,n){var r=this.get(e);if(!r){if(n)throw new Error("Updating failed - Row ".concat(e," was not cached"));return!1}return this.set(e,t(r)),!0}},{key:"get",value:function(e){var t=this.cache[e];return t||null}},{key:"updateChildren",value:function(e){var t=this;return e.setChildren(e.childRows.map((function(e){return t.get(e)})))}},{key:"setLine",value:function(e,t){this.update(e,(function(e){return e.setLine(t)}),!0)}},{key:"setCollapsed",value:function(e,t){this.update(e,(function(e){return e.setCollapsed(t)}),!0)}},{key:"setChildRows",value:function(e,t){var n=this;this.update(e,(function(e){return n.updateChildren(e.setChildRows(t))}),!0)}},{key:"setParentRows",value:function(e,t){this.update(e,(function(e){return e.setParentRows(t)}),!0)}},{key:"setPluginData",value:function(e,t){this.update(e,(function(e){return e.setPluginData(t)}),!0)}}]),e}(),it=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object(g.a)(this,n),(r=t.call(this)).cache=void 0,r.store=void 0,r.name=void 0,r.root=void 0,r.cache=new st,r.store=e,r.name=a,r.root=rt.root(),Object(Ke.a)(r,Object(Ge.a)(r))}return Object(N.a)(n,[{key:"_newChild",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:-1,e.next=3,this.store.getNew();case 3:return r=e.sent,e.next=6,this.emitAsync("childAdded",{row:r,parent:t});case 6:return this.cache.loadRow(r,{line:[],collapsed:!1,childRows:[],parentRows:[],pluginData:{}}),e.next=9,Promise.all([this._attach(r,t,n),this.store.setDetachedParent(r,null)]);case 9:return a=e.sent,i=Object(B.a)(a,1),o=i[0],e.next=14,this.updateCachedPluginData(r);case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getInfo",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c,u,h,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E(null!=t,"Cannot get info for undefined"),null===(n=this.cache.get(t))){e.next=4;break}return e.abrupt("return",n);case 4:return e.next=6,Promise.all([this.store.getLine(t),this.store.getCollapsed(t),this.store.getChildren(t),this.store.getParents(t),this.applyHookAsync("pluginRowContents",{},{row:t})]);case 6:return r=e.sent,a=Object(B.a)(r,5),i=a[0],o=a[1],c=a[2],u=a[3],h=a[4],l={line:i,collapsed:o,parentRows:u,childRows:c,pluginData:h},e.abrupt("return",this.cache.loadRow(t,l));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"forceLoadTree",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a=this,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:this.root.row,n=o.length>1&&void 0!==o[1]&&o[1],e.next=4,this.getInfo(t);case 4:if(r=e.sent,!n&&r.collapsed){e.next=8;break}return e.next=8,Promise.all(r.childRows.map(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.forceLoadTree(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"forceLoadPath",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getAncestry(),e.next=3,Promise.all(n.map(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getInfo(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateCachedPluginData",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.isCached(t)){e.next=7;break}return e.next=3,this.applyHookAsync("pluginRowContents",{},{row:t});case 3:n=e.sent,this.cache.setPluginData(t,n),e.next=9;break;case 7:return e.next=9,this.getInfo(t);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLine",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getInfo(t);case 2:return e.abrupt("return",e.sent.line);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getText",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLine(t);case 2:return e.abrupt("return",e.sent.join(""));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChar",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLine(t);case 2:return e.t0=n,e.abrupt("return",e.sent[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setLine",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cache.setLine(t,n),e.next=3,this.store.setLine(t,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getWord",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLine(t);case 2:if(!Qe((r=e.sent)[n])){e.next=5;break}return e.abrupt("return","");case 5:for(a=n,i=n;a>0&&!Qe(r[a-1]);)a-=1;for(;i<r.length-1&&!Qe(r[i+1]);)i+=1;return o=(o=(o=r.slice(a,i+1).join("")).replace(/^[-.,()&$#![\]{}"']+/g,"")).replace(/[-.,()&$#![\]{}"']+$/g,""),e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeChars",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLine(t);case 2:return(a=e.sent.slice()).splice.apply(a,[n,0].concat(Object(qe.a)(r))),e.next=6,this.setLine(t,a);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteChars",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLine(t);case 2:return a=e.sent,i=a.splice(n,r),e.next=6,this.setLine(t,a);case 6:return e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getLength",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLine(t);case 2:return e.abrupt("return",e.sent.length);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:0,r=i.length>2&&void 0!==i[2]?i[2]:-1,e.next=4,this.getInfo(t);case 4:return a=e.sent,e.abrupt("return",be(a.childRows,n,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cache.setChildRows(t,n),e.next=3,this.store.setChildren(t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getParents",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getInfo(t);case 2:return n=e.sent,e.abrupt("return",n.parentRows);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setParents",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cache.setParentRows(t,n),e.next=3,this.store.setParents(t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getChildren(t.row);case 2:return e.abrupt("return",e.sent.map((function(e){return t.child(e)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getChildren(t);case 2:return e.t0=e.sent.length,e.abrupt("return",e.t0>0);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasChild",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getChildren(t);case 2:return e.t0=e.sent.indexOf(n),e.t1=-1,e.abrupt("return",e.t0!==e.t1);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSiblings",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.parent){e.next=2;break}return e.abrupt("return",[t]);case 2:return e.next=4,this.getChildren(t.parent);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"nextClone",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.parent){e.next=2;break}return e.abrupt("return",t);case 2:return e.next=4,this._getParents(t.row);case 4:n=e.sent,E((r=n.indexOf(t.parent.row))>-1);case 7:return r=(r+1)%n.length,i=n[r],e.next=12,this.canonicalPath(i);case 12:if(null===(a=e.sent)){e.next=15;break}return e.abrupt("break",17);case 15:e.next=7;break;case 17:return e.abrupt("return",a.child(t.row));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"indexInParent",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSiblings(t);case 2:return n=e.sent,e.abrupt("return",j.findIndex(n,(function(e){return e.row===t.row})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"collapsed",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getInfo(t);case 2:return e.abrupt("return",e.sent.collapsed);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setCollapsed",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cache.setCollapsed(t,n),e.next=3,this.store.setCollapsed(t,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"toggleCollapsed",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.t1=t,e.next=4,this.collapsed(t);case 4:e.t2=!e.sent,e.t0.setCollapsed.call(e.t0,e.t1,e.t2);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"walkToLastVisible",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:[],e.next=3,this.collapsed(t);case 3:if(!e.sent){e.next=5;break}return e.abrupt("return",n);case 5:return e.next=7,this._getChildren(t);case 7:if(0!==(r=e.sent).length){e.next=10;break}return e.abrupt("return",n);case 10:return a=r[r.length-1],e.t0=[a],e.next=14,this.walkToLastVisible(a);case 14:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isClone",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getParents(t);case 2:if(!((n=e.sent).length<2)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,xe(n,function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.isAttached(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:return r=e.sent,e.abrupt("return",r.length>1);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"canonicalPath",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E(null!==t,"Empty row passed to canonicalPath"),t!==rt.rootRow()){e.next=3;break}return e.abrupt("return",this.root);case 3:return e.next=5,this._getParents(t);case 5:n=e.sent,r=0;case 7:if(!(r<n.length)){e.next=17;break}return a=n[r],e.next=11,this.canonicalPath(a);case 11:if(null===(i=e.sent)){e.next=14;break}return e.abrupt("return",i.child(t));case 14:r++,e.next=7;break;case 17:return e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"allAncestors",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,o,c,u=this,h=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h.length>1&&void 0!==h[1]?h[1]:{},r=n.inclusive,a={},o=[],void 0!==r&&r&&o.push(t),c=function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a[t]=!0,e.next=3,u._getParents(t);case 3:n=e.sent,r=0;case 5:if(!(r<n.length)){e.next=14;break}if((i=n[r])in a){e.next=11;break}return o.push(i),e.next=11,c(i);case 11:r++,e.next=5;break;case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=7,c(t);case 7:return e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_hasChild",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getChildren(t);case 2:return r=e.sent,a=j.findIndex(r,(function(e){return e===n})),e.abrupt("return",-1!==a);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_removeChild",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getChildren(t);case 2:return r=e.sent,E(-1!==(a=j.findIndex(r,(function(e){return e===n})))),r.splice(a,1),e.next=8,this._setChildren(t,r);case 8:return e.next=10,this._getParents(n);case 10:return i=e.sent,o=j.findIndex(i,(function(e){return e===t})),i.splice(o,1),e.next=15,this._setParents(n,i);case 15:return c={parent_row:t,parent_index:o,row:n,child_index:a},this.emit("childRemoved",c),e.abrupt("return",c);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_addChild",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getChildren(t);case 2:return a=e.sent,E(r<=a.length),-1===r&&(r=a.length),a.splice(r,0,n),e.next=8,this._setChildren(t,a);case 8:return e.next=10,this._getParents(n);case 10:return(i=e.sent).push(t),e.next=14,this._setParents(n,i);case 14:return o={parent_row:t,parent_index:i.length-1,row:n,child_index:r},e.abrupt("return",o);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_detach",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.isClone(t);case 2:return r=!e.sent,e.next=5,this.emitAsync("beforeDetach",{row:t,parent_row:n,last:r});case 5:return e.next=7,this._removeChild(n,t);case 7:if(a=e.sent,!r){e.next=11;break}return e.next=11,this.store.setDetachedParent(t,n);case 11:return e.next=13,this.emitAsync("afterDetach",{row:t,parent_row:n,last:r});case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_attach",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:-1,e.next=3,this._getParents(t);case 3:return e.t0=e.sent.length,a=0===e.t0,e.next=7,this.emitAsync("beforeAttach",{row:t,parent_row:n,first:a});case 7:return e.next=9,this._addChild(n,t,r);case 9:return i=e.sent,e.next=12,this.store.getDetachedParent(t);case 12:if(null===(o=e.sent)){e.next=17;break}return E(a),e.next=17,this.store.setDetachedParent(t,null);case 17:return e.next=19,this.emitAsync("afterAttach",{row:t,parent_row:n,first:a,old_detached_parent:o});case 19:return e.abrupt("return",i);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_move",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>3&&void 0!==c[3]?c[3]:-1,e.next=3,this.emitAsync("beforeMove",{row:t,old_parent:n,new_parent:r});case 3:return e.next=5,this._removeChild(n,t);case 5:return i=e.sent,n===r&&a>i.child_index&&(a-=1),e.next=9,this._addChild(r,t,a);case 9:return o=e.sent,e.next=12,this.emitAsync("afterMove",{row:t,old_parent:n,new_parent:r});case 12:return e.abrupt("return",{old:i,new:o});case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"attachChild",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:-1,e.next=3,this.attachChildren(t,[n],r);case 3:return e.abrupt("return",e.sent[0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"attachChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:-1,e.next=3,this._attachChildren(t.row,n.map((function(e){return e.row})),r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_attachChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=o.length>2&&void 0!==o[2]?o[2]:-1,a=0;case 2:if(!(a<n.length)){e.next=10;break}return i=n[a],e.next=6,this._attach(i,t,r);case 6:r>=0&&(r+=1);case 7:a++,e.next=2;break;case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCommonAncestor",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.getAncestryPaths(),a=n.getAncestryPaths(),i=j.takeWhile(j.zip(r,a),(function(e){return e[0]&&e[1]&&e[0].is(e[1])})).map((function(e){return e[0]})),null!=(o=j.last(i))){e.next=6;break}throw new Error("No common ancestor found between ".concat(t," and ").concat(n));case 6:return c=i.length,e.abrupt("return",[o,r.slice(c),a.slice(c)]);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"isAttached",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.allAncestors(t,{inclusive:!0});case 2:return e.t0=e.sent.indexOf(this.root.row),e.t1=-1,e.abrupt("return",e.t0!==e.t1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isValidPath",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0,r=t.getAncestry(),a=0;case 3:if(!(a<r.length)){e.next=13;break}return i=r[a],e.next=7,this.hasChild(n,i);case 7:if(e.sent){e.next=9;break}return e.abrupt("return",!1);case 9:n=i;case 10:a++,e.next=3;break;case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSiblingBefore",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSiblingOffset(t,-1);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSiblingAfter",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSiblingOffset(t,1);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSiblingOffset",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSiblingRange(t,n,n);case 2:if((r=e.sent).length){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",r[0]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSiblingRange",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a,i,o,c,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.indexInParent(t),this.getSiblings(t)]);case 2:if(a=e.sent,i=Object(B.a)(a,2),o=i[0],c=i[1],!(o+r<0)){e.next=8;break}return e.abrupt("return",[]);case 8:return u=be(c,Math.max(o+n,0),o+r),e.abrupt("return",u);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getChildRange",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getChildren(t.row,n,r);case 2:return e.abrupt("return",e.sent.map((function(e){return t.child(e)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"newChild",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:-1,e.next=3,this._newChild(t.row,n);case 3:return r=e.sent,a=r.row,e.abrupt("return",t.child(a));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"traverseSubtree",value:function(e){var t=this;return Object(Je.a)(s.a.mark((function n(){var r,a,i,o;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=function(){return(o=Object(Je.a)(s.a.mark((function e(t){var n,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.row in r)){e.next=2;break}return e.abrupt("return");case 2:return r[t.row]=!0,e.next=5,t;case 5:return e.next=7,Object(Ye.a)(a.getChildren(t));case 7:n=e.sent,o=0;case 9:if(!(o<n.length)){e.next=21;break}return e.t0=Ze.a,e.t1=$e.a,e.next=14,Object(Ye.a)(i(n[o]));case 14:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=Ye.a,e.delegateYield((0,e.t0)(e.t3,e.t4),"t5",18);case 18:o++,e.next=9;break;case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)},i=function(e){return o.apply(this,arguments)},r={},a=t,n.t0=Ze.a,n.t1=$e.a,n.next=8,Object(Ye.a)(i(e));case 8:return n.t2=n.sent,n.t3=(0,n.t1)(n.t2),n.t4=Ye.a,n.delegateYield((0,n.t0)(n.t3,n.t4),"t5",12);case 12:case"end":return n.stop()}}),n)})))()}},{key:"search",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c,u,h,l,p,f,d,v,b,x,w,g,k=this,m=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=m.length>2&&void 0!==m[2]?m[2]:{},a=r.nresults,i=void 0===a?10:a,o=r.case_sensitive,c=void 0!==o&&o,u=[],0!==n.length){e.next=5;break}return e.abrupt("return",u);case 5:h=function(e){return c?e:e.toLowerCase()},l=n.split(/\s/g).filter((function(e){return e.length})).map(h),p=this.traverseSubtree(t),f=!0,d=!1,e.prev=10,b=s.a.mark((function e(){var t,n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g,e.next=3,k.getText(t.row);case 3:if(n=e.sent,r=h(n),a=[],j.every(l.map((function(e){var t=r.indexOf(e);if(-1===t)return!1;for(var n=t;n<t+e.length;n++)a.push(n);return!0})))&&u.push({path:t,matches:a}),!(i>0&&u.length===i)){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),x=Object($e.a)(p);case 13:return e.next=15,x.next();case 15:return w=e.sent,f=w.done,e.next=19,w.value;case 19:if(g=e.sent,f){e.next=28;break}return e.delegateYield(b(),"t0",22);case 22:if("break"!==e.t0){e.next=25;break}return e.abrupt("break",28);case 25:f=!0,e.next=13;break;case 28:e.next=34;break;case 30:e.prev=30,e.t1=e.catch(10),d=!0,v=e.t1;case 34:if(e.prev=34,e.prev=35,f||null==x.return){e.next=39;break}return e.next=39,x.return();case 39:if(e.prev=39,!d){e.next=42;break}throw v;case 42:return e.finish(39);case 43:return e.finish(34);case 44:return e.abrupt("return",u);case 45:case"end":return e.stop()}}),e,this,[[10,30,34,44],[35,,39,43]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"serializeRow",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:this.root.row,e.next=3,this.getText(t);case 3:return n=e.sent,r={text:n},e.next=7,this.collapsed(t);case 7:if(!e.sent){e.next=9;break}r.collapsed=!0;case 9:return e.next=11,this.applyHookAsync("serializeRow",{},{row:t});case 11:return a=e.sent,Object.keys(a).length>0&&(r.plugins=a),e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialize",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o,c,u=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:this.root.row,n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2&&void 0!==u[2]?u[2]:{},!(t in r)){e.next=7;break}return r[t].id=t,e.abrupt("return",{clone:t});case 7:return e.next=9,this.serializeRow(t);case 9:return a=e.sent,e.next=12,this._getChildren(t);case 12:i=e.sent,o=[],c=0;case 15:if(!(c<i.length)){e.next=24;break}return e.t0=o,e.next=19,this.serialize(i[c],n,r);case 19:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 21:c++,e.next=15;break;case 24:if(o.length&&(a.children=o),r[t]=a,!n.pretty){e.next=37;break}if(e.t3=0===o.length,!e.t3){e.next=32;break}return e.next=31,this.isClone(t);case 31:e.t3=!e.sent;case 32:if(e.t2=e.t3,!e.t2){e.next=35;break}e.t2=!a.plugins;case 35:if(!e.t2){e.next=37;break}return e.abrupt("return",a.text);case 37:return e.abrupt("return",a);case 38:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadTo",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c,u,h,l,p,f,d=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]?d[1]:this.root,r=d.length>2&&void 0!==d[2]?d[2]:-1,a=d.length>3&&void 0!==d[3]?d[3]:{},i=d.length>4&&void 0!==d[4]&&d[4],!t.clone){e.next=11;break}return E(t.clone in a),o=a[t.clone],c=n.child(o),e.next=10,this.attachChild(n,c,r);case 10:return e.abrupt("return",c);case 11:return e.next=13,this.getChildren(n);case 13:if(u=e.sent,e.t0=i&&1===u.length,!e.t0){e.next=20;break}return e.next=18,this.getLine(u[0].row);case 18:e.t1=e.sent.length,e.t0=0===e.t1;case 20:if(!e.t0){e.next=24;break}h=u[0],e.next=27;break;case 24:return e.next=26,this.newChild(n,r);case 26:h=e.sent;case 27:if("string"!==typeof t){e.next=32;break}return e.next=30,this.setLine(h.row,t.split(""));case 30:e.next=45;break;case 32:return t.id&&(a[t.id]=h.row),l=t.text.split(""),e.next=36,Promise.all([this.setLine(h.row,l),this.setCollapsed(h.row,t.collapsed)]);case 36:if(!t.children){e.next=45;break}p=0;case 38:if(!(p<t.children.length)){e.next=45;break}return f=t.children[p],e.next=42,this.loadTo(f,h,-1,a);case 42:p++,e.next=38;break;case 45:return e.next=47,this.emitAsync("loadRow",h,t.plugins||{});case 47:return e.abrupt("return",h);case 48:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=0;case 2:if(!(r<t.length)){e.next=9;break}return a=t[r],e.next=6,this.loadTo(a,this.root,-1,n,!0);case 6:r++,e.next=2;break;case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadEmpty",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load([""]);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(J),ot=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.call(this,new Te(new Pe))}return n}(it),ct=n(21),ut={};!function(e){e[e.UNREGISTERED=0]="UNREGISTERED",e[e.DISABLING=1]="DISABLING",e[e.DISABLED=2]="DISABLED",e[e.ENABLING=3]="ENABLING",e[e.ENABLED=4]="ENABLED"}(nt||(nt={}));var ht=function(){function e(t,n,r,a,s){Object(g.a)(this,e),this.session=void 0,this.metadata=void 0,this.pluginManager=void 0,this.name=void 0,this.document=void 0,this.cursor=void 0,this.logger=void 0,this.bindings=void 0,this.definitions=void 0,this.config=void 0,this.registrations=void 0,this.session=n,this.config=t,this.metadata=a,this.pluginManager=s,this.name=this.metadata.name,this.document=this.session.document,this.cursor=this.session.cursor,this.logger=I,this.bindings=r,this.definitions=this.bindings.definitions,this.registrations=[]}return Object(N.a)(e,[{key:"getPlugin",value:function(e){var t,n=!1,r=Object(ct.a)(this.metadata.dependencies||[]);try{for(r.s();!(t=r.n()).done;){t.value===e&&(n=!0)}}catch(s){r.e(s)}finally{r.f()}if(!n)throw new S("Plugin ".concat(this.metadata.name," asked for plugin ").concat(e," but did not list it as a dependency"));var a=this.pluginManager.getInfo(e);if(a.status!==nt.ENABLED)throw new S("Plugin ".concat(e," was not enabled but required by ").concat(this.metadata.name,"??"));return a.value}},{key:"setData",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.store.setPluginData(this.name,t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getData",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,e.next=3,this.document.store.getPluginData(this.name,t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updatedDataForRender",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.updateCachedPluginData(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"registerMode",value:function(e){var t=this,n=U(e);return this.registrations.push((function(){t.deregisterMode(e)})),n}},{key:"deregisterMode",value:function(e){V(e)}},{key:"registerDefaultMappings",value:function(e,t){var n=this;this.config.defaultMappings.registerModeMappings(e,t),this.registrations.push((function(){n.deregisterDefaultMappings(e,t)}))}},{key:"deregisterDefaultMappings",value:function(e,t){this.config.defaultMappings.deregisterModeMappings(e,t)}},{key:"registerMotion",value:function(e,t,n){var r=this,a=new oe(e,t,n);return this.definitions.registerMotion(a),this.registrations.push((function(){r.deregisterMotion(a.name)})),a}},{key:"deregisterMotion",value:function(e){this.definitions.deregisterMotion(e)}},{key:"registerAction",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=new ce(e,t,n,a);return this.definitions.registerAction(s),this.registrations.push((function(){r.deregisterAction(s.name)})),s}},{key:"deregisterAction",value:function(e){this.definitions.deregisterAction(e)}},{key:"_getEmitter",value:function(e){if("document"===e)return this.document;if("session"===e)return this.session;throw new S("Unknown hook listener ".concat(e))}},{key:"registerListener",value:function(e,t,n){var r=this;this._getEmitter(e).on(t,n),this.registrations.push((function(){r.deregisterListener(e,t,n)}))}},{key:"deregisterListener",value:function(e,t,n){this._getEmitter(e).off(t,n)}},{key:"registerHook",value:function(e,t,n){var r=this;this._getEmitter(e).addHook(t,n),this.registrations.push((function(){r.deregisterHook(e,t,n)})),this.document.cache.clear()}},{key:"deregisterHook",value:function(e,t,n){this._getEmitter(e).removeHook(t,n),this.document.cache.clear()}},{key:"deregisterAll",value:function(){this.registrations.reverse().forEach((function(e){e()})),this.registrations=[]}},{key:"panic",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.pluginManager.disable(this.name),new Error("Plugin '".concat(this.name,"' has encountered a major problem.\n      Please report this problem to the plugin author."));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),lt=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r,a){var s;return Object(g.a)(this,n),(s=t.call(this)).session=void 0,s.config=void 0,s.bindings=void 0,s.plugin_infos=void 0,s.session=e,s.config=r,s.bindings=a,s.plugin_infos={},s}return Object(N.a)(n,[{key:"getInfo",value:function(e){return this.plugin_infos[e]}},{key:"getStatus",value:function(e){return ut[e]?this.plugin_infos[e]&&this.plugin_infos[e].status||nt.DISABLED:nt.UNREGISTERED}},{key:"setStatus",value:function(e,t){if(I.debug("Plugin ".concat(e," status: ").concat(t)),!ut[e])throw new Error("Plugin ".concat(e," was not registered"));var n=this.plugin_infos[e]||{};n.status=t,this.plugin_infos[e]=n,this.emit("status")}},{key:"updateEnabledPlugins",value:function(){var e=[];for(var t in this.plugin_infos)this.getStatus(t)===nt.ENABLED&&e.push(t);this.emit("enabledPluginsChange",e)}},{key:"enable",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.getStatus(t))!==nt.UNREGISTERED){e.next=4;break}return I.error("No plugin registered as ".concat(t)),e.abrupt("return");case 4:if(n!==nt.ENABLING){e.next=6;break}throw new S("Already enabling plugin ".concat(t));case 6:if(n!==nt.DISABLING){e.next=8;break}throw new S("Still disabling plugin ".concat(t));case 8:if(n!==nt.ENABLED){e.next=10;break}throw new S("Plugin ".concat(t," is already enabled"));case 10:r=ut[t],a=Object(ct.a)(r.dependencies||[]),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=21;break}if(o=i.value,this.getStatus(o)===nt.ENABLED){e.next=19;break}throw new S("Plugin ".concat(t," requires ").concat(o," to be enabled"));case 19:e.next=14;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(12),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:return E(n===nt.DISABLED),this.setStatus(t,nt.ENABLING),c=new ht(this.config,this.session,this.bindings,r,this),e.next=34,r.enable(c);case 34:u=e.sent,this.plugin_infos[t]={api:c,value:u},this.setStatus(t,nt.ENABLED),this.updateEnabledPlugins();case 38:case"end":return e.stop()}}),e,this,[[12,23,26,29]])})));return function(t){return e.apply(this,arguments)}}()},{key:"disable",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c,u,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.getStatus(t))!==nt.UNREGISTERED){e.next=3;break}throw new S("No plugin registered as ".concat(t));case 3:if(n!==nt.ENABLING){e.next=5;break}throw new S("Still enabling plugin ".concat(t));case 5:if(n!==nt.DISABLING){e.next=7;break}throw new S("Already disabling plugin ".concat(t));case 7:if(n!==nt.DISABLED){e.next=9;break}throw new S("Plugin ".concat(t," already disabled"));case 9:e.t0=s.a.keys(this.plugin_infos);case 10:if((e.t1=e.t0()).done){e.next=33;break}if(r=e.t1.value,this.getStatus(r)!==nt.ENABLED){e.next=31;break}a=this.plugin_infos[r].api.metadata,i=Object(ct.a)(a.dependencies||[]),e.prev=15,i.s();case 17:if((o=i.n()).done){e.next=23;break}if(c=o.value,t!==c){e.next=21;break}throw new S("Cannot disable ".concat(t," because ").concat(r," requires it"));case 21:e.next=17;break;case 23:e.next=28;break;case 25:e.prev=25,e.t2=e.catch(15),i.e(e.t2);case 28:return e.prev=28,i.f(),e.finish(28);case 31:e.next=10;break;case 33:if(E(n===nt.ENABLED),this.setStatus(t,nt.DISABLING),u=this.plugin_infos[t]){e.next=38;break}throw new Error("Enabled plugin ".concat(t," missing from info?"));case 38:if(u.api){e.next=40;break}throw new Error("Enabled plugin ".concat(t," missing api?"));case 40:if(h=ut[t]){e.next=43;break}throw new Error("Enabled plugin ".concat(t," missing from registration?"));case 43:return e.next=45,h.disable(u.api,u.value);case 45:delete this.plugin_infos[t],this.updateEnabledPlugins();case 47:case"end":return e.stop()}}),e,this,[[15,25,28,31]])})));return function(t){return e.apply(this,arguments)}}()}]),n}(J),pt=function(e,t,n){e.version=e.version||1,e.author=e.author||"anonymous";var r=Object(Ie.a)(Object(Ie.a)({},j.cloneDeep(e)),{},{enable:t,disable:n||j.once((function(e){throw e.deregisterAll(),new Error("The plugin '".concat(r.name,"' was disabled but doesn't support online disable functionality. Refresh to disable."))}))});ut[r.name]=r};var ft=function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a.length>3&&void 0!==a[3]?a[3]:{}).noSiblingCheck){e.next=7;break}return e.next=4,t.document._hasChild(n,r);case 4:if(!e.sent){e.next=7;break}return t.showMessage("Cloned rows cannot be inserted as siblings",{text_class:"error"}),e.abrupt("return",!1);case 7:return e.t0=j,e.next=10,t.document.allAncestors(n,{inclusive:!0});case 10:if(e.t1=e.sent,e.t2=r,!e.t0.includes.call(e.t0,e.t1,e.t2)){e.next=15;break}return t.showMessage("Cloned rows cannot be nested under themselves",{text_class:"error"}),e.abrupt("return",!1);case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),dt=function(){function e(){Object(g.a)(this,e)}return Object(N.a)(e,[{key:"str",value:function(){return""}},{key:"validate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new C;case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"remutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"moveCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),vt=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r,a){var s;return Object(g.a)(this,n),(s=t.call(this)).row=void 0,s.col=void 0,s.chars=void 0,s.row=e,s.col=r,s.chars=a,s}return Object(N.a)(n,[{key:"str",value:function(){return"row ".concat(this.row,", col ").concat(this.col,", nchars ").concat(this.chars.length)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.document.writeChars(this.row,this.col,this.chars);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new bt(this.row,this.col,this.chars.length)]);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"moveCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.path.row===this.row){e.next=2;break}return e.abrupt("return");case 2:if(!(t.col>=this.col)){e.next=5;break}return e.next=5,t.setCol(t.col+this.chars.length);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dt),bt=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r,a){var s;return Object(g.a)(this,n),(s=t.call(this)).row=void 0,s.col=void 0,s.nchars=void 0,s.deletedChars=[],s.row=e,s.col=r,s.nchars=a,s}return Object(N.a)(n,[{key:"str",value:function(){return"row ".concat(this.row,", col ").concat(this.col,", nchars ").concat(this.nchars)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.document.deleteChars(this.row,this.col,this.nchars);case 2:this.deletedChars=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new vt(this.row,this.col,this.deletedChars)]);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"moveCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.row===this.row){e.next=2;break}return e.abrupt("return");case 2:if(!(t.col<this.col)){e.next=6;break}return e.abrupt("return");case 6:if(!(t.col<this.col+this.nchars)){e.next=11;break}return e.next=9,t.setCol(this.col);case 9:e.next=13;break;case 11:return e.next=13,t.setCol(t.col-this.nchars);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dt),xt=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r,a,s,i){var o;return Object(g.a)(this,n),(o=t.call(this)).row=void 0,o.col=void 0,o.nchars=void 0,o.transform=void 0,o.newChars=void 0,o.deletedChars=[],o.ncharsDeleted=0,o.row=e,o.col=r,o.nchars=a,o.transform=s,o.newChars=i,o}return Object(N.a)(n,[{key:"str",value:function(){return"change row ".concat(this.row,", col ").concat(this.col,", nchars ").concat(this.nchars)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.document.deleteChars(this.row,this.col,this.nchars);case 2:if(this.deletedChars=e.sent,this.ncharsDeleted=this.deletedChars.length,this.transform&&(this.newChars=this.transform(this.deletedChars),E(this.newChars.length===this.ncharsDeleted)),this.newChars){e.next=7;break}throw new Error("Changechars should receive either transform or newChars");case 7:return e.next=9,t.document.writeChars(this.row,this.col,this.newChars);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.newChars){e.next=2;break}throw new Error("No new chars after mutation?");case 2:return e.abrupt("return",[new n(this.row,this.col,this.newChars.length,void 0,this.deletedChars)]);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"remutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.newChars){e.next=2;break}throw new Error("No new chars after mutation?");case 2:return e.next=4,t.document.deleteChars(this.row,this.col,this.ncharsDeleted);case 4:return e.next=6,t.document.writeChars(this.row,this.col,this.newChars);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dt),wt=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r,a){var s;if(Object(g.a)(this,n),(s=t.call(this)).path=void 0,s.parent=void 0,s.old_parent=void 0,s.index=void 0,s.old_index=-1,s.path=e,s.parent=r,null==s.path.parent)throw new Error("Can't move root");return s.old_parent=s.path.parent,s.index=void 0===a?-1:a,s}return Object(N.a)(n,[{key:"str",value:function(){return"move ".concat(this.path.row," from ").concat(this.old_parent.row," to ").concat(this.parent.row)}},{key:"validate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.path.isRoot()){e.next=3;break}return t.showMessage("Cannot detach root",{text_class:"error"}),e.abrupt("return",!1);case 3:return n=this.parent.row===this.old_parent.row,e.next=6,ft(t,this.parent.row,this.path.row,{noSiblingCheck:n});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.document._move(this.path.row,this.old_parent.row,this.parent.row,this.index);case 2:n=e.sent,this.old_index=n.old.child_index;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new n(this.parent.extend([this.path.row]),this.old_parent,this.old_index)]);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"moveCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=t.path.walkFrom(this.path))){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,t._setPath(this.parent.extend([this.path.row]).extend(n));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dt),gt=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r,a){var s;return Object(g.a)(this,n),(s=t.call(this)).parent=void 0,s.cloned_rows=void 0,s.nrows=void 0,s.index=void 0,s.parent=e,s.cloned_rows=r,s.nrows=s.cloned_rows.length,s.index=void 0===a?-1:a,s}return Object(N.a)(n,[{key:"str",value:function(){return"parent ".concat(this.parent,", index ").concat(this.index)}},{key:"validate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.cloned_rows.length)){e.next=10;break}return r=this.cloned_rows[n],e.next=5,ft(t,this.parent,r);case 5:if(e.sent){e.next=7;break}return e.abrupt("return",!1);case 7:n++,e.next=1;break;case 10:return e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.document._attachChildren(this.parent,this.cloned_rows,this.index);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new kt(this.parent,this.index,this.nrows)]);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dt),kt=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r){var a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(g.a)(this,n),(a=t.call(this)).parent=void 0,a.index=void 0,a.nrows=void 0,a.deleted=[],a.next=[],a.created_info=null,a.options=void 0,a.parent=e,a.index=r,a.nrows=s,a.options=i,a}return Object(N.a)(n,[{key:"str",value:function(){return"parent ".concat(this.parent,", index ").concat(this.index,", nrows ").concat(this.nrows)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c,u,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.document._getChildren(this.parent,this.index,this.index+this.nrows-1);case 2:this.deleted=e.sent,n=0;case 4:if(!(n<this.deleted.length)){e.next=11;break}return r=this.deleted[n],e.next=8,t.document._detach(r,this.parent);case 8:n++,e.next=4;break;case 11:if(this.created_info=null,!this.options.addNew){e.next=17;break}return e.next=15,t.document._newChild(this.parent,this.index);case 15:a=e.sent,this.created_info=a;case 17:return e.next=19,t.document._getChildren(this.parent);case 19:if(i=e.sent,!(this.index<i.length)){e.next=24;break}o=[i[this.index]],e.next=40;break;case 24:if(0!==this.index){e.next=35;break}if(o=[],this.parent!==t.document.root.row){e.next=33;break}if(this.options.noNew){e.next=33;break}return e.next=30,t.document._newChild(this.parent);case 30:c=e.sent,this.created_info=c,o=[c.row];case 33:e.next=40;break;case 35:return u=i[this.index-1],e.next=38,t.document.walkToLastVisible(u);case 38:h=e.sent,o=[u].concat(h);case 40:this.next=o;case 41:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],null!==this.created_info&&t.push(new n(this.parent,this.created_info.child_index,1,{noNew:!0})),t.push(new gt(this.parent,this.deleted,this.index)),e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"remutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.deleted.length)){e.next=8;break}return r=this.deleted[n],e.next=5,t.document._detach(r,this.parent);case 5:n++,e.next=1;break;case 8:if(null===this.created_info){e.next=11;break}return e.next=11,t.document._attach(this.created_info.row,this.parent,this.created_info.child_index);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"moveCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=t.path.shedUntil(this.parent))){e.next=3;break}return e.abrupt("return");case 3:if(r=Object(B.a)(n,2),a=r[0],i=r[1],0!==a.length){e.next=6;break}return e.abrupt("return");case 6:if(o=a[0],-1!==this.deleted.indexOf(o)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,t.setPosition(i.extend(this.next),0);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dt),mt=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r,a){var s;return Object(g.a)(this,n),(s=t.call(this)).parent=void 0,s.serialized_rows=void 0,s.index=void 0,s.nrows=void 0,s.added_rows=[],s.parent=e,s.serialized_rows=a,s.index=void 0===r?-1:r,s.nrows=s.serialized_rows.length,s}return Object(N.a)(n,[{key:"str",value:function(){return"parent ".concat(this.parent.row,", index ").concat(this.index)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.index,r={},this.added_rows=[],a=0;case 4:if(!(a<this.serialized_rows.length)){e.next=14;break}return i=this.serialized_rows[a],e.next=8,t.document.loadTo(i,this.parent,n,r);case 8:o=e.sent,this.added_rows.push(o),n+=1;case 11:a++,e.next=4;break;case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new kt(this.parent.row,this.index,this.nrows)]);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"remutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.index,r=0;case 2:if(!(r<this.added_rows.length)){e.next=10;break}return a=this.added_rows[r],e.next=6,t.document.attachChild(this.parent,a,n);case 6:n+=1;case 7:r++,e.next=2;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dt),yt=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this)).row=void 0,r.row=e,r}return Object(N.a)(n,[{key:"str",value:function(){return"row ".concat(this.row)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.document.toggleCollapsed(this.row);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[this]);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(dt),jt=/^[a-z0-9_]+$/i,Ot=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r){var a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return Object(g.a)(this,n),(a=t.call(this)).col=void 0,a.path=void 0,a.session=void 0,a.document=void 0,a.moveCol=void 0,a.session=e,a.document=e.document,a.path=r,a.col=s,a.moveCol=null!==i?i:s,a}return Object(N.a)(n,[{key:"clone",value:function(){return new n(this.session,this.path,this.col,this.moveCol)}},{key:"_setPath",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.emitAsync("rowChange",this.path,t);case 2:this.path=t;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setCol",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.emitAsync("colChange",this.col,t);case 2:this.col=t;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"from",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setPath(t.path);case 2:return e.next=4,this._setCol(t.col);case 4:this.moveCol=t.moveCol;case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setPosition",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setPath(t);case 2:return e.next=4,this.setCol(n,r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setPath",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setPath(t);case 2:return e.next=4,this._fromMoveCol(n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setCol",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{pastEnd:!0},this.moveCol=t,e.next=4,this._fromMoveCol(n);case 4:this.moveCol>=0&&(this.moveCol=this.col);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fromMoveCol",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},e.next=3,this.document.getLength(this.path.row);case 3:return n=e.sent,r=n-(t.pastEnd?0:1),a=this.moveCol<0?Math.max(0,n+this.moveCol+1):Math.max(0,Math.min(r,this.moveCol)),e.next=8,this._setCol(a);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_left",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setCol(this.col-1);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_right",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setCol(this.col+1);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"left",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.col>0)){e.next=3;break}return e.next=3,this._left();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"right",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=t.pastEnd?0:1,e.t0=this.col,e.next=5,this.document.getLength(this.path.row);case 5:if(e.t1=e.sent,e.t2=n,e.t3=e.t1-e.t2,!(e.t0<e.t3)){e.next=11;break}return e.next=11,this._right();case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backIfNeeded",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.col,e.next=3,this.document.getLength(this.path.row);case 3:if(e.t1=e.sent,e.t2=e.t1-1,!(e.t0>e.t2)){e.next=9;break}return e.next=8,this.left();case 8:return e.abrupt("return",!0);case 9:return e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"atVisibleEnd",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.col,e.next=3,this.document.getLength(this.path.row);case 3:if(e.t1=e.sent,e.t2=e.t1-1,!(e.t0<e.t2)){e.next=9;break}return e.abrupt("return",!1);case 9:return e.next=11,this.session.nextVisible(this.path);case 11:if(null===e.sent){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_nextChar",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.col,e.next=3,this.document.getLength(this.path.row);case 3:if(e.t1=e.sent,e.t2=e.t1-1,!(e.t0<e.t2)){e.next=11;break}return e.next=8,this._right();case 8:return e.abrupt("return",!0);case 11:return e.next=13,this.session.nextVisible(this.path);case 13:if(null===(t=e.sent)){e.next=18;break}return e.next=17,this.setPosition(t,0);case 17:return e.abrupt("return",!0);case 18:return e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"atVisibleStart",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.col>0)){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,this.session.prevVisible(this.path);case 6:if(null===e.sent){e.next=9;break}return e.abrupt("return",!1);case 9:return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_prevChar",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.col>0)){e.next=6;break}return e.next=3,this._left();case 3:return e.abrupt("return",!0);case 6:return e.next=8,this.session.prevVisible(this.path);case 8:if(null===(t=e.sent)){e.next=13;break}return e.next=12,this.setPosition(t,-1);case 12:return e.abrupt("return",!0);case 13:return e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"home",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setCol(0);case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"end",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.setCol(t.pastEnd?-1:-2);case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"visibleHome",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.session.viewRoot.isRoot()){e.next=11;break}return e.next=3,this.session.nextVisible(this.session.viewRoot);case 3:if(null!=(n=e.sent)){e.next=6;break}throw new Error("No next visible for root?");case 6:if(null!=n.parent){e.next=8;break}throw new Error("Next visible of root was root?");case 8:t=n,e.next=12;break;case 11:t=this.session.viewRoot;case 12:return e.next=14,this.setPosition(t,0);case 14:return e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"visibleEnd",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.session.lastVisible();case 2:return t=e.sent,e.next=5,this.setPosition(t,0);case 5:return e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isInWhitespace",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.getChar(t.row,n);case 2:return r=e.sent,e.abrupt("return",Qe(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"isInWord",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Qe(r)){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this.document.getChar(t.row,n);case 4:if(!Qe(a=e.sent)){e.next=7;break}return e.abrupt("return",!1);case 7:if(!jt.test(a)){e.next=11;break}return e.abrupt("return",jt.test(r));case 11:return e.abrupt("return",!jt.test(r));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_getWordCheck",value:function(e,t){var n=this;return e.whitespaceWord?function(){var e=Object(i.a)(s.a.mark((function e(t,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.isInWhitespace(t,r);case 2:return e.abrupt("return",!e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}():function(){var e=Object(i.a)(s.a.mark((function e(r,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.isInWord(r,a,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}},{key:"beginningWord",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.atVisibleStart();case 3:if(!e.sent){e.next=5;break}return e.abrupt("return",this);case 5:return e.next=7,this._prevChar();case 7:return e.next=9,this.atVisibleStart();case 9:if(e.t0=!e.sent,!e.t0){e.next=14;break}return e.next=13,this.isInWhitespace(this.path,this.col);case 13:e.t0=e.sent;case 14:if(!e.t0){e.next=19;break}return e.next=17,this._prevChar();case 17:e.next=7;break;case 19:return e.t1=this,e.t2=t,e.next=23,this.document.getChar(this.path.row,this.col);case 23:e.t3=e.sent,n=e.t1._getWordCheck.call(e.t1,e.t2,e.t3);case 25:if(e.t4=this.col>0,!e.t4){e.next=30;break}return e.next=29,n(this.path,this.col-1);case 29:e.t4=e.sent;case 30:if(!e.t4){e.next=35;break}return e.next=33,this._left();case 33:e.next=25;break;case 35:return e.abrupt("return",this);case 36:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"endWord",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},e.next=3,this.atVisibleEnd();case 3:if(!e.sent){e.next=8;break}if(!t.cursor||!t.cursor.pastEnd){e.next=7;break}return e.next=7,this._right();case 7:return e.abrupt("return",this);case 8:return e.next=10,this._nextChar();case 10:return e.next=12,this.atVisibleEnd();case 12:if(e.t0=!e.sent,!e.t0){e.next=17;break}return e.next=16,this.isInWhitespace(this.path,this.col);case 16:e.t0=e.sent;case 17:if(!e.t0){e.next=22;break}return e.next=20,this._nextChar();case 20:e.next=10;break;case 22:return e.next=24,this.document.getLength(this.path.row);case 24:return e.t1=e.sent,n=e.t1-1,e.t2=this,e.t3=t,e.next=30,this.document.getChar(this.path.row,this.col);case 30:e.t4=e.sent,r=e.t2._getWordCheck.call(e.t2,e.t3,e.t4);case 32:if(e.t5=this.col<n,!e.t5){e.next=37;break}return e.next=36,r(this.path,this.col+1);case 36:e.t5=e.sent;case 37:if(!e.t5){e.next=42;break}return e.next=40,this._right();case 40:e.next=32;break;case 42:if(!t.cursor||!t.cursor.pastEndWord){e.next=45;break}return e.next=45,this._right();case 45:return e.next=47,this.document.getLength(this.path.row);case 47:if(e.t6=e.sent,n=e.t6-1,this.col!==n||!t.cursor||!t.cursor.pastEnd){e.next=52;break}return e.next=52,this._right();case 52:return e.abrupt("return",this);case 53:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nextWord",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},e.next=3,this.atVisibleEnd();case 3:if(!e.sent){e.next=8;break}if(!t.cursor||!t.cursor.pastEnd){e.next=7;break}return e.next=7,this._right();case 7:return e.abrupt("return",this);case 8:return e.next=10,this.document.getLength(this.path.row);case 10:return e.t0=e.sent,n=e.t0-1,e.t1=this,e.t2=t,e.next=16,this.document.getChar(this.path.row,this.col);case 16:e.t3=e.sent,r=e.t1._getWordCheck.call(e.t1,e.t2,e.t3);case 18:if(e.t4=this.col<n,!e.t4){e.next=23;break}return e.next=22,r(this.path,this.col+1);case 22:e.t4=e.sent;case 23:if(!e.t4){e.next=28;break}return e.next=26,this._right();case 26:e.next=18;break;case 28:return e.next=30,this._nextChar();case 30:a=!1,i=!1;case 32:return e.next=35,this.isInWhitespace(this.path,this.col);case 35:if(e.sent){e.next=38;break}return i&&(a=!0),e.abrupt("break",47);case 38:return i=!0,e.next=41,this.atVisibleEnd();case 41:if(!e.sent){e.next=43;break}return e.abrupt("break",47);case 43:return e.next=45,this._nextChar();case 45:e.next=32;break;case 47:if(a){e.next=56;break}if(!t.cursor||!t.cursor.pastEnd){e.next=56;break}return e.next=51,this.document.getLength(this.path.row);case 51:if(e.t5=e.sent,n=e.t5-1,this.col!==n){e.next=56;break}return e.next=56,this._right();case 56:return e.abrupt("return",this);case 57:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"findNextChar",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},e.next=3,this.document.getLength(this.path.row);case 3:if(e.t0=e.sent,r=e.t0-1,this.col!==r){e.next=7;break}return e.abrupt("return");case 7:a=this.col,n.beforeFound&&(a+=1),i=null;case 10:if(!(a<r)){e.next=21;break}return a+=1,e.next=14,this.document.getChar(this.path.row,a);case 14:if(e.t1=e.sent,e.t2=t,e.t1!==e.t2){e.next=19;break}return i=a,e.abrupt("break",21);case 19:e.next=10;break;case 21:if(null!==i){e.next=23;break}return e.abrupt("return");case 23:return e.next=25,this.setCol(i);case 25:if(!n.cursor||!n.cursor.pastEnd){e.next=28;break}return e.next=28,this._right();case 28:if(!n.beforeFound){e.next=32;break}return e.next=31,this._left();case 31:return e.abrupt("return",e.sent);case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findPrevChar",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},0!==this.col){e.next=3;break}return e.abrupt("return");case 3:r=this.col,n.beforeFound&&(r-=1),a=null;case 6:if(!(r>0)){e.next=17;break}return r-=1,e.next=10,this.document.getChar(this.path.row,r);case 10:if(e.t0=e.sent,e.t1=t,e.t0!==e.t1){e.next=15;break}return a=r,e.abrupt("break",17);case 15:e.next=6;break;case 17:if(null!==a){e.next=19;break}return e.abrupt("return");case 19:return e.next=21,this.setCol(a);case 21:if(!n.beforeFound){e.next=24;break}return e.next=24,this._right();case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"up",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.session.prevVisible(this.path);case 3:if(null===(n=e.sent)){e.next=7;break}return e.next=7,this.setPath(n,t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"down",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.session.nextVisible(this.path);case 3:if(null===(n=e.sent)){e.next=7;break}return e.next=7,this.setPath(n,t);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"parent",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},null!=(n=this.path.parent)){e.next=4;break}throw new Error("Cursor was at root");case 4:if(null!=n.parent){e.next=6;break}return e.abrupt("return");case 6:if(!this.path.is(this.session.viewRoot)){e.next=9;break}return e.next=9,this.session.changeViewRoot(n);case 9:return e.next=11,this.setPath(n,t);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"prevSibling",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.document.getSiblingBefore(this.path);case 3:if(null===(n=e.sent)){e.next=8;break}return e.next=7,this.setPath(n,t);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nextSibling",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.document.getSiblingAfter(this.path);case 3:if(null===(n=e.sent)){e.next=8;break}return e.next=7,this.setPath(n,t);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"row",get:function(){return this.path.row}}]),n}(J),Ct=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(Object(g.a)(this,e),this.row=void 0,this.cursor=void 0,this.selected=void 0,this.visual=void 0,this.children=void 0,this.parent=void 0,this.hasSelection=void 0,null===n&&t!==rt.rootRow())throw new Error("CursorsInfoTree rooted at non-root row");this.row=t,this.visual=!1,this.selected={},this.cursor=null,this.children={},this.parent=n,this.hasSelection=!1}return Object(N.a)(e,[{key:"getPath",value:function(e){var t=this;return e.getAncestry().forEach((function(e){t=t.getChild(e)})),t}},{key:"getChild",value:function(t){var n=this.children[t];if(null!=n)return n;var r=new e(t,this);return this.children[t]=r,r}},{key:"markSelected",value:function(){this.hasSelection||(this.hasSelection=!0,this.parent&&this.parent.markSelected())}},{key:"markCols",value:function(e){var t=this;e.forEach((function(e){t.selected[e]=!0})),this.markSelected()}},{key:"markCursor",value:function(e){this.cursor=e,this.markSelected()}},{key:"markVisual",value:function(){this.visual=!0,this.markSelected()}},{key:"markChildrenVisual",value:function(e){var t=this;e.forEach((function(e){t.getChild(e).markVisual()}))}}]),e}(),_t=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e,r){var a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(g.a)(this,n),(a=t.call(this)).mode=void 0,a.clientStore=void 0,a.document=void 0,a.register=void 0,a.cursor=void 0,a._anchor=void 0,a.viewRoot=void 0,a.menu=null,a.mutations=[],a.history=[],a.historyIndex=0,a.jumpHistory=[],a.jumpIndex=0,a.getLinesPerPage=void 0,a.showMessage=void 0,a.toggleBindingsDiv=void 0,a.clientStore=e,a.document=r,a.showMessage=s.showMessage||function(e){I.info("Showing message: ".concat(e))},a.toggleBindingsDiv=s.toggleBindingsDiv||function(){return null},a.getLinesPerPage=s.getLinesPerPage||function(){return 10},a.register=new G(Object(Ge.a)(a)),a.menu=null,a.viewRoot=s.viewRoot||rt.root(),a.cursor=new Ot(Object(Ge.a)(a),s.cursorPath||a.viewRoot,0),a._anchor=null,a.reset_history(),a.reset_jump_history();var i=s.initialMode||"NORMAL";return a.mode=i,Object(Ke.a)(a,Object(Ge.a)(a))}return Object(N.a)(n,null,[{key:"swapCase",value:function(e){return e.map((function(e){return e.toLowerCase()===e?e.toUpperCase():e.toLowerCase()}))}}]),Object(N.a)(n,[{key:"exit",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.emitAsync("exit");case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setMode",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this.mode){e.next=2;break}return e.abrupt("return");case 2:if(!(n=this.mode)){e.next=6;break}return e.next=6,K(n).exit(this,t);case 6:return this.mode=t,e.next=9,K(this.mode).enter(this,n);case 9:this.emit("modeChange",n,t);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseJson",value:function(e){var t;try{t=JSON.parse(e)}catch(n){return this.showMessage("The uploaded file is not valid JSON",{text_class:"error"}),!1}return function e(t){if(t.clone)return!0;if(!t.text&&""!==t.text)return!1;if(t.children)for(var n=0;n<t.children.length;n++){if(!e(t.children[n]))return!1}return!0}(t)?t:(this.showMessage("The uploaded file is not in a valid vimflowy format",{text_class:"error"}),!1)}},{key:"parsePlaintext",value:function(e){var t=[],n=/^\s*/;for(e.split("\n").forEach((function(e){var r=e.match(n),a=r?r[0].length:0;e.match(/^\s*".*"$/)?t.push({indent:a,line:e.replace(/^\s*"(.*)"$/,"$1"),annotation:!0}):t.push({indent:a,line:e.replace(n,"").replace(/^(?:-\s*)?(?:\[COMPLETE\] )?/,"")})}));""===t[t.length-1].line;)t=t.splice(0,t.length-1);var r=function e(n,r){var a=[];for(r<t.length&&t[r].annotation&&(a.push({text:t[r].line}),r+=1);r<t.length&&t[r].indent>n;){var s={text:t[r].line},i=e(t[r].indent,r+1);r=i.lineNumber,null!==i.children&&(s.children=i.children,s.collapsed=i.children.length>0),a.push(s)}return{children:a,lineNumber:r}}(-1,0).children;return{text:"",children:r,collapsed:r.length>0}}},{key:"parseContent",value:function(e,t){return"application/json"===t?this.parseJson(e):"text/plain"===t||"Text"===t?this.parsePlaintext(e):null}},{key:"importContent",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=t.replace(/(?:\r)/g,""),r=this.parseContent(t,n)){e.next=4;break}return e.abrupt("return",!1);case 4:if(a=this.cursor.path,""!==r.text||!r.children){e.next=10;break}return e.next=8,this.addBlocks(a,0,r.children);case 8:e.next=12;break;case 10:return e.next=12,this.addBlocks(a,0,[r]);case 12:return this.save(),this.emit("importFinished"),e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"exportContent",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.serialize();case 2:if(n=e.sent,"application/json"!==t){e.next=7;break}return e.abrupt("return",JSON.stringify(n,void 0,2));case 7:if("text/plain"!==t){e.next=13;break}return"  ",r=function e(t){if("string"===typeof t)return["- ".concat(t)];var n=[];return n.push("- ".concat(t.text)),(t.children||[]).forEach((function(t){t.clone||e(t).forEach((function(e){n.push("".concat("  ").concat(e))}))})),n},e.abrupt("return",r(n).join("\n"));case 13:throw new _("mimetype",t);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"exportFile",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:"json",this.showMessage("Exporting...",{time:0}),n=""===this.document.name?"vimflowy.".concat(t):"".concat(this.document.name,".").concat(t),r=w(n)){e.next=6;break}throw new Error("Invalid export type");case 6:return e.next=8,this.exportContent(r);case 8:a=e.sent,x(n,a,r),this.showMessage("Exported to ".concat(n,"!"),{text_class:"success"});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reset_history",value:function(){this.mutations=[],this.history=[{index:0}],this.historyIndex=0}},{key:"save",value:function(){this.historyIndex===this.history.length-1&&(this.history[this.historyIndex].index!==this.mutations.length&&(this.history[this.historyIndex].after={cursor:this.cursor.clone(),viewRoot:this.viewRoot},this.historyIndex+=1,this.history.push({index:this.mutations.length})))}},{key:"_restoreViewState",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cursor.from(t.cursor);case 2:return e.next=4,this.fixCursorForMode();case 4:return e.next=6,this.changeView(t.viewRoot);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"undo",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.historyIndex>0)){e.next=31;break}t=this.history[this.historyIndex],this.historyIndex-=1,n=this.history[this.historyIndex],I.debug("UNDOING <"),r=t.index-1;case 6:if(!(r>n.index-1)){e.next=26;break}return a=this.mutations[r],I.debug("  Undoing mutation ".concat(a.constructor.name,"(").concat(a.str(),")")),e.next=11,a.rewind(this);case 11:i=e.sent,o=0;case 13:if(!(o<i.length)){e.next=23;break}return c=i[o],I.debug("  Undo mutation ".concat(c.constructor.name,"(").concat(c.str(),")")),e.next=18,c.mutate(this);case 18:return e.next=20,c.moveCursor(this.cursor);case 20:o++,e.next=13;break;case 23:r--,e.next=6;break;case 26:if(I.debug("> END UNDO"),n.before){e.next=29;break}throw new Error("No previous cursor state found while undoing");case 29:return e.next=31,this._restoreViewState(n.before);case 31:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"redo",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.historyIndex<this.history.length-1)){e.next=25;break}t=this.history[this.historyIndex],this.historyIndex+=1,n=this.history[this.historyIndex],I.debug("REDOING <"),r=t.index;case 6:if(!(r<n.index)){e.next=20;break}return a=this.mutations[r],e.next=10,a.validate(this);case 10:if(e.sent){e.next=12;break}throw new S("Failed to redo mutation: ".concat(a.str()));case 12:return I.debug("  Redoing mutation ".concat(a.constructor.name,"(").concat(a.str(),")")),e.next=15,a.remutate(this);case 15:return e.next=17,a.moveCursor(this.cursor);case 17:r++,e.next=6;break;case 20:if(I.debug("> END REDO"),t.after){e.next=23;break}throw new Error("No after cursor state found while redoing");case 23:return e.next=25,this._restoreViewState(t.after);case 25:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"do",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.history){e.next=5;break}return I.warn("Tried mutation ".concat(t," before init!")),e.next=4,t.mutate(this);case 4:return e.abrupt("return",!0);case 5:return e.next=7,t.validate(this);case 7:if(e.sent){e.next=9;break}return e.abrupt("return",!1);case 9:return this.historyIndex!==this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1),this.mutations=this.mutations.slice(0,this.history[this.historyIndex].index)),n=this.history[this.historyIndex],this.mutations.length===n.index&&(n.before={cursor:this.cursor.clone(),viewRoot:this.viewRoot}),I.debug("Applying mutation ".concat(t.constructor.name,"(").concat(t.str(),")")),e.next=15,t.mutate(this);case 15:return e.next=17,t.moveCursor(this.cursor);case 17:return e.next=19,this.fixCursorForMode();case 19:return this.mutations.push(t),e.abrupt("return",!0);case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fixCursorForMode",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K(this.mode).metadata.cursorBetween){e.next=3;break}return e.next=3,this.cursor.backIfNeeded();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"viewable",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.is(this.viewRoot),e.t0){e.next=8;break}if(e.t1=t.isDescendant(this.viewRoot),!e.t1){e.next=7;break}return e.next=6,this.document.collapsed(t.row);case 6:e.t1=!e.sent;case 7:e.t0=e.t1;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isVisible",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.youngestVisibleAncestor(t);case 2:return n=e.sent,e.abrupt("return",null!==n&&t.is(n));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"nextVisible",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewable(t);case 2:if(!e.sent){e.next=8;break}return e.next=5,this.document.getChildren(t);case 5:if(!((n=e.sent).length>0)){e.next=8;break}return e.abrupt("return",n[0]);case 8:if(!t.is(this.viewRoot)){e.next=10;break}return e.abrupt("return",null);case 10:return e.next=13,this.document.getSiblingAfter(t);case 13:if(null===(r=e.sent)){e.next=16;break}return e.abrupt("return",r);case 16:if(null!=t.parent){e.next=18;break}throw new Error("Did not encounter view root on way to root");case 18:if(!(t=t.parent).is(this.viewRoot)){e.next=21;break}return e.abrupt("return",null);case 21:e.next=10;break;case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"lastVisible",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:this.viewRoot,e.next=3,this.viewable(t);case 3:if(e.sent){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,this.document.getChildren(t);case 7:if(!((n=e.sent).length>0)){e.next=12;break}return e.next=11,this.lastVisible(n[n.length-1]);case 11:return e.abrupt("return",e.sent);case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"prevVisible",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.parent){e.next=2;break}return e.abrupt("return",null);case 2:if(!t.is(this.viewRoot)){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,this.document.getSiblingBefore(t);case 6:if(null===(n=e.sent)){e.next=11;break}return e.next=10,this.lastVisible(n);case 10:return e.abrupt("return",e.sent);case 11:if(!t.parent.is(this.viewRoot)){e.next=17;break}if(!t.parent.is(this.document.root)){e.next=16;break}return e.abrupt("return",null);case 16:return e.abrupt("return",this.viewRoot);case 17:return e.abrupt("return",t.parent);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"oldestVisibleAncestor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t;case 1:if(null!=n.parent){e.next=4;break}return e.abrupt("return",null);case 4:if(!(r=n.parent).is(this.viewRoot)){e.next=7;break}return e.abrupt("return",n);case 7:n=r,e.next=1;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"youngestVisibleAncestor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t,r=t;case 2:if(!r.is(this.viewRoot)){e.next=5;break}return e.abrupt("return",n);case 5:if(null!=r.parent){e.next=7;break}return e.abrupt("return",null);case 7:return e.next=9,this.document.collapsed(r.row);case 9:if(!e.sent){e.next=11;break}n=r;case 11:r=r.parent,e.next=2;break;case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeViewRoot",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.viewRoot=t,this.emit("changeViewRoot",t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"reset_jump_history",value:function(){this.jumpHistory=[{viewRoot:this.viewRoot,cursor_before:this.cursor.clone()}],this.jumpIndex=0}},{key:"_addToJumpHistory",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.jumpHistory[this.jumpIndex].cursor_after=this.cursor.clone(),this.jumpHistory=this.jumpHistory.slice(0,this.jumpIndex+1),e.next=5,t();case 5:this.jumpHistory.push({viewRoot:this.viewRoot,cursor_before:this.cursor.clone()}),this.jumpIndex+=1;case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"tryJump",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.viewRoot.row!==this.viewRoot.row){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this.document.isAttached(t.viewRoot.row);case 4:if(e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,this.document.getChildren(t.viewRoot);case 8:return n=e.sent,e.next=11,this.changeViewRoot(t.viewRoot);case 11:if(!n.length){e.next=16;break}return e.next=14,this.cursor.setPath(n[0]);case 14:e.next=18;break;case 16:return e.next=18,this.cursor.setPath(t.viewRoot);case 18:if(t.cursor_after){e.next=20;break}throw new Error("Jump should have had cursor_after");case 20:return e.next=22,this.document.isAttached(t.cursor_after.row);case 22:if(!e.sent){e.next=29;break}return e.next=25,this.youngestVisibleAncestor(t.cursor_after.path);case 25:if(null===(r=e.sent)){e.next=29;break}return e.next=29,this.cursor.setPath(r);case 29:return e.abrupt("return",!0);case 30:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"jumpPrevious",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.jumpIndex,this.jumpHistory[t].cursor_after=this.cursor.clone();case 3:if(0!==t){e.next=6;break}return e.abrupt("return",!1);case 6:return t-=1,n=this.jumpHistory[t],e.next=10,this.tryJump(n);case 10:if(!e.sent){e.next=13;break}return this.jumpIndex=t,e.abrupt("return",!0);case 13:e.next=3;break;case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"jumpNext",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.jumpIndex,this.jumpHistory[t].cursor_after=this.cursor.clone();case 3:if(t!==this.jumpHistory.length-1){e.next=6;break}return e.abrupt("return",!1);case 6:return t+=1,n=this.jumpHistory[t],e.next=10,this.tryJump(n);case 10:if(!e.sent){e.next=13;break}return this.jumpIndex=t,e.abrupt("return",!0);case 13:e.next=3;break;case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeView",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.is(this.viewRoot)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this._addToJumpHistory(Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.changeViewRoot(t);case 2:case"end":return e.stop()}}),e)}))));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"zoomInto",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.changeView(t);case 2:return e.next=4,this.youngestVisibleAncestor(this.cursor.path);case 4:return null===(n=e.sent)&&(n=t),e.next=8,this.cursor.setPath(n);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"zoomOut",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.viewRoot.parent){e.next=3;break}return e.next=3,this.zoomInto(this.viewRoot.parent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"zoomIn",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cursor.path.is(this.viewRoot)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.oldestVisibleAncestor(this.cursor.path);case 4:if(null!=(t=e.sent)){e.next=7;break}throw new Error("Got error zooming in to cursor");case 7:return e.next=9,this.zoomInto(t);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"zoomDown",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.getSiblingAfter(this.viewRoot);case 2:if(null!==(t=e.sent)){e.next=6;break}return this.showMessage("No next sibling to zoom down to",{text_class:"error"}),e.abrupt("return");case 6:return e.next=8,this.zoomInto(t);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"zoomUp",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.getSiblingBefore(this.viewRoot);case 2:if(null!==(t=e.sent)){e.next=6;break}return this.showMessage("No previous sibling to zoom up to",{text_class:"error"}),e.abrupt("return");case 6:return e.next=8,this.zoomInto(t);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"curLine",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.getLine(this.cursor.row);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"curText",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.getText(this.cursor.row);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"curLineLength",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.getLength(this.cursor.row);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addChars",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<0)){e.next=7;break}return e.next=3,this.document.getLength(t);case 3:e.t0=e.sent,e.t1=n,e.t2=e.t0+e.t1,n=e.t2+1;case 7:return e.next=9,this.do(new vt(t,n,r));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"addCharsAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addChars(this.cursor.row,this.cursor.col,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addCharsAfterCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.cursor.col,e.t0=n,e.next=4,this.document.getLength(this.cursor.row);case 4:if(e.t1=e.sent,!(e.t0<e.t1)){e.next=7;break}n+=1;case 7:return e.next=9,this.addChars(this.cursor.row,n,t);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delChars",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a,i,o,c,u=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>3&&void 0!==u[3]?u[3]:{},e.next=3,this.document.getLength(t);case 3:if(i=e.sent,o=[],n<0&&(n=i+n),!(i>0&&r>0&&n<i)){e.next=12;break}return c=new bt(t,n,r),e.next=10,this.do(c);case 10:o=c.deletedChars,a.yank&&this.register.saveChars(o);case 12:return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"delCharsBeforeCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},t=Math.min(this.cursor.col,t),e.next=4,this.delChars(this.cursor.path.row,this.cursor.col-t,t,n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delCharsAfterCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.delChars(this.cursor.path.row,this.cursor.col,t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"changeChars",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r,a){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new xt(t,n,r,a),e.next=3,this.do(i);case 3:return e.abrupt("return",i.ncharsDeleted);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"swapCaseAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.changeChars(this.cursor.row,this.cursor.col,1,n.swapCase);case 2:return e.next=4,this.cursor.right();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"swapCaseInVisual",value:function(){var e=Object(i.a)(s.a.mark((function e(t,r){var a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.path.is(t.path)){e.next=3;break}return I.warn("Not yet implemented"),e.abrupt("return");case 3:return r.col<t.col&&(t=(a=[r,t])[0],r=a[1]),i=r.col-t.col+1,e.next=7,this.changeChars(t.row,t.col,i,n.swapCase);case 7:return e.next=9,this.cursor.from(t);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"swapCaseInVisualLine",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=r,e.t1=t,e.next=4,r.document.getLength(t);case 4:return e.t2=e.sent,e.t3=n.swapCase,e.next=8,e.t0.changeChars.call(e.t0,e.t1,0,e.t2,e.t3);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceCharsAfterCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.changeChars(this.cursor.row,this.cursor.col,n,(function(e){return e.map((function(e){return t}))}));case 2:return r=e.sent,e.next=5,this.cursor.setCol(this.cursor.col+r-1);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearRowAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.yank){e.next=3;break}return e.next=3,this.yankRowAtCursor();case 3:return e.t0=this,e.t1=this.cursor.path.row,e.next=7,this.curLineLength();case 7:return e.t2=e.sent,e.next=10,e.t0.delChars.call(e.t0,e.t1,0,e.t2);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"yankChars",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.getLine(t.row);case 2:(a=e.sent).length>0&&this.register.saveChars(a.slice(n,n+r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"yankBetween",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>2&&void 0!==o[2]?o[2]:{},n.path.is(t.path)){e.next=4;break}return I.warn("Not yet implemented"),e.abrupt("return");case 4:return n.col<t.col&&(t=(a=[n,t])[0],n=a[1]),i=r.includeEnd?1:0,e.next=8,this.yankChars(t.path,t.col,n.col-t.col+i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"yankRowAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.serializeRow(this.cursor.row);case 2:return t=e.sent,e.abrupt("return",this.register.saveSerializedRows([t]));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteBetween",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>2&&void 0!==o[2]?o[2]:{},n.path.is(t.path)){e.next=4;break}return I.warn("Not yet implemented"),e.abrupt("return");case 4:return n.col<t.col&&(t=(a=[n,t])[0],n=a[1]),i=r.includeEnd?1:0,e.next=8,this.delChars(t.path.row,t.col,n.col-t.col+i,r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"newLineBelow",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o,c,u=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=u.length>0&&void 0!==u[0]?u[0]:{}).setCursor="first",e.next=4,Promise.all([this.document.collapsed(this.cursor.row),this.document.hasChildren(this.cursor.row)]);case 4:if(n=e.sent,r=Object(B.a)(n,2),a=r[0],i=r[1],!this.cursor.path.is(this.viewRoot)){e.next=17;break}if(i){e.next=13;break}if(a){e.next=13;break}return e.next=13,this.toggleBlockCollapsed(this.cursor.row);case 13:return e.next=15,this.addBlocks(this.cursor.path,0,[""],t);case 15:e.next=30;break;case 17:if(a||!i){e.next=22;break}return e.next=20,this.addBlocks(this.cursor.path,0,[""],t);case 20:e.next=30;break;case 22:if(null!=(o=this.cursor.path.parent)){e.next=25;break}throw new Error("Cursor was at viewroot?");case 25:return e.next=27,this.document.indexInParent(this.cursor.path);case 27:return c=e.sent,e.next=30,this.addBlocks(o,c+1,[""],t);case 30:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"newLineAbove",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cursor.path.is(this.viewRoot)){e.next=2;break}return e.abrupt("return");case 2:if(null!=(t=this.cursor.path.parent)){e.next=5;break}throw new Error("Cursor was at viewroot?");case 5:return e.next=7,this.document.indexInParent(this.cursor.path);case 7:return n=e.sent,e.next=10,this.addBlocks(t,n,[""],{setCursor:"first"});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"newLineAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.cursor.col,e.next=3,this.document.getLength(this.cursor.row);case 3:if(e.t1=e.sent,e.t0!==e.t1){e.next=9;break}return e.next=7,this.newLineBelow({cursorOptions:{}});case 7:e.next=19;break;case 9:return t=new bt(this.cursor.row,0,this.cursor.col),e.next=12,this.do(t);case 12:return n=this.cursor.path,e.next=15,this.newLineAbove();case 15:return e.next=17,this.addCharsAfterCursor(t.deletedChars);case 17:return e.next=19,this.cursor.setPosition(n,0,{});case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_joinRows",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>2&&void 0!==c[2]?c[2]:{},null!=t.parent){e.next=3;break}throw new Error("Tried to join first as root?");case 3:if(null!=n.parent){e.next=5;break}throw new Error("Tried to join first as root?");case 5:return a=null,e.next=8,this.document.getLine(t.row);case 8:return i=e.sent,e.next=11,this.document.getLine(n.row);case 11:return o=e.sent,r.delimiter&&i.length&&o.length&&i[i.length-1]!==r.delimiter&&o[0]!==r.delimiter&&(a=r.delimiter),e.next=15,this.document.hasChildren(n.row);case 15:if(e.sent){e.next=28;break}return e.next=18,this.cursor.setPosition(t,-1);case 18:return e.next=20,this.delBlock(n,{noNew:!0,noSave:!0});case 20:if(null==a){e.next=23;break}return e.next=23,this.do(new vt(t.row,i.length,[a]));case 23:return e.next=25,this.do(new vt(t.row,i.length+(null==a?0:1),o));case 25:return e.next=27,this.cursor.setPosition(t,i.length);case 27:return e.abrupt("return",!0);case 28:return e.next=30,this.document.hasChildren(t.row);case 30:if(!e.sent){e.next=33;break}return this.showMessage("Cannot join when both rows have children",{text_class:"error"}),e.abrupt("return",!1);case 33:if(n.parent.row===t.parent.row){e.next=36;break}return this.showMessage("Cannot join with non sibling/child",{text_class:"error"}),e.abrupt("return",!1);case 36:return e.next=38,this.cursor.setPosition(n,0);case 38:return e.next=40,this.delBlock(t,{noNew:!0,noSave:!0});case 40:if(null==a){e.next=43;break}return e.next=43,this.do(new vt(n.row,0,[a]));case 43:return e.next=45,this.do(new vt(n.row,0,i));case 45:if(null==a){e.next=48;break}return e.next=48,this.cursor.left();case 48:return e.abrupt("return",!0);case 49:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"joinAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.cursor.path,e.next=3,this.nextVisible(t);case 3:if(null!==(n=e.sent)){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,this._joinRows(t,n,{delimiter:" "});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deleteAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.cursor.col>0)){e.next=4;break}return e.next=3,this.delCharsBeforeCursor(1);case 3:return e.abrupt("return",!0);case 4:return t=this.cursor.path,e.next=7,this.prevVisible(t);case 7:if(null!==(n=e.sent)){e.next=10;break}return e.abrupt("return",!1);case 10:return e.next=12,this._joinRows(n,t);case 12:if(!e.sent){e.next=14;break}return e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delBlock",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.parent){e.next=2;break}throw new Error("Cannot delete root");case 2:return e.t0=this,e.t1=t.parent.row,e.next=6,this.document.indexInParent(t);case 6:return e.t2=e.sent,e.t3=n,e.next=10,e.t0.delBlocks.call(e.t0,e.t1,e.t2,1,e.t3);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"delBlocks",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},i=new kt(t,n,r,a),e.next=4,this.do(i);case 4:return a.noSave||this.register.saveClonedRows(i.deleted),e.next=7,this.isVisible(this.cursor.path);case 7:if(e.sent){e.next=10;break}return e.next=10,this.zoomOut();case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"delBlocksAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},null!=(r=this.cursor.path.parent)){e.next=4;break}throw new Error("Cursor was at root?");case 4:return e.next=6,this.document.indexInParent(this.cursor.path);case 6:return a=e.sent,e.next=9,this.delBlocks(r.row,a,t,n);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addBlocks",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:-1,r=o.length>2?o[2]:void 0,a=o.length>3&&void 0!==o[3]?o[3]:{},i=new mt(t,n,r),e.next=6,this.do(i);case 6:if("first"!==a.setCursor){e.next=11;break}return e.next=9,this.cursor.setPosition(i.added_rows[0],0,a.cursorOptions);case 9:e.next=14;break;case 11:if("last"!==a.setCursor){e.next=14;break}return e.next=14,this.cursor.setPosition(i.added_rows[i.added_rows.length-1],0,a.cursorOptions);case 14:return e.abrupt("return",i.added_rows);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"yankBlocks",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,o=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.getSiblingRange(t,0,n-1);case 2:return r=e.sent,e.next=5,Promise.all(r.map(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.document.serialize(t.row);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:a=e.sent,this.register.saveSerializedRows(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"yankBlocksAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yankBlocks(this.cursor.path,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"yankBlocksClone",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.getSiblingRange(t,0,n-1);case 2:r=e.sent,this.register.saveClonedRows(r.map((function(e){return e.row})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"yankBlocksCloneAtCursor",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.yankBlocksClone(this.cursor.path,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"attachBlocks",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>2&&void 0!==c[2]?c[2]:-1,a=c.length>3&&void 0!==c[3]?c[3]:{},i=new gt(t.row,n,r),e.next=5,i.validate(this);case 5:return o=e.sent,e.next=8,this.do(i);case 8:if(!o){e.next=17;break}if("first"!==a.setCursor){e.next=14;break}return e.next=12,this.cursor.setPosition(t.child(n[0]),0);case 12:e.next=17;break;case 14:if("last"!==a.setCursor){e.next=17;break}return e.next=17,this.cursor.setPosition(t.child(n[n.length-1]),0);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"moveBlock",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:-1,e.next=3,this.do(new wt(t,n,r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"indentBlocks",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:1,!t.is(this.viewRoot)){e.next=4;break}return this.showMessage("Cannot indent view root",{text_class:"error"}),e.abrupt("return");case 4:return e.next=6,this.document.getSiblingBefore(t);case 6:if(null!==(r=e.sent)){e.next=10;break}return this.showMessage("Cannot indent without higher sibling",{text_class:"error"}),e.abrupt("return",null);case 10:return e.next=12,this.document.collapsed(r.row);case 12:if(!e.sent){e.next=15;break}return e.next=15,this.toggleBlockCollapsed(r.row);case 15:return e.next=17,this.document.getSiblingRange(t,0,n-1);case 17:a=e.sent,i=0;case 19:if(!(i<a.length)){e.next=26;break}return o=a[i],e.next=23,this.moveBlock(o,r,-1);case 23:i++,e.next=19;break;case 26:return e.abrupt("return",r);case 27:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unindentBlocks",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c,u,h=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.length>1&&void 0!==h[1]?h[1]:1,t.row!==this.viewRoot.row){e.next=4;break}return this.showMessage("Cannot unindent view root",{text_class:"error"}),e.abrupt("return",null);case 4:if(null!=t.parent){e.next=6;break}throw new Error("Tried to unindent root?");case 6:if(null!=(r=t.parent).parent){e.next=10;break}return this.showMessage("Cannot unindent past root",{text_class:"error"}),e.abrupt("return");case 10:return e.next=12,this.document.getSiblingRange(t,0,n-1);case 12:return a=e.sent,i=r.parent,e.next=16,this.document.indexInParent(r);case 16:o=e.sent,c=0;case 18:if(!(c<a.length)){e.next=26;break}return u=a[c],o+=1,e.next=23,this.moveBlock(u,i,o);case 23:c++,e.next=18;break;case 26:if(!r.is(this.viewRoot)){e.next=29;break}return e.next=29,this.zoomInto(i);case 29:return e.abrupt("return",i);case 30:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"indent",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=o.length>0&&void 0!==o[0]?o[0]:this.cursor.path).is(this.viewRoot)){e.next=4;break}return this.showMessage("Cannot indent view root",{text_class:"error"}),e.abrupt("return");case 4:return e.next=6,this.document.collapsed(t.row);case 6:if(!e.sent){e.next=10;break}return e.next=9,this.indentBlocks(t);case 9:return e.abrupt("return");case 10:return e.next=12,this.document.getSiblingBefore(t);case 12:if(null!=(n=e.sent)){e.next=16;break}return this.showMessage("Cannot indent without higher sibling",{text_class:"error"}),e.abrupt("return");case 16:return e.next=18,this.indentBlocks(t);case 18:if(null!==e.sent){e.next=21;break}return e.abrupt("return");case 21:return e.next=23,this.document.getChildren(t);case 23:r=e.sent,a=0;case 25:if(!(a<r.length)){e.next=32;break}return i=r[a],e.next=29,this.moveBlock(i,n,-1);case 29:a++,e.next=25;break;case 32:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unindent",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=c.length>0&&void 0!==c[0]?c[0]:this.cursor.path).is(this.viewRoot)){e.next=4;break}return this.showMessage("Cannot unindent view root",{text_class:"error"}),e.abrupt("return");case 4:if(null!=(n=t.parent)){e.next=7;break}throw new Error("Path was at root and yet not viewRoot?");case 7:return e.next=9,this.document.collapsed(t.row);case 9:if(!e.sent){e.next=13;break}return e.next=12,this.unindentBlocks(t);case 12:return e.abrupt("return");case 13:return e.next=15,this.document.hasChildren(t.row);case 15:if(!e.sent){e.next=18;break}return this.showMessage("Cannot unindent line with children",{text_class:"error"}),e.abrupt("return");case 18:return e.next=20,this.document.indexInParent(t);case 20:return r=e.sent,e.next=23,this.unindentBlocks(t);case 23:if(null!==e.sent){e.next=26;break}return e.abrupt("return");case 26:return e.next=28,this.document.getChildren(n);case 28:a=e.sent.slice(r),i=0;case 30:if(!(i<a.length)){e.next=37;break}return o=a[i],e.next=34,this.moveBlock(o,t,-1);case 34:i++,e.next=30;break;case 37:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"swapDown",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:this.cursor.path,e.t0=this,e.next=4,this.lastVisible(t);case 4:return e.t1=e.sent,e.next=7,e.t0.nextVisible.call(e.t0,e.t1);case 7:if(null!==(n=e.sent)){e.next=10;break}return e.abrupt("return");case 10:if(null!=n.parent){e.next=12;break}throw new Error("Next visible should never return root");case 12:return e.next=14,this.document.hasChildren(n.row);case 14:if(e.t2=e.sent,!e.t2){e.next=19;break}return e.next=18,this.document.collapsed(n.row);case 18:e.t2=!e.sent;case 19:if(!e.t2){e.next=25;break}return e.next=22,this.moveBlock(t,n,0);case 22:return e.abrupt("return",e.sent);case 25:return r=n.parent,e.next=28,this.document.indexInParent(n);case 28:return a=e.sent,e.next=31,this.moveBlock(t,r,a+1);case 31:return e.abrupt("return",e.sent);case 32:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"swapUp",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:this.cursor.path,e.next=3,this.prevVisible(t);case 3:if(null!==(n=e.sent)){e.next=6;break}return e.abrupt("return");case 6:if(null!=n.parent){e.next=8;break}throw new Error("Prev visible should never return root");case 8:if(!n.is(this.viewRoot)){e.next=10;break}return e.abrupt("return");case 10:return r=n.parent,e.next=13,this.document.indexInParent(n);case 13:return a=e.sent,e.next=16,this.moveBlock(t,r,a);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleCurBlockCollapsed",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.toggleBlockCollapsed(this.cursor.row);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleBlockCollapsed",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.do(new yt(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setCurBlockCollapsed",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setBlockCollapsed(this.cursor.row,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setBlockCollapsed",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.document.collapsed(t);case 2:if(e.t0=e.sent,e.t1=n,e.t0===e.t1){e.next=7;break}return e.next=7,this.do(new yt(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"pasteBefore",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.register.paste({before:!0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"pasteAfter",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.register.paste({});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startAnchor",value:function(){this._anchor=this.cursor.clone()}},{key:"stopAnchor",value:function(){this._anchor=null}},{key:"getVisualLineSelections",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o,c,u,h,l,p,f,d,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.anchor,n=this.cursor,e.next=4,this.document.getCommonAncestor(n.path,t.path);case 4:if(r=e.sent,a=Object(B.a)(r,3),i=a[0],o=a[1],c=a[2],0!==o.length){e.next=19;break}if(null!=i.parent){e.next=12;break}throw new Error("Invalid state: cursor was at root?");case 12:return u=i.parent,e.next=15,this.document.indexInParent(n.path);case 15:return h=e.sent,e.abrupt("return",[u,h,h]);case 19:if(0!==c.length){e.next=29;break}if(null!=i.parent){e.next=22;break}throw new Error("Invalid state: anchor was at root?");case 22:return l=i.parent,e.next=25,this.document.indexInParent(t.path);case 25:return p=e.sent,e.abrupt("return",[l,p,p]);case 29:return e.next=31,this.document.indexInParent(o[0]||n.path);case 31:return f=e.sent,e.next=34,this.document.indexInParent(c[0]||t.path);case 34:return(d=e.sent)<f&&(f=(v=[d,f])[0],d=v[1]),e.abrupt("return",[i,f,d]);case 37:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"scroll",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Math.round(t*this.getLinesPerPage()),!((n=Math.max(Math.min(n,1e3),-1e3))>0)){e.next=12;break}r=0;case 4:if(!(r<n)){e.next=10;break}return e.next=7,this.cursor.down();case 7:r++,e.next=4;break;case 10:e.next=19;break;case 12:a=0;case 13:if(!(a<-n)){e.next=19;break}return e.next=16,this.cursor.up();case 16:a++,e.next=13;break;case 19:this.emit("scroll",n);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTextRecusive",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,o,c,u,h,l,p,f,d=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r=null,e.next=4,this.document.collapsed(t.row);case 4:if(!e.sent){e.next=6;break}return e.abrupt("return",["Some blocks are folded!",null]);case 6:return e.next=8,this.document.getText(t.row);case 8:return a=e.sent,n.push(a),e.next=12,this.document.hasChildren(t.row);case 12:if(!e.sent){e.next=21;break}return e.next=15,this.document.getChildren(t);case 15:return o=e.sent,e.next=18,Promise.all(o.map(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.getTextRecusive(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 18:c=e.sent,u=Object(ct.a)(c);try{for(u.s();!(h=u.n()).done;)l=Object(B.a)(h.value,2),p=l[0],f=l[1],null!==p?r=p:n.push.apply(n,Object(qe.a)(f))}catch(r){u.e(r)}finally{u.f()}case 21:if(null!==r){e.next=25;break}return e.abrupt("return",[null,n]);case 25:return e.abrupt("return",[r,null]);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"anchor",get:function(){if("VISUAL_LINE"!==this.mode&&"VISUAL"!==this.mode)throw new Error("Wanted visual line selections but not in visual or visual line mode");if(null==this._anchor)throw new Error("No anchor found in ".concat(this.mode," mode!"));return this._anchor}}]),n}(J),St=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(g.a)(this,n);var r=new ot;return r.loadEmpty(),t.call(this,new Se(new Le),r,e)}return n}(_t);ue.registerMotion(new oe("motion-left","Move cursor left",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.left();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-right","Move cursor right",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.right(n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-up","Move cursor up",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.up(n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-down","Move cursor down",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.down(n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-line-beginning","Move cursor to beginning of line",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.home();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-line-end","Move cursor to end of line",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.end(n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-word-beginning","Move cursor to the first word-beginning before it",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.beginningWord({cursor:n});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-word-end","Move cursor to the first word-ending after it",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.endWord({cursor:n});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-word-next","Move cursor to the beginning of the next word",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.nextWord({cursor:n});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-Word-beginning","Move cursor to the first Word-beginning before it",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.beginningWord({cursor:n,whitespaceWord:!0});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-Word-end","Move cursor to the first Word-ending after it",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.endWord({cursor:n,whitespaceWord:!0});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-Word-next","Move cursor to the beginning of the next Word",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.nextWord({cursor:n,whitespaceWord:!0});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-find-next-char","Move cursor to next occurrence of character in line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyStream,e.next=3,n.dequeue();case 3:return r=e.sent,e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findNextChar(r,{cursor:n});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerMotion(new oe("motion-find-prev-char","Move cursor to previous occurrence of character in line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyStream,e.next=3,n.dequeue();case 3:return r=e.sent,e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findPrevChar(r,{cursor:n});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerMotion(new oe("motion-to-next-char","Move cursor to just before next occurrence of character in line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyStream,e.next=3,n.dequeue();case 3:return r=e.sent,e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findNextChar(r,{cursor:n,beforeFound:!0});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerMotion(new oe("motion-to-prev-char","Move cursor to just after previous occurrence of character in line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyStream,e.next=3,n.dequeue();case 3:return r=e.sent,e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findPrevChar(r,{cursor:n,beforeFound:!0});case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerMotion(new oe("motion-visible-beginning","Go to the beginning of visible document",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.visibleHome();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-visible-end","Go to end of visible document",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.visibleEnd();case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-parent","Go to the parent of current line",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.parent(n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-next-sibling","Move cursor to the next sibling of the current line",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.nextSibling(n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))))),ue.registerMotion(new oe("motion-prev-sibling","Move cursor to the previous sibling of the current line",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.prevSibling(n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))));var Rt=["motion-left","motion-right","motion-line-beginning","motion-line-end","motion-word-beginning","motion-word-end","motion-word-next","motion-Word-beginning","motion-Word-end","motion-Word-next","motion-find-next-char","motion-find-prev-char","motion-to-next-char","motion-to-prev-char"],Dt={"motion-left":[["left"],["h"]],"motion-right":[["right"],["l"]],"motion-up":[["up"],["k"]],"motion-down":[["down"],["j"]],"motion-line-beginning":[["home"],["0"],["^"]],"motion-line-end":[["end"],["$"]],"motion-word-beginning":[["b"]],"motion-word-end":[["e"]],"motion-word-next":[["w"]],"motion-Word-beginning":[["B"]],"motion-Word-end":[["E"]],"motion-Word-next":[["W"]],"motion-visible-beginning":[["g","g"]],"motion-visible-end":[["G"],["g","G"]],"motion-parent":[["g","p"]],"motion-next-sibling":[["}"]],"motion-prev-sibling":[["{"]],"motion-find-next-char":[["f"]],"motion-find-prev-char":[["F"]],"motion-to-next-char":[["t"]],"motion-to-prev-char":[["T"]]},Et={"motion-left":[["left"]],"motion-right":[["right"]],"motion-up":[["up"]],"motion-down":[["down"]],"motion-line-beginning":[["home"],["ctrl+a"],["meta+left"]],"motion-line-end":[["end"],["ctrl+e"],["meta+right"]],"motion-word-beginning":[["alt+b"],["alt+left"]],"motion-word-end":[],"motion-word-next":[["alt+f"],["alt+right"]],"motion-Word-beginning":[],"motion-Word-end":[],"motion-Word-next":[],"motion-visible-beginning":[["meta+home"]],"motion-visible-end":[["meta+end"]],"motion-parent":[["ctrl+g","p"]],"motion-next-sibling":[["alt+down"]],"motion-prev-sibling":[["alt+up"]]},At=Object.assign({"move-cursor-normal":[[ie]],"toggle-help":[["?"]],"enter-visual-mode":[["v"]],"enter-visual-line-mode":[["V"]],"enter-insert-before-cursor":[["i"]],"enter-insert-after-cursor":[["a"]],"enter-insert-line-beginning":[["I"]],"enter-insert-line-end":[["A"]],"enter-insert-below-line":[["o"]],"enter-insert-above-line":[["O"]],"visit-link":[["g","x"]],"fold-toggle":[["z"]],"fold-open":[],"fold-close":[],"replace-char":[["r"]],"delete-blocks":[["d","d"]],"delete-motion":[["d",ie]],"change-line":[["c","c"]],"change-to-line-end":[["C"]],"change-blocks":[["c","r"]],"change-motion":[["c",ie]],"yank-line":[["y","y"]],"yank-to-line-end":[["Y"]],"yank-blocks":[["y","r"]],"yank-motion":[["y",ie]],"yank-clone":[["y","c"]],"normal-delete-char":[["x"]],"normal-delete-char-before":[["X"]],"change-char":[["s"]],"delete-to-line-beginning":[],"delete-to-line-end":[["D"]],"delete-to-word-beginning":[],"paste-after":[["p"]],"paste-before":[["P"]],"join-line":[["J"]],"split-line":[["K"]],"scroll-down":[["page down"],["ctrl+d"]],"scroll-up":[["page up"],["ctrl+u"]],undo:[["u"]],redo:[["ctrl+r"]],"replay-command":[["."]],"record-macro":[["q"]],"play-macro":[["@"]],"unindent-row":[["<"]],"indent-row":[[">"]],"unindent-blocks":[["shift+tab"],["ctrl+h"]],"indent-blocks":[["tab"],["ctrl+l"]],"swap-block-down":[["ctrl+j"]],"swap-block-up":[["ctrl+k"]],"search-local":[["ctrl+/"],["ctrl+f"]],"search-global":[["/"]],"export-file":[["ctrl+s"]],"zoom-prev-sibling":[["alt+k"]],"zoom-next-sibling":[["alt+j"]],"zoom-in":[["]"],["alt+l"],["ctrl+right"]],"zoom-out":[["["],["alt+h"],["ctrl+left"]],"zoom-cursor":[["enter"],["ctrl+shift+right"]],"zoom-root":[["shift+enter"],["ctrl+shift+left"]],"jump-prev":[["ctrl+o"]],"jump-next":[["ctrl+i"]],"swap-case":[["~"]],"go-next-clone":[["g","c"]]},Dt),Tt=Object.assign({"move-cursor-visual":[[ie]],"toggle-help":[["?"]],"exit-mode":[["esc"],["ctrl+c"],["ctrl+["]],"swap-visual-cursor":[["o"],["O"]],"visual-delete":[["d"],["x"]],"visual-change":[["c"]],"visual-yank":[["y"]],"visual-swap-case":[["~"]]},j.pick(Dt,Rt)),Mt=Object.assign({"move-cursor-visual-line":[[ie]],"toggle-help":[["?"]],"exit-mode":[["esc"],["ctrl+c"],["ctrl+["]],"swap-visual-cursor":[["o"],["O"]],"visual-line-delete":[["d"],["x"]],"visual-line-change":[["c"]],"visual-line-join":[["J"]],"visual-line-yank":[["y"]],"visual-line-yank-clone":[["Y"]],"visual-line-indent":[[">"],["tab"],["ctrl+l"]],"visual-line-unindent":[["<"],["shift+tab"],["ctrl+h"]],"visual-line-swap-case":[["~"]]},Dt),Nt=Object.assign({"move-cursor-insert":[[ie]],"toggle-help":[["ctrl+?"]],"exit-mode":[["esc"],["ctrl+c"],["ctrl+["]],"fold-toggle":[["ctrl+space"]],"fold-open":[["meta+down"]],"fold-close":[["meta+up"]],"delete-blocks":[["meta+shift+delete"]],"delete-char-after":[["delete"]],"delete-char-before":[["backspace"],["shift+backspace"]],"delete-to-line-beginning":[["ctrl+u"]],"delete-to-line-end":[["ctrl+k"]],"delete-to-word-beginning":[["ctrl+w"],["ctrl+backspace"]],"paste-before":[["ctrl+y"]],"split-line":[["enter"]],"scroll-down":[["page down"]],"scroll-up":[["page up"]],undo:[["ctrl+z"]],redo:[["ctrl+Z"]],"unindent-row":[],"indent-row":[],"unindent-blocks":[["shift+tab"]],"indent-blocks":[["tab"]],"swap-block-down":[],"swap-block-up":[],"zoom-prev-sibling":[["alt+k"]],"zoom-next-sibling":[["alt+j"]],"zoom-in":[["ctrl+right"]],"zoom-out":[["ctrl+left"]],"zoom-cursor":[["ctrl+shift+right"]],"zoom-root":[["ctrl+shift+left"]]},Et),Lt=Object.assign({"move-cursor-search":[[ie]],"toggle-help":[["ctrl+?"]],"exit-mode":[["esc"],["ctrl+c"],["ctrl+["]],"search-delete-char-after":[["delete"]],"search-delete-char-before":[["backspace"],["shift+backspace"]],"search-select":[["enter"]],"search-up":[["ctrl+k"],["up"],["shift+tab"]],"search-down":[["ctrl+j"],["down"],["tab"]]},j.pick(Et,Rt));Object.assign({"move-cursor-insert":[[ie]],"toggle-help":[["ctrl+?"],["meta+?"]],"fold-toggle":[],"fold-open":[["meta+down"]],"fold-close":[["meta+up"]],"delete-blocks":[["meta+shift+delete"]],"delete-char-after":[["delete"]],"delete-char-before":[["backspace"],["shift+backspace"]],"delete-to-line-beginning":[["ctrl+u"]],"delete-to-line-end":[["ctrl+k"]],"delete-to-word-beginning":[["ctrl+w"],["ctrl+backspace"]],"paste-before":[["ctrl+y"]],"split-line":[["enter"]],"scroll-down":[["page down"]],"scroll-up":[["page up"]],undo:[["ctrl+z"],["meta+z"]],redo:[["ctrl+Z"],["meta+Z"],["meta+y"]],"unindent-row":[],"indent-row":[],"unindent-blocks":[["shift+tab"]],"indent-blocks":[["tab"]],"swap-block-down":[["meta+shift+up"]],"swap-block-up":[["meta+shift+down"]],"zoom-prev-sibling":[],"zoom-next-sibling":[],"zoom-in":[],"zoom-out":[["meta+<"]],"zoom-cursor":[["meta+>"]],"zoom-root":[]},Et);var Pt={defaultMode:"NORMAL",getDefaultData:function(){return["Welcome to vimflowy!","I hope you know to use j and k to move up and down!","If not, the cheat sheet on the right will be your friend.  Once you become an expert, you'll know to use ? to hide it",{text:"Features",children:[{text:"Workflowy features",children:[{text:"Nested bullets",children:["Bullets with children can be collapsed to avoid clutter",{text:"Use enter to zoom into any bullet.  Try on this one",collapsed:!0,children:["This bullet had children, but you can zoom into bullets with no children to start expanding upon them","Use shift+enter to zoom all the way back out","Use ] and [ to zoom in and out just one level"]},{text:"Use z to toggle collapsedness",collapsed:!0,children:["You found me :)"]},"Use tab and shift+tab to indent and unindent blocks","Use < and > to indent and unindent just a single line"]}]},{text:"Vim features",collapsed:!0,children:["Most of vim's movement commands","Modal editing (note visual mode only works on one line)","Undo/redo, jump history (ctrl+o to jump to previous location, ctrl+i to jump forward)","Repeat commands with . and record macros with q","Let the vimflowy devs know if anything major is missing"]},"Press / to start searching for text",{text:"Marks",plugins:{mark:"mark"},collapsed:!0,children:[{text:"I am marked!",plugins:{mark:"im_a_mark"}},"Press m to start marking a line, and enter to finish","Use ' to search and jump to marks","Link to marks with the @ symbol, like this:  @im_a_mark.  Use gm to follow the link.","Delete marks by using dm, or just mark with empty string"]},{text:"Tags",plugins:{tags:["tag"]},collapsed:!0,children:[{text:"I am tagged!",plugins:{tags:["tag","another_tag"]}},"Each row can have multiple tags, and rows can share the same tags","Press # to start adding a tag to a line, and enter to finish","Use - to search and jump to tags","Delete the i'th tag by using d#i"]},{text:"Cloning",collapsed:!0,children:[{text:"I am a clone!  Try editing me",id:1},{text:"Clones can't be siblings or descendants of each other",children:[{clone:1}]},"Make new clones with yc, then p"]},{text:"Rich text",collapsed:!0,children:[{text:"Text formatting",collapsed:!0,children:["**Bold**, *italicized*, and _underlined_ text.  ** * _Emphatic_ * **!",{text:"Strike through",children:["~~Cross thing off todo list~~","Cross another thing off todo list"]}]},{text:"LaTeX",collapsed:!0,children:["Inline equations: $E = mc^2$ and $f(b) - f(a) = \\int_a^b f'(t) dt$","Block equations: $$\\max_{x \\ge 0, Ax \\le b} c^T x = \\min_{y \\ge 0, A^ty \\ge c} b^T y$$"]},{text:"HTML",collapsed:!0,children:['Inline arbitrary HTML, such as images: <img src="/images/vimflowy-32.png"/>',"Or tables: <table><tr><th>Pros</th><th>Cons</th></tr><tr><td>Everything</td><td>Nothing</td></tr></table>","Or <span style='color: blue'>colored</span> <span style='color: orange'>text</span>"]}]},{text:"Customizability (see Settings menu)",collapsed:!0,children:[{text:"Plugins system",collapsed:!0,children:["If you're interested in writing plugins, see here: https://github.com/WuTheFWasThat/vimflowy/blob/master/docs/plugins.md"]},"Customizable hotkeys (via downloading/uploading a json file)","Customizable color theme"]}]},{text:"Data",collapsed:!0,children:[{text:"Backing storage",children:["Vimflowy was designed to be agnostic to the storage backend","As a user, you are in full control of your data","By default, all data is entirely local","There are no backups, and it is never sent over the internet","However, remote data storage is supported","For more details, visit https://github.com/WuTheFWasThat/vimflowy/blob/master/docs/storage/README.md","To manage your data, visit the Settings menu"]},{text:"Importing and exporting data",children:["Two import and export formats are supported.","Check out settings for more information.","You can regularly export your data in JSON format, as a form of backup"]},'To make a new document with separate data, just add the "doc" query parameter. '+"For example, ".concat(window.location.origin,"/?doc=newdocname#")]},"Press i to enter insert mode and start adding your own content!","For more info, visit https://github.com/WuTheFWasThat/vimflowy (visit links under the cursor with gx)"]},defaultMappings:new de({NORMAL:At,INSERT:Nt,VISUAL:Tt,VISUAL_LINE:Mt,SEARCH:Lt,SETTINGS:{"exit-mode":[["esc"],["ctrl+c"],["ctrl+["]]}})},It=JSON.parse(Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER_CONFIG||"{}");ue.registerAction(new ce("move-cursor-normal","Move the cursor (according to the specified motion)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.motion,r=t.session,a=t.repeat,null!=n){e.next=3;break}throw new Error("Motion command was not passed a motion");case 3:i=r.cursor.clone(),o=0;case 5:if(!(o<a)){e.next=11;break}return e.next=8,n(i,{});case 8:o++,e.next=5;break;case 11:return e.next=13,r.isVisible(i.path);case 13:if(!e.sent){e.next=16;break}return e.next=16,r.cursor.from(i);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP,acceptsMotion:!0})),ue.registerAction(new ce("move-cursor-insert","Move the cursor (according to the specified motion)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.motion,r=t.session,null!=n){e.next=3;break}throw new Error("Motion command was not passed a motion");case 3:return e.next=5,n(r.cursor,{pastEnd:!0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{acceptsMotion:!0})),ue.registerAction(new ce("move-cursor-visual","Move the cursor (according to the specified motion)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.motion,r=t.session,a=t.repeat,null!=n){e.next=3;break}throw new Error("Motion command was not passed a motion");case 3:i=r.cursor.clone(),o=0;case 5:if(!(o<a)){e.next=11;break}return e.next=8,n(i,{pastEnd:!0});case 8:o++,e.next=5;break;case 11:if(i.path.is(r.cursor.path)){e.next=15;break}r.showMessage("Visual mode currently only works on one line",{text_class:"error"}),e.next=17;break;case 15:return e.next=17,r.cursor.from(i);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{acceptsMotion:!0})),ue.registerAction(new ce("move-cursor-visual-line","Move the cursor (according to the specified motion)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.motion,r=t.session,a=t.repeat,null!=n){e.next=3;break}throw new Error("Motion command was not passed a motion");case 3:i=0;case 4:if(!(i<a)){e.next=10;break}return e.next=7,n(r.cursor,{pastEnd:!0});case 7:i++,e.next=4;break;case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{acceptsMotion:!0})),ue.registerAction(new ce("toggle-help","Show/hide key bindings (edit in settings)",function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.session.toggleBindingsDiv();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("enter-insert-before-cursor","Insert at character",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("INSERT");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("enter-insert-after-cursor","Insert after character",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("INSERT");case 3:return e.next=5,n.cursor.right({pastEnd:!0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("enter-insert-line-beginning","Insert at beginning of line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("INSERT");case 3:return e.next=5,n.cursor.home();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("enter-insert-line-end","Insert after end of line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("INSERT");case 3:return e.next=5,n.cursor.end({pastEnd:!0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("enter-insert-below-line","Insert on new line after current line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("INSERT");case 3:return e.next=5,n.newLineBelow();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("enter-insert-above-line","Insert on new line before current line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("INSERT");case 3:return e.next=5,n.newLineAbove();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visit-link","Visit the link indicated by the cursor, in a new tab",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.document.getWord(n.cursor.row,n.cursor.col);case 3:et(r=e.sent)?window.open(r):n.showMessage("Tried to open non-link: ".concat(r),{text_class:"error"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("fold-toggle","Toggle whether a block is folded",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.toggleCurBlockCollapsed();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("fold-open","Open a collapsed block",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setCurBlockCollapsed(!1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("fold-close","Close a collapsed block",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setCurBlockCollapsed(!0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("replace-char","Replace character(s)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.keyStream,a=t.repeat,e.next=3,r.dequeue();case 3:return"space"===(i=e.sent)&&(i=" "),e.next=7,n.replaceCharsAfterCursor(i,a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-delete","Delete visual selection",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r={includeEnd:!0,yank:!0},e.next=4,n.deleteBetween(n.cursor,n.anchor,r);case 4:return e.next=6,n.setMode("NORMAL");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-line-delete","Delete visual line selection",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,null!=(r=t.visual_line)){e.next=3;break}throw new Error("Visual_line mode arguments missing");case 3:return e.next=5,n.delBlocks(r.parent.row,r.start_i,r.num_rows,{addNew:!1});case 5:return e.next=7,n.setMode("NORMAL");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("delete-motion","Delete from cursor with motion",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.motion,r=t.session,a=t.repeat,null!=n){e.next=3;break}throw new Error("Delete motion command was not passed a motion");case 3:i=r.cursor.clone(),o=0;case 5:if(!(o<a)){e.next=11;break}return e.next=8,n(i,{pastEnd:!0,pastEndWord:!0});case 8:o++,e.next=5;break;case 11:return e.next=13,r.deleteBetween(r.cursor,i,{yank:!0});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{acceptsMotion:!0})),ue.registerAction(new ce("delete-blocks","Delete block",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.repeat,e.next=3,n.delBlocksAtCursor(r,{addNew:!1});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-change","Change",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r={includeEnd:!0,yank:!0},e.next=4,n.deleteBetween(n.cursor,n.anchor,r);case 4:return e.next=6,n.setMode("INSERT");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-line-change","Change",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,null!=(r=t.visual_line)){e.next=3;break}throw new Error("Visual_line mode arguments missing");case 3:return e.next=5,n.delBlocks(r.parent.row,r.start_i,r.num_rows,{addNew:!0});case 5:return e.next=7,n.setMode("INSERT");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-line-join","Join all selected rows",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,o,c,u,h,l,p,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,null!=(r=t.visual_line)){e.next=3;break}throw new Error("Visual_line mode arguments missing");case 3:if(!(r.num_rows<1)){e.next=5;break}return e.abrupt("return",n.showMessage("No lines selected!?",{text_class:"error"}));case 5:return e.next=7,Promise.all(r.selected.map(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getTextRecusive(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:a=e.sent,o=[],c=Object(ct.a)(a),e.prev=10,c.s();case 12:if((u=c.n()).done){e.next=21;break}if(h=Object(B.a)(u.value,2),l=h[0],p=h[1],null===l){e.next=18;break}return e.abrupt("return",n.showMessage(l,{text_class:"error"}));case 18:o.push.apply(o,Object(qe.a)(p));case 19:e.next=12;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(10),c.e(e.t0);case 26:return e.prev=26,c.f(),e.finish(26);case 29:if(f=o.join("\n"),!o){e.next=35;break}return e.next=33,n.delBlocks(r.parent.row,r.start_i,r.num_rows,{addNew:!1});case 33:return e.next=35,n.addBlocks(r.parent,r.start_i,[f]);case 35:return e.next=37,n.setMode("NORMAL");case 37:case"end":return e.stop()}}),e,null,[[10,23,26,29]])})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("change-line","Delete row, and enter insert mode",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("INSERT");case 3:return e.next=5,n.clearRowAtCursor({yank:!0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("change-blocks","Delete blocks, and enter insert mode",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.repeat,e.next=3,n.setMode("INSERT");case 3:return e.next=5,n.delBlocksAtCursor(r,{addNew:!0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("change-motion","Delete from cursor with motion, and enter insert mode",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,r=t.repeat,null!=(a=t.motion)){e.next=3;break}throw new Error("Change motion command was not passed a motion");case 3:i=n.cursor.clone(),o=0;case 5:if(!(o<r)){e.next=11;break}return e.next=8,a(i,{pastEnd:!0,pastEndWord:!0});case 8:o++,e.next=5;break;case 11:return e.next=13,n.setMode("INSERT");case 13:return e.next=15,n.deleteBetween(n.cursor,i,{yank:!0});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{acceptsMotion:!0})),ue.registerComposedAction("change-to-line-end","Delete to the end of the line, and enter insert mode",["change-motion","motion-line-end"]),ue.registerAction(new ce("visual-yank","Yank",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r={includeEnd:!0},e.next=4,n.yankBetween(n.cursor,n.anchor,r);case 4:return e.next=6,n.setMode("NORMAL");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP_ALL})),ue.registerAction(new ce("visual-line-yank","Yank",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,null!=(r=t.visual_line)){e.next=3;break}throw new Error("Visual_line mode arguments missing");case 3:return e.next=5,n.yankBlocks(r.start,r.num_rows);case 5:return e.next=7,n.setMode("NORMAL");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP_ALL})),ue.registerAction(new ce("yank-line","Yank row",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.yankRowAtCursor();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("yank-blocks","Yank blocks",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.repeat,e.next=3,n.yankBlocksAtCursor(r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("yank-motion","Yank from cursor with motion",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,r=t.motion,a=t.repeat,null!=r){e.next=3;break}throw new Error("Yank motion command was not passed a motion");case 3:i=n.cursor.clone(),o=0;case 5:if(!(o<a)){e.next=11;break}return e.next=8,r(i,{pastEnd:!0,pastEndWord:!0});case 8:o++,e.next=5;break;case 11:return e.next=13,n.yankBetween(n.cursor,i,{});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{acceptsMotion:!0})),ue.registerComposedAction("yank-to-line-end","Yank to the end of the line",["yank-motion","motion-line-end"]),ue.registerAction(new ce("yank-clone","Yank blocks as a clone",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.repeat,e.next=3,n.yankBlocksCloneAtCursor(r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-line-yank-clone","Yank blocks as a clone",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,null!=(r=t.visual_line)){e.next=3;break}throw new Error("Visual_line mode arguments missing");case 3:return e.next=5,n.yankBlocksClone(r.start,r.num_rows);case 5:return e.next=7,n.setMode("NORMAL");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("normal-delete-char","Delete character at the cursor",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.repeat,e.next=3,n.delCharsAfterCursor(r,{yank:!0});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("delete-char-after","Delete character after the cursor (i.e. del key)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.delCharsAfterCursor(1);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("normal-delete-char-before","Delete previous character",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,r=t.repeat,!((a=Math.min(n.cursor.col,r))>0)){e.next=5;break}return e.next=5,n.delCharsBeforeCursor(a,{yank:!0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("delete-char-before","Delete previous character (i.e. backspace key)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.deleteAtCursor();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("change-char","Change character",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("INSERT");case 3:return e.next=5,n.delCharsAfterCursor(1,{yank:!0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerComposedAction("delete-to-line-beginning","Delete to the beginning of the line",["delete-motion","motion-line-beginning"]),ue.registerComposedAction("delete-to-line-end","Delete to the end of the line",["delete-motion","motion-line-end"]),ue.registerComposedAction("delete-to-word-beginning","Delete to the beginning of the previous word",["delete-motion","motion-word-beginning"]),ue.registerAction(new ce("paste-after","Paste after cursor",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.pasteAfter();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("paste-before","Paste before cursor",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.pasteBefore();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("join-line","Join current line with line below",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.joinAtCursor();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("split-line","Split line at cursor",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.newLineAtCursor();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("scroll-down","Scroll half window down",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.scroll(.5);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("scroll-up","Scroll half window up",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.scroll(-.5);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("exit-mode","Exit back to normal mode",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("NORMAL");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("enter-visual-mode","Enter visual mode",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("VISUAL");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("enter-visual-line-mode","Enter visual line mode",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("VISUAL_LINE");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("swap-visual-cursor","Swap cursor to other end of selection, in visual and visual line mode",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=n.anchor.clone(),e.next=4,n.anchor.from(n.cursor);case 4:return e.next=6,n.cursor.from(r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("swap-case","Swap case",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.swapCaseAtCursor();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-swap-case","Swap case in VISUAL mode",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.swapCaseInVisual(n.cursor,n.anchor);case 3:return e.next=5,n.setMode("NORMAL");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-line-swap-case","Swap case in VISUAL_LINE mode",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,null!=(r=t.visual_line)){e.next=3;break}throw new Error("Visual_line mode arguments missing");case 3:return e.next=5,n.document.getChildRange(r.parent,r.start_i,r.end_i);case 5:return a=e.sent.map((function(e){return e.row})),e.next=8,n.swapCaseInVisualLine(a);case 8:return e.next=10,n.setMode("NORMAL");case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("go-next-clone","Go to next copy of this clone",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.document.nextClone(n.cursor.path);case 3:return r=e.sent,e.next=6,n.cursor.setPath(r);case 6:return e.next=8,n.isVisible(r);case 8:if(e.sent){e.next=11;break}return e.next=11,n.zoomInto(r);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("undo","Undo",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.session,r=t.repeat,a=0;case 2:if(!(a<r)){e.next=8;break}return e.next=5,n.undo();case 5:a++,e.next=2;break;case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("redo","Redo",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.session,r=t.repeat,a=0;case 2:if(!(a<r)){e.next=8;break}return e.next=5,n.redo();case 5:a++,e.next=2;break;case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("replay-command","Replay last command",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.repeat,r=t.keyStream,a=t.keyHandler,i=0;case 2:if(!(i<n)){e.next=8;break}return e.next=5,a.playRecording(r.lastSequence);case 5:i++,e.next=2;break;case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP}));var Bt=null,Ht=function(e){if(!Bt)throw new Error("Recording listener on while there was no recording");Bt.macro.push(e)};ue.registerAction(new ce("record-macro","Begin/stop recording a macro",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.keyStream,r=t.session,null!==Bt){e.next=9;break}return e.next=4,n.dequeue();case 4:a=e.sent,Bt={macro:[],key:a},n.on("dequeue",Ht),e.next=16;break;case 9:Bt.macro.pop(),i=r.clientStore.getMacros(),o=Bt.macro,i[Bt.key]=o,r.clientStore.setMacros(i),Bt=null,n.off("dequeue",Ht);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("play-macro","Play a macro",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c,u,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.keyStream,r=t.keyHandler,a=t.repeat,i=t.session,e.next=3,n.dequeue();case 3:if(o=e.sent,c=i.clientStore.getMacros(),null!=(u=c[o])){e.next=9;break}return n.drop(),e.abrupt("return");case 9:h=0;case 10:if(!(h<a)){e.next=16;break}return e.next=13,r.playRecording(u);case 13:h++,e.next=10;break;case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("indent-row","Indent row right",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.indent();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-line-indent","Indent blocks right",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,null!=(r=t.visual_line)){e.next=3;break}throw new Error("Visual_line mode arguments missing");case 3:return e.next=5,n.indentBlocks(r.start,r.num_rows);case 5:return e.next=7,n.setMode("NORMAL");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("unindent-row","Unindent row",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.unindent();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("visual-line-unindent","Unindent blocks",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.session,null!=(r=t.visual_line)){e.next=3;break}throw new Error("Visual_line mode arguments missing");case 3:return e.next=5,n.unindentBlocks(r.start,r.num_rows);case 5:return e.next=7,n.setMode("NORMAL");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("indent-blocks","Indent blocks right",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.repeat,e.next=3,n.indentBlocks(n.cursor.path,r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("unindent-blocks","Move block left",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,r=t.repeat,e.next=3,n.unindentBlocks(n.cursor.path,r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("swap-block-down","Move block down",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.swapDown();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("swap-block-up","Move block up",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.swapUp();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));var Ft=function(){function e(t){Object(g.a)(this,e),this.searchFn=void 0,this.results=void 0,this.selection=void 0,this.session=void 0,this.lastQuery=null,this.searchFn=t,this.session=new St({initialMode:"INSERT"}),this.selection=1,this.results=[]}return Object(N.a)(e,[{key:"up",value:function(){this.results.length&&(this.selection<=0?this.selection=this.results.length-1:this.selection=this.selection-1)}},{key:"down",value:function(){this.results.length&&(this.selection+1>=this.results.length?this.selection=0:this.selection=this.selection+1)}},{key:"update",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.session.curText();case 2:if(t=e.sent,JSON.stringify(t)===JSON.stringify(this.lastQuery)){e.next=9;break}return this.lastQuery=t,e.next=7,this.searchFn(t);case 7:this.results=e.sent,this.selection=0;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"select",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.results.length){e.next=2;break}return e.abrupt("return");case 2:return t=this.results[this.selection],e.next=5,t.fn();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function Ut(e,t){return Vt.apply(this,arguments)}function Vt(){return(Vt=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.setMode("SEARCH");case 2:n.menu=new Ft(function(){var e=Object(i.a)(s.a.mark((function e(r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.document.search(t,r);case 2:return a=e.sent,e.abrupt("return",Promise.all(a.map(function(){var e=Object(i.a)(s.a.mark((function e(t){var r,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.path,a=t.matches,c={},a.forEach((function(e){c[e]=!0})),e.next=5,n.document.getLine(r.row);case 5:return e.t0=e.sent,e.t1=function(e){var t=n.document.cache.get(r.row);if(!t)throw new Error("Row wasnt cached despite search returning it");var a={path:r,pluginData:t.pluginData};return Object(o.jsx)("span",{children:n.applyHook("renderLineContents",[e],a)})},e.t2={accents:c},e.t3=function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.zoomInto(r);case 2:return e.next=4,n.cursor.setPath(r);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",{contents:e.t0,renderHook:e.t1,renderOptions:e.t2,fn:e.t3});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zt(){return Wt.apply(this,arguments)}function Wt(){return(Wt=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],u.a.makeArray(u()(".bullet")).forEach((function(e){if(v(u()(e),u()("#view"))&&!u()(e).hasClass("fa-clone")){var n=u()(e).attr("data-ancestry");if(n){var r=rt.loadFromAncestry(JSON.parse(n));t.push(r)}}})),e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n<=0&&(n=e.length+n),{index:e.index+t,length:n-t,text:e.text.slice(t,n),info:e.info.slice(t,n)}}function Kt(e,t){return[qt(e,0,t),qt(e,t)]}ue.registerAction(new ce("search-local","Search within view root",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,Ut(n.viewRoot,n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("search-global","Search within entire document",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,Ut(n.document.root,n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("move-cursor-search","Move the cursor within the search box (according to the specified motion)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.motion,r=t.session,null!=n){e.next=3;break}throw new Error("Motion command was not passed a motion");case 3:if(null!=r.menu){e.next=5;break}throw new Error("Menu session missing");case 5:return e.next=7,n(r.menu.session.cursor,{pastEnd:!0});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{acceptsMotion:!0})),ue.registerAction(new ce("search-delete-char-after","Delete character after the cursor (i.e. del key)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.session).menu){e.next=3;break}throw new Error("Menu session missing");case 3:return e.next=5,n.menu.session.delCharsAfterCursor(1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("search-delete-char-before","Delete previous character (i.e. backspace key)",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.session).menu){e.next=3;break}throw new Error("Menu session missing");case 3:return e.next=5,n.menu.session.deleteAtCursor();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("search-select","Select current menu selection",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.session).menu){e.next=3;break}throw new Error("Menu session missing");case 3:return e.next=5,n.menu.select();case 5:return e.next=7,n.setMode("NORMAL");case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("search-up","Select previous menu selection",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.session).menu){e.next=3;break}throw new Error("Menu session missing");case 3:return e.abrupt("return",n.menu.up());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("search-down","Select next menu selection",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.session).menu){e.next=3;break}throw new Error("Menu session missing");case 3:return e.abrupt("return",n.menu.down());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())),ue.registerAction(new ce("export-file","Export as Json file",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.exportFile("json");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("zoom-prev-sibling","Zoom to view root's previous sibling",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.zoomUp();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("zoom-next-sibling","Zoom to view root's next sibling",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.zoomDown();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("zoom-in","Zoom in by one level",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.zoomIn();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("zoom-out","Zoom out by one level",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.zoomOut();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("zoom-cursor","Zoom in onto cursor",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.zoomInto(n.cursor.path);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("zoom-root","Zoom out to document root",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.zoomInto(n.document.root);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("jump-prev","Jump to previously visited location",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.jumpPrevious();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),ue.registerAction(new ce("jump-next","Jump to next location",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.jumpNext();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{sequence:ne.DROP})),pt({name:"Easy motion",author:"Jeff Wu",description:Object(o.jsxs)("div",{children:["Lets you easily jump between rows, by default with space key. Based on ",Object(o.jsx)("a",{href:"https://github.com/easymotion/vim-easymotion",children:"this vim plugin"})]})},(function(e){var t=null;e.registerMotion("easy-motion","Jump to a visible row (based on EasyMotion)",function(){var n=Object(i.a)(s.a.mark((function n(r){var a,o,c,u,h,l,p,f;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=r.session,o=r.keyStream,c=r.keyHandler,n.next=3,zt();case 3:return u=n.sent.filter((function(e){return!e.is(a.cursor.path)})),(h=["Z","X","C","V","Q","W","E","R","T","A","S","D","F","z","x","c","v","q","w","e","r","t","a","s","d","f","g","h","j","k","l","y","u","i","o","p","b","n","m","G","H","J","K","L","Y","U","I","O","P","B","N","M"]).length>u.length?(l=(h.length-u.length)/2,h=h.slice(l,l+u.length)):(l=(u.length-h.length)/2,u=u.slice(l,l+u.length)),p={key_to_path:{},path_to_key:{}},j.zip(u,h).forEach((function(e){var t=Object(B.a)(e,2),n=t[0],r=t[1];p.key_to_path[r]=n,p.path_to_key[JSON.stringify(n.getAncestry())]=r})),t=p,n.next=11,Promise.all(j.values(t.key_to_path).map(function(){var t=Object(i.a)(s.a.mark((function t(n){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updatedDataForRender(n.row);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 11:return c.emit("handledKey"),n.next=14,o.dequeue();case 14:return f=n.sent,n.abrupt("return",function(){var n=Object(i.a)(s.a.mark((function n(r){var a;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!==t){n.next=2;break}throw new Error("Easy motion mappings were not set, as expected");case 2:if(!(f in t.key_to_path)){n.next=6;break}return a=t.key_to_path[f],n.next=6,r.setPosition(a,0);case 6:return n.next=8,Promise.all(j.values(t.key_to_path).map(function(){var t=Object(i.a)(s.a.mark((function t(n){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updatedDataForRender(n.row);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 8:t=null;case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());case 16:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()),e.registerDefaultMappings("NORMAL",{"easy-motion":[["space"]]}),e.registerHook("session","renderBullet",(function(n,r){var a=JSON.stringify(r.path.getAncestry());return null!==t&&a in t.path_to_key&&(n=Object(o.jsx)("span",{className:"bullet",style:Object(Ie.a)({},ge(e.session.clientStore,["theme-text-accent"])),children:t.path_to_key[a]},"easymotion")),n}))}),(function(e){return e.deregisterAll()}));var Gt=function(){function e(t){Object(g.a)(this,e),this.fn=void 0,this.fn=t}return Object(N.a)(e,[{key:"unfold",value:function(e){var t=[];return this.fn(e,(function(){t.push.apply(t,arguments)})),t}},{key:"then",value:function(t){var n=this;return new e((function(e,r){n.unfold(e).forEach((function(e){r.apply(void 0,Object(qe.a)(t.unfold(e)))}))}))}}]),e}(),Jt=function(){function e(t){Object(g.a)(this,e),this.partial_fn=void 0,this.partial_fn=t}return Object(N.a)(e,null,[{key:"trivial",value:function(){return new e((function(e,t,n){t.apply(void 0,Object(qe.a)(n.unfold(e)))}))}}]),Object(N.a)(e,[{key:"then",value:function(t){var n=this;return new e((function(e,r,a){n.partial_fn(e,r,new Gt((function(e,n){t.partial_fn(e,n,a)})))}))}},{key:"finish",value:function(e){var t=this;return new Gt((function(n,r){t.partial_fn(n,r,e)}))}}]),e}();function Yt(e,t){return new Jt((function(n,r,a){for(var s=e.exec(n.text);s;){var i=s.index+s[0].indexOf(s[1]);if(i>0){var o,c=Kt(n,i),u=Object(B.a)(c,2);o=u[0],n=u[1],r.apply(void 0,Object(qe.a)(a.unfold(o)))}var h,l=Kt(n,s[1].length),p=Object(B.a)(l,2);h=p[0],n=p[1],t(h,r,a),s=e.exec(n.text)}n.text.length&&r.apply(void 0,Object(qe.a)(a.unfold(n)))}))}function $t(e,t){return new Jt((function(n,r,a){for(var s=0;;){var i=e.exec(n.text.slice(s));if(!i)break;var o=s+i.index+i[0].indexOf(i[1]),c=o+i[1].length;t(n.info.slice(o,c)),s=c}r.apply(void 0,Object(qe.a)(a.unfold(n)))}))}function Zt(e,t,n){return function(r){r.slice(0,e).forEach((function(e){e.renderOptions.classes.hidden=!0})),r.slice(e,-t).forEach(n),r.slice(-t).forEach((function(e){e.renderOptions.classes.hidden=!0}))}}var Qt=["div","span","img","table"],Xt=[];Qt.forEach((function(e){Xt.push("<".concat(e,"(.|\\n)*>(.|\\n)*</").concat(e,">")),Xt.push("<".concat(e,"(.|\\n)*/>"))}));var en="("+Xt.map((function(e){return"("+e+")"})).join("|")+")";pt({name:"HTML",author:"Jeff Wu",description:"\n      Lets you inline the following html tags:\n        ".concat(Qt.map((function(e){return"<"+e+">"})).join(" "),"\n    ")},(function(e){e.registerHook("session","renderLineTokenHook",(function(t,n){return n.has_cursor||n.has_highlight?t:t.then(Yt(new RegExp(en),(function(t,n,r){try{n(Object(o.jsx)("span",{dangerouslySetInnerHTML:{__html:t.text}},"html-".concat(t.index)))}catch(a){e.session.showMessage(a.message,{text_class:"error"}),n.apply(void 0,Object(qe.a)(r.unfold(t)))}})))}))}),(function(e){return e.deregisterAll()}));var tn=n(78);n(126);pt({name:"LaTeX",author:"Jeff Wu",description:"\n      Lets you inline LaTeX between $ delimiters,\n      or add block LaTeX between $$ delimiters.\n      Limited to what KaTeX supports.\n    "},(function(e){e.registerHook("session","renderLineTokenHook",(function(t,n){return n.has_cursor||n.has_highlight?t:t.then(Yt(tt("\\$\\$(\\n|.)+?\\$\\$"),(function(t,n,r){try{var a=tn.renderToString(t.text.slice(2,-2),{displayMode:!0});n(Object(o.jsx)("div",{dangerouslySetInnerHTML:{__html:a}},"latex-".concat(t.index)))}catch(s){e.session.showMessage(s.message,{text_class:"error"}),n.apply(void 0,Object(qe.a)(r.unfold(t)))}}))).then(Yt(tt("\\$(\\n|.)+?\\$"),(function(t,n,r){try{var a=tn.renderToString(t.text.slice(1,-1),{displayMode:!1});n(Object(o.jsx)("span",{dangerouslySetInnerHTML:{__html:a}},"latex-".concat(t.index)))}catch(s){e.session.showMessage(s.message,{text_class:"error"}),n.apply(void 0,Object(qe.a)(r.unfold(t)))}})))}))}),(function(e){return e.deregisterAll()}));var nn=n(30),rn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"render",value:function(){var e=this,t=this.props.cursorBetween||!1,n=j.cloneDeep(this.props.lineData),r=this.props.cursors||{},a=this.props.highlights||{},s=this.props.accents||{};if(n.length in r&&n.push(" "),0===n.length)return Object(o.jsx)("span",{});var i,c=function(t){return Object(o.jsx)("div",{className:"cursor blink-background",style:Object(Ie.a)({display:"inline-block",height:"1.2em",width:2,marginLeft:-1,marginRight:-1},e.props.cursorStyle),children:" "},"insert-cursor-".concat(t))},u=new Gt((function(n,r){for(var a=0;a<n.text.length;a++){var s=n.info[a],i=Object.keys(s.renderOptions.classes),o=s.renderOptions.style||{};s.highlight&&Object.assign(o,e.props.highlightStyle),s.accent&&Object.assign(o,e.props.accentStyle),s.cursor&&(t?r(c(n.index+a)):(i.push("cursor"),Object.assign(o,e.props.cursorStyle)));var u=n.index+a,l=null,p=null;s.renderOptions.href&&(l=s.renderOptions.href,p="_blank");var f=void 0;null==l&&(void 0!==s.renderOptions.onClick?f=s.renderOptions.onClick:e.props.onCharClick&&(f=e.props.onCharClick.bind(e,u)));var d=s.renderOptions.divType||"span";r(h.createElement(d,{style:o,key:"default-".concat(u),className:i.join(" "),onClick:f,href:l,target:p},n.text[a]))}}));i=this.props.lineHook?this.props.lineHook:Jt.trivial();var l,p=Yt(new RegExp("(\n)"),(function(n,r){if(1!==n.text.length)throw new Error("Expected matched newline of length 1");if(1!==n.info.length)throw new Error("Expected matched newline with info of length 1");var a=n.info[0],s=a.renderOptions.style||{},i=Object.keys(a.renderOptions.classes);a.highlight&&Object.assign(s,e.props.highlightStyle),a.accent&&Object.assign(s,e.props.accentStyle),a.cursor&&(t?r(c(n.index)):(i.push("cursor"),Object.assign(s,e.props.cursorStyle),r(h.createElement("span",{style:s,key:"cursor-".concat(n.index),className:i.join(" "),onClick:void 0}," ")))),r(h.createElement("div",{key:"newline-".concat(n.index),className:i.join(" "),onClick:void 0},""))}));l=(l=this.props.wordHook?this.props.wordHook:Jt.trivial()).then(new Jt((function(t,n,r){et(t.text)&&t.info.forEach((function(n){n.renderOptions.divType="a",n.renderOptions.style=n.renderOptions.style||{},Object.assign(n.renderOptions.style,e.props.linksStyle),n.renderOptions.onClick=null,n.renderOptions.href=t.text})),n.apply(void 0,Object(qe.a)(r.unfold(t)))})));for(var f=Yt(new RegExp("([^\t\r\n ,!()\"'*+\\;<>\\[\\]`{}|]+)"),l.partial_fn),d=i.then(p).then(f).finish(u),v=[],b=0;b<n.length;b++){var x={highlight:b in a,cursor:b in r,accent:b in s,renderOptions:{classes:{}}};v.push(x)}var w={index:0,length:n.length,text:n.join(""),info:v},g=d.unfold(w);return Object(o.jsx)("span",{children:g})}}]),n}(h.Component),an={padding:"0px 8px",marginRight:8,borderRadius:5},sn=function(){function e(t){Object(g.a)(this,e),this.api=void 0,this.logger=void 0,this.session=void 0,this.document=void 0,this.markstate=null,this.SetMark=void 0,this.UnsetMark=void 0,this.marks_to_paths=void 0,this.api=t,this.logger=this.api.logger,this.session=this.api.session,this.document=this.session.document,this.marks_to_paths={}}return Object(N.a)(e,[{key:"enable",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,this.logger.debug("Enabling marks"),n=function(e){Object(k.a)(a,e);var n=Object(m.a)(a);function a(e,t){var r;return Object(g.a)(this,a),(r=n.call(this)).row=void 0,r.mark=void 0,r.row=e,r.mark=t,r}return Object(N.a)(a,[{key:"str",value:function(){return"row ".concat(this.row,", mark ").concat(this.mark)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._setMark(this.row,this.mark);case 2:return e.next=4,t.api.updatedDataForRender(this.row);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new r(this.row)]);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(dt),this.SetMark=n,r=function(e){Object(k.a)(a,e);var r=Object(m.a)(a);function a(e){var t;return Object(g.a)(this,a),(t=r.call(this)).row=void 0,t.mark=void 0,t.row=e,t}return Object(N.a)(a,[{key:"str",value:function(){return"row ".concat(this.row)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getMark(this.row);case 2:if(this.mark=e.sent,null===this.mark){e.next=8;break}return e.next=6,t._unsetMark(this.row,this.mark);case 6:return e.next=8,t.api.updatedDataForRender(this.row);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.mark){e.next=2;break}throw new Error("Rewinding before mutating: UnsetMark");case 2:if(null!==this.mark){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",[new n(this.row,this.mark)]);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(dt),this.UnsetMark=r,this.api.registerHook("document","serializeRow",function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getMark(n.row);case 2:return(r=e.sent)&&(t.mark=r),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerListener("document","loadRow",function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n.mark){e.next=6;break}return e.next=3,a.setMark(t.row,n.mark);case 3:if(!(r=e.sent)){e.next=6;break}return e.abrupt("return",a.session.showMessage(r,{text_class:"error"}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.markstate=null,this.api.registerMode({name:"MARK",cursorBetween:!0,within_row:!0,enter:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.markstate={session:new St,path:t.cursor.path},e.next=3,a.markstate.session.setMode("INSERT");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),exit:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.markstate){e.next=2;break}throw new Error("Mark state null during exit");case 2:return t=a.markstate.path.row,a.markstate=null,e.next=6,a.api.updatedDataForRender(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),every:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.markstate){e.next=2;break}throw new Error("Mark state null during every");case 2:return e.next=4,a.api.updatedDataForRender(a.markstate.path.row);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),key_transforms:[function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.length){e.next=9;break}if(!/^\S*$/.test(t)){e.next=9;break}if(null!==a.markstate){e.next=4;break}throw new Error("Mark state null during key transform");case 4:return e.next=6,a.markstate.session.addCharsAtCursor([t]);case 6:return e.next=8,a.api.updatedDataForRender(a.markstate.path.row);case 8:return e.abrupt("return",[null,n]);case 9:return e.abrupt("return",[t,n]);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()]}),this.api.registerAction("begin-mark","Mark a line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("MARK");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerAction("finish-mark","Finish typing mark",function(){var e=Object(i.a)(s.a.mark((function e(n){var r,a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.session,a=n.keyStream,null!==t.markstate){e.next=3;break}throw new Error("Mark state null in mark mode");case 3:return e.next=5,t.markstate.session.curText();case 5:return i=e.sent,o=t.markstate.path.row,e.next=9,t.setMark(o,i);case 9:return(c=e.sent)&&r.showMessage(c,{text_class:"error"}),e.next=13,r.setMode("NORMAL");case 13:a.save();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerMotion("go-mark","Go to the mark indicated by the cursor, if it exists",function(){var e=Object(i.a)(s.a.mark((function e(n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.session,e.abrupt("return",function(){var e=Object(i.a)(s.a.mark((function e(n){var a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.document.getWord(n.row,n.col);case 2:if(!((a=e.sent).length<1||"@"!==a[0])){e.next=6;break}return r.showMessage("Cursor should be over a @mark link"),e.abrupt("return");case 6:return i=a.slice(1),e.next=9,t.listMarks();case 9:if(o=e.sent,!(i in o)){e.next=16;break}return c=o[i],e.next=14,r.zoomInto(c);case 14:e.next=17;break;case 16:r.showMessage("No mark ".concat(i," to go to!"));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerAction("delete-mark","Delete mark at cursor",function(){var e=Object(i.a)(s.a.mark((function e(n){var r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.session,a=n.keyStream,e.next=3,t.setMark(r.cursor.row,"");case 3:(i=e.sent)&&r.showMessage(i,{text_class:"error"}),a.save();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerAction("search-marks","Go to (search for) a mark",function(){var e=Object(i.a)(s.a.mark((function e(n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.session,e.next=3,r.setMode("SEARCH");case 3:return e.next=5,t.listMarks();case 5:a=e.sent,r.menu=new Ft(function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,i,o,c,u=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=u.length>2&&void 0!==u[2]?u[2]:10,i=[],e.t0=s.a.keys(a);case 3:if((e.t1=e.t0()).done){e.next=12;break}if(o=e.t1.value,c=a[o],0!==o.indexOf(n)){e.next=10;break}if(i.push({path:c,mark:o}),!(r>0&&i.length===r)){e.next=10;break}return e.abrupt("break",12);case 10:e.next=3;break;case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),e.t0=Promise,e.next=4,n(r.document,t);case 4:return e.t1=e.sent.map(function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.path,a=t.mark,e.next=3,r.document.getLine(n.row);case 3:return c=e.sent,e.abrupt("return",{contents:c,renderHook:function(e){return Object(o.jsxs)("span",{children:[Object(o.jsx)("span",{style:Object(Ie.a)(Object(Ie.a)({},ge(r.clientStore,["theme-bg-tertiary","theme-trim"])),an),children:a},"mark_".concat(a)),e]})},fn:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.zoomInto(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,e.t0.all.call(e.t0,e.t1);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerAction("move-cursor-mark","Move the cursor within the mark being edited (according to the specified motion)",function(){var e=Object(i.a)(s.a.mark((function e(n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(r=n.motion)){e.next=3;break}throw new Error("Expected a motion!");case 3:if(null!==t.markstate){e.next=5;break}throw new Error("Mark state null in mark mode");case 5:return e.next=7,r(t.markstate.session.cursor,{pastEnd:!0});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{acceptsMotion:!0}),this.api.registerAction("mark-delete-char-before","Delete last character (i.e. backspace key)",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.markstate){e.next=2;break}throw new Error("Mark state null in mark mode");case 2:return e.next=4,t.markstate.session.deleteAtCursor();case 4:case"end":return e.stop()}}),e)})))),this.api.registerAction("mark-delete-char-after","Delete character at the cursor (i.e. del key)",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.markstate){e.next=2;break}throw new Error("Mark state null in mark mode");case 2:return e.next=4,t.markstate.session.delCharsAfterCursor(1);case 4:case"end":return e.stop()}}),e)})))),this.api.registerDefaultMappings("MARK",Object.assign({"toggle-help":[["ctrl+?"]],"move-cursor-mark":[[ie]],"finish-mark":[["enter"]],"mark-delete-char-after":[["delete"]],"mark-delete-char-before":[["backspace"],["shift+backspace"]],"exit-mode":[["esc"],["ctrl+c"]]},j.pick(Et,Rt))),this.api.registerDefaultMappings("NORMAL",{"begin-mark":[["m"]],"go-mark":[["g","m"]],"delete-mark":[["d","m"]],"search-marks":[["'"],["`"]]}),this.api.registerHook("document","pluginRowContents",function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.row,e.next=3,a.getMark(r);case 3:if(i=e.sent,o=a.markstate&&a.markstate.path.row===r,t.marks={mark:i,marking:o},!a.markstate||!o){e.next=11;break}return e.next=9,a.markstate.session.document.getLine(a.markstate.session.cursor.path.row);case 9:t.marks.markText=e.sent,t.marks.markCol=a.markstate.session.cursor.col;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerHook("session","renderLineOptions",(function(e,t){return t.pluginData.marks&&t.pluginData.marks.marking&&(e.cursors={}),e})),this.api.registerHook("session","renderLineContents",(function(e,t){var n=t.pluginData;if(n.marks)if(n.marks.marking)e.unshift(Object(o.jsx)("span",{style:Object(Ie.a)(Object(Ie.a)({},ge(a.api.session.clientStore,["theme-bg-tertiary","theme-trim-accent"])),an),children:Object(o.jsx)(rn,{lineData:n.marks.markText,cursors:Object(nn.a)({},n.marks.markCol,!0),cursorStyle:ge(a.api.session.clientStore,["theme-cursor"]),highlightStyle:ge(a.api.session.clientStore,["theme-bg-highlight"]),linksStyle:ge(a.api.session.clientStore,["theme-link"]),accentStyle:ge(a.api.session.clientStore,["theme-text-accent"]),cursorBetween:!0})},"mark"));else{var r=n.marks.mark;r&&e.unshift(Object(o.jsx)("span",{style:Object(Ie.a)(Object(Ie.a)({},ge(a.api.session.clientStore,["theme-bg-tertiary"])),an),children:r},"mark"))}return e})),this.api.registerHook("session","renderWordTokenHook",(function(e){return e.then(new Jt((function(e,t,n){if("NORMAL"===a.session.mode&&"@"===e.text[0]){var r=e.text.slice(1).replace(/(\.|!|\?)+$/g,""),o=a.marks_to_paths[r];o&&e.info.forEach((function(e){e.renderOptions.divType="a",e.renderOptions.style=e.renderOptions.style||{},Object.assign(e.renderOptions.style,ge(a.session.clientStore,["theme-link"])),e.renderOptions.onClick=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.session.zoomInto(o);case 2:a.session.save();case 3:case"end":return e.stop()}}),e)})))}))}t.apply(void 0,Object(qe.a)(n.unfold(e)))})))})),this.api.registerListener("document","afterDetach",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.computeMarksToPaths();case 1:case"end":return e.stop()}}),e)})))),this.computeMarksToPaths();case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getRowsToMarks",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.getData("ids_to_marks",{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setRowsToMarks",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.setData("ids_to_marks",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getMarksToRows",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.getData("marks_to_ids",{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setMarksToRows",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.setData("marks_to_ids",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sanityCheckMarks",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 2:return e.next=4,Promise.all([this._getMarksToRows(),this._getRowsToMarks()]);case 4:for(o in t=e.sent,n=Object(B.a)(t,2),r=n[0],a=n[1],i={},a)c=a[o],i[c]=parseInt(o,10);T(r,i,"Inconsistent rows_to_marks");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMark",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getRowsToMarks();case 2:return n=e.sent,e.abrupt("return",n[t]||null);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setMark",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sanityCheckMarks();case 2:return e.next=4,this._getMarksToRows();case 4:return r=e.sent,e.next=7,this._getRowsToMarks();case 7:return a=e.sent,E(!r.hasOwnProperty(n)),E(!a.hasOwnProperty(t)),r[n]=t,a[t]=n,e.next=14,this._setMarksToRows(r);case 14:return e.next=16,this._setRowsToMarks(a);case 16:return e.next=18,this._sanityCheckMarks();case 18:this.computeMarksToPaths();case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_unsetMark",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sanityCheckMarks();case 2:return e.next=4,this._getMarksToRows();case 4:return r=e.sent,e.next=7,this._getRowsToMarks();case 7:return a=e.sent,A(r[n],t),A(a[t],n),delete r[n],delete a[t],e.next=14,this._setMarksToRows(r);case 14:return e.next=16,this._setRowsToMarks(a);case 16:return e.next=18,this._sanityCheckMarks();case 18:this.computeMarksToPaths();case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"computeMarksToPaths",value:function(){var e=this;Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.listMarks();case 2:e.marks_to_paths=t.sent;case 3:case"end":return t.stop()}}),t)})))()}},{key:"listMarks",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sanityCheckMarks();case 2:return e.next=4,this._getMarksToRows();case 4:return t=e.sent,n={},e.next=8,Promise.all(Object.keys(t).map(function(){var e=Object(i.a)(s.a.mark((function e(a){var i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t[a],e.next=3,r.document.canonicalPath(i);case 3:null!==(o=e.sent)&&(n[a]=o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setMark",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:null,e.next=3,this._getMarksToRows();case 3:return r=e.sent,e.next=6,this._getRowsToMarks();case 6:if(a=e.sent,(i=a[t])||n){e.next=10;break}return e.abrupt("return","No mark to delete!");case 10:if(!n||!(n in r)){e.next=22;break}if(r[n]!==t){e.next=13;break}return e.abrupt("return","Already marked, nothing to do!");case 13:return o=r[n],e.next=16,this.document.isAttached(o);case 16:if(!e.sent){e.next=20;break}return e.abrupt("return","Mark '".concat(n,"' was already taken!"));case 20:return e.next=22,this.session.do(new this.UnsetMark(o));case 22:if(!i){e.next=25;break}return e.next=25,this.session.do(new this.UnsetMark(t));case 25:if(!n){e.next=28;break}return e.next=28,this.session.do(new this.SetMark(t,n));case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),on="Marks";pt({name:on,author:"Jeff Wu",description:"Lets you tag a row with a string, and then reference that row with @markname.\n  Fast search for marked rows, using '."},function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new sn(t),e.next=3,n.enable();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return e.deregisterAll()}));n(127);function cn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0",r=""+e,a=t-r.length;return 0===a?r:new Array(a+1).join(n)+r}pt({name:"Text Formatting",author:"Jeff Wu",description:Object(o.jsxs)("div",{children:["Lets you:",Object(o.jsxs)("ul",{children:[Object(o.jsxs)("li",{children:[" ",Object(o.jsx)("span",{className:"italic",children:"italicize"})," text by surrounding with *asterisks* "]}),Object(o.jsxs)("li",{children:[" ",Object(o.jsx)("span",{className:"bold",children:"bold"})," text by surrounding with **double asterisks** "]}),Object(o.jsxs)("li",{children:[" ",Object(o.jsx)("span",{className:"underline",children:"underline"})," text by surrounding with _underscores_ "]}),Object(o.jsxs)("li",{children:[" ",Object(o.jsx)("span",{className:"code",children:"code"})," text by surrounding with `back-ticks` "]})]})]})},(function(e){e.registerHook("session","renderLineTokenHook",(function(e,t){return t.has_cursor||t.has_highlight?e:e.then($t(tt("\\*\\*\\*(\\n|.)+?\\*\\*\\*"),Zt(3,3,(function(e){e.renderOptions.classes.italic=!0,e.renderOptions.classes.bold=!0})))).then($t(tt("(?:(\\*\\*_)|(_\\*\\*))(\\n|.)+?(?:(\\*\\*_)|(_\\*\\*))"),Zt(3,3,(function(e){e.renderOptions.classes.bold=!0,e.renderOptions.classes.underline=!0})))).then($t(tt("(?:(\\*_)|(_\\*))(\\n|.)+?(?:(\\*_)|(_\\*))"),Zt(2,2,(function(e){e.renderOptions.classes.italic=!0,e.renderOptions.classes.underline=!0})))).then($t(tt("\\*((\\n|[^\\*])|[^\\*](\\n|.)+?[^\\*])?\\*"),Zt(1,1,(function(e){e.renderOptions.classes.italic=!0})))).then($t(tt("\\*\\*(\\n|.)+?\\*\\*"),Zt(2,2,(function(e){e.renderOptions.classes.bold=!0})))).then($t(tt("(?:[\\*]*)_(\\n|.)+?_(?:[\\*]*)"),Zt(1,1,(function(e){e.renderOptions.classes.underline=!0})))).then($t(tt("\\`(\\n|.)+?\\`"),Zt(1,1,(function(e){e.renderOptions.classes.code=!0}))))}))}),(function(e){return e.deregisterAll()}));var un=function(){function e(t){var n=this;Object(g.a)(this,e),this.api=void 0,this.logger=void 0,this.currentPath=void 0,this.isLogging=void 0,this.api=t,this.logger=this.api.logger,this.logger.info("Loading time tracking"),this.currentPath=null,this.isLogging=!1,this.api.cursor.on("rowChange",function(){var e=Object(i.a)(s.a.mark((function e(t,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.onRowChange(r.row);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerListener("document","childAdded",function(){var e=Object(i.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.row,e.next=3,Promise.all([n._setRowData(r,"treeTotalTime",0),n._setRowData(r,"rowTotalTime",0),n._setRowData(r,"detachedTime",0)]);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerHook("document","pluginRowContents",function(){var e=Object(i.a)(s.a.mark((function e(t,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.row,e.next=3,n.rowTime(a);case 3:return t.timeTracked=e.sent,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerHook("session","renderAfterLine",(function(e,t){var r=t.path,a=t.pluginData.timeTracked;if(null==a)e.push(Object(o.jsxs)("span",{style:{color:"lightgray"},children:[" ","Loading..."]},"time"));else{var s=null!==n.currentPath&&r.row===n.currentPath.row;if(s||a>1e3){var i=" ";if(i+=n.printTime(a),s&&(i+=" + "),e.push(Object(o.jsx)("span",{style:{color:"lightgray"},children:i},"time")),null!==n.currentPath&&s){var c=Date.now()-n.currentPath.time;e.push(Object(o.jsx)("span",{style:{color:"lightgray"},className:"curtime",children:n.printTime(c)},"curtime"))}}}return e})),this.api.registerListener("document","afterMove",function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._rebuildTreeTime(t.row);case 2:return e.next=4,n._rebuildTreeTime(t.old_parent,!0);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerListener("document","afterAttach",function(){var e=Object(i.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.old_detached_parent){e.next=8;break}return e.next=3,n.getRowData(t.row,"treeTotalTime",0);case 3:return r=e.sent,e.next=6,n.transformRowData(t.old_detached_parent,"detachedTime",(function(e){return e-r}),0);case 6:return e.next=8,n._rebuildTreeTime(t.old_detached_parent,!0);case 8:return e.next=10,n._rebuildTreeTime(t.row);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerListener("document","afterDetach",function(){var e=Object(i.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.last){e.next=6;break}return e.next=3,n.getRowData(t.row,"treeTotalTime",0);case 3:return r=e.sent,e.next=6,n.transformRowData(t.parent_row,"detachedTime",(function(e){return e+r}),0);case 6:return e.next=8,n._rebuildTreeTime(t.row);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerListener("session","exit",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.onRowChange(null);case 2:case"end":return e.stop()}}),e)})))),this.api.registerAction("toggle-time-tracking","Toggle whether time is being logged",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.toggleLogging();case 2:case"end":return e.stop()}}),e)})))),this.api.registerAction("clear-row-time","Clear current row time",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.resetCurrentPath();case 2:case"end":return e.stop()}}),e)})))),this.api.registerAction("add-row-time","Add time to current row (in minutes)",function(){var e=Object(i.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.repeat,e.next=3,n.changeTimeCurrentPath(r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerAction("subtract-row-time","Subtract time from current row (in minutes)",function(){var e=Object(i.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.repeat,e.next=3,n.changeTimeCurrentPath(-r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerDefaultMappings("NORMAL",{"toggle-time-tracking":[["Z","l"]],"clear-row-time":[["Z","c"]],"add-row-time":[["Z","a"],["Z",">"]],"subtract-row-time":[["Z","s"],["Z","<"]]}),setInterval((function(){if(null!==n.currentPath){var e=Date.now()-n.currentPath.time;u()(".curtime").text(n.printTime(e))}}),1e3)}return Object(N.a)(e,[{key:"changeTimeCurrentPath",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.currentPath){e.next=12;break}if(n=Date.now()-this.currentPath.time,!((n+=60*t*1e3)<0)){e.next=9;break}return this.currentPath.time=Date.now(),e.next=7,this.modifyTimeForRow(this.currentPath.row,n);case 7:e.next=10;break;case 9:this.currentPath.time=Date.now()-n;case 10:return e.next=12,this.api.updatedDataForRender(this.currentPath.row);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getRowData",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:null,a="".concat(t,":").concat(n),e.next=4,this.api.getData(a,r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_setRowData",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(t,":").concat(n),e.next=3,this.api.setData(a,r);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setRowData",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setRowData(t,n,r);case 2:return e.next=4,this.api.updatedDataForRender(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"transformRowData",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>3&&void 0!==i[3]?i[3]:null,e.t0=this,e.t1=t,e.t2=n,e.t3=r,e.next=7,this.getRowData(t,n,a);case 7:return e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.next=11,e.t0.setRowData.call(e.t0,e.t1,e.t2,e.t5);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"toggleLogging",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!this.isLogging,null!=t&&(n=t),!n){e.next=11;break}return this.logger.info("Turning logging on"),e.next=6,this.api.setData("isLogging",!0);case 6:if(this.isLogging){e.next=9;break}return e.next=9,this.onRowChange(this.api.cursor.row);case 9:e.next=17;break;case 11:if(this.logger.info("Turning logging off"),!this.isLogging){e.next=15;break}return e.next=15,this.onRowChange(null);case 15:return e.next=17,this.api.setData("isLogging",!1);case 17:this.isLogging=n;case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onRowChange",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.currentPath&&this.currentPath.row||null,this.isLogging){e.next=7;break}if(this.currentPath=null,!n){e.next=6;break}return e.next=6,this.api.updatedDataForRender(n);case 6:return e.abrupt("return");case 7:if(null==n||n!==t){e.next=9;break}return e.abrupt("return");case 9:if(this.logger.debug("Switching from row ".concat(n," to row ").concat(t)),r=Date.now(),null==this.currentPath){e.next=16;break}return e.next=14,this.modifyTimeForRow(this.currentPath.row,r-this.currentPath.time);case 14:return e.next=16,this.api.updatedDataForRender(n);case 16:if(null===t){e.next=22;break}return this.currentPath={row:t,time:r},e.next=20,this.api.updatedDataForRender(t);case 20:e.next=23;break;case 22:this.currentPath=null;case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"resetCurrentPath",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.currentPath){e.next=4;break}return this.currentPath.time=Date.now(),e.next=4,this.api.updatedDataForRender(this.currentPath.row);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"modifyTimeForRow",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.transformRowData(t,"rowTotalTime",(function(e){return e+n}),0);case 2:return e.next=4,this._rebuildTreeTime(t,!0);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_rebuildTotalTime",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,o=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.session.document._getChildren(t);case 2:return n=e.sent,e.next=5,Promise.all(n.map(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getRowData(t,"treeTotalTime",0);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).concat([this.getRowData(t,"detachedTime",0),this.getRowData(t,"rowTotalTime",0)]));case 5:return r=e.sent,a=r.reduce((function(e,t){return e+t}),0),e.next=9,this.setRowData(t,"treeTotalTime",a);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_rebuildTreeTime",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],e.next=3,this.api.session.document.allAncestors(t,{inclusive:n});case 3:r=e.sent,a=0;case 5:if(!(a<r.length)){e.next=12;break}return i=r[a],e.next=9,this._rebuildTotalTime(i);case 9:a++,e.next=5;break;case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowTime",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getRowData(t,"treeTotalTime",0);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"printTime",value:function(e){var t="";e<0&&(t="-",e=-e);var n=Math.floor(e/1e3%60),r=Math.floor(e/6e4%60),a=Math.floor(e/36e5);return a>0?"".concat(t).concat(a,"h:").concat(cn(r,2),"m"):r>0?"".concat(t).concat(r,"m:").concat(cn(n,2),"s"):"".concat(t).concat(n,"s")}}]),e}();pt({name:"Time Tracking",author:"Zachary Vance",description:"\n    Keeps track of how much time has been spent in each row\n    (including its descendants)\n    ",version:3},function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new un(t),e.t0=n,e.next=4,t.getData("isLogging",!0);case 4:return e.t1=e.sent,e.next=7,e.t0.toggleLogging.call(e.t0,e.t1);case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return e.deregisterAll()}));n(128);pt({name:"Todo",author:"Jeff Wu",description:"Lets you strike out bullets (by default with ctrl+enter)"},(function(e){function t(e,t){return n.apply(this,arguments)}function n(){return(n=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.document.store._isStruckThroughOldFormat(n);case 2:if(!e.sent){e.next=5;break}return e.abrupt("return",!0);case 5:return e.next=7,t.document.getText(n);case 7:return r=e.sent,e.abrupt("return","~~"===r.slice(0,2)&&"~~"===r.slice(-2));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function r(e,t){return a.apply(this,arguments)}function a(){return(a=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.addChars(n,-1,["~","~"]);case 2:return e.next=4,t.addChars(n,0,["~","~"]);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function o(e,t){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.delChars(n,-2,2);case 2:return e.next=4,t.delChars(n,0,2);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.registerHook("session","renderLineTokenHook",(function(e,t){return t.has_cursor||t.has_highlight?e:e.then($t(tt("\\~\\~(\\n|.)+?\\~\\~"),Zt(2,2,(function(e){e.renderOptions.classes.strikethrough=!0}))))})),e.registerAction("toggle-strikethrough","Toggle strikethrough for a row",function(){var e=Object(i.a)(s.a.mark((function e(n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.session,e.next=3,t(a,a.cursor.row);case 3:if(!e.sent){e.next=8;break}return e.next=6,o(a,a.cursor.row);case 6:e.next=10;break;case 8:return e.next=10,r(a,a.cursor.row);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.registerAction("visual-line-toggle-strikethrough","Toggle strikethrough for rows",function(){var e=Object(i.a)(s.a.mark((function e(n){var a,c,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.session,null!=(c=n.visual_line)){e.next=3;break}throw new Error("Visual_line mode arguments missing");case 3:return e.next=5,Promise.all(c.selected.map(function(){var e=Object(i.a)(s.a.mark((function e(n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(a,n.row);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:if(u=e.sent,!j.every(u)){e.next=11;break}return e.next=9,Promise.all(c.selected.map(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(a,t.row);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:e.next=13;break;case 11:return e.next=13,Promise.all(c.selected.map(function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u[n]){e.next=3;break}return e.next=3,r(a,t.row);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 13:return e.next=15,a.setMode("NORMAL");case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.registerDefaultMappings("NORMAL",{"toggle-strikethrough":[["ctrl+enter"]]}),e.registerDefaultMappings("INSERT",{"toggle-strikethrough":[["ctrl+enter","meta+enter"]]}),e.registerDefaultMappings("VISUAL_LINE",{"visual-line-toggle-strikethrough":[["ctrl+enter"]]})}),(function(e){return e.deregisterAll()}));pt({name:"Recursive-Expand",author:"Nikhil Sonti",description:"Lets you recursively expand or collapse a node"},(function(e){function t(e,t,r){return n.apply(this,arguments)}function n(){return(n=Object(i.a)(s.a.mark((function e(n,r,a){var o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I.debug("Toggle state: "+a+" row = "+r.row),e.next=3,n.document.setCollapsed(r.row,a);case 3:return e.next=5,n.document.hasChildren(r.row);case 5:if(!e.sent){e.next=11;break}return e.next=8,n.document.getChildren(r);case 8:o=e.sent,I.debug("No of children: "+o.length),o.forEach(function(){var e=Object(i.a)(s.a.mark((function e(r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(n,r,a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.registerAction("toggle-expand","Toggle expand/collapse recursively",function(){var e=Object(i.a)(s.a.mark((function e(n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.session,e.next=3,r.document.collapsed(r.cursor.row);case 3:return a=e.sent,e.next=6,t(r,r.cursor.path,!a);case 6:return e.next=8,r.document.forceLoadTree(r.cursor.row,!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.registerDefaultMappings("NORMAL",{"toggle-expand":[["Z"]]})}),(function(e){return e.deregisterAll()})),pt({name:"Daily Notes",author:"shady2k",description:Object(o.jsxs)("div",{children:["How to use:",Object(o.jsxs)("ul",{children:[Object(o.jsx)("li",{children:'This plugin automatically creates a "Daily Notes" node at the root. Sub-nodes are created automatically every day (if missing, they can also be manually created). Paths to sub-nodes have YYYY, YYYY-MM and YYYY-MM-DD date formats.'}),Object(o.jsx)("li",{children:" Marks plugin required: easy navigation between today, tommorrow and yesterday nodes (created every day automatically)"}),Object(o.jsx)("li",{children:" All new records will be automatically cloned in the today node"}),Object(o.jsx)("li",{children:" Adding a date in format YYYY-MM-DD will create that day in the Daily Notes subtree as a Linked node"})]})]}),version:1,dependencies:[on]},function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new hn(t),e.next=4,t.setData("isLogging",!1);case 4:e.next=8;break;case 6:return e.next=8,t.setData("isLogging",!0);case 8:return e.next=10,n.init();case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return e.deregisterAll()}));var hn=function(){function e(t){var n=this;Object(g.a)(this,e),this.api=void 0,this.logger=void 0,this.isLogging=void 0,this.dailyMarks=void 0,this.childAddedArr=void 0,this.dailyNotesRoot=void 0,this.lastRowText=void 0,this.detachTimer=void 0,this.api=t,this.logger=this.api.logger,this.logger.info("Loading Daily notes"),this.isLogging=!1,this.childAddedArr=[],this.dailyNotesRoot=null,this.lastRowText=null,this.detachTimer=null,this.setLogging(),this.api.cursor.on("rowChange",function(){var e=Object(i.a)(s.a.mark((function e(t,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.log("rowChange",t,r),n.checkNewDay(),n.checkRowTextChanged(t,r);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerListener("document","childAdded",function(){var e=Object(i.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.row,n.log("childAdded",r),n.childAddedArr.push(r);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerListener("document","loadRow",function(){var e=Object(i.a)(s.a.mark((function e(t,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:-1!==(a=j.findIndex(n.childAddedArr,(function(e){return e===t.row})))&&(n.log("loadRow",t,r),n.childAddedArr.splice(a,1),n.addCreatedToday(t.row));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerListener("document","afterDetach",function(){var e=Object(i.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n,n.detachTimer&&clearTimeout(n.detachTimer),n.detachTimer=setTimeout(Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.checkDeleted(t);case 2:case"end":return e.stop()}}),e)}))),1e3);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}return Object(N.a)(e,[{key:"setLogging",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.getData("isLogging",!1);case 2:this.isLogging=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("init"),e.next=3,this.initDailyMarks();case 3:return e.next=5,this.checkDailyMarks();case 5:t=Object(ct.a)(this.dailyMarks),e.prev=6,t.s();case 8:if((n=t.n()).done){e.next=15;break}if(!(r=n.value).date||!r.mark){e.next=13;break}return e.next=13,this.createDailyNode(r.id,r.date,r.mark);case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),t.e(e.t0);case 20:return e.prev=20,t.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[6,17,20,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"initDailyMarks",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new Date,(n=new Date).setDate(t.getDate()+1),(r=new Date).setDate(t.getDate()-1),this.dailyMarks=[{id:"tomorrow",mark:"tomorrow",date:n,node:null,linkedNode:null},{id:"today",mark:"today",date:t,node:null,linkedNode:null},{id:"yesterday",mark:"yesterday",date:r,node:null,linkedNode:null}];case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkNewDay",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("checkNewDay"),!this.isNewDay()){e.next=8;break}return this.log("New day comes"),this.initDailyMarks(),e.next=6,this.init();case 6:e.next=9;break;case 8:this.log("Same day");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNewDay",value:function(){this.log("isNewDay");var e=this.dailyMarks.find((function(e){return"today"===e.id})),t=new Date,n=e.date;if(t&&n)return t.setHours(0,0,0,0)!==n.setHours(0,0,0,0);throw new Error("Can't get dates")}},{key:"checkRowTextChanged",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t===n){e.next=8;break}return e.next=3,this.api.session.document.getText(t.row);case 3:return r=e.sent,null!==this.lastRowText&&this.lastRowText!==r&&(this.log("Row text changed",t),this.checkForDates(t,r)),e.next=7,this.api.session.document.getText(n.row);case 7:this.lastRowText=e.sent;case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"isValidDate",value:function(e,t,n){var r=new Date(e,t,n);return r.getFullYear()===e&&r.getMonth()===t&&r.getDate()===n}},{key:"checkForDates",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c,u,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}return e.next=3,this.api.session.document.getText(t.row);case 3:n=e.sent;case 4:if(n){e.next=6;break}return e.abrupt("return");case 6:if(r=tt("\\d{4}\\-\\d{2}\\-\\d{2}"),!(a=r.exec(n))){e.next=23;break}if(this.log("Matched",a),i=a[1],o=new Date(Date.parse(i)),3!==(c=a[1].split("-")).length){e.next=23;break}if(!this.isValidDate(Number.parseInt(c[0]),Number.parseInt(c[1]),Number.parseInt(c[2]))){e.next=23;break}return u={id:i,mark:null,date:o,node:null,linkedNode:null},this.dailyMarks.push(u),e.next=20,this.createDailyNode(i,o,null);case 20:return h=this.getLinkedNode(i),e.next=23,this.addLinked(h,t.row,!0);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkDeleted",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("checkDeleted",t),n=!1,e.next=4,this.getDailyNotesRoot();case 4:r=e.sent,a=Object(ct.a)(this.dailyMarks);try{for(a.s();!(i=a.n()).done;)(o=i.value).node&&t.row===o.node.row&&(n=!0),o.linkedNode&&t.row===o.linkedNode.row&&(n=!0)}catch(s){a.e(s)}finally{a.f()}if(r&&t.row===r.row&&(n=!0),!n){e.next=13;break}return this.log("needReInit",!0),this.dailyNotesRoot=null,e.next=13,this.init();case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isHasRows",value:function(e,t){if(e){var n,r=!1,a=Object(ct.a)(t);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(e.row===s){r=!0;break}}}catch(i){a.e(i)}finally{a.f()}return!!r||!!e.parent&&this.isHasRows(e.parent,t)}return!1}},{key:"addLinked",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c,u,h,l,p=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>2&&void 0!==p[2]&&p[2],this.log("addLinked",n),a=!1,e.next=5,this.api.session.document.canonicalPath(n);case 5:if(i=e.sent,r){e.next=11;break}return e.next=9,this.getDailyNotesRoot();case 9:o=e.sent,a=this.isHasRows(i,[o.row]);case 11:return c=!1,e.next=14,this.getChildren(t);case 14:(u=e.sent)&&(h=[],u.map((function(e){return h.push(e.row)})),c=this.isHasRows(i,h)),a||c||(this.log("Create clone",n),(l=[]).push(n),t&&this.api.session.attachBlocks(t,l,0));case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addCreatedToday",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("addCreatedToday",t),n=this.getLinkedNode("today"),e.next=4,this.addLinked(n,t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setNode",value:function(e,t){this.log("setNode",e,t),this.dailyMarks.find((function(t){return t.id===e})).node=t}},{key:"getLinkedNode",value:function(e){return this.log("getLinkedNode",e),this.dailyMarks.find((function(t){return t.id===e})).linkedNode}},{key:"setLinkedNode",value:function(e,t){this.log("setLinkedNode",e,t),this.dailyMarks.find((function(t){return t.id===e})).linkedNode=t}},{key:"checkDailyMarks",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o,c,u,h,l=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("checkDailyMarks"),t=this.api.getPlugin(on),e.t0=this,e.next=5,this.getDailyNotesRoot();case 5:e.t1=e.sent,n=e.t0.traverseSubtree.call(e.t0,e.t1),r=!0,a=!1,e.prev=9,o=s.a.mark((function e(){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=h,e.next=3,t.getMark(n.row);case 3:if(null===(r=e.sent)){e.next=10;break}if(!(a=l.dailyMarks.find((function(e){return e.mark===r})))){e.next=10;break}return l.log("checkDailyMarks","Clear mark",a.mark),e.next=10,l.setMark(n,null);case 10:case"end":return e.stop()}}),e)})),c=Object($e.a)(n);case 12:return e.next=14,c.next();case 14:return u=e.sent,r=u.done,e.next=18,u.value;case 18:if(h=e.sent,r){e.next=24;break}return e.delegateYield(o(),"t2",21);case 21:r=!0,e.next=12;break;case 24:e.next=30;break;case 26:e.prev=26,e.t3=e.catch(9),a=!0,i=e.t3;case 30:if(e.prev=30,e.prev=31,r||null==c.return){e.next=35;break}return e.next=35,c.return();case 35:if(e.prev=35,!a){e.next=38;break}throw i;case 38:return e.finish(35);case 39:return e.finish(30);case 40:case"end":return e.stop()}}),e,this,[[9,26,30,40],[31,,35,39]])})));return function(){return e.apply(this,arguments)}}()},{key:"getNodeText",value:function(e,t){var n=e.getFullYear().toString(),r=("0"+(e.getMonth()+1).toString()).slice(-2),a=("0"+e.getDate().toString()).slice(-2);return"year"===t?n:"month"===t?[n,r].join("-"):[n,r,a].join("-")}},{key:"log",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLogging){for(n=i.length,r=new Array(n),a=0;a<n;a++)r[a]=i[a];(t=this.logger).info.apply(t,["Daily notes: "].concat(r))}case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNodeWithText",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c,u,h,l,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("getNodeWithText",t,n),r=this.api.session.document,e.next=4,r.hasChildren(t.row);case 4:if(!e.sent){e.next=46;break}return e.next=7,r.getChildren(t);case 7:a=e.sent,i=!0,o=!1,e.prev=10,u=Object($e.a)(a);case 12:return e.next=14,u.next();case 14:return h=e.sent,i=h.done,e.next=18,h.value;case 18:if(l=e.sent,i){e.next=30;break}return p=l,e.next=23,r.getText(p.row);case 23:if(e.t0=e.sent,e.t1=n,e.t0!==e.t1){e.next=27;break}return e.abrupt("return",p);case 27:i=!0,e.next=12;break;case 30:e.next=36;break;case 32:e.prev=32,e.t2=e.catch(10),o=!0,c=e.t2;case 36:if(e.prev=36,e.prev=37,i||null==u.return){e.next=41;break}return e.next=41,u.return();case 41:if(e.prev=41,!o){e.next=44;break}throw c;case 44:return e.finish(41);case 45:return e.finish(36);case 46:return e.abrupt("return",null);case 47:case"end":return e.stop()}}),e,this,[[10,32,36,46],[37,,41,45]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDailyNotesRoot",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("getDailyNotesRoot"),!this.dailyNotesRoot||!this.api.session.document.isValidPath(this.dailyNotesRoot)){e.next=6;break}return this.log("getDailyNotesRoot from cache"),e.abrupt("return",this.dailyNotesRoot);case 6:return e.next=8,this.getNodeWithText(this.api.session.document.root,"Daily Notes");case 8:if(t=e.sent){e.next=17;break}return e.next=12,this.createDailyNotesRoot();case 12:return e.next=14,this.getNodeWithText(this.api.session.document.root,"Daily Notes");case 14:if(t=e.sent){e.next=17;break}throw new Error("Error while creating node");case 17:return this.dailyNotesRoot=t,e.abrupt("return",t);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setMark",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("setMark",t,n),r=this.api.getPlugin(on),e.next=4,r.setMark(t.row,n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"traverseSubtree",value:function(e){var t=this;return Object(Je.a)(s.a.mark((function n(){var r,a,i,o;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=function(){return(o=Object(Je.a)(s.a.mark((function e(t){var n,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.row in r)){e.next=2;break}return e.abrupt("return");case 2:return r[t.row]=!0,e.next=5,t;case 5:return e.next=7,Object(Ye.a)(a.getChildren(t));case 7:n=e.sent,o=0;case 9:if(!(o<n.length)){e.next=21;break}return e.t0=Ze.a,e.t1=$e.a,e.next=14,Object(Ye.a)(i(n[o]));case 14:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=Ye.a,e.delegateYield((0,e.t0)(e.t3,e.t4),"t5",18);case 18:o++,e.next=9;break;case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)},i=function(e){return o.apply(this,arguments)},r={},a=t,n.t0=Ze.a,n.t1=$e.a,n.next=8,Object(Ye.a)(i(e));case 8:return n.t2=n.sent,n.t3=(0,n.t1)(n.t2),n.t4=Ye.a,n.delegateYield((0,n.t0)(n.t3,n.t4),"t5",12);case 12:case"end":return n.stop()}}),n)})))()}},{key:"getChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.api.session.document.getChildren(t);case 4:return e.abrupt("return",e.sent.map((function(e){return t.child(e.row)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBlock",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(c.length>2&&void 0!==c[2])||c[2],a=c.length>3?c[3]:void 0,i={text:n,collapsed:r,plugins:a,children:[]},this.log("createBlock",t,n,r,a,i),e.next=6,this.api.session.addBlocks(t,0,[i]);case 6:return e.next=8,this.getNodeWithText(t,n);case 8:if(o=e.sent,this.log("Block created",t,n),o){e.next=12;break}throw new Error("Error while creating block");case 12:return e.next=14,this.api.updatedDataForRender(t.row);case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createDailyNotesRoot",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("createDailyNotes"),e.next=3,this.createBlock(this.api.session.document.root,"Daily Notes");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createDailyNode",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,r){var a,i,o,c,u,h,l,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("createDailyNode",n,r),e.next=3,this.getDailyNotesRoot();case 3:return a=e.sent,i=this.getNodeText(n,"year"),o=this.getNodeText(n,"month"),c=this.getNodeText(n,"day"),e.next=9,this.getNodeWithText(a,i);case 9:if(u=e.sent){e.next=14;break}return e.next=13,this.createBlock(a,i);case 13:u=e.sent;case 14:return e.next=16,this.getNodeWithText(u,o);case 16:if(h=e.sent){e.next=21;break}return e.next=20,this.createBlock(u,o);case 20:h=e.sent;case 21:return e.next=23,this.getNodeWithText(h,c);case 23:if(l=e.sent){e.next=30;break}return e.next=27,this.createBlock(h,c,!0,{mark:r});case 27:l=e.sent,e.next=31;break;case 30:r&&this.setMark(l,r);case 31:return this.setNode(t,l),e.next=34,this.getNodeWithText(l,"Linked");case 34:if(p=e.sent){e.next=39;break}return e.next=38,this.createBlock(l,"Linked",!1);case 38:p=e.sent;case 39:this.setLinkedNode(t,p);case 40:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}();pt({name:"Deadlines",author:"Victor Tao",description:Object(o.jsx)("div",{children:Object(o.jsxs)("ul",{children:[Object(o.jsx)("li",{children:' Creates a "Deadlines" node at the root'}),Object(o.jsx)("li",{children:' Add a deadline to a node by adding a child of the form "due YYYY-MM-DD" or "due MM-DD"'}),Object(o.jsx)("li",{children:" All new deadlines will be automatically cloned in the Deadlines node in sorted order"}),Object(o.jsx)("li",{children:' Requires marks plugin to mark the "Deadlines" node '})]})}),version:1,dependencies:[on]},function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ln(t),e.next=4,t.setData("isLogging",!1);case 4:e.next=8;break;case 6:return e.next=8,t.setData("isLogging",!0);case 8:return e.next=10,n.init();case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return e.deregisterAll()}));var ln=function(){function e(t){var n=this;Object(g.a)(this,e),this.api=void 0,this.logger=void 0,this.isLogging=void 0,this.deadlinesRoot=void 0,this.detachTimer=void 0,this.api=t,this.logger=this.api.logger,this.logger.info("Loading Deadlines"),this.isLogging=!1,this.deadlinesRoot=null,this.detachTimer=null,this.api.cursor.on("rowChange",function(){var e=Object(i.a)(s.a.mark((function e(t,r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.log("rowChange",t,r),n.checkForDates(t);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerListener("document","afterDetach",function(){var e=Object(i.a)(s.a.mark((function e(t){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n,n.detachTimer&&clearTimeout(n.detachTimer),n.detachTimer=setTimeout(Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.checkDeleted(t);case 2:case"end":return e.stop()}}),e)}))),1e3);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}return Object(N.a)(e,[{key:"setLogging",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.getData("isLogging",!0);case 2:this.isLogging=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.log("init"),this.getDeadlinesRoot();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkForDates",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("checkForDates",t),n){e.next=5;break}return e.next=4,this.api.session.document.getText(t.row);case 4:n=e.sent;case 5:if(n){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.parseDate(n);case 9:if(!(r=e.sent)||!t.parent){e.next=17;break}return e.next=13,this.inDeadlines(t.parent.row);case 13:if(e.sent){e.next=17;break}return e.next=17,this.createDeadlineClone(t.parent.row,r);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"inDeadlines",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("inDeadlines",t),e.next=3,this.getDeadlinesRoot();case 3:return n=e.sent,r=this.api.session.document,e.next=7,r.getInfo(t);case 7:return a=e.sent,i=a.parentRows,e.abrupt("return",i.includes(n.row));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDeadlineClone",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c,u,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("createDeadlineClone",t,n),e.next=3,this.getDeadlinesRoot();case 3:return r=e.sent,a=0,e.next=7,this.getChildren(r);case 7:i=e.sent,o=Object(ct.a)(i),e.prev=9,o.s();case 11:if((c=o.n()).done){e.next=21;break}return u=c.value,e.next=15,this.getDate(u);case 15:if(!((h=e.sent)&&n<h)){e.next=18;break}return e.abrupt("break",21);case 18:a++;case 19:e.next=11;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(9),o.e(e.t0);case 26:return e.prev=26,o.f(),e.finish(26);case 29:return this.log("createDeadlineClone attachBlocks",r,t,a),e.next=32,this.api.session.attachBlocks(r,[t],a);case 32:return e.next=34,this.api.updatedDataForRender(t);case 34:case"end":return e.stop()}}),e,this,[[9,23,26,29]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("getDate",t),e.next=3,this.getChildren(t);case 3:n=e.sent,r=Object(ct.a)(n),e.prev=5,r.s();case 7:if((a=r.n()).done){e.next=19;break}return i=a.value,e.next=11,this.api.session.document.getText(i.row);case 11:return o=e.sent,e.next=14,this.parseDate(o);case 14:if(!(c=e.sent)){e.next=17;break}return e.abrupt("return",c);case 17:e.next=7;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(5),r.e(e.t0);case 24:return e.prev=24,r.f(),e.finish(24);case 27:return e.abrupt("return",null);case 28:case"end":return e.stop()}}),e,this,[[5,21,24,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseDate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("parseDate",t),e.abrupt("return",this.parseFullDate(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseFullDate",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("parseFullDate",t),n=tt("due ((\\d+\\-)?\\d+\\-\\d+)"),!(r=n.exec(t.toLowerCase()))){e.next=15;break}return this.log("Matched",r),a=r[2].split("-").map(Number),i=r[2],o=new Date,2===a.length&&(i=o.getFullYear().toString()+"-"+i),c=new Date(Date.parse(i)),(u=new Date(o)).setDate(o.getDate()-7),2===a.length&&c<u&&c.setFullYear(c.getFullYear()+1),this.log("parseFullDate",a,c),e.abrupt("return",c);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkDeleted",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("checkDeleted",t),n=!1,e.next=4,this.getDeadlinesRoot();case 4:if((r=e.sent)&&t.row===r.row&&(n=!0),!n){e.next=11;break}return this.log("needReInit",!0),this.deadlinesRoot=null,e.next=11,this.init();case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"log",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isLogging){for(n=i.length,r=new Array(n),a=0;a<n;a++)r[a]=i[a];(t=this.logger).info.apply(t,["Deadlines: "].concat(r))}case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getMarkPath",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("getMarkPath",t),n=this.api.getPlugin(on),e.next=4,n.listMarks();case 4:return r=e.sent,this.log("getMarkPath",r,t),e.abrupt("return",r[t]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDeadlinesRoot",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.log("getDeadlinesRoot"),!this.deadlinesRoot||!this.api.session.document.isValidPath(this.deadlinesRoot)){e.next=6;break}return this.log("getDeadlinesRoot from cache"),e.abrupt("return",this.deadlinesRoot);case 6:return e.next=8,this.getMarkPath("deadlines");case 8:if(t=e.sent){e.next=17;break}return e.next=12,this.createDeadlinesRoot();case 12:return e.next=14,this.getMarkPath("deadlines");case 14:if(t=e.sent){e.next=17;break}throw new Error("Error while creating node");case 17:return this.deadlinesRoot=t,e.abrupt("return",t);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setMark",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("setMark",t,n),r=this.api.getPlugin(on),e.next=4,r.setMark(t.row,n);case 4:a=e.sent,this.log("setMark",a);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getChildren",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=4,this.api.session.document.getChildren(t);case 4:return e.abrupt("return",e.sent.map((function(e){return t.child(e.row)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createBlock",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(c.length>2&&void 0!==c[2])||c[2],a=c.length>3?c[3]:void 0,i={text:n,collapsed:r,plugins:a,children:[]},this.log("createBlock",t,n,r,a,i),e.next=6,this.api.session.addBlocks(t,0,[i]);case 6:if(!((o=e.sent).length>0)){e.next=14;break}return this.log("Block created",t,n),e.next=11,this.api.updatedDataForRender(t.row);case 11:return e.abrupt("return",o[0]);case 14:throw new Error("Error while creating block");case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createDeadlinesRoot",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("createDeadlines"),e.next=3,this.createBlock(this.api.session.document.root,"Deadlines");case 3:if(!(t=e.sent)){e.next=7;break}return e.next=7,this.setMark(t,"deadlines");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),pn={padding:"0px 8px",marginLeft:8},fn={padding:"0px 8px",marginRight:8},dn=function(){function e(t){Object(g.a)(this,e),this.api=void 0,this.logger=void 0,this.session=void 0,this.document=void 0,this.tagstate=null,this.SetTag=void 0,this.UnsetTag=void 0,this.api=t,this.logger=this.api.logger,this.session=this.api.session,this.document=this.session.document}return Object(N.a)(e,[{key:"enable",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,this.logger.debug("Enabling tags"),n=function(e){Object(k.a)(a,e);var n=Object(m.a)(a);function a(e,t){var r,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(g.a)(this,a),(r=n.call(this)).row=void 0,r.tag=void 0,r.undo=void 0,r.row=e,r.tag=t,r.undo=s,r}return Object(N.a)(a,[{key:"str",value:function(){return"row ".concat(this.row,", tag ").concat(this.tag)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._setTag(this.row,this.tag);case 2:return e.next=4,t.api.updatedDataForRender(this.row);case 4:if(this.undo){e.next=7;break}return e.next=7,t.document.applyHookAsync("tagAdded",{},{tag:this.tag,row:this.row});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new r(this.row,this.tag,!0)]);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(dt),this.SetTag=n,r=function(e){Object(k.a)(a,e);var r=Object(m.a)(a);function a(e,t){var n,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(g.a)(this,a),(n=r.call(this)).row=void 0,n.tag=void 0,n.undo=void 0,n.row=e,n.tag=t,n.undo=s,n}return Object(N.a)(a,[{key:"str",value:function(){return"row ".concat(this.row,", tag ").concat(this.tag)}},{key:"mutate",value:function(){var e=Object(i.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTags(this.row);case 2:if(null===(n=e.sent)||!n.includes(this.tag)){e.next=11;break}return e.next=6,t._unsetTag(this.row,this.tag);case 6:return e.next=8,t.api.updatedDataForRender(this.row);case 8:if(this.undo){e.next=11;break}return e.next=11,t.document.applyHookAsync("tagRemoved",{},{tag:this.tag,row:this.row});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"rewind",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("unset undo",this.tag),e.abrupt("return",[new n(this.row,this.tag)]);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),a}(dt),this.UnsetTag=r,this.api.registerHook("document","serializeRow",function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getTags(n.row);case 2:return(r=e.sent)&&(t.tags=r),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerListener("document","loadRow",function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n.tags){e.next=6;break}return e.next=3,a.setTags(t.row,n.tags);case 3:if(!(r=e.sent)){e.next=6;break}return e.abrupt("return",a.session.showMessage(r,{text_class:"error"}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.tagstate=null,this.api.registerMode({name:"TAG",cursorBetween:!0,within_row:!0,enter:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.tagstate={session:new St,path:t.cursor.path},e.next=3,a.tagstate.session.setMode("INSERT");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),exit:function(){var e=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.tagstate){e.next=2;break}throw new Error("Tag state null during exit");case 2:return t=a.tagstate.path.row,a.tagstate=null,e.next=6,a.api.updatedDataForRender(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),every:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.tagstate){e.next=2;break}throw new Error("Tag state null during every");case 2:return e.next=4,a.api.updatedDataForRender(a.tagstate.path.row);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),key_transforms:[function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.length){e.next=9;break}if(!/^\S*$/.test(t)){e.next=9;break}if(null!==a.tagstate){e.next=4;break}throw new Error("Tag state null during key transform");case 4:return e.next=6,a.tagstate.session.addCharsAtCursor([t]);case 6:return e.next=8,a.api.updatedDataForRender(a.tagstate.path.row);case 8:return e.abrupt("return",[null,n]);case 9:return e.abrupt("return",[t,n]);case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()]}),this.api.registerAction("begin-tag","Tag a line",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.session,e.next=3,n.setMode("TAG");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerAction("finish-tag","Finish typing tag",function(){var e=Object(i.a)(s.a.mark((function e(n){var r,a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.session,a=n.keyStream,null!==t.tagstate){e.next=3;break}throw new Error("Tag state null in tag mode");case 3:return e.next=5,t.tagstate.session.curText();case 5:return i=e.sent,o=t.tagstate.path.row,e.next=9,t.addTag(o,i);case 9:return(c=e.sent)&&r.showMessage(c,{text_class:"error"}),e.next=13,r.setMode("NORMAL");case 13:a.save();case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerAction("delete-tag","Delete tag at cursor",function(){var e=Object(i.a)(s.a.mark((function e(n){var r,a,i,o,c,u,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.session,a=n.keyStream,i=null,e.next=4,t._getRowsToTags();case 4:if(o=e.sent,c=r.cursor.row,null!=o[c]&&0!==o[c].length){e.next=10;break}i="Row is not tagged",e.next=29;break;case 10:if(1!==o[c].length){e.next=14;break}u="1",e.next=17;break;case 14:return e.next=16,a.dequeue();case 16:u=e.sent;case 17:if(!(u>="1"&&u<="9")){e.next=28;break}if(!((h=parseInt(u,10)-1)>=o[c].length)){e.next=23;break}i="Index out of range",e.next=26;break;case 23:return e.next=25,t.removeTag(r.cursor.row,o[c][h]);case 25:i=e.sent;case 26:e.next=29;break;case 28:i="Key not a number from 1-9";case 29:return i&&r.showMessage(i,{text_class:"error"}),e.next=32,r.setMode("NORMAL");case 32:a.save();case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerAction("move-cursor-tag","Move the cursor within the tag being edited (according to the specified motion)",function(){var e=Object(i.a)(s.a.mark((function e(n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(r=n.motion)){e.next=3;break}throw new Error("Expected a motion!");case 3:if(null!==t.tagstate){e.next=5;break}throw new Error("Tag state null in tag mode");case 5:return e.next=7,r(t.tagstate.session.cursor,{pastEnd:!0});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),{acceptsMotion:!0}),this.api.registerAction("tag-delete-char-before","Delete last character (i.e. backspace key)",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.tagstate){e.next=2;break}throw new Error("Tag state null in tag mode");case 2:return e.next=4,t.tagstate.session.deleteAtCursor();case 4:case"end":return e.stop()}}),e)})))),this.api.registerAction("tag-delete-char-after","Delete character at the cursor (i.e. del key)",Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.tagstate){e.next=2;break}throw new Error("Tag state null in tag mode");case 2:return e.next=4,t.tagstate.session.delCharsAfterCursor(1);case 4:case"end":return e.stop()}}),e)})))),this.api.registerAction("search-tags","List tagged rows",function(){var e=Object(i.a)(s.a.mark((function e(n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.session,e.next=3,r.setMode("SEARCH");case 3:return e.next=5,t.listTags();case 5:a=e.sent,r.menu=new Ft(function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,i,o,c,u,h,l,p=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p.length>2&&void 0!==p[2]?p[2]:10,i=[],e.t0=s.a.keys(a);case 3:if((e.t1=e.t0()).done){e.next=27;break}if(0!==(o=e.t1.value).indexOf(n)){e.next=25;break}c=a[o],u=Object(ct.a)(c),e.prev=8,u.s();case 10:if((h=u.n()).done){e.next=17;break}if(l=h.value,i.push({path:l,tag:o}),!(r>0&&i.length===r)){e.next=15;break}return e.abrupt("break",17);case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t2=e.catch(8),u.e(e.t2);case 22:return e.prev=22,u.f(),e.finish(22);case 25:e.next=3;break;case 27:return e.abrupt("return",i);case 28:case"end":return e.stop()}}),e,null,[[8,19,22,25]])})));return function(t,n){return e.apply(this,arguments)}}(),e.t0=Promise,e.next=4,n(r.document,t);case 4:return e.t1=e.sent.map(function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.path,a=t.tag,e.next=3,r.document.getLine(n.row);case 3:return c=e.sent,e.abrupt("return",{contents:c,renderHook:function(e){return Object(o.jsxs)("span",{children:[Object(o.jsx)("span",{style:Object(Ie.a)(Object(Ie.a)({},ge(r.clientStore,["theme-bg-tertiary","theme-trim"])),fn),children:a}),e]},"tag_".concat(a))},fn:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.zoomInto(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,e.t0.all.call(e.t0,e.t1);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.api.registerDefaultMappings("TAG",Object.assign({"toggle-help":[["ctrl+?"]],"move-cursor-tag":[[ie]],"finish-tag":[["enter"]],"tag-delete-char-after":[["delete"]],"tag-delete-char-before":[["backspace"],["shift+backspace"]],"exit-mode":[["esc"],["ctrl+c"]]},j.pick(Et,Rt))),this.api.registerDefaultMappings("NORMAL",{"begin-tag":[["#"]],"delete-tag":[["d","#"]],"search-tags":[["-"]]}),this.api.registerHook("document","pluginRowContents",function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.row,e.next=3,a.getTags(r);case 3:if(i=e.sent,o=a.tagstate&&a.tagstate.path.row===r,t.tags={tags:i,tagging:o},!a.tagstate||!o){e.next=11;break}return e.next=9,a.tagstate.session.document.getLine(a.tagstate.session.cursor.path.row);case 9:t.tags.tagText=e.sent,t.tags.tagCol=a.tagstate.session.cursor.col;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerHook("session","renderLineOptions",(function(e,t){return t.pluginData.tags&&t.pluginData.tags.tagging&&(e.cursors={}),e})),this.api.registerHook("session","renderLineContents",(function(e,t){var n=t.pluginData;if(n.tags){var r=n.tags.tags;if(r){var s,i=Object(ct.a)(r);try{for(i.s();!(s=i.n()).done;){var c=s.value,u="tag-"+c;e.push(Object(o.jsx)("span",{style:Object(Ie.a)(Object(Ie.a)({},ge(a.api.session.clientStore,["theme-bg-tertiary"])),pn),children:c},u))}}catch(h){i.e(h)}finally{i.f()}}n.tags.tagging&&e.push(Object(o.jsx)("span",{style:Object(Ie.a)(Object(Ie.a)({},ge(a.api.session.clientStore,["theme-bg-tertiary","theme-trim-accent"])),pn),children:Object(o.jsx)(rn,{lineData:n.tags.tagText,cursors:Object(nn.a)({},n.tags.tagCol,!0),cursorStyle:ge(a.api.session.clientStore,["theme-cursor"]),highlightStyle:ge(a.api.session.clientStore,["theme-bg-highlight"]),linksStyle:ge(a.api.session.clientStore,["theme-link"]),accentStyle:ge(a.api.session.clientStore,["theme-text-accent"]),cursorBetween:!0})},"editingTag"))}return e}));case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getRowsToTags",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.getData("ids_to_tags",{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setRowsToTags",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.setData("ids_to_tags",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getTagsToRows",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.getData("tags_to_ids",{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setTagsToRows",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.setData("tags_to_ids",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sanityCheckTags",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r,a,i,o,c,u,h,l,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 2:return e.next=4,Promise.all([this._getTagsToRows(),this._getRowsToTags()]);case 4:for(o in t=e.sent,n=Object(B.a)(t,2),r=n[0],a=n[1],i={},a){E((c=a[o]).length===new Set(c).size),u=Object(ct.a)(c);try{for(u.s();!(h=u.n()).done;)l=h.value,i[l]||(i[l]=[]),i[l].push(parseInt(o,10))}catch(s){u.e(s)}finally{u.f()}}for(p in r)r[p].sort(),i[p].sort(),E(r[p].length===new Set(r[p]).size);T(r,i,"Inconsistent rows_to_tags");case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTags",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getRowsToTags();case 2:return n=e.sent,e.abrupt("return",n[t]||null);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setTag",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sanityCheckTags();case 2:return e.next=4,this._getTagsToRows();case 4:return r=e.sent,e.next=7,this._getRowsToTags();case 7:return a=e.sent,E(!r.hasOwnProperty(n)||!r[n].includes(t)),E(!a.hasOwnProperty(t)||!a[t].includes(n)),r[n]||(r[n]=[]),a[t]||(a[t]=[]),r[n].push(t),a[t].push(n),r[n].sort(),a[t].sort(),e.next=18,this._setTagsToRows(r);case 18:return e.next=20,this._setRowsToTags(a);case 20:return e.next=22,this._sanityCheckTags();case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_unsetTag",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sanityCheckTags();case 2:return e.next=4,this._getTagsToRows();case 4:return r=e.sent,e.next=7,this._getRowsToTags();case 7:return a=e.sent,E(r[n].includes(t)),E(a[t].includes(n)),r[n]=r[n].filter((function(e){return e!==t})),a[t]=a[t].filter((function(e){return e!==n})),0===r[n].length&&delete r[n],0===a[t].length&&delete a[t],e.next=16,this._setTagsToRows(r);case 16:return e.next=18,this._setRowsToTags(a);case 18:return e.next=20,this._sanityCheckTags();case 20:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"listTags",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sanityCheckTags();case 2:return e.next=4,this._getTagsToRows();case 4:return t=e.sent,n={},e.next=8,Promise.all(Object.keys(t).map(function(){var e=Object(i.a)(s.a.mark((function e(a){var o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t[a],n[a]=[],e.next=4,Promise.all(o.map(function(){var e=Object(i.a)(s.a.mark((function e(t){var i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.document.canonicalPath(t);case 2:null!==(i=e.sent)&&n[a].push(i);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addTag",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getTagsToRows();case 2:if(r=e.sent,!(n in r)){e.next=6;break}if(!r[n].includes(t)){e.next=6;break}return e.abrupt("return","Already tagged, nothing to do!");case 6:return e.next=8,this.session.do(new this.SetTag(t,n));case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeTag",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getRowsToTags();case 2:if(r=e.sent,null!==(a=r[t])&&a.includes(n)){e.next=6;break}return e.abrupt("return","Tag not in row, nothing to do!");case 6:return e.next=8,this.session.do(new this.UnsetTag(t,n));case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setTags",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c,u,h,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getRowsToTags();case 2:if(r=e.sent,a=null,!(t in r)){e.next=23;break}i=Object(ct.a)(r[t]),e.prev=6,i.s();case 8:if((o=i.n()).done){e.next=15;break}return c=o.value,e.next=12,this.removeTag(t,c);case 12:a=e.sent;case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),i.e(e.t0);case 20:return e.prev=20,i.f(),e.finish(20);case 23:if(!a){e.next=25;break}return e.abrupt("return",a);case 25:u=Object(ct.a)(n),e.prev=26,u.s();case 28:if((h=u.n()).done){e.next=35;break}return l=h.value,e.next=32,this.addTag(t,l);case 32:a=e.sent;case 33:e.next=28;break;case 35:e.next=40;break;case 37:e.prev=37,e.t1=e.catch(26),u.e(e.t1);case 40:return e.prev=40,u.f(),e.finish(40);case 43:if(!a){e.next=45;break}return e.abrupt("return",a);case 45:return e.abrupt("return",null);case 46:case"end":return e.stop()}}),e,this,[[6,17,20,23],[26,37,40,43]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),vn="Tags";pt({name:vn,author:"Victor Tao",description:"Similar to Marks, but each row can have multiple tags and tags can be reused.\n      Press '#' to add a new tag, 'd#[number]' to remove a tag, and '-' to search tags.\n   ",version:1},function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new dn(t),e.next=3,n.enable();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return e.deregisterAll()}));var bn=function(){function e(t){Object(g.a)(this,e),this.api=void 0,this.logger=void 0,this.tagRoot=void 0,this.tagsPlugin=void 0,this.api=t,this.logger=this.api.logger,this.tagRoot={},this.tagsPlugin=this.api.getPlugin(vn)}return Object(N.a)(e,[{key:"enable",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.logger.debug("Enabling cloning tags"),this.api.registerHook("document","tagAdded",function(){var e=Object(i.a)(s.a.mark((function e(n,r){var a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.tag,i=r.row,e.next=3,t.createClone(i,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.api.registerHook("document","tagRemoved",function(){var e=Object(i.a)(s.a.mark((function e(n,r){var a,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.tag,i=r.row,e.next=3,t.deleteClone(i,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"inTagRoot",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTagRoot(n);case 2:return r=e.sent,a=this.api.session.document,e.next=6,a.getInfo(t);case 6:return i=e.sent,o=i.parentRows,e.abrupt("return",o.includes(r.row));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createClone",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTagRoot(n);case 2:return r=e.sent,e.next=5,this.inTagRoot(t,n);case 5:if(e.sent){e.next=10;break}return e.next=8,this.api.session.attachBlocks(r,[t],0);case 8:return e.next=10,this.api.updatedDataForRender(t);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteClone",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.inTagRoot(t,n);case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.getTagRoot(n);case 6:if(r=e.sent,a=this.api.session.document,r){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,a._detach(t,r.row);case 12:return e.next=14,this.api.updatedDataForRender(t);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getMarkPath",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.api.getPlugin(on),e.next=3,n.listMarks();case 3:return r=e.sent,e.abrupt("return",r[t]);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getTagRoot",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.tagRoot[t],e.t1=n,!e.t1){e.next=6;break}return e.next=5,this.api.session.document.isValidPath(n);case 5:e.t1=e.sent;case 6:if(e.t0=e.t1,!e.t0){e.next=11;break}return e.next=10,this.api.session.document.isAttached(n.row);case 10:e.t0=e.sent;case 11:if(!e.t0){e.next=15;break}return e.abrupt("return",n);case 15:return e.next=17,this.getMarkPath(t);case 17:if(n=e.sent){e.next=26;break}return e.next=21,this.createTagRoot(t);case 21:return e.next=23,this.getMarkPath(t);case 23:if(n=e.sent){e.next=26;break}throw new Error("Error while creating node");case 26:return this.tagRoot[t]=n,e.abrupt("return",n);case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setMark",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.api.getPlugin(on),e.next=3,r.setMark(t.row,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createBlock",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){var r,a,i,o,c=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(c.length>2&&void 0!==c[2])||c[2],a=c.length>3?c[3]:void 0,i={text:n,collapsed:r,plugins:a,children:[]},e.next=5,this.api.session.addBlocks(t,0,[i]);case 5:if(!((o=e.sent).length>0)){e.next=12;break}return e.next=9,this.api.updatedDataForRender(t.row);case 9:return e.abrupt("return",o[0]);case 12:throw new Error("Error while creating block");case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createTagRoot",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,r,a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createBlock(this.api.session.document.root,t);case 2:if(!(n=e.sent)){e.next=6;break}return e.next=6,this.setMark(n,t);case 6:return e.next=8,this.tagsPlugin._getTagsToRows();case 8:r=e.sent,a=this.api.session.document,i=Object(ct.a)(r[t]),e.prev=11,i.s();case 13:if((o=i.n()).done){e.next=22;break}return c=o.value,e.next=17,a.isAttached(c);case 17:if(!e.sent){e.next=20;break}return e.next=20,this.createClone(c,t);case 20:e.next=13;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(11),i.e(e.t0);case 27:return e.prev=27,i.f(),e.finish(27);case 30:case"end":return e.stop()}}),e,this,[[11,24,27,30]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();pt({name:"Tag Clone",author:"Victor Tao",description:"Creates a root node for every tag with mark [TAGNAME]. Tagged rows are cloned to to this node.",version:1,dependencies:[vn,on]},function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new bn(t),e.next=3,n.enable();case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return e.deregisterAll()}));var xn,wn=n(112),gn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"render",value:function(){var e={};return this.props.onClick&&Object.assign(e,ge(this.props.session.clientStore,["theme-link"])),Object(o.jsxs)("span",{children:[Object(o.jsx)("span",{style:e,onClick:this.props.onClick,children:this.props.children}),Object(o.jsx)("i",{className:"fa fa-angle-right",style:{marginRight:15,marginLeft:15}})]})}}]),n}(h.PureComponent),kn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).state={loaded:!1},r}return Object(N.a)(n,[{key:"render",value:function(){var e=this.props.session,t=[],n=this.props.viewRoot;if(null==n.parent)throw new Error("Shouldn't render breadcrumbs at root");for(n=n.parent;null!=n.parent;){var r=e.document.cache.get(n.row);if(!r)throw new Error("Row wasnt cached despite being in crumbs");var a={path:n,pluginData:r.pluginData};t.push(Object(o.jsx)(gn,{session:e,onClick:this.props.onCrumbClick&&this.props.onCrumbClick.bind(this,n),children:e.applyHook("renderLineContents",[this.props.crumbContents[n.row]],a)},n.row)),n=n.parent}return t.push(Object(o.jsx)(gn,{session:e,onClick:this.props.onCrumbClick&&this.props.onCrumbClick.bind(this,n),children:Object(o.jsx)("i",{className:"fa fa-home"})},n.row)),t.reverse(),Object(o.jsx)("div",{style:{fontSize:20,marginBottom:10},children:t},"breadcrumbs")}}]),n}(h.Component),mn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"render",value:function(){var e={fontSize:this.props.fontSize||20,marginRight:this.props.loadingText?10:0};return Object(o.jsxs)("span",{children:[Object(o.jsx)("i",{className:"fa fa-spin fa-spinner",style:e}),this.props.loadingText]})}}]),n}(h.PureComponent),yn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).onClick=void 0,r.onCharClick=void 0,r.init(e),r}return Object(N.a)(n,[{key:"init",value:function(e){e.onClick&&(this.onClick=function(){if(!e.onClick)throw new Error("onClick disappeared");e.onClick(e.path)}),e.onCharClick&&(this.onCharClick=function(t,n){if(!e.onCharClick)throw new Error("onCharClick disappeared");e.onCharClick(e.path,t,n)})}},{key:"componentWillReceiveProps",value:function(e){this.init(e)}},{key:"render",value:function(){var e=this.props.session,t=this.props.path,n=this.props.cached.line,r=this.props.cursorsTree,a={},s=!1,i={},c=!1;null!=r.cursor&&(a[r.cursor]=!0,s=!0),Object.keys(r.selected).forEach((function(e){i[e]=!0,c=!0}));var u=[],h={lineData:n,cursors:a,cursorStyle:ge(e.clientStore,["theme-cursor"]),highlights:i,highlightStyle:ge(e.clientStore,["theme-bg-highlight"]),linksStyle:ge(e.clientStore,["theme-link"]),accentStyle:ge(e.clientStore,["theme-text-accent"]),cursorBetween:this.props.cursorBetween},l={path:t,pluginData:this.props.cached.pluginData,has_cursor:s,has_highlight:c};h.lineHook=Jt.trivial(),h.lineHook=e.applyHook("renderLineTokenHook",h.lineHook,l),h.wordHook=Jt.trivial(),h.wordHook=e.applyHook("renderWordTokenHook",h.wordHook,l),h=e.applyHook("renderLineOptions",h,l);var p=[Object(o.jsx)(rn,Object(Ie.a)({onCharClick:this.onCharClick},h),"line")];p=e.applyHook("renderLineContents",p,l),u.push.apply(u,Object(qe.a)(p));var f=e.applyHook("renderAfterLine",[],l);return Object(o.jsxs)("div",{className:"node-text",onClick:this.onClick,style:this.props.style,children:[u,f]},"text")}}]),n}(h.Component),jn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"shouldComponentUpdate",value:function(e){return!!this.props.cursorsTree.hasSelection||(!!e.cursorsTree.hasSelection||(e.topLevel!==this.props.topLevel||(e.cached!==this.props.cached||(!e.path.is(this.props.path)||(e.cursorBetween!==this.props.cursorBetween||(e.onCharClick!==this.props.onCharClick||(e.onLineClick!==this.props.onLineClick||e.onBulletClick!==this.props.onBulletClick)))))))}},{key:"render",value:function(){var e=this,t=this.props.session,r=this.props.path,a=this.props.cached,s=this.props.cursorsTree,i=[];if(null===a)return this.props.fetchData(),Object(o.jsx)(mn,{});if(!r.isRoot()){var c=Object(o.jsx)(yn,{style:{fontSize:this.props.topLevel?20:void 0,marginBottom:this.props.topLevel?10:void 0},cursorsTree:s,cursorBetween:this.props.cursorBetween,session:t,path:r,onCharClick:this.props.onCharClick,cached:a,onClick:this.props.onLineClick},"row");i.push(c)}var u=a.childRows,h=a.collapsed;if(this.props.topLevel&&!u.length){var l="Nothing here yet.";"NORMAL"===t.mode&&(l+=" Press `o` to start adding content!"),i.push(Object(o.jsx)("div",{className:"center",style:{padding:20,fontSize:20,opacity:.5},children:l},"nothing"))}else if(u.length&&(!h||this.props.topLevel)){var p=!0,f=a.children.map((function(a){if(null===a)return p=!1,null;var i=a.row,c=r.child(i),u=null;a.parentRows.length>1&&(u=Object(o.jsx)("i",{className:"fa fa-clone bullet clone-icon",title:"Cloned"},"clone"));var h={},l="fa-circle",f=void 0;if(a.childRows.length){l=a.collapsed?"fa-plus-circle":"fa-minus-circle";var d=e.props.onBulletClick;null!=d&&(f=function(){return d(c)},h.cursor="pointer")}var v=Object(o.jsx)("i",{className:"fa ".concat(l," bullet"),style:h,onClick:f,"data-ancestry":JSON.stringify(c.getAncestry())},"bullet");return v=t.applyHook("renderBullet",v,{path:c}),Object(o.jsxs)("div",{children:[u,v,Object(o.jsx)(n,{cached:a,topLevel:!1,cursorsTree:s.getChild(c.row),onCharClick:e.props.onCharClick,onLineClick:e.props.onLineClick,onBulletClick:e.props.onBulletClick,session:t,path:c,cursorBetween:e.props.cursorBetween,fetchData:e.props.fetchData},"block")]},c.row)}));p||(this.props.fetchData(),f=[Object(o.jsx)(mn,{},"spinner")]),i.push(Object(o.jsx)("div",{className:"block",children:f},"children"))}var d={};return s.visual&&Object.assign(d,ge(t.clientStore,["theme-bg-highlight"])),Object(o.jsx)("div",{className:"node",style:d,children:i})}}]),n}(h.Component),On=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).update=void 0,r.profileRender=void 0,r.getProfiler=void 0,r.onCharClick=void 0,r.onLineClick=void 0,r.onBulletClick=void 0,r.onCrumbClick=void 0,r.state={loaded:!1},r.onCharClick=function(e,t,n){return r.props.session.cursor.setPosition(e,t).then((function(){r.update()})),n.stopPropagation(),!1},r.onLineClick=function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.session,a=r.cursorBetween()?-1:-2,e.next=4,n.cursor.setPosition(t,a);case 4:r.update();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.onBulletClick=function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.session,e.next=3,n.toggleBlockCollapsed(t.row);case 3:n.save(),r.update();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.onCrumbClick=function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.props.session,e.next=3,n.zoomInto(t);case 3:n.save(),r.update();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.fetchAndRerender=r.fetchAndRerender.bind(Object(Ge.a)(r)),r.profileRender=!0,r.getProfiler=function(e){return e?function(e){var t=Date.now();return function(){I.info(e,Date.now()-t)}}:function(){return function(){return null}}},r.update=function(e){var t=!1,n=!1,r=function r(){for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];t=!0,e.apply(void 0,s).then((function(){n?(n=!1,r.apply(void 0,s)):t=!1}))};return function(){t?n=!0:r.apply(void 0,arguments)}}(Object(i.a)(s.a.mark((function e(){var t,n,a,i,o,c,u,h,l,p,f,d,v,b,x,w,g;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.props.session,n=r.getProfiler(r.profileRender)("Update took"),a=new Ct(rt.rootRow()),i=t.cursor,(o=a.getPath(i.path)).markCursor(i.col),"VISUAL_LINE"!==t.mode){e.next=20;break}return e.next=9,t.getVisualLineSelections();case 9:return c=e.sent,u=Object(B.a)(c,3),h=u[0],l=u[1],p=u[2],e.next=16,t.document.getChildRange(h,l,p);case 16:e.sent.forEach((function(e){a.getPath(e).markVisual()})),e.next=21;break;case 20:if("VISUAL"===t.mode)if((f=t.anchor).path&&i.path.is(f.path)){for(d=Math.min(i.col,f.col),v=Math.max(i.col,f.col),b=[],x=d;x<=v;x++)b.push(x);o.markCols(b)}else I.warn("Multiline not yet implemented");case 21:w={},g=t.viewRoot;case 23:if(null==g.parent){e.next=30;break}return g=g.parent,e.next=27,t.document.getText(g.row);case 27:w[g.row]=e.sent,e.next=23;break;case 30:r.setState({crumbContents:w,cursorsTree:a,loaded:!0}),n();case 32:case"end":return e.stop()}}),e)})))),r}return Object(N.a)(n,[{key:"fetchAndRerender",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.session,n=this.getProfiler(this.profileRender)("forceLoadTree took"),e.next=4,t.document.forceLoadTree(t.viewRoot.row,!0);case 4:n(),this.update();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillReceiveProps",value:function(){this.update()}},{key:"componentDidMount",value:function(){this.update()}},{key:"cursorBetween",value:function(){var e=this.props.session.mode;return K(e).metadata.cursorBetween}},{key:"render",value:function(){var e=this.props.session;if(!this.state.loaded)return Object(o.jsx)(mn,{});var t=this.state.crumbContents;if(null==t)throw new Error("crumbContents should have been loaded");var n=this.state.cursorsTree;if(null==n)throw new Error("cursorsTree should have been loaded");var r=e.mode,a=e.viewRoot;if(null===e.document.cache.get(a.row))return this.fetchAndRerender(),Object(o.jsx)(mn,{});var s=this.cursorBetween(),i=void 0,c=void 0;"NORMAL"!==r&&"INSERT"!==r&&"VISUAL"!==r&&"VISUAL_LINE"!==r||(c=this.onCharClick,i=this.onLineClick);var u=void 0;return"NORMAL"===r&&(u=this.onCrumbClick),Object(o.jsxs)("div",{children:[a.isRoot()?null:[Object(o.jsx)(kn,{session:e,viewRoot:a,onCrumbClick:u,crumbContents:t},"crumbs"),Object(o.jsx)("hr",{style:{opacity:.5,marginBottom:10}},"bar")],Object(o.jsx)(jn,{session:e,cursorsTree:n.getPath(a),cached:e.document.cache.get(a.row),path:a,cursorBetween:s,topLevel:!0,onCharClick:c,onLineClick:i,onBulletClick:this.onBulletClick,fetchData:this.fetchAndRerender})]})}}]),n}(h.Component),Cn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).updateFn=void 0,r.state={query:null},r}return Object(N.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.menu;this.updateFn=Object(i.a)(s.a.mark((function n(){var r;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.session.curLine();case 2:r=n.sent,e.setState({query:r});case 4:case"end":return n.stop()}}),n)}))),this.props.session.on("handledKey",this.updateFn),this.updateFn()}},{key:"componentWillUnmount",value:function(){if(!this.updateFn)throw new Error("Unmounting before mounting!?");this.props.session.off("handledKey",this.updateFn)}},{key:"render",value:function(){var e,t=this.props.menu,n=this.state.query,r=this.props.session,a=Object(o.jsxs)("div",{className:"searchBox",style:Object(Ie.a)({},ge(r.clientStore,["theme-trim"])),children:[Object(o.jsx)("i",{className:"fa fa-search",style:{marginRight:10}}),Object(o.jsx)("span",{children:null===n?Object(o.jsx)(mn,{}):Object(o.jsx)(rn,{lineData:n,cursors:Object(nn.a)({},t.session.cursor.col,!0),cursorStyle:ge(r.clientStore,["theme-cursor"]),highlightStyle:ge(r.clientStore,["theme-bg-highlight"]),linksStyle:ge(r.clientStore,["theme-link"]),accentStyle:ge(r.clientStore,["theme-text-accent"]),cursorBetween:!0})})]});if(0===t.results.length){var s="";s=n&&n.length?"No results!  Try typing something else":"Type something to search!",e=Object(o.jsx)("div",{style:{fontSize:20,opacity:.5},className:"center",children:s})}else e=t.results.map((function(e,n){var a=n===t.selection,s=e.renderOptions||{},i=Object(o.jsx)(rn,Object(Ie.a)({lineData:e.contents,cursorStyle:ge(r.clientStore,["theme-cursor"]),highlightStyle:ge(r.clientStore,["theme-bg-highlight"]),linksStyle:ge(r.clientStore,["theme-link"]),accentStyle:ge(r.clientStore,["theme-text-accent"])},s),"line_".concat(n));e.renderHook&&(i=e.renderHook(i));var c={marginBottom:10};return a&&Object.assign(c,ge(r.clientStore,["theme-bg-highlight"])),Object(o.jsxs)("div",{style:c,children:[Object(o.jsx)("i",{style:{marginRight:20},className:"fa ".concat(a?"fa-arrow-circle-right":"fa-circle"," bullet")}),i]},n)}));return Object(o.jsxs)("div",{children:[a,e]})}}]),n}(h.Component),_n=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"render",value:function(){var e=this,t=this.props.keyMap;if(!t)return Object(o.jsx)("div",{children:"No hotkeys!"});var n=this.props.definitions,r=this.props.ignoreEmpty,a=[],s=[];return Object.keys(t).forEach((function(i){var c=n.getRegistration(i);if(null!==c){var u=t[i];if(0!==u.length||!r){var h={fontSize:10,border:"1px solid",padding:5},l=Object(o.jsxs)("tr",{children:[Object(o.jsxs)("td",{style:h,children:[c.name,Object(o.jsx)("i",{className:"fa fa-question-circle tooltip",title:c.description,style:{float:"right"}})]}),Object(o.jsx)("td",{style:h,children:u.map((function(t,n){return Object(o.jsxs)("span",{children:[n>0?Object(o.jsx)("span",{children:" OR "},"or"):null,t.map((function(t,n){return Object(o.jsx)("span",{style:Object(Ie.a)(Object(Ie.a)({},ge(e.props.clientStore,["theme-trim","theme-bg-primary"])),{},{padding:1,borderRadius:3,margin:1}),children:t},n)}))]},n)}))})]},i);if(c instanceof oe)s.push(l);else{if(!(c instanceof ce))throw new Error("Unexpected: unknown registration type for ".concat(c));a.push(l)}}}})),Object(o.jsx)("div",{children:[{label:"Motions",rows:s},{label:"Actions",rows:a}].map((function(t){var n=t.label,r=t.rows;return[Object(o.jsx)("h5",{style:{margin:"5px 10px"},children:n},n+"_header"),Object(o.jsx)("table",{style:Object(Ie.a)({width:"100%"},ge(e.props.clientStore,["theme-bg-secondary"])),children:Object(o.jsx)("tbody",{children:r})},n+"_table")]}))})}}]),n}(h.Component),Sn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"render",value:function(){var e=this,t=this.props.pluginManager;return Object(o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[Object(o.jsx)("thead",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("th",{style:Object(Ie.a)({},ge(this.props.clientStore,["theme-trim"])),children:"Plugin"}),Object(o.jsx)("th",{style:Object(Ie.a)({},ge(this.props.clientStore,["theme-trim"])),children:"Description"}),Object(o.jsx)("th",{style:Object(Ie.a)({},ge(this.props.clientStore,["theme-trim"])),children:"Dependencies"}),Object(o.jsx)("th",{style:Object(Ie.a)(Object(Ie.a)({},ge(this.props.clientStore,["theme-trim"])),{},{maxWidth:"10%"}),children:"Version"}),Object(o.jsx)("th",{style:Object(Ie.a)(Object(Ie.a)({},ge(this.props.clientStore,["theme-trim"])),{},{maxWidth:"15%"}),children:"Author"}),Object(o.jsx)("th",{style:Object(Ie.a)(Object(Ie.a)({},ge(this.props.clientStore,["theme-trim"])),{},{maxWidth:"10%"}),children:"Status"}),Object(o.jsx)("th",{style:Object(Ie.a)(Object(Ie.a)({},ge(this.props.clientStore,["theme-trim"])),{},{maxWidth:"20%"}),children:"Actions"})]})}),Object(o.jsx)("tbody",{children:j.keys(ut).sort().map((function(n){var r,a,c=t.getStatus(n),u=[];c===nt.ENABLED?(r=function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.disable(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a="Disable"):c===nt.DISABLED&&(r=function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.enable(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a="Enable"),a&&u.push(Object(o.jsx)("div",{onClick:r,className:"btn",style:Object(Ie.a)(Object(Ie.a)({},ge(e.props.clientStore,["theme-trim"])),{},{width:60}),children:a},a));var h,l="inherit";c===nt.ENABLED?l="green":c===nt.ENABLING||c===nt.DISABLING?l="yellow":c!==nt.UNREGISTERED&&c!==nt.DISABLED||(l="red"),c===nt.ENABLED?h="Enabled":c===nt.ENABLING?h="Enabling":c===nt.DISABLED?h="Disabled":c===nt.DISABLING?h="Disabling":c===nt.UNREGISTERED&&(h="Unregistered");var p=function(e){return ut[e]}(n)||{},f={padding:5};return Object(o.jsxs)("tr",{style:Object(Ie.a)({},ge(e.props.clientStore,["theme-bg-secondary"])),children:[Object(o.jsx)("td",{className:"center plugin-name",style:Object(Ie.a)(Object(Ie.a)({},ge(e.props.clientStore,["theme-trim"])),f),children:n}),Object(o.jsx)("td",{style:Object(Ie.a)(Object(Ie.a)(Object(Ie.a)({},ge(e.props.clientStore,["theme-trim"])),f),{},{fontSize:12}),children:p.description||""}),Object(o.jsx)("td",{className:"center",style:Object(Ie.a)(Object(Ie.a)({},ge(e.props.clientStore,["theme-trim"])),f),children:(p.dependencies||[]).join(", ")}),Object(o.jsx)("td",{className:"center",style:Object(Ie.a)(Object(Ie.a)({},ge(e.props.clientStore,["theme-trim"])),f),children:(p.version||"")+""}),Object(o.jsx)("td",{className:"center",style:Object(Ie.a)(Object(Ie.a)(Object(Ie.a)({},ge(e.props.clientStore,["theme-trim"])),f),{},{fontSize:12}),children:p.author||""}),Object(o.jsx)("td",{className:"center",style:Object(Ie.a)(Object(Ie.a)(Object(Ie.a)({},ge(e.props.clientStore,["theme-trim"])),f),{},{boxShadow:"inset 0px 0px 0px 2px ".concat(l)}),children:h}),Object(o.jsx)("td",{className:"center",style:Object(Ie.a)(Object(Ie.a)({},ge(e.props.clientStore,["theme-trim"])),f),children:u})]},n)}))})]})}}]),n}(h.Component),Rn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;Object(g.a)(this,n),r=t.call(this,e);var a=e.clientStore;return r.state={backendType:e.initialBackendType,firebaseId:a.getDocSetting("firebaseId")||"",firebaseApiKey:a.getDocSetting("firebaseApiKey")||"",firebaseUserEmail:a.getDocSetting("firebaseUserEmail")||"",firebaseUserPassword:a.getDocSetting("firebaseUserPassword")||"",socketServerHost:a.getDocSetting("socketServerHost")||"",socketServerPassword:a.getDocSetting("socketServerPassword")||"",socketServerDocument:a.getDocSetting("socketServerDocument")||""},r}return Object(N.a)(n,[{key:"saveDataSettings",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props.clientStore,n=this.state.backendType,t.setDocSetting("dataSource",n),"firebase"===n?(t.setDocSetting("firebaseId",this.state.firebaseId),t.setDocSetting("firebaseApiKey",this.state.firebaseApiKey),t.setDocSetting("firebaseUserEmail",this.state.firebaseUserEmail),t.setDocSetting("firebaseUserPassword",this.state.firebaseUserPassword)):"socketserver"===n&&(t.setDocSetting("socketServerHost",this.state.socketServerHost),t.setDocSetting("socketServerPassword",this.state.socketServerPassword),t.setDocSetting("socketServerDocument",this.state.socketServerDocument)),window.location.reload();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setBackendType",value:function(e){this.setState({backendType:e})}},{key:"setFirebaseId",value:function(e){this.setState({firebaseId:e})}},{key:"setFirebaseApiKey",value:function(e){this.setState({firebaseApiKey:e})}},{key:"setFirebaseUserEmail",value:function(e){this.setState({firebaseUserEmail:e})}},{key:"setFirebaseUserPassword",value:function(e){this.setState({firebaseUserPassword:e})}},{key:"setSocketServerHost",value:function(e){this.setState({socketServerHost:e})}},{key:"setSocketServerPassword",value:function(e){this.setState({socketServerPassword:e})}},{key:"setSocketServerDocument",value:function(e){this.setState({socketServerDocument:e})}},{key:"render",value:function(){var e=this,t="https://console.firebase.google.com/project/".concat(this.state.firebaseId||"${firebaseProjectId}"),n=[{name:"HTML5 Local Storage (default)",type:"Local",value:"local",info:"\n          Stores data on your computer, through standard browser APIs.\n          No backups, so you should export regularly.\n          Clearing local storage will result in data loss.\n        "},{name:"In-memory",type:"Local",value:"inmemory",info:"\n          Not saved at all!\n          Data loss as soon as you close the tab.\n          Good for testing with complete throw-away data.\n        "},{name:"Firebase",type:"Remote",value:"firebase",info:Object(o.jsxs)("div",{children:["Stores data in Google's Firebase cloud service. Regular backups can be turned on."," ",Object(o.jsx)("a",{href:"https://github.com/WuTheFWasThat/vimflowy/tree/master/docs/storage/Firebase.md",children:"Details here"}),"."]}),config:Object(o.jsxs)("div",{children:["For details on configuration, ",Object(o.jsx)("a",{href:"https://github.com/WuTheFWasThat/vimflowy/tree/master/docs/storage/firebase.md",children:"see here"}),".",Object(o.jsx)("br",{}),Object(o.jsx)("table",{children:Object(o.jsxs)("tbody",{children:[Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:"Firebase ID"}),Object(o.jsx)("td",{children:Object(o.jsx)("input",{type:"text",value:this.state.firebaseId,placeholder:"e.g. something-fiery-2222",onChange:function(t){return e.setFirebaseId(t.target.value)},style:{float:"right"}})})]}),Object(o.jsxs)("tr",{children:[Object(o.jsxs)("td",{children:["Firebase API Key (found "," ",Object(o.jsx)("a",{href:"".concat(t,"/settings/general/"),children:"here"}),")"]}),Object(o.jsx)("td",{children:Object(o.jsx)("input",{type:"text",value:this.state.firebaseApiKey,placeholder:"should be a long string of alphanumeric digits and dashes",onChange:function(t){return e.setFirebaseApiKey(t.target.value)},style:{float:"right"}})})]}),Object(o.jsxs)("tr",{children:[Object(o.jsxs)("td",{children:["Firebase User Email (added "," ",Object(o.jsx)("a",{href:"".concat(t,"/authentication/users"),children:"here"}),")"]}),Object(o.jsx)("td",{children:Object(o.jsx)("input",{type:"text",value:this.state.firebaseUserEmail,onChange:function(t){return e.setFirebaseUserEmail(t.target.value)},style:{float:"right"}})})]}),Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:"Firebase User Password"}),Object(o.jsx)("td",{children:Object(o.jsx)("input",{type:"password",value:this.state.firebaseUserPassword,onChange:function(t){return e.setFirebaseUserPassword(t.target.value)},style:{float:"right"}})})]})]})}),Object(o.jsx)("br",{})]})},{name:"Vimflowy server",type:"Remote",value:"socketserver",info:"\n          Client talks to a server over websockets.\n          Server stores data in SQLite.\n        ",config:Object(o.jsxs)("div",{children:["For details on configuration, ",Object(o.jsx)("a",{href:"https://github.com/WuTheFWasThat/vimflowy/tree/master/docs/storage/socket_server.md",children:"see here"}),".",Object(o.jsx)("br",{}),Object(o.jsx)("table",{children:Object(o.jsxs)("tbody",{children:[Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:"Server"}),Object(o.jsx)("td",{children:Object(o.jsx)("input",{type:"text",value:this.state.socketServerHost,placeholder:"e.g. ws://localhost:3000 or wss://54.0.0.1:3000",onChange:function(t){return e.setSocketServerHost(t.target.value)},style:{float:"right"}})})]}),Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:"Password"}),Object(o.jsx)("td",{children:Object(o.jsx)("input",{type:"password",value:this.state.socketServerPassword,onChange:function(t){return e.setSocketServerPassword(t.target.value)},style:{float:"right"}})})]}),Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:"Document"}),Object(o.jsx)("td",{children:Object(o.jsx)("input",{type:"text",value:this.state.socketServerDocument,onChange:function(t){return e.setSocketServerDocument(t.target.value)},style:{float:"right"}})})]})]})}),Object(o.jsx)("br",{})]})}];return Object(o.jsxs)("div",{children:[Object(o.jsxs)("div",{style:{marginBottom:10},children:[Object(o.jsx)("b",{children:" Local "})," data sources:",Object(o.jsxs)("ul",{children:[Object(o.jsx)("li",{children:"Offline access supported"}),Object(o.jsx)("li",{children:"Data is never sent over the internet"}),Object(o.jsx)("li",{children:"Can only be accessed from this browser"})]})]}),Object(o.jsxs)("div",{style:{marginBottom:10},children:[Object(o.jsx)("b",{children:" Remote "})," data sources:",Object(o.jsxs)("ul",{children:[Object(o.jsx)("li",{children:"Can be accessed from multiple devices or browsers"}),Object(o.jsx)("li",{children:"No offline support"})]})]}),Object(o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[Object(o.jsx)("thead",{children:Object(o.jsxs)("tr",{children:[Object(o.jsx)("th",{}),Object(o.jsx)("th",{style:Object(Ie.a)({padding:10},ge(this.props.clientStore,["theme-trim"])),children:"Storage Type"}),Object(o.jsx)("th",{style:Object(Ie.a)({padding:10},ge(this.props.clientStore,["theme-trim"])),children:"Local/Remote"}),Object(o.jsx)("th",{style:Object(Ie.a)({padding:10},ge(this.props.clientStore,["theme-trim"])),children:"Info"})]})}),Object(o.jsx)("tbody",{children:function(){var t=[];return n.forEach((function(n){var r=e.state.backendType===n.value;t.push(Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{style:{padding:10},children:Object(o.jsx)("input",{type:"radio",name:"backendType",value:n.value,checked:r,readOnly:!0,onClick:function(t){return e.setBackendType(t.target.value)}})}),Object(o.jsx)("td",{style:{padding:10},children:Object(o.jsx)("b",{children:n.name})}),Object(o.jsx)("td",{style:{padding:10},children:n.type}),Object(o.jsx)("td",{style:{padding:10},children:n.info})]},n.value)),r&&n.config&&t.push(Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{}),Object(o.jsx)("td",{colSpan:999,children:n.config})]},"selected"))})),t}()})]}),Object(o.jsx)("div",{className:"btn",style:Object(Ie.a)({},ge(this.props.clientStore,["theme-bg-tertiary","theme-trim"])),onClick:function(){return e.saveDataSettings()},children:"Load Data Settings"}),Object(o.jsx)("h5",{style:{display:"inline-block"},children:"(WARNING: will reload page)"})]})}}]),n}(h.Component),Dn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).id=void 0,r.id="fileinput.".concat(Math.random()),r}return Object(N.a)(n,[{key:"handleChange",value:function(e){var t=this,n=e.target.files[0];n&&(this.props.onSelect&&this.props.onSelect(n.name),function(e){return new Promise((function(t,n){var r=new FileReader;r.readAsText(e,"UTF-8"),r.onload=function(n){var r=n.target.result;return t({name:e.name,contents:r})},r.onerror=function(e){n("Failed to reading file: ".concat(e))}}))}(n).then((function(e){var n=e.name,r=e.contents;t.props.onLoad&&t.props.onLoad(n,r),u()("#".concat(t.id)).val("")})).catch((function(e){t.props.onError&&t.props.onError(e),u()("#".concat(t.id)).val("")})))}},{key:"render",value:function(){var e=this;return Object(o.jsxs)("div",{style:this.props.style||{position:"relative"},children:[Object(o.jsx)("input",{type:"file",id:this.id,style:{position:"absolute",opacity:0,width:"100%",height:"100%",zIndex:1,cursor:"pointer"},onChange:function(t){return e.handleChange(t)}}),this.props.children]})}}]),n}(h.Component),En=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;Object(g.a)(this,n),r=t.call(this,e);var a=e.clientStore;return r.state={copyToClipboard:a.getClientSetting("copyToClipboard"),formattedCopy:a.getClientSetting("formattedCopy")},r.setCopyToClipboard=r.setCopyToClipboard.bind(Object(Ge.a)(r)),r.setFormattedCopy=r.setFormattedCopy.bind(Object(Ge.a)(r)),r}return Object(N.a)(n,[{key:"setCopyToClipboard",value:function(e){return this.setState({copyToClipboard:e}),this.props.clientStore.setClientSetting("copyToClipboard",e),this.state.copyToClipboard}},{key:"setFormattedCopy",value:function(e){return this.setState({formattedCopy:e}),this.props.clientStore.setClientSetting("formattedCopy",e),this.state.formattedCopy}},{key:"render",value:function(){return Object(o.jsxs)("div",{style:{fontSize:"1.3em"},children:[Object(o.jsx)(An,{id:"copyToClipboard",fn:this.setCopyToClipboard,checked:this.state.copyToClipboard,name:"Copy to system clipboard",desc:"copy yanked text to system clipboard"}),Object(o.jsx)(An,{id:"formattedCopy",fn:this.setFormattedCopy,checked:this.state.formattedCopy,name:"Formatted block copy",desc:"format with indents and hyphens when copying bullets with children to system clipboard"})]})}}]),n}(h.Component),An=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"render",value:function(){var e=this;return Object(o.jsxs)("div",{style:{fontSize:"0.9em",marginBottom:"0.3em"},children:[Object(o.jsx)("input",{type:"checkbox",id:this.props.id,checked:this.props.checked,onChange:function(t){e.props.fn(t.target.checked)}}),Object(o.jsxs)("label",{htmlFor:this.props.id,style:{marginLeft:"0.5rem"},children:[this.props.name+" - ",Object(o.jsx)("span",{style:{fontSize:"0.9em"},children:this.props.desc})]})]})}}]),n}(h.Component);function Tn(e){var t={};return Object.keys(je.Default).forEach((function(n){t[n]=e.getClientSetting(n)})),t}!function(e){e[e.DATA=0]="DATA",e[e.THEME=1]="THEME",e[e.BEHAVIOR=2]="BEHAVIOR",e[e.HOTKEYS=3]="HOTKEYS",e[e.PLUGIN=4]="PLUGIN",e[e.ABOUT=5]="ABOUT"}(xn||(xn={}));var Mn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(e){var r;return Object(g.a)(this,n),(r=t.call(this,e)).keyBindingsUpdate=void 0,r.preview_session=null,r.preview_menu=null,r.initial_theme=void 0,r.state={currentTab:xn.DATA,themeProperty:"theme-bg-primary",presetTheme:"Default"},r.keyBindingsUpdate=function(){r.forceUpdate()},r.initial_theme=Tn(e.session.clientStore),Object(i.a)(s.a.mark((function e(){var t,n,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e,t){for(var n={},r=e;r<=t;r++)n[r]=!0;return n},t=new it(new Te(new Pe)),e.next=4,t.load([{text:"Preview document",children:[{text:"Breadcrumbs",children:[{text:"Header",children:["This is a preview document","This is a link: http://www.google.com","Here is a visual selection"]}]}]}]);case 4:return r.preview_session=new _t(r.props.session.clientStore,t,{viewRoot:rt.loadFromAncestry([1,2,3])}),n=rt.loadFromAncestry([1,2,3,6]),e.next=8,r.preview_session.cursor.setPosition(n,10);case 8:return e.next=10,r.preview_session.setMode("VISUAL");case 10:return e.next=12,r.preview_session.anchor.setPosition(n,4);case 12:return r.preview_session.document.cache.clear(),r.preview_menu=new Ft(function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[{contents:"Some blah result".split(""),renderOptions:{accents:a(5,8)},fn:function(){return null}},{contents:"Another blah result".split(""),renderOptions:{accents:a(8,11)},fn:function(){return null}}]);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=16,r.preview_menu.session.addCharsAtCursor("blah".split(""));case 16:return e.next=18,r.preview_menu.update();case 18:r.forceUpdate();case 19:case"end":return e.stop()}}),e)})))(),r}return Object(N.a)(n,[{key:"componentDidMount",value:function(){this.props.keyBindings.on("update",this.keyBindingsUpdate)}},{key:"componentWillUnmount",value:function(){this.props.keyBindings.off("update",this.keyBindingsUpdate)}},{key:"render",value:function(){var e=this,t=this.props.session,n=this.props.keyBindings,r=function(){e.preview_session&&e.preview_session.document.cache.clear(),e.props.rerenderAll()},a=function(e){Object.keys(e).forEach((function(n){t.clientStore.setClientSetting(n,e[n])})),r()},c=function(n,r){var a=t.clientStore.getClientSetting("theme-bg-primary"),s=parseInt(a.substring(1),16),i=.2126*(s>>16&255)+.7152*(s>>8&255)+.0722*(s>>0&255),c={fontSize:11,padding:10,cursor:"pointer"};return r===e.state.themeProperty&&Object.assign(c,ge(t.clientStore,["theme-bg-highlight"])),Object(o.jsxs)("tr",{style:c,onClick:function(){return e.setState({themeProperty:r})},children:[Object(o.jsx)("td",{style:{width:"50px",border:"1px solid ".concat(i>40?"black":"white"),backgroundColor:t.clientStore.getClientSetting(r)}}),Object(o.jsxs)("td",{style:{paddingLeft:10},children:[" ",n," "]})]})},u=[{tab:xn.DATA,heading:"Data",div:Object(o.jsxs)("div",{children:[It.socketserver?Object(o.jsx)("div",{style:Object(Ie.a)({marginBottom:20,padding:10},ge(t.clientStore,["theme-trim-accent"])),children:"NOTE: Since you are using a Vimflowy server, you can simply back up the data server-side, assuming you have access to the server."}):Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{className:"settings-header",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-secondary","theme-trim"])),children:"Data storage"}),Object(o.jsx)("div",{className:"settings-content",children:Object(o.jsx)(Rn,{clientStore:t.clientStore,initialBackendType:this.props.initialBackendType})})]}),Object(o.jsx)("div",{className:"settings-header",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-secondary","theme-trim"])),children:"Export Data"}),Object(o.jsx)("div",{className:"settings-content",children:Object(o.jsx)("table",{children:Object(o.jsxs)("tbody",{children:[Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:Object(o.jsx)("div",{className:"btn",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),onClick:function(){return t.exportFile("json")},children:"Export as JSON"})}),Object(o.jsx)("td",{children:"Best for vimflowy backups, re-imports preserving all features."})]}),Object(o.jsxs)("tr",{children:[Object(o.jsx)("td",{children:Object(o.jsx)("div",{className:"btn",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),onClick:function(){return t.exportFile("txt")},children:"Export as plaintext"})}),Object(o.jsx)("td",{children:"Workflowy compatible. Does not support all features (e.g. vimflowy's marks/clones, or workflowy's tags, etc.)"})]})]})})}),Object(o.jsx)("div",{className:"settings-header",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-secondary","theme-trim"])),children:"Import Data"}),Object(o.jsx)("div",{className:"settings-content",children:Object(o.jsx)(Dn,{onSelect:function(e){t.showMessage("Reading in file ".concat(e,"..."))},onLoad:function(){var e=Object(i.a)(s.a.mark((function e(n,r){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=w(n)){e.next=4;break}return t.showMessage("Invalid filetype!",{time:0}),e.abrupt("return");case 4:return t.showMessage("Importing contents...",{time:0}),e.next=7,t.importContent(r,a);case 7:if(!e.sent){e.next=13;break}return t.showMessage("Imported!",{text_class:"success"}),e.next=11,t.setMode("NORMAL");case 11:e.next=14;break;case 13:t.showMessage("Import failed due to parsing issue",{text_class:"error"});case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),onError:function(e){I.error("Data file input error",e),t.showMessage("Error reading data: ".concat(e),{text_class:"error"})},children:Object(o.jsx)("div",{className:"btn",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),children:"Import from file"})})})]})},{tab:xn.THEME,heading:"Visual theme",div:Object(o.jsxs)("div",{style:{display:"flex"},children:[Object(o.jsxs)("div",{style:{padding:5,flexBasis:1,flexGrow:1},children:[Object(o.jsx)("div",{className:"settings-header",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-secondary","theme-trim"])),children:"Colors"}),Object(o.jsxs)("div",{className:"settings-content",style:{display:"flex"},children:[Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{style:{paddingTop:10},children:Object(o.jsx)("table",{style:{borderCollapse:"collapse"},children:Object(o.jsxs)("tbody",{children:[c("Main background color","theme-bg-primary"),c("Secondary background color","theme-bg-secondary"),c("Tertiary background color","theme-bg-tertiary"),c("Highlight background color","theme-bg-highlight"),c("Main text color","theme-text-primary"),c("Accented text color","theme-text-accent"),c("Trim color","theme-trim"),c("Accented trim color","theme-trim-accent"),c("Cursor text color","theme-text-cursor"),c("Cursor background color","theme-bg-cursor"),c("Link text color","theme-text-link")]})})}),Object(o.jsxs)("div",{style:{padding:10},children:[Object(o.jsx)("span",{className:"btn",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),onClick:function(){return a(e.initial_theme)},children:"Reset"}),Object(o.jsx)("span",{className:"btn",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),onClick:function(){x("vimflowy_colors.json",JSON.stringify(Tn(t.clientStore)),"application/json")},children:"Download"})]}),Object(o.jsxs)("div",{children:[Object(o.jsx)("select",{value:this.state.presetTheme,onChange:function(t){var n=t.target.value;e.setState({presetTheme:n})},children:Object.keys(je).map((function(e){return Object(o.jsx)("option",{value:e,children:e},e)}))}),Object(o.jsx)("span",{className:"btn",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),onClick:function(){return a(je[e.state.presetTheme])},children:"Apply preset theme"}),Object(o.jsx)("div",{style:{marginTop:5},children:Object(o.jsx)(Dn,{onSelect:function(e){t.showMessage("Reading in file ".concat(e,"..."))},onLoad:function(e,n){var r;try{r=JSON.parse(n)}catch(s){return void t.showMessage("Failed to parse JSON: ".concat(s),{text_class:"error"})}a(r)},onError:function(e){I.error("Theme file input error",e),t.showMessage("Error reading theme: ".concat(e),{text_class:"error"})},style:{float:"left",position:"relative"},children:Object(o.jsx)("div",{className:"btn",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),children:"Import theme from file"})})})]})]}),Object(o.jsx)("div",{style:{marginLeft:50},children:Object(o.jsx)(wn.a,{color:t.clientStore.getClientSetting(this.state.themeProperty),onChangeComplete:function(n){var a=n.hex;t.clientStore.setClientSetting(e.state.themeProperty,a),r()}})})]})]}),Object(o.jsxs)("div",{style:{padding:5,flexBasis:1,flexGrow:1},children:[Object(o.jsx)("div",{className:"settings-header",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-secondary","theme-trim"])),children:"Preview"}),Object(o.jsx)("div",{className:"settings-content",style:Object(Ie.a)(Object(Ie.a)({},ge(t.clientStore,["theme-trim-accent"])),{},{padding:10,marginTop:10,pointerEvents:"none"}),children:this.preview_session?Object(o.jsx)(On,{session:this.preview_session}):Object(o.jsx)(mn,{})}),Object(o.jsx)("div",{className:"settings-content",style:Object(Ie.a)(Object(Ie.a)({},ge(t.clientStore,["theme-trim-accent"])),{},{padding:10,marginTop:10,pointerEvents:"none"}),children:this.preview_menu&&this.preview_session?Object(o.jsx)(Cn,{menu:this.preview_menu,session:this.preview_session}):Object(o.jsx)(mn,{})})]})]})},{tab:xn.BEHAVIOR,heading:"Yank behavior",div:Object(o.jsx)("div",{children:Object(o.jsx)("div",{className:"settings-content",children:Object(o.jsx)(En,{clientStore:t.clientStore})})})},{tab:xn.HOTKEYS,heading:"Hotkeys",div:Object(o.jsx)("div",{children:Object(o.jsxs)("div",{className:"settings-content",children:[Object(o.jsxs)("div",{className:"clearfix",style:{marginBottom:10},children:[Object(o.jsx)("div",{className:"btn",style:Object(Ie.a)({float:"left"},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),onClick:this.props.onExport,children:"Export as file"}),Object(o.jsx)("div",{className:"btn",style:Object(Ie.a)({float:"left"},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),onClick:function(){return n.setMappings(e.props.config.defaultMappings),t.showMessage("Loaded defaults!",{text_class:"success"})},children:"Load defaults"}),Object(o.jsx)(Dn,{onSelect:function(e){t.showMessage("Reading in file ".concat(e,"..."))},onLoad:function(e,r){var a;try{a=JSON.parse(r)}catch(i){return void t.showMessage("Failed to parse JSON: ".concat(i),{text_class:"error"})}var s=new de(a);n.setMappings(s),t.clientStore.setClientSetting("hotkeys",a)},onError:function(e){I.error("Hotkeys file input error",e),t.showMessage("Error reading hotkeys: ".concat(e),{text_class:"error"})},style:{float:"left",position:"relative"},children:Object(o.jsx)("div",{className:"btn",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-tertiary","theme-trim"])),children:"Import from file"})})]}),Object(o.jsx)("div",{children:Object.keys(F).map((function(e){return Object(o.jsxs)("div",{children:[e,Object(o.jsx)(_n,{keyMap:n.mappings.mappings[e],definitions:n.definitions,clientStore:t.clientStore})]},e)}))})]})})},{tab:xn.PLUGIN,heading:"Plugins",div:Object(o.jsx)(Sn,{clientStore:t.clientStore,pluginManager:this.props.pluginManager})},{tab:xn.ABOUT,heading:"About",div:Object(o.jsxs)("div",{children:["For more info, or to contact the maintainers, please visit"," ",Object(o.jsx)("a",{href:"https://github.com/WuTheFWasThat/vimflowy",style:Object(Ie.a)({},ge(t.clientStore,["theme-link"])),children:"the github website"}),"."]})}];return Object(o.jsxs)("div",{children:[Object(o.jsx)("ul",{className:"tabs",style:Object(Ie.a)({margin:20},ge(t.clientStore,["theme-bg-primary"])),children:j.map(u,(function(n){var r=n.tab===e.state.currentTab;return Object(o.jsx)("li",{className:r?"active":"",style:Object(Ie.a)({},ge(t.clientStore,["theme-bg-secondary","theme-trim"])),onClick:function(){return e.setState({currentTab:n.tab})},children:n.heading},n.tab)}))}),j.map(u,(function(t){var n=t.tab===e.state.currentTab;return Object(o.jsx)("div",{className:n?"":"hidden",style:{padding:20},children:t.div},t.tab)}))]})}}]),n}(h.Component),Nn=function(e){Object(k.a)(n,e);var t=Object(m.a)(n);function n(){return Object(g.a)(this,n),t.apply(this,arguments)}return Object(N.a)(n,[{key:"render",value:function(){var e,t=this;if(null!==this.props.error)return e=this.props.error instanceof R?Object(o.jsx)("div",{children:this.props.error.message}):Object(o.jsxs)("div",{children:["An unexpected error was caught!",Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),"Please help out Vimflowy and report the bug. Report the issue "," ",Object(o.jsx)("a",{href:"https://github.com/WuTheFWasThat/vimflowy/issues/new",children:"here"})," "," with:",Object(o.jsxs)("ul",{children:[Object(o.jsx)("li",{children:"a description of what you did"}),Object(o.jsx)("li",{children:"a copy of the Javascript console output (ideally, but be careful if data privacy is important)"}),Object(o.jsx)("li",{children:"a copy of the following error message"})]}),Object(o.jsx)("h3",{children:"Error:"}),Object(o.jsxs)("pre",{style:{marginLeft:20},children:[this.props.error.message,Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),this.props.error.stack]}),Object(o.jsx)("br",{}),"Refresh the page to continue."]}),Object(o.jsx)("div",{style:{padding:50},children:e});var n=this.props.pluginManager,r=this.props.session,a=this.props.keyBindings,c="SETTINGS"===r.mode,u=this.props.message||{},h=this.props.saveMessage||{};return Object(o.jsxs)("div",{style:Object(Ie.a)({},ge(r.clientStore,["theme-text-primary"])),children:[Object(o.jsx)("div",{id:"paste-hack",contentEditable:!0,className:"offscreen"}),Object(o.jsxs)("div",{id:"contents",style:Object(Ie.a)({},ge(r.clientStore,["theme-bg-primary"])),children:[Object(o.jsx)("div",{id:"menu",className:"SEARCH"===r.mode?"":"hidden",children:r.menu?Object(o.jsx)(Cn,{menu:r.menu,session:r}):null}),Object(o.jsx)("div",{id:"view",style:Object(Ie.a)({flex:"1 1 auto",fontSize:10},ge(r.clientStore,["theme-bg-primary"])),className:"SEARCH"===r.mode?" hidden":"",children:Object(o.jsx)(On,{session:r})}),Object(o.jsx)("div",{className:"transition-ease-width",style:Object(Ie.a)({overflowY:"auto",height:"100%",flex:"0 1 auto",position:"relative",width:this.props.showingKeyBindings?500:"0%"},ge(r.clientStore,["theme-bg-secondary"])),children:Object(o.jsx)(_n,{clientStore:r.clientStore,keyMap:a.mappings.mappings[r.mode],definitions:a.definitions,ignoreEmpty:!0})})]}),Object(o.jsx)("div",{id:"settings",className:c?"":"hidden",style:Object(Ie.a)({},ge(r.clientStore,["theme-bg-primary"])),children:Object(o.jsx)(Mn,{session:r,config:this.props.config,keyBindings:a,pluginManager:n,initialBackendType:this.props.initialBackendType,rerenderAll:function(){t.forceUpdate()},onExport:function(){var e="vimflowy_hotkeys.json";x(e,JSON.stringify(a.mappings.serialize(),null,2),"application/json"),r.showMessage("Downloaded hotkeys to ".concat(e,"!"),{text_class:"success"})}})}),Object(o.jsxs)("div",{id:"bottom-bar",style:Object(Ie.a)({display:"flex"},ge(r.clientStore,["theme-bg-primary","theme-trim"])),children:[Object(o.jsx)("a",{className:"center",onClick:Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.setMode(c?"NORMAL":"SETTINGS");case 2:case"end":return e.stop()}}),e)}))),style:Object(Ie.a)({flexBasis:100,flexGrow:0,cursor:"pointer",textDecoration:"none"},ge(r.clientStore,["theme-bg-secondary"])),children:Object(o.jsxs)("div",{children:[Object(o.jsx)("span",{style:{marginRight:10},className:"fa ".concat(c?"fa-arrow-left":"fa-cog")}),Object(o.jsx)("span",{children:c?"Back":"Settings"})]})}),Object(o.jsx)("div",{style:{flexBasis:0,flexGrow:1,overflowX:"hidden"},className:u.text_class,children:u.message}),Object(o.jsx)("div",{style:{flexBasis:0,flexGrow:0},className:h.text_class,children:h.message}),Object(o.jsx)("div",{className:"center",style:Object(Ie.a)({flexBasis:80,flexGrow:0},ge(r.clientStore,["theme-bg-secondary"])),children:K(r.mode).name})]})]})}}]),n}(h.Component),Ln=u()("#app")[0];function Pn(e,t){function n(n){n.clipboardData&&(t&&n.clipboardData.setData("text/html",t),n.clipboardData.setData("text/plain",e),n.preventDefault())}if(window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var r=document.createElement("textarea");r.textContent=e,r.style.position="fixed",document.body.appendChild(r),r.select();try{return document.addEventListener("copy",n),document.execCommand("copy")}catch(a){return console.warn("Copy to clipboard failed.",a),!1}finally{document.body.removeChild(r),document.removeEventListener("copy",n)}}return!1}l.render(Object(o.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"},children:[Object(o.jsx)("div",{style:{flexGrow:3}}),Object(o.jsxs)("div",{style:{textAlign:"center",alignSelf:"center",color:"#999"},children:[Object(o.jsx)("i",{className:"fa fa-5x fa-spin fa-spinner"}),Object(o.jsx)("p",{children:"Loading... this can take a minute the first time"})]}),Object(o.jsx)("div",{style:{flexGrow:8}})]}),Ln),u()(document).ready(Object(i.a)(s.a.mark((function e(){var t,n,a,c,h,p,v,x,w,g,k,m,y,j,O,C,_,S,R,D,A,T,M,N,L,P,B,H,F,U,V,z,W;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(z=function(){return(z=Object(i.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){l.render(Object(o.jsx)(Nn,{error:n,message:a,saveMessage:c,config:w,session:N,pluginManager:L,showingKeyBindings:C,keyBindings:R,initialBackendType:v}),Ln,e)}));case 2:(t=u()("#view .cursor")[0])&&d(t,u()("#view"),50);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)},V=function(){return z.apply(this,arguments)},M=function(){var e=u()(".node-text").height()||21;return E(e>0),e},j=function(){return(j=Object(i.a)(s.a.mark((function e(){var n,r,a,i,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(It.socketserver?(n=window.location.origin.replace(/^http/,"ws"),r=t,a=h.getDocSetting("socketServerPassword")):(n=h.getDocSetting("socketServerHost"),r=h.getDocSetting("socketServerDocument"),a=h.getDocSetting("socketServerPassword")),n){e.next=3;break}throw new Error("No socket server host found");case 3:i=new We,o=new Te(i);case 5:return e.prev=6,e.next=9,i.init(n,a||"",r||"");case 9:return e.abrupt("break",21);case 12:if(e.prev=12,e.t0=e.catch(6),"Wrong password!"!==e.t0){e.next=18;break}a=prompt(a?"Password incorrect!  Please try again: ":"Please enter the password",""),e.next=19;break;case 18:throw e.t0;case 19:e.next=5;break;case 21:return h.setDocSetting("socketServerPassword",a),I.info("Successfully initialized socked connection: ".concat(n)),e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,null,[[6,12]])})))).apply(this,arguments)},y=function(){return j.apply(this,arguments)},m=function(){return(m=Object(i.a)(s.a.mark((function e(){var n,r,a,i,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=h.getDocSetting("firebaseId"),r=h.getDocSetting("firebaseApiKey"),a=h.getDocSetting("firebaseUserEmail"),i=h.getDocSetting("firebaseUserPassword"),n){e.next=6;break}throw new Error("No firebase ID found");case 6:if(r){e.next=8;break}throw new Error("No firebase API key found");case 8:return o=new ze(t,n,r),c=new Te(o,t),e.next=12,o.init(a||"",i||"");case 12:return I.info("Successfully initialized firebase connection: ".concat(n)),e.abrupt("return",c);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)},k=function(){return m.apply(this,arguments)},g=function(){return new Te(new Ve(t),t)},""!==(t=b("doc")||"")&&(document.title="".concat(t," - Vimflowy")),n=null,a=null,c=null,window.onerror=function(e,t,r,a,s){I.error("Caught error: '".concat(e,"' from  ").concat(t,":").concat(r)),s?(I.error("Error: ",e,s,s.stack,JSON.stringify(s)),n=s):(I.error("Error: ",e,JSON.stringify(e)),n=new Error(e)),V()},"undefined"===typeof localStorage||null===localStorage?(alert("You need local storage support for data to be persisted!"),h=new Se(new Le),v="inmemory"):(h=new Se(new Ue,t),v=It.socketserver?"socketserver":h.getDocSetting("dataSource")),w=Pt,"firebase"!==v){e.next=31;break}return e.prev=18,e.next=21,k();case 21:p=e.sent,e.next=29;break;case 24:e.prev=24,e.t0=e.catch(18),alert("\n        Error loading firebase datastore:\n\n        ".concat(e.t0.message,"\n\n        ").concat(e.t0.stack,"\n\n        Falling back to localStorage default.\n      ")),p=g(),v="local";case 29:e.next=52;break;case 31:if("inmemory"!==v){e.next=35;break}p=new Te(new Pe),e.next=52;break;case 35:if("socketserver"!==v){e.next=50;break}return e.prev=36,e.next=39,y();case 39:p=e.sent,e.next=48;break;case 42:e.prev=42,e.t1=e.catch(36),alert("\n        Error loading socket server datastore:\n\n        ".concat(e.t1.message,"\n\n        ").concat(e.t1.stack,"\n\n        Falling back to localStorage default.\n      ")),h.setDocSetting("socketServerPassword",""),p=g(),v="local";case 48:e.next=52;break;case 50:p=g(),v="local";case 52:return x=new it(p,t),O=null,e.next=56,p.getChildren(rt.rootRow());case 56:if(e.t2=e.sent.length,0!==e.t2){e.next=59;break}O=w.getDefaultData();case 59:return C=h.getClientSetting("showKeyBindings"),x.store.events.on("saved",(function(){c={message:"Saved!",text_class:"text-success"},V()})),x.store.events.on("unsaved",(function(){c={message:"Saving....",text_class:"text-error"},V()})),_=h.getClientSetting("hotkeys"),S=de.merge(w.defaultMappings,new de(_)),R=new le(ue,S),e.next=67,x.hasChildren(x.root.row);case 67:if(e.sent){e.next=70;break}return e.next=70,x.loadEmpty();case 70:if(!(window.location.hash.length>1)){e.next=84;break}return e.prev=71,A=parseInt(window.location.hash.slice(1),10),e.next=75,x.isAttached(A);case 75:if(!e.sent){e.next=79;break}return e.next=78,x.canonicalPath(A);case 78:D=e.sent;case 79:e.next=84;break;case 81:e.prev=81,e.t3=e.catch(71),I.error("Invalid hash: ".concat(window.location.hash));case 84:if(D){e.next=90;break}return e.t4=rt,e.next=88,h.getLastViewRoot();case 88:e.t5=e.sent,D=e.t4.loadFromAncestry.call(e.t4,e.t5);case 90:if(e.t6=D.isRoot(),e.t6){e.next=95;break}return e.next=94,x.isValidPath(D);case 94:e.t6=!e.sent;case 95:if(!e.t6){e.next=103;break}return D=rt.root(),e.next=99,x.getChildren(D);case 99:T=e.sent[0],window.location.hash="",e.next=104;break;case 103:T=D;case 104:return N=new _t(h,x,{viewRoot:D,cursorPath:T,showMessage:function(){var e=null;return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.time,s=void 0===r?5e3:r,i=n.text_class,o=void 0===i?"":i;I.info("Showing message: ".concat(t)),a={message:t,text_class:o?"text-"+o:""},V(),null!==e&&clearTimeout(e),0!==s&&(e=window.setTimeout((function(){a=null,V()}),s))}}(),toggleBindingsDiv:function(){C=!C,h.setClientSetting("showKeyBindings",C),V()},getLinesPerPage:function(){var e=M();return u()(document).height()/e}}),L=new lt(N,w,R),e.next=108,p.getSetting("enabledPlugins");case 108:"undefined"===typeof(P=e.sent).slice&&(P=Object.keys(P)),B=0;case 111:if(!(B<P.length)){e.next=118;break}return H=P[B],e.next=115,L.enable(H);case 115:B++,e.next=111;break;case 118:if(null===O){e.next=130;break}return e.next=121,x.load(O);case 121:return e.t7=N.cursor,e.next=124,x.getChildren(D);case 124:return e.t8=e.sent[0],e.t7.setPosition.call(e.t7,e.t8,0),N.reset_history(),N.reset_jump_history(),e.next=130,V();case 130:return F=new fe(N,R),U=new re,window.Modes=r,window.session=N,window.logger=I,window.keyHandler=F,window.keyEmitter=U,window.keyBindings=R,window.renderMain=V,e.next=141,V();case 141:N.on("scroll",(function(e){var t=M();f(u()("#view"),t*e)})),N.on("yank",(function(e){if(h.getClientSetting("copyToClipboard")){var t,n;if(e.type===q.CHARS)t=e.saved.join(""),n=e.saved.join("");else{if(e.type!==q.SERIALIZED_ROWS){if(e.type===q.CLONED_ROWS)return;throw Error("Unexpected yank with invalid info ".concat(e))}var r=h.getClientSetting("formattedCopy"),a=[],s=["<ul>"],i={},o=function e(t,n){if("string"===typeof t)throw new Error("Expected non-pretty serialization");t.clone?t=i[t.clone]:i[t.id]=t,r?a.push(" ".repeat(4*n)+(t.collapsed?"+ ":"- ")+t.text):a.push(t.text),s.push("<li>"+t.text+"</li>"),!t.collapsed&&t.children&&(s.push("<ul>"),t.children.forEach((function(t){return e(t,n+1)})),s.push("</ul>"))};e.saved.forEach((function(e){return o(e,0)})),t=a.join("\n"),s.push("</ul>"),n=a.length<=1?t:s.join("\n")}Pn(t,n)}})),N.on("importFinished",V),N.on("changeViewRoot",function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.setLastViewRoot(t.getAncestry());case 2:window.location.hash="#".concat(t.row);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),U.listen(),U.on("keydown",(function(e){return F.queueKey(e),null!=R.bindings[N.mode].getKey(e)})),F.on("handledKey",V),N.on("modeChange",V),R.on("applied_hotkey_settings",(function(e){h.setClientSetting("hotkeys",e),V()})),L.on("status",V),L.on("enabledPluginsChange",(function(e){p.setSetting("enabledPlugins",e),V()})),(W=u()("#paste-hack")).focus(),u()(document).on("click",(function(){"SETTINGS"!==N.mode&&(window.getSelection().toString()||W.focus())})),u()(document).on("paste",function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("SETTINGS"!==N.mode){e.next=2;break}return e.abrupt("return");case 2:return t.preventDefault(),n=(n=(t.originalEvent||t).clipboardData.getData("text/plain")).replace(/(?:\r)/g,""),e.next=7,F.queue(Object(i.a)(s.a.mark((function e(){var t,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.split("\n"),r=0;case 2:if(!(r<t.length)){e.next=12;break}if(a=t[r],0===r){e.next=7;break}return e.next=7,N.newLineAtCursor();case 7:return e.next=9,N.addCharsAtCursor(a.split(""));case 9:r++,e.next=2;break;case 12:N.save();case 13:case"end":return e.stop()}}),e)}))));case 7:V();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),u()(window).on("unload",(function(){N.exit()}));case 157:case"end":return e.stop()}}),e,null,[[18,24],[36,42],[71,81]])}))))}},[[237,1,2]]]);
//# sourceMappingURL=main.463a6d47.chunk.js.map